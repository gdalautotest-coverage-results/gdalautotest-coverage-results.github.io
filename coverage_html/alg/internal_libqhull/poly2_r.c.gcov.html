<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - gdal_filtered.info - alg/internal_libqhull/poly2_r.c</title>
  <link rel="stylesheet" type="text/css" href="../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../../index.html">top level</a> - <a href="index.html">alg/internal_libqhull</a> - poly2_r.c<span style="font-size: 80%;"> (source / <a href="poly2_r.c.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">gdal_filtered.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">717</td>
            <td class="headerCovTableEntry">1982</td>
            <td class="headerCovTableEntryLo">36.2 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2025-11-01 14:18:55</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">31</td>
            <td class="headerCovTableEntry">59</td>
            <td class="headerCovTableEntryLo">52.5 %</td>
          </tr>
          <tr><td><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : /*&lt;html&gt;&lt;pre&gt;  -&lt;a                             href=&quot;qh-poly_r.htm&quot;</a>
<a name="2"><span class="lineNum">       2 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;TOP&quot;&gt;-&lt;/a&gt;</a>
<a name="3"><span class="lineNum">       3 </span>            : </a>
<a name="4"><span class="lineNum">       4 </span>            :    poly2_r.c</a>
<a name="5"><span class="lineNum">       5 </span>            :    implements polygons and simplicies</a>
<a name="6"><span class="lineNum">       6 </span>            : </a>
<a name="7"><span class="lineNum">       7 </span>            :    see qh-poly_r.htm, poly_r.h and libqhull_r.h</a>
<a name="8"><span class="lineNum">       8 </span>            : </a>
<a name="9"><span class="lineNum">       9 </span>            :    frequently used code is in poly_r.c</a>
<a name="10"><span class="lineNum">      10 </span>            : </a>
<a name="11"><span class="lineNum">      11 </span>            :    Copyright (c) 1993-2020 The Geometry Center.</a>
<a name="12"><span class="lineNum">      12 </span>            :    $Id: //main/2019/qhull/src/libqhull_r/poly2_r.c#20 $$Change: 2953 $</a>
<a name="13"><span class="lineNum">      13 </span>            :    $DateTime: 2020/05/21 22:05:32 $$Author: bbarber $</a>
<a name="14"><span class="lineNum">      14 </span>            : */</a>
<a name="15"><span class="lineNum">      15 </span>            : </a>
<a name="16"><span class="lineNum">      16 </span>            : #include &quot;qhull_ra.h&quot;</a>
<a name="17"><span class="lineNum">      17 </span>            : </a>
<a name="18"><span class="lineNum">      18 </span>            : /*======== functions in alphabetical order ==========*/</a>
<a name="19"><span class="lineNum">      19 </span>            : </a>
<a name="20"><span class="lineNum">      20 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="21"><span class="lineNum">      21 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;addfacetvertex&quot;&gt;-&lt;/a&gt;</a>
<a name="22"><span class="lineNum">      22 </span>            : </a>
<a name="23"><span class="lineNum">      23 </span>            :   qh_addfacetvertex(qh, facet, newvertex )</a>
<a name="24"><span class="lineNum">      24 </span>            :     add newvertex to facet.vertices if not already there</a>
<a name="25"><span class="lineNum">      25 </span>            :     vertices are inverse sorted by vertex-&gt;id</a>
<a name="26"><span class="lineNum">      26 </span>            : </a>
<a name="27"><span class="lineNum">      27 </span>            :   returns:</a>
<a name="28"><span class="lineNum">      28 </span>            :     True if new vertex for facet</a>
<a name="29"><span class="lineNum">      29 </span>            : </a>
<a name="30"><span class="lineNum">      30 </span>            :   notes:</a>
<a name="31"><span class="lineNum">      31 </span>            :     see qh_replacefacetvertex</a>
<a name="32"><span class="lineNum">      32 </span>            : */</a>
<a name="33"><span class="lineNum">      33 </span><span class="lineCov">          1 : boolT qh_addfacetvertex(qhT *qh, facetT *facet, vertexT *newvertex) {</span></a>
<a name="34"><span class="lineNum">      34 </span>            :   vertexT *vertex;</a>
<a name="35"><span class="lineNum">      35 </span><span class="lineCov">          1 :   int vertex_i= 0, vertex_n;</span></a>
<a name="36"><span class="lineNum">      36 </span><span class="lineCov">          1 :   boolT isnew= True;</span></a>
<a name="37"><span class="lineNum">      37 </span>            : </a>
<a name="38"><span class="lineNum">      38 </span><span class="lineCov">          4 :   FOREACHvertex_i_(qh, facet-&gt;vertices) {</span></a>
<a name="39"><span class="lineNum">      39 </span><span class="lineCov">          3 :     if (vertex-&gt;id &lt; newvertex-&gt;id) {</span></a>
<a name="40"><span class="lineNum">      40 </span><span class="lineNoCov">          0 :       break;</span></a>
<a name="41"><span class="lineNum">      41 </span><span class="lineCov">          3 :     }else if (vertex-&gt;id == newvertex-&gt;id) {</span></a>
<a name="42"><span class="lineNum">      42 </span><span class="lineNoCov">          0 :       isnew= False;</span></a>
<a name="43"><span class="lineNum">      43 </span><span class="lineNoCov">          0 :       break;</span></a>
<a name="44"><span class="lineNum">      44 </span>            :     }</a>
<a name="45"><span class="lineNum">      45 </span>            :   }</a>
<a name="46"><span class="lineNum">      46 </span><span class="lineCov">          1 :   if (isnew)</span></a>
<a name="47"><span class="lineNum">      47 </span><span class="lineCov">          1 :     qh_setaddnth(qh, &amp;facet-&gt;vertices, vertex_i, newvertex);</span></a>
<a name="48"><span class="lineNum">      48 </span><span class="lineCov">          1 :   return isnew;</span></a>
<a name="49"><span class="lineNum">      49 </span>            : } /* addfacetvertex */</a>
<a name="50"><span class="lineNum">      50 </span>            : </a>
<a name="51"><span class="lineNum">      51 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="52"><span class="lineNum">      52 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;addhash&quot;&gt;-&lt;/a&gt;</a>
<a name="53"><span class="lineNum">      53 </span>            : </a>
<a name="54"><span class="lineNum">      54 </span>            :   qh_addhash( newelem, hashtable, hashsize, hash )</a>
<a name="55"><span class="lineNum">      55 </span>            :     add newelem to linear hash table at hash if not already there</a>
<a name="56"><span class="lineNum">      56 </span>            : */</a>
<a name="57"><span class="lineNum">      57 </span><span class="lineNoCov">          0 : void qh_addhash(void *newelem, setT *hashtable, int hashsize, int hash) {</span></a>
<a name="58"><span class="lineNum">      58 </span>            :   int scan;</a>
<a name="59"><span class="lineNum">      59 </span>            :   void *elem;</a>
<a name="60"><span class="lineNum">      60 </span>            : </a>
<a name="61"><span class="lineNum">      61 </span><span class="lineNoCov">          0 :   for (scan= (int)hash; (elem= SETelem_(hashtable, scan));</span></a>
<a name="62"><span class="lineNum">      62 </span><span class="lineNoCov">          0 :        scan= (++scan &gt;= hashsize ? 0 : scan)) {</span></a>
<a name="63"><span class="lineNum">      63 </span><span class="lineNoCov">          0 :     if (elem == newelem)</span></a>
<a name="64"><span class="lineNum">      64 </span><span class="lineNoCov">          0 :       break;</span></a>
<a name="65"><span class="lineNum">      65 </span>            :   }</a>
<a name="66"><span class="lineNum">      66 </span>            :   /* loop terminates because qh_HASHfactor &gt;= 1.1 by qh_initbuffers */</a>
<a name="67"><span class="lineNum">      67 </span><span class="lineNoCov">          0 :   if (!elem)</span></a>
<a name="68"><span class="lineNum">      68 </span><span class="lineNoCov">          0 :     SETelem_(hashtable, scan)= newelem;</span></a>
<a name="69"><span class="lineNum">      69 </span><span class="lineNoCov">          0 : } /* addhash */</span></a>
<a name="70"><span class="lineNum">      70 </span>            : </a>
<a name="71"><span class="lineNum">      71 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="72"><span class="lineNum">      72 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;check_bestdist&quot;&gt;-&lt;/a&gt;</a>
<a name="73"><span class="lineNum">      73 </span>            : </a>
<a name="74"><span class="lineNum">      74 </span>            :   qh_check_bestdist(qh)</a>
<a name="75"><span class="lineNum">      75 </span>            :     check that all points are within max_outside of the nearest facet</a>
<a name="76"><span class="lineNum">      76 </span>            :     if qh.ONLYgood,</a>
<a name="77"><span class="lineNum">      77 </span>            :       ignores !good facets</a>
<a name="78"><span class="lineNum">      78 </span>            : </a>
<a name="79"><span class="lineNum">      79 </span>            :   see:</a>
<a name="80"><span class="lineNum">      80 </span>            :     qh_check_maxout(), qh_outerinner()</a>
<a name="81"><span class="lineNum">      81 </span>            : </a>
<a name="82"><span class="lineNum">      82 </span>            :   notes:</a>
<a name="83"><span class="lineNum">      83 </span>            :     only called from qh_check_points()</a>
<a name="84"><span class="lineNum">      84 </span>            :       seldom used since qh.MERGING is almost always set</a>
<a name="85"><span class="lineNum">      85 </span>            :     if notverified&gt;0 at end of routine</a>
<a name="86"><span class="lineNum">      86 </span>            :       some points were well inside the hull.  If the hull contains</a>
<a name="87"><span class="lineNum">      87 </span>            :       a lens-shaped component, these points were not verified.  Use</a>
<a name="88"><span class="lineNum">      88 </span>            :       options 'Qi Tv' to verify all points.  (Exhaustive check also verifies)</a>
<a name="89"><span class="lineNum">      89 </span>            : </a>
<a name="90"><span class="lineNum">      90 </span>            :   design:</a>
<a name="91"><span class="lineNum">      91 </span>            :     determine facet for each point (if any)</a>
<a name="92"><span class="lineNum">      92 </span>            :     for each point</a>
<a name="93"><span class="lineNum">      93 </span>            :       start with the assigned facet or with the first facet</a>
<a name="94"><span class="lineNum">      94 </span>            :       find the best facet for the point and check all coplanar facets</a>
<a name="95"><span class="lineNum">      95 </span>            :       error if point is outside of facet</a>
<a name="96"><span class="lineNum">      96 </span>            : */</a>
<a name="97"><span class="lineNum">      97 </span><span class="lineNoCov">          0 : void qh_check_bestdist(qhT *qh) {</span></a>
<a name="98"><span class="lineNum">      98 </span><span class="lineNoCov">          0 :   boolT waserror= False, unassigned;</span></a>
<a name="99"><span class="lineNum">      99 </span><span class="lineNoCov">          0 :   facetT *facet, *bestfacet, *errfacet1= NULL, *errfacet2= NULL;</span></a>
<a name="100"><span class="lineNum">     100 </span>            :   facetT *facetlist;</a>
<a name="101"><span class="lineNum">     101 </span><span class="lineNoCov">          0 :   realT dist, maxoutside, maxdist= -REALmax;</span></a>
<a name="102"><span class="lineNum">     102 </span>            :   pointT *point;</a>
<a name="103"><span class="lineNum">     103 </span><span class="lineNoCov">          0 :   int numpart= 0, facet_i, facet_n, notgood= 0, notverified= 0;</span></a>
<a name="104"><span class="lineNum">     104 </span>            :   setT *facets;</a>
<a name="105"><span class="lineNum">     105 </span>            : </a>
<a name="106"><span class="lineNum">     106 </span><span class="lineNoCov">          0 :   trace1((qh, qh-&gt;ferr, 1020, &quot;qh_check_bestdist: check points below nearest facet.  Facet_list f%d\n&quot;,</span></a>
<a name="107"><span class="lineNum">     107 </span>            :       qh-&gt;facet_list-&gt;id));</a>
<a name="108"><span class="lineNum">     108 </span><span class="lineNoCov">          0 :   maxoutside= qh_maxouter(qh);</span></a>
<a name="109"><span class="lineNum">     109 </span><span class="lineNoCov">          0 :   maxoutside += qh-&gt;DISTround;</span></a>
<a name="110"><span class="lineNum">     110 </span>            :   /* one more qh.DISTround for check computation */</a>
<a name="111"><span class="lineNum">     111 </span><span class="lineNoCov">          0 :   trace1((qh, qh-&gt;ferr, 1021, &quot;qh_check_bestdist: check that all points are within %2.2g of best facet\n&quot;, maxoutside));</span></a>
<a name="112"><span class="lineNum">     112 </span><span class="lineNoCov">          0 :   facets= qh_pointfacet(qh /* qh.facet_list */);</span></a>
<a name="113"><span class="lineNum">     113 </span><span class="lineNoCov">          0 :   if (!qh_QUICKhelp &amp;&amp; qh-&gt;PRINTprecision)</span></a>
<a name="114"><span class="lineNum">     114 </span><span class="lineNoCov">          0 :     qh_fprintf(qh, qh-&gt;ferr, 8091, &quot;\n\</span></a>
<a name="115"><span class="lineNum">     115 </span>            : qhull output completed.  Verifying that %d points are\n\</a>
<a name="116"><span class="lineNum">     116 </span>            : below %2.2g of the nearest %sfacet.\n&quot;,</a>
<a name="117"><span class="lineNum">     117 </span><span class="lineNoCov">          0 :              qh_setsize(qh, facets), maxoutside, (qh-&gt;ONLYgood ?  &quot;good &quot; : &quot;&quot;));</span></a>
<a name="118"><span class="lineNum">     118 </span><span class="lineNoCov">          0 :   FOREACHfacet_i_(qh, facets) {  /* for each point with facet assignment */</span></a>
<a name="119"><span class="lineNum">     119 </span><span class="lineNoCov">          0 :     if (facet)</span></a>
<a name="120"><span class="lineNum">     120 </span><span class="lineNoCov">          0 :       unassigned= False;</span></a>
<a name="121"><span class="lineNum">     121 </span>            :     else {</a>
<a name="122"><span class="lineNum">     122 </span><span class="lineNoCov">          0 :       unassigned= True;</span></a>
<a name="123"><span class="lineNum">     123 </span><span class="lineNoCov">          0 :       facet= qh-&gt;facet_list;</span></a>
<a name="124"><span class="lineNum">     124 </span>            :     }</a>
<a name="125"><span class="lineNum">     125 </span><span class="lineNoCov">          0 :     point= qh_point(qh, facet_i);</span></a>
<a name="126"><span class="lineNum">     126 </span><span class="lineNoCov">          0 :     if (point == qh-&gt;GOODpointp)</span></a>
<a name="127"><span class="lineNum">     127 </span><span class="lineNoCov">          0 :       continue;</span></a>
<a name="128"><span class="lineNum">     128 </span><span class="lineNoCov">          0 :     qh_distplane(qh, point, facet, &amp;dist);</span></a>
<a name="129"><span class="lineNum">     129 </span><span class="lineNoCov">          0 :     numpart++;</span></a>
<a name="130"><span class="lineNum">     130 </span><span class="lineNoCov">          0 :     bestfacet= qh_findbesthorizon(qh, !qh_IScheckmax, point, facet, qh_NOupper, &amp;dist, &amp;numpart);</span></a>
<a name="131"><span class="lineNum">     131 </span>            :     /* occurs after statistics reported */</a>
<a name="132"><span class="lineNum">     132 </span><span class="lineNoCov">          0 :     maximize_(maxdist, dist);</span></a>
<a name="133"><span class="lineNum">     133 </span><span class="lineNoCov">          0 :     if (dist &gt; maxoutside) {</span></a>
<a name="134"><span class="lineNum">     134 </span><span class="lineNoCov">          0 :       if (qh-&gt;ONLYgood &amp;&amp; !bestfacet-&gt;good</span></a>
<a name="135"><span class="lineNum">     135 </span><span class="lineNoCov">          0 :       &amp;&amp; !((bestfacet= qh_findgooddist(qh, point, bestfacet, &amp;dist, &amp;facetlist))</span></a>
<a name="136"><span class="lineNum">     136 </span><span class="lineNoCov">          0 :       &amp;&amp; dist &gt; maxoutside))</span></a>
<a name="137"><span class="lineNum">     137 </span><span class="lineNoCov">          0 :         notgood++;</span></a>
<a name="138"><span class="lineNum">     138 </span>            :       else {</a>
<a name="139"><span class="lineNum">     139 </span><span class="lineNoCov">          0 :         waserror= True;</span></a>
<a name="140"><span class="lineNum">     140 </span><span class="lineNoCov">          0 :         qh_fprintf(qh, qh-&gt;ferr, 6109, &quot;qhull precision error (qh_check_bestdist): point p%d is outside facet f%d, distance= %6.8g maxoutside= %6.8g\n&quot;,</span></a>
<a name="141"><span class="lineNum">     141 </span>            :                 facet_i, bestfacet-&gt;id, dist, maxoutside);</a>
<a name="142"><span class="lineNum">     142 </span><span class="lineNoCov">          0 :         if (errfacet1 != bestfacet) {</span></a>
<a name="143"><span class="lineNum">     143 </span><span class="lineNoCov">          0 :           errfacet2= errfacet1;</span></a>
<a name="144"><span class="lineNum">     144 </span><span class="lineNoCov">          0 :           errfacet1= bestfacet;</span></a>
<a name="145"><span class="lineNum">     145 </span>            :         }</a>
<a name="146"><span class="lineNum">     146 </span>            :       }</a>
<a name="147"><span class="lineNum">     147 </span><span class="lineNoCov">          0 :     }else if (unassigned &amp;&amp; dist &lt; -qh-&gt;MAXcoplanar)</span></a>
<a name="148"><span class="lineNum">     148 </span><span class="lineNoCov">          0 :       notverified++;</span></a>
<a name="149"><span class="lineNum">     149 </span>            :   }</a>
<a name="150"><span class="lineNum">     150 </span><span class="lineNoCov">          0 :   qh_settempfree(qh, &amp;facets);</span></a>
<a name="151"><span class="lineNum">     151 </span><span class="lineNoCov">          0 :   if (notverified &amp;&amp; !qh-&gt;DELAUNAY &amp;&amp; !qh_QUICKhelp &amp;&amp; qh-&gt;PRINTprecision)</span></a>
<a name="152"><span class="lineNum">     152 </span><span class="lineNoCov">          0 :     qh_fprintf(qh, qh-&gt;ferr, 8092, &quot;\n%d points were well inside the hull.  If the hull contains\n\</span></a>
<a name="153"><span class="lineNum">     153 </span>            : a lens-shaped component, these points were not verified.  Use\n\</a>
<a name="154"><span class="lineNum">     154 </span>            : options 'Qci Tv' to verify all points.\n&quot;, notverified);</a>
<a name="155"><span class="lineNum">     155 </span><span class="lineNoCov">          0 :   if (maxdist &gt; qh-&gt;outside_err) {</span></a>
<a name="156"><span class="lineNum">     156 </span><span class="lineNoCov">          0 :     qh_fprintf(qh, qh-&gt;ferr, 6110, &quot;qhull precision error (qh_check_bestdist): a coplanar point is %6.2g from convex hull.  The maximum value is qh.outside_err (%6.2g)\n&quot;,</span></a>
<a name="157"><span class="lineNum">     157 </span>            :               maxdist, qh-&gt;outside_err);</a>
<a name="158"><span class="lineNum">     158 </span><span class="lineNoCov">          0 :     qh_errexit2(qh, qh_ERRprec, errfacet1, errfacet2);</span></a>
<a name="159"><span class="lineNum">     159 </span><span class="lineNoCov">          0 :   }else if (waserror &amp;&amp; qh-&gt;outside_err &gt; REALmax/2)</span></a>
<a name="160"><span class="lineNum">     160 </span><span class="lineNoCov">          0 :     qh_errexit2(qh, qh_ERRprec, errfacet1, errfacet2);</span></a>
<a name="161"><span class="lineNum">     161 </span>            :   /* else if waserror, the error was logged to qh.ferr but does not effect the output */</a>
<a name="162"><span class="lineNum">     162 </span><span class="lineNoCov">          0 :   trace0((qh, qh-&gt;ferr, 20, &quot;qh_check_bestdist: max distance outside %2.2g\n&quot;, maxdist));</span></a>
<a name="163"><span class="lineNum">     163 </span><span class="lineNoCov">          0 : } /* check_bestdist */</span></a>
<a name="164"><span class="lineNum">     164 </span>            : </a>
<a name="165"><span class="lineNum">     165 </span>            : #ifndef qh_NOmerge</a>
<a name="166"><span class="lineNum">     166 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="167"><span class="lineNum">     167 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;check_maxout&quot;&gt;-&lt;/a&gt;</a>
<a name="168"><span class="lineNum">     168 </span>            : </a>
<a name="169"><span class="lineNum">     169 </span>            :   qh_check_maxout(qh)</a>
<a name="170"><span class="lineNum">     170 </span>            :     updates qh.max_outside by checking all points against bestfacet</a>
<a name="171"><span class="lineNum">     171 </span>            :     if qh.ONLYgood, ignores !good facets</a>
<a name="172"><span class="lineNum">     172 </span>            : </a>
<a name="173"><span class="lineNum">     173 </span>            :   returns:</a>
<a name="174"><span class="lineNum">     174 </span>            :     updates facet-&gt;maxoutside via qh_findbesthorizon()</a>
<a name="175"><span class="lineNum">     175 </span>            :     sets qh.maxoutdone</a>
<a name="176"><span class="lineNum">     176 </span>            :     if printing qh.min_vertex (qh_outerinner),</a>
<a name="177"><span class="lineNum">     177 </span>            :       it is updated to the current vertices</a>
<a name="178"><span class="lineNum">     178 </span>            :     removes inside/coplanar points from coplanarset as needed</a>
<a name="179"><span class="lineNum">     179 </span>            : </a>
<a name="180"><span class="lineNum">     180 </span>            :   notes:</a>
<a name="181"><span class="lineNum">     181 </span>            :     defines coplanar as qh.min_vertex instead of qh.MAXcoplanar</a>
<a name="182"><span class="lineNum">     182 </span>            :     may not need to check near-inside points because of qh.MAXcoplanar</a>
<a name="183"><span class="lineNum">     183 </span>            :       and qh.KEEPnearinside (before it was -qh.DISTround)</a>
<a name="184"><span class="lineNum">     184 </span>            : </a>
<a name="185"><span class="lineNum">     185 </span>            :   see also:</a>
<a name="186"><span class="lineNum">     186 </span>            :     qh_check_bestdist()</a>
<a name="187"><span class="lineNum">     187 </span>            : </a>
<a name="188"><span class="lineNum">     188 </span>            :   design:</a>
<a name="189"><span class="lineNum">     189 </span>            :     if qh.min_vertex is needed</a>
<a name="190"><span class="lineNum">     190 </span>            :       for all neighbors of all vertices</a>
<a name="191"><span class="lineNum">     191 </span>            :         test distance from vertex to neighbor</a>
<a name="192"><span class="lineNum">     192 </span>            :     determine facet for each point (if any)</a>
<a name="193"><span class="lineNum">     193 </span>            :     for each point with an assigned facet</a>
<a name="194"><span class="lineNum">     194 </span>            :       find the best facet for the point and check all coplanar facets</a>
<a name="195"><span class="lineNum">     195 </span>            :         (updates outer planes)</a>
<a name="196"><span class="lineNum">     196 </span>            :     remove near-inside points from coplanar sets</a>
<a name="197"><span class="lineNum">     197 </span>            : */</a>
<a name="198"><span class="lineNum">     198 </span><span class="lineCov">          8 : void qh_check_maxout(qhT *qh) {</span></a>
<a name="199"><span class="lineNum">     199 </span><span class="lineCov">          8 :   facetT *facet, *bestfacet, *neighbor, **neighborp, *facetlist, *maxbestfacet= NULL, *minfacet, *maxfacet, *maxpointfacet;</span></a>
<a name="200"><span class="lineNum">     200 </span>            :   realT dist, maxoutside, mindist, nearest;</a>
<a name="201"><span class="lineNum">     201 </span>            :   realT maxoutside_base, minvertex_base;</a>
<a name="202"><span class="lineNum">     202 </span><span class="lineCov">          8 :   pointT *point, *maxpoint= NULL;</span></a>
<a name="203"><span class="lineNum">     203 </span><span class="lineCov">          8 :   int numpart= 0, facet_i, facet_n, notgood= 0;</span></a>
<a name="204"><span class="lineNum">     204 </span>            :   setT *facets, *vertices;</a>
<a name="205"><span class="lineNum">     205 </span>            :   vertexT *vertex, *minvertex;</a>
<a name="206"><span class="lineNum">     206 </span>            : </a>
<a name="207"><span class="lineNum">     207 </span><span class="lineCov">          8 :   trace1((qh, qh-&gt;ferr, 1022, &quot;qh_check_maxout: check and update qh.min_vertex %2.2g and qh.max_outside %2.2g\n&quot;, qh-&gt;min_vertex, qh-&gt;max_outside));</span></a>
<a name="208"><span class="lineNum">     208 </span><span class="lineCov">          8 :   minvertex_base= fmin_(qh-&gt;min_vertex, -(qh-&gt;ONEmerge+qh-&gt;DISTround));</span></a>
<a name="209"><span class="lineNum">     209 </span><span class="lineCov">          8 :   maxoutside= mindist= 0.0;</span></a>
<a name="210"><span class="lineNum">     210 </span><span class="lineCov">          8 :   minvertex= qh-&gt;vertex_list;</span></a>
<a name="211"><span class="lineNum">     211 </span><span class="lineCov">          8 :   maxfacet= minfacet= maxpointfacet= qh-&gt;facet_list;</span></a>
<a name="212"><span class="lineNum">     212 </span><span class="lineCov">          8 :   if (qh-&gt;VERTEXneighbors</span></a>
<a name="213"><span class="lineNum">     213 </span><span class="lineCov">          8 :   &amp;&amp; (qh-&gt;PRINTsummary || qh-&gt;KEEPinside || qh-&gt;KEEPcoplanar</span></a>
<a name="214"><span class="lineNum">     214 </span><span class="lineNoCov">          0 :         || qh-&gt;TRACElevel || qh-&gt;PRINTstatistics || qh-&gt;VERIFYoutput || qh-&gt;CHECKfrequently</span></a>
<a name="215"><span class="lineNum">     215 </span><span class="lineNoCov">          0 :         || qh-&gt;PRINTout[0] == qh_PRINTsummary || qh-&gt;PRINTout[0] == qh_PRINTnone)) {</span></a>
<a name="216"><span class="lineNum">     216 </span><span class="lineCov">          8 :     trace1((qh, qh-&gt;ferr, 1023, &quot;qh_check_maxout: determine actual minvertex\n&quot;));</span></a>
<a name="217"><span class="lineNum">     217 </span><span class="lineCov">          8 :     vertices= qh_pointvertex(qh /* qh.facet_list */);</span></a>
<a name="218"><span class="lineNum">     218 </span><span class="lineCov">      14710 :     FORALLvertices {</span></a>
<a name="219"><span class="lineNum">     219 </span><span class="lineCov">      73072 :       FOREACHneighbor_(vertex) {</span></a>
<a name="220"><span class="lineNum">     220 </span><span class="lineCov">      58370 :         zinc_(Zdistvertex);  /* distance also computed by main loop below */</span></a>
<a name="221"><span class="lineNum">     221 </span><span class="lineCov">      58370 :         qh_distplane(qh, vertex-&gt;point, neighbor, &amp;dist);</span></a>
<a name="222"><span class="lineNum">     222 </span><span class="lineCov">      58370 :         if (dist &lt; mindist) {</span></a>
<a name="223"><span class="lineNum">     223 </span><span class="lineCov">         30 :           if (qh-&gt;min_vertex/minvertex_base &gt; qh_WIDEmaxoutside &amp;&amp; (qh-&gt;PRINTprecision || !qh-&gt;ALLOWwide)) {</span></a>
<a name="224"><span class="lineNum">     224 </span><span class="lineNoCov">          0 :             nearest= qh_vertex_bestdist(qh, neighbor-&gt;vertices);</span></a>
<a name="225"><span class="lineNum">     225 </span>            :             /* should be caught in qh_mergefacet */</a>
<a name="226"><span class="lineNum">     226 </span><span class="lineNoCov">          0 :             qh_fprintf(qh, qh-&gt;ferr, 7083, &quot;Qhull precision warning: in post-processing (qh_check_maxout) p%d(v%d) is %2.2g below f%d nearest vertices %2.2g\n&quot;,</span></a>
<a name="227"><span class="lineNum">     227 </span>            :               qh_pointid(qh, vertex-&gt;point), vertex-&gt;id, dist, neighbor-&gt;id, nearest);</a>
<a name="228"><span class="lineNum">     228 </span>            :           }</a>
<a name="229"><span class="lineNum">     229 </span><span class="lineCov">         30 :           mindist= dist;</span></a>
<a name="230"><span class="lineNum">     230 </span><span class="lineCov">         30 :           minvertex= vertex;</span></a>
<a name="231"><span class="lineNum">     231 </span><span class="lineCov">         30 :           minfacet= neighbor;</span></a>
<a name="232"><span class="lineNum">     232 </span>            :         }</a>
<a name="233"><span class="lineNum">     233 </span>            : #ifndef qh_NOtrace</a>
<a name="234"><span class="lineNum">     234 </span><span class="lineCov">      58370 :         if (-dist &gt; qh-&gt;TRACEdist || dist &gt; qh-&gt;TRACEdist</span></a>
<a name="235"><span class="lineNum">     235 </span><span class="lineCov">      58370 :         || neighbor == qh-&gt;tracefacet || vertex == qh-&gt;tracevertex) {</span></a>
<a name="236"><span class="lineNum">     236 </span><span class="lineNoCov">          0 :           nearest= qh_vertex_bestdist(qh, neighbor-&gt;vertices);</span></a>
<a name="237"><span class="lineNum">     237 </span><span class="lineNoCov">          0 :           qh_fprintf(qh, qh-&gt;ferr, 8093, &quot;qh_check_maxout: p%d(v%d) is %.2g from f%d nearest vertices %2.2g\n&quot;,</span></a>
<a name="238"><span class="lineNum">     238 </span>            :                     qh_pointid(qh, vertex-&gt;point), vertex-&gt;id, dist, neighbor-&gt;id, nearest);</a>
<a name="239"><span class="lineNum">     239 </span>            :         }</a>
<a name="240"><span class="lineNum">     240 </span>            : #endif</a>
<a name="241"><span class="lineNum">     241 </span>            :       }</a>
<a name="242"><span class="lineNum">     242 </span>            :     }</a>
<a name="243"><span class="lineNum">     243 </span><span class="lineCov">          8 :     if (qh-&gt;MERGING) {</span></a>
<a name="244"><span class="lineNum">     244 </span><span class="lineCov">          8 :       wmin_(Wminvertex, qh-&gt;min_vertex);</span></a>
<a name="245"><span class="lineNum">     245 </span>            :     }</a>
<a name="246"><span class="lineNum">     246 </span><span class="lineCov">          8 :     qh-&gt;min_vertex= mindist;</span></a>
<a name="247"><span class="lineNum">     247 </span><span class="lineCov">          8 :     qh_settempfree(qh, &amp;vertices);</span></a>
<a name="248"><span class="lineNum">     248 </span>            :   }</a>
<a name="249"><span class="lineNum">     249 </span><span class="lineCov">          8 :   trace1((qh, qh-&gt;ferr, 1055, &quot;qh_check_maxout: determine actual maxoutside\n&quot;));</span></a>
<a name="250"><span class="lineNum">     250 </span><span class="lineCov">          8 :   maxoutside_base= fmax_(qh-&gt;max_outside, qh-&gt;ONEmerge+qh-&gt;DISTround);</span></a>
<a name="251"><span class="lineNum">     251 </span>            :   /* maxoutside_base is same as qh.MAXoutside without qh.MINoutside (qh_detmaxoutside) */</a>
<a name="252"><span class="lineNum">     252 </span><span class="lineCov">          8 :   facets= qh_pointfacet(qh /* qh.facet_list */);</span></a>
<a name="253"><span class="lineNum">     253 </span><span class="lineCov">      14711 :   FOREACHfacet_i_(qh, facets) {     /* for each point with facet assignment */</span></a>
<a name="254"><span class="lineNum">     254 </span><span class="lineCov">      14703 :     if (facet) {</span></a>
<a name="255"><span class="lineNum">     255 </span><span class="lineCov">      14703 :       point= qh_point(qh, facet_i);</span></a>
<a name="256"><span class="lineNum">     256 </span><span class="lineCov">      14703 :       if (point == qh-&gt;GOODpointp)</span></a>
<a name="257"><span class="lineNum">     257 </span><span class="lineNoCov">          0 :         continue;</span></a>
<a name="258"><span class="lineNum">     258 </span><span class="lineCov">      14703 :       zzinc_(Ztotcheck);</span></a>
<a name="259"><span class="lineNum">     259 </span><span class="lineCov">      14703 :       qh_distplane(qh, point, facet, &amp;dist);</span></a>
<a name="260"><span class="lineNum">     260 </span><span class="lineCov">      14703 :       numpart++;</span></a>
<a name="261"><span class="lineNum">     261 </span><span class="lineCov">      14703 :       bestfacet= qh_findbesthorizon(qh, qh_IScheckmax, point, facet, !qh_NOupper, &amp;dist, &amp;numpart);</span></a>
<a name="262"><span class="lineNum">     262 </span><span class="lineCov">      14703 :       if (bestfacet &amp;&amp; dist &gt;= maxoutside) {</span></a>
<a name="263"><span class="lineNum">     263 </span><span class="lineCov">         33 :         if (qh-&gt;ONLYgood &amp;&amp; !bestfacet-&gt;good</span></a>
<a name="264"><span class="lineNum">     264 </span><span class="lineNoCov">          0 :         &amp;&amp; !((bestfacet= qh_findgooddist(qh, point, bestfacet, &amp;dist, &amp;facetlist))</span></a>
<a name="265"><span class="lineNum">     265 </span><span class="lineNoCov">          0 :         &amp;&amp; dist &gt; maxoutside)) {</span></a>
<a name="266"><span class="lineNum">     266 </span><span class="lineNoCov">          0 :           notgood++;</span></a>
<a name="267"><span class="lineNum">     267 </span><span class="lineCov">         33 :         }else if (dist/maxoutside_base &gt; qh_WIDEmaxoutside &amp;&amp; (qh-&gt;PRINTprecision || !qh-&gt;ALLOWwide)) {</span></a>
<a name="268"><span class="lineNum">     268 </span><span class="lineNoCov">          0 :           nearest= qh_vertex_bestdist(qh, bestfacet-&gt;vertices);</span></a>
<a name="269"><span class="lineNum">     269 </span><span class="lineNoCov">          0 :           if (nearest &lt; fmax_(qh-&gt;ONEmerge, qh-&gt;max_outside) * qh_RATIOcoplanaroutside * 2) {</span></a>
<a name="270"><span class="lineNum">     270 </span><span class="lineNoCov">          0 :             qh_fprintf(qh, qh-&gt;ferr, 7087, &quot;Qhull precision warning: in post-processing (qh_check_maxout) p%d for f%d is %2.2g above twisted facet f%d nearest vertices %2.2g\n&quot;,</span></a>
<a name="271"><span class="lineNum">     271 </span>            :               qh_pointid(qh, point), facet-&gt;id, dist, bestfacet-&gt;id, nearest);</a>
<a name="272"><span class="lineNum">     272 </span>            :           }else {</a>
<a name="273"><span class="lineNum">     273 </span><span class="lineNoCov">          0 :             qh_fprintf(qh, qh-&gt;ferr, 7088, &quot;Qhull precision warning: in post-processing (qh_check_maxout) p%d for f%d is %2.2g above hidden facet f%d nearest vertices %2.2g\n&quot;,</span></a>
<a name="274"><span class="lineNum">     274 </span>            :               qh_pointid(qh, point), facet-&gt;id, dist, bestfacet-&gt;id, nearest);</a>
<a name="275"><span class="lineNum">     275 </span>            :           }</a>
<a name="276"><span class="lineNum">     276 </span><span class="lineNoCov">          0 :           maxbestfacet= bestfacet;</span></a>
<a name="277"><span class="lineNum">     277 </span>            :         }</a>
<a name="278"><span class="lineNum">     278 </span><span class="lineCov">         33 :         maxoutside= dist;</span></a>
<a name="279"><span class="lineNum">     279 </span><span class="lineCov">         33 :         maxfacet= bestfacet;</span></a>
<a name="280"><span class="lineNum">     280 </span><span class="lineCov">         33 :         maxpoint= point;</span></a>
<a name="281"><span class="lineNum">     281 </span><span class="lineCov">         33 :         maxpointfacet= facet;</span></a>
<a name="282"><span class="lineNum">     282 </span>            :       }</a>
<a name="283"><span class="lineNum">     283 </span><span class="lineCov">      14703 :       if (dist &gt; qh-&gt;TRACEdist || (bestfacet &amp;&amp; bestfacet == qh-&gt;tracefacet))</span></a>
<a name="284"><span class="lineNum">     284 </span><span class="lineNoCov">          0 :         qh_fprintf(qh, qh-&gt;ferr, 8094, &quot;qh_check_maxout: p%d is %.2g above f%d\n&quot;,</span></a>
<a name="285"><span class="lineNum">     285 </span>            :               qh_pointid(qh, point), dist, (bestfacet ? bestfacet-&gt;id : UINT_MAX));</a>
<a name="286"><span class="lineNum">     286 </span>            :     }</a>
<a name="287"><span class="lineNum">     287 </span>            :   }</a>
<a name="288"><span class="lineNum">     288 </span><span class="lineCov">          8 :   zzadd_(Zcheckpart, numpart);</span></a>
<a name="289"><span class="lineNum">     289 </span><span class="lineCov">          8 :   qh_settempfree(qh, &amp;facets);</span></a>
<a name="290"><span class="lineNum">     290 </span><span class="lineCov">          8 :   wval_(Wmaxout)= maxoutside - qh-&gt;max_outside;</span></a>
<a name="291"><span class="lineNum">     291 </span><span class="lineCov">          8 :   wmax_(Wmaxoutside, qh-&gt;max_outside);</span></a>
<a name="292"><span class="lineNum">     292 </span><span class="lineCov">          8 :   if (!qh-&gt;APPROXhull &amp;&amp; maxoutside &gt; qh-&gt;DISTround) { /* initial value for f.maxoutside */</span></a>
<a name="293"><span class="lineNum">     293 </span><span class="lineNoCov">          0 :     FORALLfacets {</span></a>
<a name="294"><span class="lineNum">     294 </span><span class="lineNoCov">          0 :       if (maxoutside &lt; facet-&gt;maxoutside) {</span></a>
<a name="295"><span class="lineNum">     295 </span><span class="lineNoCov">          0 :         if (!qh-&gt;KEEPcoplanar) {</span></a>
<a name="296"><span class="lineNum">     296 </span><span class="lineNoCov">          0 :           maxoutside= facet-&gt;maxoutside;</span></a>
<a name="297"><span class="lineNum">     297 </span><span class="lineNoCov">          0 :         }else if (maxoutside + qh-&gt;DISTround &lt; facet-&gt;maxoutside) { /* maxoutside is computed distance, e.g., rbox 100 s D3 t1547136913 | qhull R1e-3 Tcv Qc */</span></a>
<a name="298"><span class="lineNum">     298 </span><span class="lineNoCov">          0 :           qh_fprintf(qh, qh-&gt;ferr, 7082, &quot;Qhull precision warning (qh_check_maxout): f%d.maxoutside (%4.4g) is greater than computed qh.max_outside (%2.2g) + qh.DISTround (%2.2g).  It should be less than or equal\n&quot;,</span></a>
<a name="299"><span class="lineNum">     299 </span>            :             facet-&gt;id, facet-&gt;maxoutside, maxoutside, qh-&gt;DISTround);</a>
<a name="300"><span class="lineNum">     300 </span>            :         }</a>
<a name="301"><span class="lineNum">     301 </span>            :       }</a>
<a name="302"><span class="lineNum">     302 </span>            :     }</a>
<a name="303"><span class="lineNum">     303 </span>            :   }</a>
<a name="304"><span class="lineNum">     304 </span><span class="lineCov">          8 :   qh-&gt;max_outside= maxoutside;</span></a>
<a name="305"><span class="lineNum">     305 </span><span class="lineCov">          8 :   qh_nearcoplanar(qh /* qh.facet_list */);</span></a>
<a name="306"><span class="lineNum">     306 </span><span class="lineCov">          8 :   qh-&gt;maxoutdone= True;</span></a>
<a name="307"><span class="lineNum">     307 </span><span class="lineCov">          8 :   trace1((qh, qh-&gt;ferr, 1024, &quot;qh_check_maxout:  p%d(v%d) is qh.min_vertex %2.2g below facet f%d.  Point p%d for f%d is qh.max_outside %2.2g above f%d.  %d points are outside of not-good facets\n&quot;,</span></a>
<a name="308"><span class="lineNum">     308 </span>            :     qh_pointid(qh, minvertex-&gt;point), minvertex-&gt;id, qh-&gt;min_vertex, minfacet-&gt;id, qh_pointid(qh, maxpoint), maxpointfacet-&gt;id, qh-&gt;max_outside, maxfacet ? maxfacet-&gt;id : -1, notgood));</a>
<a name="309"><span class="lineNum">     309 </span><span class="lineCov">          8 :   if(!qh-&gt;ALLOWwide) {</span></a>
<a name="310"><span class="lineNum">     310 </span><span class="lineCov">          8 :     if (maxoutside/maxoutside_base &gt; qh_WIDEmaxoutside) {</span></a>
<a name="311"><span class="lineNum">     311 </span><span class="lineNoCov">          0 :       qh_fprintf(qh, qh-&gt;ferr, 6297, &quot;Qhull precision error (qh_check_maxout): large increase in qh.max_outside during post-processing dist %2.2g (%.1fx).  See warning QH0032/QH0033.  Allow with 'Q12' (allow-wide) and 'Pp'\n&quot;,</span></a>
<a name="312"><span class="lineNum">     312 </span>            :         maxoutside, maxoutside/maxoutside_base);</a>
<a name="313"><span class="lineNum">     313 </span><span class="lineNoCov">          0 :       qh_errexit(qh, qh_ERRwide, maxbestfacet, NULL);</span></a>
<a name="314"><span class="lineNum">     314 </span><span class="lineCov">          8 :     }else if (!qh-&gt;APPROXhull &amp;&amp; maxoutside_base &gt; (qh-&gt;ONEmerge * qh_WIDEmaxoutside2)) {</span></a>
<a name="315"><span class="lineNum">     315 </span><span class="lineNoCov">          0 :       if (maxoutside &gt; (qh-&gt;ONEmerge * qh_WIDEmaxoutside2)) {  /* wide facets may have been deleted */</span></a>
<a name="316"><span class="lineNum">     316 </span><span class="lineNoCov">          0 :         qh_fprintf(qh, qh-&gt;ferr, 6298, &quot;Qhull precision error (qh_check_maxout): a facet merge, vertex merge, vertex, or coplanar point produced a wide facet %2.2g (%.1fx). Trace with option 'TWn' to identify the merge.   Allow with 'Q12' (allow-wide)\n&quot;,</span></a>
<a name="317"><span class="lineNum">     317 </span><span class="lineNoCov">          0 :           maxoutside_base, maxoutside_base/(qh-&gt;ONEmerge + qh-&gt;DISTround));</span></a>
<a name="318"><span class="lineNum">     318 </span><span class="lineNoCov">          0 :         qh_errexit(qh, qh_ERRwide, maxbestfacet, NULL);</span></a>
<a name="319"><span class="lineNum">     319 </span>            :       }</a>
<a name="320"><span class="lineNum">     320 </span><span class="lineCov">          8 :     }else if (qh-&gt;min_vertex/minvertex_base &gt; qh_WIDEmaxoutside) {</span></a>
<a name="321"><span class="lineNum">     321 </span><span class="lineNoCov">          0 :       qh_fprintf(qh, qh-&gt;ferr, 6354, &quot;Qhull precision error (qh_check_maxout): large increase in qh.min_vertex during post-processing dist %2.2g (%.1fx).  See warning QH7083.  Allow with 'Q12' (allow-wide) and 'Pp'\n&quot;,</span></a>
<a name="322"><span class="lineNum">     322 </span><span class="lineNoCov">          0 :         qh-&gt;min_vertex, qh-&gt;min_vertex/minvertex_base);</span></a>
<a name="323"><span class="lineNum">     323 </span><span class="lineNoCov">          0 :       qh_errexit(qh, qh_ERRwide, minfacet, NULL);</span></a>
<a name="324"><span class="lineNum">     324 </span><span class="lineCov">          8 :     }else if (minvertex_base &lt; -(qh-&gt;ONEmerge * qh_WIDEmaxoutside2)) {</span></a>
<a name="325"><span class="lineNum">     325 </span><span class="lineNoCov">          0 :       if (qh-&gt;min_vertex &lt; -(qh-&gt;ONEmerge * qh_WIDEmaxoutside2)) {  /* wide facets may have been deleted */</span></a>
<a name="326"><span class="lineNum">     326 </span><span class="lineNoCov">          0 :         qh_fprintf(qh, qh-&gt;ferr, 6380, &quot;Qhull precision error (qh_check_maxout): a facet or vertex merge produced a wide facet: v%d below f%d distance %2.2g (%.1fx). Trace with option 'TWn' to identify the merge.  Allow with 'Q12' (allow-wide)\n&quot;,</span></a>
<a name="327"><span class="lineNum">     327 </span><span class="lineNoCov">          0 :           minvertex-&gt;id, minfacet-&gt;id, mindist, -qh-&gt;min_vertex/(qh-&gt;ONEmerge + qh-&gt;DISTround));</span></a>
<a name="328"><span class="lineNum">     328 </span><span class="lineNoCov">          0 :         qh_errexit(qh, qh_ERRwide, minfacet, NULL);</span></a>
<a name="329"><span class="lineNum">     329 </span>            :       }</a>
<a name="330"><span class="lineNum">     330 </span>            :     }</a>
<a name="331"><span class="lineNum">     331 </span>            :   }</a>
<a name="332"><span class="lineNum">     332 </span><span class="lineCov">          8 : } /* check_maxout */</span></a>
<a name="333"><span class="lineNum">     333 </span>            : #else /* qh_NOmerge */</a>
<a name="334"><span class="lineNum">     334 </span>            : void qh_check_maxout(qhT *qh) {</a>
<a name="335"><span class="lineNum">     335 </span>            :   QHULL_UNUSED(qh)</a>
<a name="336"><span class="lineNum">     336 </span>            : }</a>
<a name="337"><span class="lineNum">     337 </span>            : #endif</a>
<a name="338"><span class="lineNum">     338 </span>            : </a>
<a name="339"><span class="lineNum">     339 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="340"><span class="lineNum">     340 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;check_output&quot;&gt;-&lt;/a&gt;</a>
<a name="341"><span class="lineNum">     341 </span>            : </a>
<a name="342"><span class="lineNum">     342 </span>            :   qh_check_output(qh)</a>
<a name="343"><span class="lineNum">     343 </span>            :     performs the checks at the end of qhull algorithm</a>
<a name="344"><span class="lineNum">     344 </span>            :     Maybe called after Voronoi output.  If so, it recomputes centrums since they are Voronoi centers instead.</a>
<a name="345"><span class="lineNum">     345 </span>            : */</a>
<a name="346"><span class="lineNum">     346 </span><span class="lineCov">          8 : void qh_check_output(qhT *qh) {</span></a>
<a name="347"><span class="lineNum">     347 </span>            :   int i;</a>
<a name="348"><span class="lineNum">     348 </span>            : </a>
<a name="349"><span class="lineNum">     349 </span><span class="lineCov">          8 :   if (qh-&gt;STOPcone)</span></a>
<a name="350"><span class="lineNum">     350 </span><span class="lineNoCov">          0 :     return;</span></a>
<a name="351"><span class="lineNum">     351 </span><span class="lineCov">          8 :   if (qh-&gt;VERIFYoutput || qh-&gt;IStracing || qh-&gt;CHECKfrequently) {</span></a>
<a name="352"><span class="lineNum">     352 </span><span class="lineNoCov">          0 :     qh_checkpolygon(qh, qh-&gt;facet_list);</span></a>
<a name="353"><span class="lineNum">     353 </span><span class="lineNoCov">          0 :     qh_checkflipped_all(qh, qh-&gt;facet_list);</span></a>
<a name="354"><span class="lineNum">     354 </span><span class="lineNoCov">          0 :     qh_checkconvex(qh, qh-&gt;facet_list, qh_ALGORITHMfault);</span></a>
<a name="355"><span class="lineNum">     355 </span><span class="lineCov">          8 :   }else if (!qh-&gt;MERGING &amp;&amp; qh_newstats(qh, qh-&gt;qhstat.precision, &amp;i)) {</span></a>
<a name="356"><span class="lineNum">     356 </span><span class="lineNoCov">          0 :     qh_checkflipped_all(qh, qh-&gt;facet_list);</span></a>
<a name="357"><span class="lineNum">     357 </span><span class="lineNoCov">          0 :     qh_checkconvex(qh, qh-&gt;facet_list, qh_ALGORITHMfault);</span></a>
<a name="358"><span class="lineNum">     358 </span>            :   }</a>
<a name="359"><span class="lineNum">     359 </span>            : } /* check_output */</a>
<a name="360"><span class="lineNum">     360 </span>            : </a>
<a name="361"><span class="lineNum">     361 </span>            : </a>
<a name="362"><span class="lineNum">     362 </span>            : </a>
<a name="363"><span class="lineNum">     363 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="364"><span class="lineNum">     364 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;check_point&quot;&gt;-&lt;/a&gt;</a>
<a name="365"><span class="lineNum">     365 </span>            : </a>
<a name="366"><span class="lineNum">     366 </span>            :   qh_check_point(qh, point, facet, maxoutside, maxdist, errfacet1, errfacet2, errcount )</a>
<a name="367"><span class="lineNum">     367 </span>            :     check that point is less than maxoutside from facet</a>
<a name="368"><span class="lineNum">     368 </span>            : </a>
<a name="369"><span class="lineNum">     369 </span>            :   notes:</a>
<a name="370"><span class="lineNum">     370 </span>            :     only called from qh_checkpoints</a>
<a name="371"><span class="lineNum">     371 </span>            :     reports up to qh_MAXcheckpoint-1 errors per facet</a>
<a name="372"><span class="lineNum">     372 </span>            : */</a>
<a name="373"><span class="lineNum">     373 </span><span class="lineNoCov">          0 : void qh_check_point(qhT *qh, pointT *point, facetT *facet, realT *maxoutside, realT *maxdist, facetT **errfacet1, facetT **errfacet2, int *errcount) {</span></a>
<a name="374"><span class="lineNum">     374 </span>            :   realT dist, nearest;</a>
<a name="375"><span class="lineNum">     375 </span>            : </a>
<a name="376"><span class="lineNum">     376 </span>            :   /* occurs after statistics reported */</a>
<a name="377"><span class="lineNum">     377 </span><span class="lineNoCov">          0 :   qh_distplane(qh, point, facet, &amp;dist);</span></a>
<a name="378"><span class="lineNum">     378 </span><span class="lineNoCov">          0 :   maximize_(*maxdist, dist);</span></a>
<a name="379"><span class="lineNum">     379 </span><span class="lineNoCov">          0 :   if (dist &gt; *maxoutside) {</span></a>
<a name="380"><span class="lineNum">     380 </span><span class="lineNoCov">          0 :     (*errcount)++;</span></a>
<a name="381"><span class="lineNum">     381 </span><span class="lineNoCov">          0 :     if (*errfacet1 != facet) {</span></a>
<a name="382"><span class="lineNum">     382 </span><span class="lineNoCov">          0 :       *errfacet2= *errfacet1;</span></a>
<a name="383"><span class="lineNum">     383 </span><span class="lineNoCov">          0 :       *errfacet1= facet;</span></a>
<a name="384"><span class="lineNum">     384 </span>            :     }</a>
<a name="385"><span class="lineNum">     385 </span><span class="lineNoCov">          0 :     if (*errcount &lt; qh_MAXcheckpoint) {</span></a>
<a name="386"><span class="lineNum">     386 </span><span class="lineNoCov">          0 :       nearest= qh_vertex_bestdist(qh, facet-&gt;vertices);</span></a>
<a name="387"><span class="lineNum">     387 </span><span class="lineNoCov">          0 :       qh_fprintf(qh, qh-&gt;ferr, 6111, &quot;qhull precision error: point p%d is outside facet f%d, distance= %6.8g maxoutside= %6.8g nearest vertices %2.2g\n&quot;,</span></a>
<a name="388"><span class="lineNum">     388 </span>            :                 qh_pointid(qh, point), facet-&gt;id, dist, *maxoutside, nearest);</a>
<a name="389"><span class="lineNum">     389 </span>            :     }</a>
<a name="390"><span class="lineNum">     390 </span>            :   }</a>
<a name="391"><span class="lineNum">     391 </span><span class="lineNoCov">          0 : } /* qh_check_point */</span></a>
<a name="392"><span class="lineNum">     392 </span>            : </a>
<a name="393"><span class="lineNum">     393 </span>            : </a>
<a name="394"><span class="lineNum">     394 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="395"><span class="lineNum">     395 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;check_points&quot;&gt;-&lt;/a&gt;</a>
<a name="396"><span class="lineNum">     396 </span>            : </a>
<a name="397"><span class="lineNum">     397 </span>            :   qh_check_points(qh)</a>
<a name="398"><span class="lineNum">     398 </span>            :     checks that all points are inside all facets</a>
<a name="399"><span class="lineNum">     399 </span>            : </a>
<a name="400"><span class="lineNum">     400 </span>            :   notes:</a>
<a name="401"><span class="lineNum">     401 </span>            :     if many points and qh_check_maxout not called (i.e., !qh.MERGING),</a>
<a name="402"><span class="lineNum">     402 </span>            :        calls qh_findbesthorizon via qh_check_bestdist (seldom done).</a>
<a name="403"><span class="lineNum">     403 </span>            :     ignores flipped facets</a>
<a name="404"><span class="lineNum">     404 </span>            :     maxoutside includes 2 qh.DISTrounds</a>
<a name="405"><span class="lineNum">     405 </span>            :       one qh.DISTround for the computed distances in qh_check_points</a>
<a name="406"><span class="lineNum">     406 </span>            :     qh_printafacet and qh_printsummary needs only one qh.DISTround</a>
<a name="407"><span class="lineNum">     407 </span>            :     the computation for qh.VERIFYdirect does not account for qh.other_points</a>
<a name="408"><span class="lineNum">     408 </span>            : </a>
<a name="409"><span class="lineNum">     409 </span>            :   design:</a>
<a name="410"><span class="lineNum">     410 </span>            :     if many points</a>
<a name="411"><span class="lineNum">     411 </span>            :       use qh_check_bestdist()</a>
<a name="412"><span class="lineNum">     412 </span>            :     else</a>
<a name="413"><span class="lineNum">     413 </span>            :       for all facets</a>
<a name="414"><span class="lineNum">     414 </span>            :         for all points</a>
<a name="415"><span class="lineNum">     415 </span>            :           check that point is inside facet</a>
<a name="416"><span class="lineNum">     416 </span>            : */</a>
<a name="417"><span class="lineNum">     417 </span><span class="lineNoCov">          0 : void qh_check_points(qhT *qh) {</span></a>
<a name="418"><span class="lineNum">     418 </span><span class="lineNoCov">          0 :   facetT *facet, *errfacet1= NULL, *errfacet2= NULL;</span></a>
<a name="419"><span class="lineNum">     419 </span><span class="lineNoCov">          0 :   realT total, maxoutside, maxdist= -REALmax;</span></a>
<a name="420"><span class="lineNum">     420 </span>            :   pointT *point, **pointp, *pointtemp;</a>
<a name="421"><span class="lineNum">     421 </span>            :   int errcount;</a>
<a name="422"><span class="lineNum">     422 </span>            :   boolT testouter;</a>
<a name="423"><span class="lineNum">     423 </span>            : </a>
<a name="424"><span class="lineNum">     424 </span><span class="lineNoCov">          0 :   maxoutside= qh_maxouter(qh);</span></a>
<a name="425"><span class="lineNum">     425 </span><span class="lineNoCov">          0 :   maxoutside += qh-&gt;DISTround;</span></a>
<a name="426"><span class="lineNum">     426 </span>            :   /* one more qh.DISTround for check computation */</a>
<a name="427"><span class="lineNum">     427 </span><span class="lineNoCov">          0 :   trace1((qh, qh-&gt;ferr, 1025, &quot;qh_check_points: check all points below %2.2g of all facet planes\n&quot;,</span></a>
<a name="428"><span class="lineNum">     428 </span>            :           maxoutside));</a>
<a name="429"><span class="lineNum">     429 </span><span class="lineNoCov">          0 :   if (qh-&gt;num_good)   /* miss counts other_points and !good facets */</span></a>
<a name="430"><span class="lineNum">     430 </span><span class="lineNoCov">          0 :      total= (float)qh-&gt;num_good * (float)qh-&gt;num_points;</span></a>
<a name="431"><span class="lineNum">     431 </span>            :   else</a>
<a name="432"><span class="lineNum">     432 </span><span class="lineNoCov">          0 :      total= (float)qh-&gt;num_facets * (float)qh-&gt;num_points;</span></a>
<a name="433"><span class="lineNum">     433 </span><span class="lineNoCov">          0 :   if (total &gt;= qh_VERIFYdirect &amp;&amp; !qh-&gt;maxoutdone) {</span></a>
<a name="434"><span class="lineNum">     434 </span><span class="lineNoCov">          0 :     if (!qh_QUICKhelp &amp;&amp; qh-&gt;SKIPcheckmax &amp;&amp; qh-&gt;MERGING)</span></a>
<a name="435"><span class="lineNum">     435 </span><span class="lineNoCov">          0 :       qh_fprintf(qh, qh-&gt;ferr, 7075, &quot;qhull input warning: merging without checking outer planes('Q5' or 'Po').  Verify may report that a point is outside of a facet.\n&quot;);</span></a>
<a name="436"><span class="lineNum">     436 </span><span class="lineNoCov">          0 :     qh_check_bestdist(qh);</span></a>
<a name="437"><span class="lineNum">     437 </span>            :   }else {</a>
<a name="438"><span class="lineNum">     438 </span><span class="lineNoCov">          0 :     if (qh_MAXoutside &amp;&amp; qh-&gt;maxoutdone)</span></a>
<a name="439"><span class="lineNum">     439 </span><span class="lineNoCov">          0 :       testouter= True;</span></a>
<a name="440"><span class="lineNum">     440 </span>            :     else</a>
<a name="441"><span class="lineNum">     441 </span><span class="lineNoCov">          0 :       testouter= False;</span></a>
<a name="442"><span class="lineNum">     442 </span>            :     if (!qh_QUICKhelp) {</a>
<a name="443"><span class="lineNum">     443 </span><span class="lineNoCov">          0 :       if (qh-&gt;MERGEexact)</span></a>
<a name="444"><span class="lineNum">     444 </span><span class="lineNoCov">          0 :         qh_fprintf(qh, qh-&gt;ferr, 7076, &quot;qhull input warning: exact merge ('Qx').  Verify may report that a point is outside of a facet.  See qh-optq.htm#Qx\n&quot;);</span></a>
<a name="445"><span class="lineNum">     445 </span><span class="lineNoCov">          0 :       else if (qh-&gt;SKIPcheckmax || qh-&gt;NOnearinside)</span></a>
<a name="446"><span class="lineNum">     446 </span><span class="lineNoCov">          0 :         qh_fprintf(qh, qh-&gt;ferr, 7077, &quot;qhull input warning: no outer plane check ('Q5') or no processing of near-inside points ('Q8').  Verify may report that a point is outside of a facet.\n&quot;);</span></a>
<a name="447"><span class="lineNum">     447 </span>            :     }</a>
<a name="448"><span class="lineNum">     448 </span><span class="lineNoCov">          0 :     if (qh-&gt;PRINTprecision) {</span></a>
<a name="449"><span class="lineNum">     449 </span><span class="lineNoCov">          0 :       if (testouter)</span></a>
<a name="450"><span class="lineNum">     450 </span><span class="lineNoCov">          0 :         qh_fprintf(qh, qh-&gt;ferr, 8098, &quot;\n\</span></a>
<a name="451"><span class="lineNum">     451 </span>            : Output completed.  Verifying that all points are below outer planes of\n\</a>
<a name="452"><span class="lineNum">     452 </span>            : all %sfacets.  Will make %2.0f distance computations.\n&quot;,</a>
<a name="453"><span class="lineNum">     453 </span><span class="lineNoCov">          0 :               (qh-&gt;ONLYgood ?  &quot;good &quot; : &quot;&quot;), total);</span></a>
<a name="454"><span class="lineNum">     454 </span>            :       else</a>
<a name="455"><span class="lineNum">     455 </span><span class="lineNoCov">          0 :         qh_fprintf(qh, qh-&gt;ferr, 8099, &quot;\n\</span></a>
<a name="456"><span class="lineNum">     456 </span>            : Output completed.  Verifying that all points are below %2.2g of\n\</a>
<a name="457"><span class="lineNum">     457 </span>            : all %sfacets.  Will make %2.0f distance computations.\n&quot;,</a>
<a name="458"><span class="lineNum">     458 </span><span class="lineNoCov">          0 :               maxoutside, (qh-&gt;ONLYgood ?  &quot;good &quot; : &quot;&quot;), total);</span></a>
<a name="459"><span class="lineNum">     459 </span>            :     }</a>
<a name="460"><span class="lineNum">     460 </span><span class="lineNoCov">          0 :     FORALLfacets {</span></a>
<a name="461"><span class="lineNum">     461 </span><span class="lineNoCov">          0 :       if (!facet-&gt;good &amp;&amp; qh-&gt;ONLYgood)</span></a>
<a name="462"><span class="lineNum">     462 </span><span class="lineNoCov">          0 :         continue;</span></a>
<a name="463"><span class="lineNum">     463 </span><span class="lineNoCov">          0 :       if (facet-&gt;flipped)</span></a>
<a name="464"><span class="lineNum">     464 </span><span class="lineNoCov">          0 :         continue;</span></a>
<a name="465"><span class="lineNum">     465 </span><span class="lineNoCov">          0 :       if (!facet-&gt;normal) {</span></a>
<a name="466"><span class="lineNum">     466 </span><span class="lineNoCov">          0 :         qh_fprintf(qh, qh-&gt;ferr, 7061, &quot;qhull warning (qh_check_points): missing normal for facet f%d\n&quot;, facet-&gt;id);</span></a>
<a name="467"><span class="lineNum">     467 </span><span class="lineNoCov">          0 :         if (!errfacet1)</span></a>
<a name="468"><span class="lineNum">     468 </span><span class="lineNoCov">          0 :           errfacet1= facet;</span></a>
<a name="469"><span class="lineNum">     469 </span><span class="lineNoCov">          0 :         continue;</span></a>
<a name="470"><span class="lineNum">     470 </span>            :       }</a>
<a name="471"><span class="lineNum">     471 </span><span class="lineNoCov">          0 :       if (testouter) {</span></a>
<a name="472"><span class="lineNum">     472 </span>            : #if qh_MAXoutside</a>
<a name="473"><span class="lineNum">     473 </span><span class="lineNoCov">          0 :         maxoutside= facet-&gt;maxoutside + 2 * qh-&gt;DISTround;</span></a>
<a name="474"><span class="lineNum">     474 </span>            :         /* one DISTround to actual point and another to computed point */</a>
<a name="475"><span class="lineNum">     475 </span>            : #endif</a>
<a name="476"><span class="lineNum">     476 </span>            :       }</a>
<a name="477"><span class="lineNum">     477 </span><span class="lineNoCov">          0 :       errcount= 0;</span></a>
<a name="478"><span class="lineNum">     478 </span><span class="lineNoCov">          0 :       FORALLpoints {</span></a>
<a name="479"><span class="lineNum">     479 </span><span class="lineNoCov">          0 :         if (point != qh-&gt;GOODpointp)</span></a>
<a name="480"><span class="lineNum">     480 </span><span class="lineNoCov">          0 :           qh_check_point(qh, point, facet, &amp;maxoutside, &amp;maxdist, &amp;errfacet1, &amp;errfacet2, &amp;errcount);</span></a>
<a name="481"><span class="lineNum">     481 </span>            :       }</a>
<a name="482"><span class="lineNum">     482 </span><span class="lineNoCov">          0 :       FOREACHpoint_(qh-&gt;other_points) {</span></a>
<a name="483"><span class="lineNum">     483 </span><span class="lineNoCov">          0 :         if (point != qh-&gt;GOODpointp)</span></a>
<a name="484"><span class="lineNum">     484 </span><span class="lineNoCov">          0 :           qh_check_point(qh, point, facet, &amp;maxoutside, &amp;maxdist, &amp;errfacet1, &amp;errfacet2, &amp;errcount);</span></a>
<a name="485"><span class="lineNum">     485 </span>            :       }</a>
<a name="486"><span class="lineNum">     486 </span><span class="lineNoCov">          0 :       if (errcount &gt;= qh_MAXcheckpoint) {</span></a>
<a name="487"><span class="lineNum">     487 </span><span class="lineNoCov">          0 :         qh_fprintf(qh, qh-&gt;ferr, 6422, &quot;qhull precision error (qh_check_points): %d additional points outside facet f%d, maxdist= %6.8g\n&quot;,</span></a>
<a name="488"><span class="lineNum">     488 </span>            :              errcount-qh_MAXcheckpoint+1, facet-&gt;id, maxdist);</a>
<a name="489"><span class="lineNum">     489 </span>            :       }</a>
<a name="490"><span class="lineNum">     490 </span>            :     }</a>
<a name="491"><span class="lineNum">     491 </span><span class="lineNoCov">          0 :     if (maxdist &gt; qh-&gt;outside_err) {</span></a>
<a name="492"><span class="lineNum">     492 </span><span class="lineNoCov">          0 :       qh_fprintf(qh, qh-&gt;ferr, 6112, &quot;qhull precision error (qh_check_points): a coplanar point is %6.2g from convex hull.  The maximum value(qh.outside_err) is %6.2g\n&quot;,</span></a>
<a name="493"><span class="lineNum">     493 </span>            :                 maxdist, qh-&gt;outside_err );</a>
<a name="494"><span class="lineNum">     494 </span><span class="lineNoCov">          0 :       qh_errexit2(qh, qh_ERRprec, errfacet1, errfacet2 );</span></a>
<a name="495"><span class="lineNum">     495 </span><span class="lineNoCov">          0 :     }else if (errfacet1 &amp;&amp; qh-&gt;outside_err &gt; REALmax/2)</span></a>
<a name="496"><span class="lineNum">     496 </span><span class="lineNoCov">          0 :         qh_errexit2(qh, qh_ERRprec, errfacet1, errfacet2 );</span></a>
<a name="497"><span class="lineNum">     497 </span>            :     /* else if errfacet1, the error was logged to qh.ferr but does not effect the output */</a>
<a name="498"><span class="lineNum">     498 </span><span class="lineNoCov">          0 :     trace0((qh, qh-&gt;ferr, 21, &quot;qh_check_points: max distance outside %2.2g\n&quot;, maxdist));</span></a>
<a name="499"><span class="lineNum">     499 </span>            :   }</a>
<a name="500"><span class="lineNum">     500 </span><span class="lineNoCov">          0 : } /* check_points */</span></a>
<a name="501"><span class="lineNum">     501 </span>            : </a>
<a name="502"><span class="lineNum">     502 </span>            : </a>
<a name="503"><span class="lineNum">     503 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="504"><span class="lineNum">     504 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;checkconvex&quot;&gt;-&lt;/a&gt;</a>
<a name="505"><span class="lineNum">     505 </span>            : </a>
<a name="506"><span class="lineNum">     506 </span>            :   qh_checkconvex(qh, facetlist, fault )</a>
<a name="507"><span class="lineNum">     507 </span>            :     check that each ridge in facetlist is convex</a>
<a name="508"><span class="lineNum">     508 </span>            :     fault = qh_DATAfault if reporting errors from qh_initialhull with qh.ZEROcentrum</a>
<a name="509"><span class="lineNum">     509 </span>            :           = qh_ALGORITHMfault otherwise</a>
<a name="510"><span class="lineNum">     510 </span>            : </a>
<a name="511"><span class="lineNum">     511 </span>            :   returns:</a>
<a name="512"><span class="lineNum">     512 </span>            :     counts Zconcaveridges and Zcoplanarridges</a>
<a name="513"><span class="lineNum">     513 </span>            :     errors if !qh.FORCEoutput ('Fo') and concaveridge or if merging a coplanar ridge</a>
<a name="514"><span class="lineNum">     514 </span>            :     overwrites Voronoi centers if set by qh_setvoronoi_all/qh_ASvoronoi</a>
<a name="515"><span class="lineNum">     515 </span>            : </a>
<a name="516"><span class="lineNum">     516 </span>            :   notes:</a>
<a name="517"><span class="lineNum">     517 </span>            :     called by qh_initial_hull, qh_check_output, qh_all_merges ('Tc'), qh_build_withrestart ('QJ')</a>
<a name="518"><span class="lineNum">     518 </span>            :     does not test f.tricoplanar facets (qh_triangulate)</a>
<a name="519"><span class="lineNum">     519 </span>            :     must be no stronger than qh_test_appendmerge</a>
<a name="520"><span class="lineNum">     520 </span>            :     if not merging,</a>
<a name="521"><span class="lineNum">     521 </span>            :       tests vertices for neighboring simplicial facets &lt; -qh.DISTround</a>
<a name="522"><span class="lineNum">     522 </span>            :     else if ZEROcentrum and simplicial facet,</a>
<a name="523"><span class="lineNum">     523 </span>            :       tests vertices for neighboring simplicial facets &lt; 0.0</a>
<a name="524"><span class="lineNum">     524 </span>            :       tests centrums of neighboring nonsimplicial facets &lt; 0.0</a>
<a name="525"><span class="lineNum">     525 </span>            :     else if ZEROcentrum</a>
<a name="526"><span class="lineNum">     526 </span>            :       tests centrums of neighboring facets &lt; 0.0</a>
<a name="527"><span class="lineNum">     527 </span>            :     else</a>
<a name="528"><span class="lineNum">     528 </span>            :       tests centrums of neighboring facets &lt; -qh.DISTround ('En' 'Rn')</a>
<a name="529"><span class="lineNum">     529 </span>            :     Does not test against -qh.centrum_radius since repeated computations may have different round-off errors (e.g., 'Rn')</a>
<a name="530"><span class="lineNum">     530 </span>            : </a>
<a name="531"><span class="lineNum">     531 </span>            :   design:</a>
<a name="532"><span class="lineNum">     532 </span>            :     for all facets</a>
<a name="533"><span class="lineNum">     533 </span>            :       report flipped facets</a>
<a name="534"><span class="lineNum">     534 </span>            :       if ZEROcentrum and simplicial neighbors</a>
<a name="535"><span class="lineNum">     535 </span>            :         test vertices against neighbor</a>
<a name="536"><span class="lineNum">     536 </span>            :       else</a>
<a name="537"><span class="lineNum">     537 </span>            :         test centrum against neighbor</a>
<a name="538"><span class="lineNum">     538 </span>            : */</a>
<a name="539"><span class="lineNum">     539 </span><span class="lineCov">          8 : void qh_checkconvex(qhT *qh, facetT *facetlist, int fault) {</span></a>
<a name="540"><span class="lineNum">     540 </span><span class="lineCov">          8 :   facetT *facet, *neighbor, **neighborp, *errfacet1=NULL, *errfacet2=NULL;</span></a>
<a name="541"><span class="lineNum">     541 </span>            :   vertexT *vertex;</a>
<a name="542"><span class="lineNum">     542 </span>            :   realT dist;</a>
<a name="543"><span class="lineNum">     543 </span>            :   pointT *centrum;</a>
<a name="544"><span class="lineNum">     544 </span><span class="lineCov">          8 :   boolT waserror= False, centrum_warning= False, tempcentrum= False, first_nonsimplicial= False, tested_simplicial, allsimplicial;</span></a>
<a name="545"><span class="lineNum">     545 </span>            :   int neighbor_i, neighbor_n;</a>
<a name="546"><span class="lineNum">     546 </span>            : </a>
<a name="547"><span class="lineNum">     547 </span><span class="lineCov">          8 :   if (qh-&gt;ZEROcentrum) {</span></a>
<a name="548"><span class="lineNum">     548 </span><span class="lineCov">          8 :     trace1((qh, qh-&gt;ferr, 1064, &quot;qh_checkconvex: check that facets are not-flipped and for qh.ZEROcentrum that simplicial vertices are below their neighbor (dist&lt;0.0)\n&quot;));</span></a>
<a name="549"><span class="lineNum">     549 </span><span class="lineCov">          8 :     first_nonsimplicial= True;</span></a>
<a name="550"><span class="lineNum">     550 </span><span class="lineNoCov">          0 :   }else if (!qh-&gt;MERGING) {</span></a>
<a name="551"><span class="lineNum">     551 </span><span class="lineNoCov">          0 :     trace1((qh, qh-&gt;ferr, 1026, &quot;qh_checkconvex: check that facets are not-flipped and that simplicial vertices are convex by qh.DISTround ('En', 'Rn')\n&quot;));</span></a>
<a name="552"><span class="lineNum">     552 </span><span class="lineNoCov">          0 :     first_nonsimplicial= True;</span></a>
<a name="553"><span class="lineNum">     553 </span>            :   }else</a>
<a name="554"><span class="lineNum">     554 </span><span class="lineNoCov">          0 :     trace1((qh, qh-&gt;ferr, 1062, &quot;qh_checkconvex: check that facets are not-flipped and that their centrums are convex by qh.DISTround ('En', 'Rn') \n&quot;));</span></a>
<a name="555"><span class="lineNum">     555 </span><span class="lineCov">          8 :   if (!qh-&gt;RERUN) {</span></a>
<a name="556"><span class="lineNum">     556 </span><span class="lineCov">          8 :     zzval_(Zconcaveridges)= 0;</span></a>
<a name="557"><span class="lineNum">     557 </span><span class="lineCov">          8 :     zzval_(Zcoplanarridges)= 0;</span></a>
<a name="558"><span class="lineNum">     558 </span>            :   }</a>
<a name="559"><span class="lineNum">     559 </span><span class="lineCov">         40 :   FORALLfacet_(facetlist) {</span></a>
<a name="560"><span class="lineNum">     560 </span><span class="lineCov">         32 :     if (facet-&gt;flipped) {</span></a>
<a name="561"><span class="lineNum">     561 </span><span class="lineNoCov">          0 :       qh_joggle_restart(qh, &quot;flipped facet&quot;); /* also tested by qh_checkflipped */</span></a>
<a name="562"><span class="lineNum">     562 </span><span class="lineNoCov">          0 :       qh_fprintf(qh, qh-&gt;ferr, 6113, &quot;qhull precision error: f%d is flipped (interior point is outside)\n&quot;,</span></a>
<a name="563"><span class="lineNum">     563 </span>            :                facet-&gt;id);</a>
<a name="564"><span class="lineNum">     564 </span><span class="lineNoCov">          0 :       errfacet1= facet;</span></a>
<a name="565"><span class="lineNum">     565 </span><span class="lineNoCov">          0 :       waserror= True;</span></a>
<a name="566"><span class="lineNum">     566 </span><span class="lineNoCov">          0 :       continue;</span></a>
<a name="567"><span class="lineNum">     567 </span>            :     }</a>
<a name="568"><span class="lineNum">     568 </span><span class="lineCov">         32 :     if (facet-&gt;tricoplanar)</span></a>
<a name="569"><span class="lineNum">     569 </span><span class="lineNoCov">          0 :       continue;</span></a>
<a name="570"><span class="lineNum">     570 </span><span class="lineCov">         32 :     if (qh-&gt;MERGING &amp;&amp; (!qh-&gt;ZEROcentrum || !facet-&gt;simplicial)) {</span></a>
<a name="571"><span class="lineNum">     571 </span><span class="lineNoCov">          0 :       allsimplicial= False;</span></a>
<a name="572"><span class="lineNum">     572 </span><span class="lineNoCov">          0 :       tested_simplicial= False;</span></a>
<a name="573"><span class="lineNum">     573 </span>            :     }else {</a>
<a name="574"><span class="lineNum">     574 </span><span class="lineCov">         32 :       allsimplicial= True;</span></a>
<a name="575"><span class="lineNum">     575 </span><span class="lineCov">         32 :       tested_simplicial= True;</span></a>
<a name="576"><span class="lineNum">     576 </span><span class="lineCov">        128 :       FOREACHneighbor_i_(qh, facet) {</span></a>
<a name="577"><span class="lineNum">     577 </span><span class="lineCov">         96 :         if (neighbor-&gt;tricoplanar)</span></a>
<a name="578"><span class="lineNum">     578 </span><span class="lineNoCov">          0 :           continue;</span></a>
<a name="579"><span class="lineNum">     579 </span><span class="lineCov">         96 :         if (!neighbor-&gt;simplicial) {</span></a>
<a name="580"><span class="lineNum">     580 </span><span class="lineNoCov">          0 :           allsimplicial= False;</span></a>
<a name="581"><span class="lineNum">     581 </span><span class="lineNoCov">          0 :           continue;</span></a>
<a name="582"><span class="lineNum">     582 </span>            :         }</a>
<a name="583"><span class="lineNum">     583 </span><span class="lineCov">         96 :         vertex= SETelemt_(facet-&gt;vertices, neighbor_i, vertexT);</span></a>
<a name="584"><span class="lineNum">     584 </span><span class="lineCov">         96 :         qh_distplane(qh, vertex-&gt;point, neighbor, &amp;dist);</span></a>
<a name="585"><span class="lineNum">     585 </span><span class="lineCov">         96 :         if (dist &gt;= -qh-&gt;DISTround) {</span></a>
<a name="586"><span class="lineNum">     586 </span><span class="lineNoCov">          0 :           if (fault == qh_DATAfault) {</span></a>
<a name="587"><span class="lineNum">     587 </span><span class="lineNoCov">          0 :             qh_joggle_restart(qh, &quot;non-convex initial simplex&quot;);</span></a>
<a name="588"><span class="lineNum">     588 </span><span class="lineNoCov">          0 :             if (dist &gt; qh-&gt;DISTround)</span></a>
<a name="589"><span class="lineNum">     589 </span><span class="lineNoCov">          0 :               qh_fprintf(qh, qh-&gt;ferr, 6114, &quot;qhull precision error: initial simplex is not convex, since p%d(v%d) is %6.4g above opposite f%d\n&quot;,</span></a>
<a name="590"><span class="lineNum">     590 </span>            :                   qh_pointid(qh, vertex-&gt;point), vertex-&gt;id, dist, neighbor-&gt;id);</a>
<a name="591"><span class="lineNum">     591 </span>            :             else</a>
<a name="592"><span class="lineNum">     592 </span><span class="lineNoCov">          0 :               qh_fprintf(qh, qh-&gt;ferr, 6379, &quot;qhull precision error: initial simplex is not convex, since p%d(v%d) is within roundoff of opposite facet f%d (dist %6.4g)\n&quot;,</span></a>
<a name="593"><span class="lineNum">     593 </span>            :                   qh_pointid(qh, vertex-&gt;point), vertex-&gt;id, neighbor-&gt;id, dist);</a>
<a name="594"><span class="lineNum">     594 </span><span class="lineNoCov">          0 :             qh_errexit(qh, qh_ERRsingular, neighbor, NULL);</span></a>
<a name="595"><span class="lineNum">     595 </span>            :           }</a>
<a name="596"><span class="lineNum">     596 </span><span class="lineNoCov">          0 :           if (dist &gt; qh-&gt;DISTround) {</span></a>
<a name="597"><span class="lineNum">     597 </span><span class="lineNoCov">          0 :             zzinc_(Zconcaveridges);</span></a>
<a name="598"><span class="lineNum">     598 </span><span class="lineNoCov">          0 :             qh_joggle_restart(qh, &quot;concave ridge&quot;);</span></a>
<a name="599"><span class="lineNum">     599 </span><span class="lineNoCov">          0 :             qh_fprintf(qh, qh-&gt;ferr, 6115, &quot;qhull precision error: f%d is concave to f%d, since p%d(v%d) is %6.4g above f%d\n&quot;,</span></a>
<a name="600"><span class="lineNum">     600 </span>            :               facet-&gt;id, neighbor-&gt;id, qh_pointid(qh, vertex-&gt;point), vertex-&gt;id, dist, neighbor-&gt;id);</a>
<a name="601"><span class="lineNum">     601 </span><span class="lineNoCov">          0 :             errfacet1= facet;</span></a>
<a name="602"><span class="lineNum">     602 </span><span class="lineNoCov">          0 :             errfacet2= neighbor;</span></a>
<a name="603"><span class="lineNum">     603 </span><span class="lineNoCov">          0 :             waserror= True;</span></a>
<a name="604"><span class="lineNum">     604 </span><span class="lineNoCov">          0 :           }else if (qh-&gt;ZEROcentrum) {</span></a>
<a name="605"><span class="lineNum">     605 </span><span class="lineNoCov">          0 :             if (dist &gt; 0.0) {     /* qh_checkzero checked convex (dist &lt; (- 2*qh-&gt;DISTround)), computation may differ e.g. 'Rn' */</span></a>
<a name="606"><span class="lineNum">     606 </span><span class="lineNoCov">          0 :               zzinc_(Zcoplanarridges);</span></a>
<a name="607"><span class="lineNum">     607 </span><span class="lineNoCov">          0 :               qh_joggle_restart(qh, &quot;coplanar ridge&quot;);</span></a>
<a name="608"><span class="lineNum">     608 </span><span class="lineNoCov">          0 :               qh_fprintf(qh, qh-&gt;ferr, 6116, &quot;qhull precision error: f%d is clearly not convex to f%d, since p%d(v%d) is %6.4g above or coplanar with f%d with qh.ZEROcentrum\n&quot;,</span></a>
<a name="609"><span class="lineNum">     609 </span>            :                 facet-&gt;id, neighbor-&gt;id, qh_pointid(qh, vertex-&gt;point), vertex-&gt;id, dist, neighbor-&gt;id);</a>
<a name="610"><span class="lineNum">     610 </span><span class="lineNoCov">          0 :               errfacet1= facet;</span></a>
<a name="611"><span class="lineNum">     611 </span><span class="lineNoCov">          0 :               errfacet2= neighbor;</span></a>
<a name="612"><span class="lineNum">     612 </span><span class="lineNoCov">          0 :               waserror= True;</span></a>
<a name="613"><span class="lineNum">     613 </span>            :             }</a>
<a name="614"><span class="lineNum">     614 </span>            :           }else {</a>
<a name="615"><span class="lineNum">     615 </span><span class="lineNoCov">          0 :             zzinc_(Zcoplanarridges);</span></a>
<a name="616"><span class="lineNum">     616 </span><span class="lineNoCov">          0 :             qh_joggle_restart(qh, &quot;coplanar ridge&quot;);</span></a>
<a name="617"><span class="lineNum">     617 </span><span class="lineNoCov">          0 :             trace0((qh, qh-&gt;ferr, 22, &quot;qhull precision error: f%d is coplanar to f%d, since p%d(v%d) is within %6.4g of f%d, during p%d\n&quot;,</span></a>
<a name="618"><span class="lineNum">     618 </span>            :               facet-&gt;id, neighbor-&gt;id, qh_pointid(qh, vertex-&gt;point), vertex-&gt;id, dist, neighbor-&gt;id, qh-&gt;furthest_id));</a>
<a name="619"><span class="lineNum">     619 </span>            :           }</a>
<a name="620"><span class="lineNum">     620 </span>            :         }</a>
<a name="621"><span class="lineNum">     621 </span>            :       }</a>
<a name="622"><span class="lineNum">     622 </span>            :     }</a>
<a name="623"><span class="lineNum">     623 </span><span class="lineCov">         32 :     if (!allsimplicial) {</span></a>
<a name="624"><span class="lineNum">     624 </span><span class="lineNoCov">          0 :       if (first_nonsimplicial) {</span></a>
<a name="625"><span class="lineNum">     625 </span><span class="lineNoCov">          0 :         trace1((qh, qh-&gt;ferr, 1063, &quot;qh_checkconvex: starting with f%d, also check that centrums of non-simplicial ridges are below their neighbors (dist&lt;0.0)\n&quot;,</span></a>
<a name="626"><span class="lineNum">     626 </span>            :              facet-&gt;id));</a>
<a name="627"><span class="lineNum">     627 </span><span class="lineNoCov">          0 :         first_nonsimplicial= False;</span></a>
<a name="628"><span class="lineNum">     628 </span>            :       }</a>
<a name="629"><span class="lineNum">     629 </span><span class="lineNoCov">          0 :       if (qh-&gt;CENTERtype == qh_AScentrum) {</span></a>
<a name="630"><span class="lineNum">     630 </span><span class="lineNoCov">          0 :         if (!facet-&gt;center)</span></a>
<a name="631"><span class="lineNum">     631 </span><span class="lineNoCov">          0 :           facet-&gt;center= qh_getcentrum(qh, facet);</span></a>
<a name="632"><span class="lineNum">     632 </span><span class="lineNoCov">          0 :         centrum= facet-&gt;center;</span></a>
<a name="633"><span class="lineNum">     633 </span>            :       }else {</a>
<a name="634"><span class="lineNum">     634 </span><span class="lineNoCov">          0 :         if (!centrum_warning &amp;&amp; !facet-&gt;simplicial) {  /* recomputed centrum correct for simplicial facets */</span></a>
<a name="635"><span class="lineNum">     635 </span><span class="lineNoCov">          0 :            centrum_warning= True;</span></a>
<a name="636"><span class="lineNum">     636 </span><span class="lineNoCov">          0 :            qh_fprintf(qh, qh-&gt;ferr, 7062, &quot;qhull warning: recomputing centrums for convexity test.  This may lead to false, precision errors.\n&quot;);</span></a>
<a name="637"><span class="lineNum">     637 </span>            :         }</a>
<a name="638"><span class="lineNum">     638 </span><span class="lineNoCov">          0 :         centrum= qh_getcentrum(qh, facet);</span></a>
<a name="639"><span class="lineNum">     639 </span><span class="lineNoCov">          0 :         tempcentrum= True;</span></a>
<a name="640"><span class="lineNum">     640 </span>            :       }</a>
<a name="641"><span class="lineNum">     641 </span><span class="lineNoCov">          0 :       FOREACHneighbor_(facet) {</span></a>
<a name="642"><span class="lineNum">     642 </span><span class="lineNoCov">          0 :         if (neighbor-&gt;simplicial &amp;&amp; tested_simplicial) /* tested above since f.simplicial */</span></a>
<a name="643"><span class="lineNum">     643 </span><span class="lineNoCov">          0 :           continue;</span></a>
<a name="644"><span class="lineNum">     644 </span><span class="lineNoCov">          0 :         if (neighbor-&gt;tricoplanar)</span></a>
<a name="645"><span class="lineNum">     645 </span><span class="lineNoCov">          0 :           continue;</span></a>
<a name="646"><span class="lineNum">     646 </span><span class="lineNoCov">          0 :         zzinc_(Zdistconvex);</span></a>
<a name="647"><span class="lineNum">     647 </span><span class="lineNoCov">          0 :         qh_distplane(qh, centrum, neighbor, &amp;dist);</span></a>
<a name="648"><span class="lineNum">     648 </span><span class="lineNoCov">          0 :         if (dist &gt; qh-&gt;DISTround) {</span></a>
<a name="649"><span class="lineNum">     649 </span><span class="lineNoCov">          0 :           zzinc_(Zconcaveridges);</span></a>
<a name="650"><span class="lineNum">     650 </span><span class="lineNoCov">          0 :           qh_joggle_restart(qh, &quot;concave ridge&quot;);</span></a>
<a name="651"><span class="lineNum">     651 </span><span class="lineNoCov">          0 :           qh_fprintf(qh, qh-&gt;ferr, 6117, &quot;qhull precision error: f%d is concave to f%d.  Centrum of f%d is %6.4g above f%d\n&quot;,</span></a>
<a name="652"><span class="lineNum">     652 </span>            :             facet-&gt;id, neighbor-&gt;id, facet-&gt;id, dist, neighbor-&gt;id);</a>
<a name="653"><span class="lineNum">     653 </span><span class="lineNoCov">          0 :           errfacet1= facet;</span></a>
<a name="654"><span class="lineNum">     654 </span><span class="lineNoCov">          0 :           errfacet2= neighbor;</span></a>
<a name="655"><span class="lineNum">     655 </span><span class="lineNoCov">          0 :           waserror= True;</span></a>
<a name="656"><span class="lineNum">     656 </span><span class="lineNoCov">          0 :         }else if (dist &gt;= 0.0) {   /* if arithmetic always rounds the same,</span></a>
<a name="657"><span class="lineNum">     657 </span>            :                                      can test against centrum radius instead */</a>
<a name="658"><span class="lineNum">     658 </span><span class="lineNoCov">          0 :           zzinc_(Zcoplanarridges);</span></a>
<a name="659"><span class="lineNum">     659 </span><span class="lineNoCov">          0 :           qh_joggle_restart(qh, &quot;coplanar ridge&quot;);</span></a>
<a name="660"><span class="lineNum">     660 </span><span class="lineNoCov">          0 :           qh_fprintf(qh, qh-&gt;ferr, 6118, &quot;qhull precision error: f%d is coplanar or concave to f%d.  Centrum of f%d is %6.4g above f%d\n&quot;,</span></a>
<a name="661"><span class="lineNum">     661 </span>            :             facet-&gt;id, neighbor-&gt;id, facet-&gt;id, dist, neighbor-&gt;id);</a>
<a name="662"><span class="lineNum">     662 </span><span class="lineNoCov">          0 :           errfacet1= facet;</span></a>
<a name="663"><span class="lineNum">     663 </span><span class="lineNoCov">          0 :           errfacet2= neighbor;</span></a>
<a name="664"><span class="lineNum">     664 </span><span class="lineNoCov">          0 :           waserror= True;</span></a>
<a name="665"><span class="lineNum">     665 </span>            :         }</a>
<a name="666"><span class="lineNum">     666 </span>            :       }</a>
<a name="667"><span class="lineNum">     667 </span><span class="lineNoCov">          0 :       if (tempcentrum)</span></a>
<a name="668"><span class="lineNum">     668 </span><span class="lineNoCov">          0 :         qh_memfree(qh, centrum, qh-&gt;normal_size);</span></a>
<a name="669"><span class="lineNum">     669 </span>            :     }</a>
<a name="670"><span class="lineNum">     670 </span>            :   }</a>
<a name="671"><span class="lineNum">     671 </span><span class="lineCov">          8 :   if (waserror &amp;&amp; !qh-&gt;FORCEoutput)</span></a>
<a name="672"><span class="lineNum">     672 </span><span class="lineNoCov">          0 :     qh_errexit2(qh, qh_ERRprec, errfacet1, errfacet2);</span></a>
<a name="673"><span class="lineNum">     673 </span><span class="lineCov">          8 : } /* checkconvex */</span></a>
<a name="674"><span class="lineNum">     674 </span>            : </a>
<a name="675"><span class="lineNum">     675 </span>            : </a>
<a name="676"><span class="lineNum">     676 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="677"><span class="lineNum">     677 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;checkfacet&quot;&gt;-&lt;/a&gt;</a>
<a name="678"><span class="lineNum">     678 </span>            : </a>
<a name="679"><span class="lineNum">     679 </span>            :   qh_checkfacet(qh, facet, newmerge, waserror )</a>
<a name="680"><span class="lineNum">     680 </span>            :     checks for consistency errors in facet</a>
<a name="681"><span class="lineNum">     681 </span>            :     newmerge set if from merge_r.c</a>
<a name="682"><span class="lineNum">     682 </span>            : </a>
<a name="683"><span class="lineNum">     683 </span>            :   returns:</a>
<a name="684"><span class="lineNum">     684 </span>            :     sets waserror if any error occurs</a>
<a name="685"><span class="lineNum">     685 </span>            : </a>
<a name="686"><span class="lineNum">     686 </span>            :   checks:</a>
<a name="687"><span class="lineNum">     687 </span>            :     vertex ids are inverse sorted</a>
<a name="688"><span class="lineNum">     688 </span>            :     unless newmerge, at least hull_dim neighbors and vertices (exactly if simplicial)</a>
<a name="689"><span class="lineNum">     689 </span>            :     if non-simplicial, at least as many ridges as neighbors</a>
<a name="690"><span class="lineNum">     690 </span>            :     neighbors are not duplicated</a>
<a name="691"><span class="lineNum">     691 </span>            :     ridges are not duplicated</a>
<a name="692"><span class="lineNum">     692 </span>            :     in 3-d, ridges=vertices</a>
<a name="693"><span class="lineNum">     693 </span>            :     (qh.hull_dim-1) ridge vertices</a>
<a name="694"><span class="lineNum">     694 </span>            :     neighbors are reciprocated</a>
<a name="695"><span class="lineNum">     695 </span>            :     ridge neighbors are facet neighbors and a ridge for every neighbor</a>
<a name="696"><span class="lineNum">     696 </span>            :     simplicial neighbors match facetintersect</a>
<a name="697"><span class="lineNum">     697 </span>            :     vertex intersection matches vertices of common ridges</a>
<a name="698"><span class="lineNum">     698 </span>            :     vertex neighbors and facet vertices agree</a>
<a name="699"><span class="lineNum">     699 </span>            :     all ridges have distinct vertex sets</a>
<a name="700"><span class="lineNum">     700 </span>            : </a>
<a name="701"><span class="lineNum">     701 </span>            :   notes:</a>
<a name="702"><span class="lineNum">     702 </span>            :     called by qh_tracemerge and qh_checkpolygon</a>
<a name="703"><span class="lineNum">     703 </span>            :     uses neighbor-&gt;seen</a>
<a name="704"><span class="lineNum">     704 </span>            : </a>
<a name="705"><span class="lineNum">     705 </span>            :   design:</a>
<a name="706"><span class="lineNum">     706 </span>            :     check sets</a>
<a name="707"><span class="lineNum">     707 </span>            :     check vertices</a>
<a name="708"><span class="lineNum">     708 </span>            :     check sizes of neighbors and vertices</a>
<a name="709"><span class="lineNum">     709 </span>            :     check for qh_MERGEridge and qh_DUPLICATEridge flags</a>
<a name="710"><span class="lineNum">     710 </span>            :     check neighbor set</a>
<a name="711"><span class="lineNum">     711 </span>            :     check ridge set</a>
<a name="712"><span class="lineNum">     712 </span>            :     check ridges, neighbors, and vertices</a>
<a name="713"><span class="lineNum">     713 </span>            : */</a>
<a name="714"><span class="lineNum">     714 </span><span class="lineCov">         32 : void qh_checkfacet(qhT *qh, facetT *facet, boolT newmerge, boolT *waserrorp) {</span></a>
<a name="715"><span class="lineNum">     715 </span><span class="lineCov">         32 :   facetT *neighbor, **neighborp, *errother=NULL;</span></a>
<a name="716"><span class="lineNum">     716 </span><span class="lineCov">         32 :   ridgeT *ridge, **ridgep, *errridge= NULL, *ridge2;</span></a>
<a name="717"><span class="lineNum">     717 </span>            :   vertexT *vertex, **vertexp;</a>
<a name="718"><span class="lineNum">     718 </span><span class="lineCov">         32 :   unsigned int previousid= INT_MAX;</span></a>
<a name="719"><span class="lineNum">     719 </span><span class="lineCov">         32 :   int numneighbors, numvertices, numridges=0, numRvertices=0;</span></a>
<a name="720"><span class="lineNum">     720 </span><span class="lineCov">         32 :   boolT waserror= False;</span></a>
<a name="721"><span class="lineNum">     721 </span><span class="lineCov">         32 :   int skipA, skipB, ridge_i, ridge_n, i, last_v= qh-&gt;hull_dim-2;</span></a>
<a name="722"><span class="lineNum">     722 </span>            :   setT *intersection;</a>
<a name="723"><span class="lineNum">     723 </span>            : </a>
<a name="724"><span class="lineNum">     724 </span><span class="lineCov">         32 :   trace4((qh, qh-&gt;ferr, 4088, &quot;qh_checkfacet: check f%d newmerge? %d\n&quot;, facet-&gt;id, newmerge));</span></a>
<a name="725"><span class="lineNum">     725 </span><span class="lineCov">         32 :   if (facet-&gt;id &gt;= qh-&gt;facet_id) {</span></a>
<a name="726"><span class="lineNum">     726 </span><span class="lineNoCov">          0 :     qh_fprintf(qh, qh-&gt;ferr, 6414, &quot;qhull internal error (qh_checkfacet): unknown facet id f%d &gt;= qh.facet_id (%d)\n&quot;, facet-&gt;id, qh-&gt;facet_id);</span></a>
<a name="727"><span class="lineNum">     727 </span><span class="lineNoCov">          0 :     waserror= True;</span></a>
<a name="728"><span class="lineNum">     728 </span>            :   }</a>
<a name="729"><span class="lineNum">     729 </span><span class="lineCov">         32 :   if (facet-&gt;visitid &gt; qh-&gt;visit_id) {</span></a>
<a name="730"><span class="lineNum">     730 </span><span class="lineNoCov">          0 :     qh_fprintf(qh, qh-&gt;ferr, 6415, &quot;qhull internal error (qh_checkfacet): expecting f%d.visitid &lt;= qh.visit_id (%d).  Got visitid %d\n&quot;, facet-&gt;id, qh-&gt;visit_id, facet-&gt;visitid);</span></a>
<a name="731"><span class="lineNum">     731 </span><span class="lineNoCov">          0 :     waserror= True;</span></a>
<a name="732"><span class="lineNum">     732 </span>            :   }</a>
<a name="733"><span class="lineNum">     733 </span><span class="lineCov">         32 :   if (facet-&gt;visible &amp;&amp; !qh-&gt;NEWtentative) {</span></a>
<a name="734"><span class="lineNum">     734 </span><span class="lineNoCov">          0 :     qh_fprintf(qh, qh-&gt;ferr, 6119, &quot;qhull internal error (qh_checkfacet): facet f%d is on qh.visible_list\n&quot;,</span></a>
<a name="735"><span class="lineNum">     735 </span>            :       facet-&gt;id);</a>
<a name="736"><span class="lineNum">     736 </span><span class="lineNoCov">          0 :     qh_errexit(qh, qh_ERRqhull, facet, NULL);</span></a>
<a name="737"><span class="lineNum">     737 </span>            :   }</a>
<a name="738"><span class="lineNum">     738 </span><span class="lineCov">         32 :   if (facet-&gt;redundant &amp;&amp; !facet-&gt;visible &amp;&amp; qh_setsize(qh, qh-&gt;degen_mergeset)==0) {</span></a>
<a name="739"><span class="lineNum">     739 </span><span class="lineNoCov">          0 :     qh_fprintf(qh, qh-&gt;ferr, 6399, &quot;qhull internal error (qh_checkfacet): redundant facet f%d not on qh.visible_list\n&quot;,</span></a>
<a name="740"><span class="lineNum">     740 </span>            :       facet-&gt;id);</a>
<a name="741"><span class="lineNum">     741 </span><span class="lineNoCov">          0 :     waserror= True;</span></a>
<a name="742"><span class="lineNum">     742 </span>            :   }</a>
<a name="743"><span class="lineNum">     743 </span><span class="lineCov">         32 :   if (facet-&gt;degenerate &amp;&amp; !facet-&gt;visible &amp;&amp; qh_setsize(qh, qh-&gt;degen_mergeset)==0) {</span></a>
<a name="744"><span class="lineNum">     744 </span><span class="lineNoCov">          0 :     qh_fprintf(qh, qh-&gt;ferr, 6400, &quot;qhull internal error (qh_checkfacet): degenerate facet f%d is not on qh.visible_list and qh.degen_mergeset is empty\n&quot;,</span></a>
<a name="745"><span class="lineNum">     745 </span>            :       facet-&gt;id);</a>
<a name="746"><span class="lineNum">     746 </span><span class="lineNoCov">          0 :     waserror= True;</span></a>
<a name="747"><span class="lineNum">     747 </span>            :   }</a>
<a name="748"><span class="lineNum">     748 </span><span class="lineCov">         32 :   if (!facet-&gt;normal) {</span></a>
<a name="749"><span class="lineNum">     749 </span><span class="lineNoCov">          0 :     qh_fprintf(qh, qh-&gt;ferr, 6120, &quot;qhull internal error (qh_checkfacet): facet f%d does not have a normal\n&quot;,</span></a>
<a name="750"><span class="lineNum">     750 </span>            :       facet-&gt;id);</a>
<a name="751"><span class="lineNum">     751 </span><span class="lineNoCov">          0 :     waserror= True;</span></a>
<a name="752"><span class="lineNum">     752 </span>            :   }</a>
<a name="753"><span class="lineNum">     753 </span><span class="lineCov">         32 :   if (!facet-&gt;newfacet) {</span></a>
<a name="754"><span class="lineNum">     754 </span><span class="lineCov">         32 :     if (facet-&gt;dupridge) {</span></a>
<a name="755"><span class="lineNum">     755 </span><span class="lineNoCov">          0 :       qh_fprintf(qh, qh-&gt;ferr, 6349, &quot;qhull internal error (qh_checkfacet): f%d is 'dupridge' but it is not a newfacet on qh.newfacet_list f%d\n&quot;,</span></a>
<a name="756"><span class="lineNum">     756 </span><span class="lineNoCov">          0 :         facet-&gt;id, getid_(qh-&gt;newfacet_list));</span></a>
<a name="757"><span class="lineNum">     757 </span><span class="lineNoCov">          0 :       waserror= True;</span></a>
<a name="758"><span class="lineNum">     758 </span>            :     }</a>
<a name="759"><span class="lineNum">     759 </span><span class="lineCov">         32 :     if (facet-&gt;newmerge) {</span></a>
<a name="760"><span class="lineNum">     760 </span><span class="lineNoCov">          0 :       qh_fprintf(qh, qh-&gt;ferr, 6383, &quot;qhull internal error (qh_checkfacet): f%d is 'newmerge' but it is not a newfacet on qh.newfacet_list f%d.  Missing call to qh_reducevertices\n&quot;,</span></a>
<a name="761"><span class="lineNum">     761 </span><span class="lineNoCov">          0 :         facet-&gt;id, getid_(qh-&gt;newfacet_list));</span></a>
<a name="762"><span class="lineNum">     762 </span><span class="lineNoCov">          0 :       waserror= True;</span></a>
<a name="763"><span class="lineNum">     763 </span>            :     }</a>
<a name="764"><span class="lineNum">     764 </span>            :   }</a>
<a name="765"><span class="lineNum">     765 </span><span class="lineCov">         32 :   qh_setcheck(qh, facet-&gt;vertices, &quot;vertices for f&quot;, facet-&gt;id);</span></a>
<a name="766"><span class="lineNum">     766 </span><span class="lineCov">         32 :   qh_setcheck(qh, facet-&gt;ridges, &quot;ridges for f&quot;, facet-&gt;id);</span></a>
<a name="767"><span class="lineNum">     767 </span><span class="lineCov">         32 :   qh_setcheck(qh, facet-&gt;outsideset, &quot;outsideset for f&quot;, facet-&gt;id);</span></a>
<a name="768"><span class="lineNum">     768 </span><span class="lineCov">         32 :   qh_setcheck(qh, facet-&gt;coplanarset, &quot;coplanarset for f&quot;, facet-&gt;id);</span></a>
<a name="769"><span class="lineNum">     769 </span><span class="lineCov">         32 :   qh_setcheck(qh, facet-&gt;neighbors, &quot;neighbors for f&quot;, facet-&gt;id);</span></a>
<a name="770"><span class="lineNum">     770 </span><span class="lineCov">        128 :   FOREACHvertex_(facet-&gt;vertices) {</span></a>
<a name="771"><span class="lineNum">     771 </span><span class="lineCov">         96 :     if (vertex-&gt;deleted) {</span></a>
<a name="772"><span class="lineNum">     772 </span><span class="lineNoCov">          0 :       qh_fprintf(qh, qh-&gt;ferr, 6121, &quot;qhull internal error (qh_checkfacet): deleted vertex v%d in f%d\n&quot;, vertex-&gt;id, facet-&gt;id);</span></a>
<a name="773"><span class="lineNum">     773 </span><span class="lineNoCov">          0 :       qh_errprint(qh, &quot;ERRONEOUS&quot;, NULL, NULL, NULL, vertex);</span></a>
<a name="774"><span class="lineNum">     774 </span><span class="lineNoCov">          0 :       waserror= True;</span></a>
<a name="775"><span class="lineNum">     775 </span>            :     }</a>
<a name="776"><span class="lineNum">     776 </span><span class="lineCov">         96 :     if (vertex-&gt;id &gt;= previousid) {</span></a>
<a name="777"><span class="lineNum">     777 </span><span class="lineNoCov">          0 :       qh_fprintf(qh, qh-&gt;ferr, 6122, &quot;qhull internal error (qh_checkfacet): vertices of f%d are not in descending id order at v%d\n&quot;, facet-&gt;id, vertex-&gt;id);</span></a>
<a name="778"><span class="lineNum">     778 </span><span class="lineNoCov">          0 :       waserror= True;</span></a>
<a name="779"><span class="lineNum">     779 </span><span class="lineNoCov">          0 :       break;</span></a>
<a name="780"><span class="lineNum">     780 </span>            :     }</a>
<a name="781"><span class="lineNum">     781 </span><span class="lineCov">         96 :     previousid= vertex-&gt;id;</span></a>
<a name="782"><span class="lineNum">     782 </span>            :   }</a>
<a name="783"><span class="lineNum">     783 </span><span class="lineCov">         32 :   numneighbors= qh_setsize(qh, facet-&gt;neighbors);</span></a>
<a name="784"><span class="lineNum">     784 </span><span class="lineCov">         32 :   numvertices= qh_setsize(qh, facet-&gt;vertices);</span></a>
<a name="785"><span class="lineNum">     785 </span><span class="lineCov">         32 :   numridges= qh_setsize(qh, facet-&gt;ridges);</span></a>
<a name="786"><span class="lineNum">     786 </span><span class="lineCov">         32 :   if (facet-&gt;simplicial) {</span></a>
<a name="787"><span class="lineNum">     787 </span><span class="lineCov">         32 :     if (numvertices+numneighbors != 2*qh-&gt;hull_dim</span></a>
<a name="788"><span class="lineNum">     788 </span><span class="lineNoCov">          0 :     &amp;&amp; !facet-&gt;degenerate &amp;&amp; !facet-&gt;redundant) {</span></a>
<a name="789"><span class="lineNum">     789 </span><span class="lineNoCov">          0 :       qh_fprintf(qh, qh-&gt;ferr, 6123, &quot;qhull internal error (qh_checkfacet): for simplicial facet f%d, #vertices %d + #neighbors %d != 2*qh-&gt;hull_dim\n&quot;,</span></a>
<a name="790"><span class="lineNum">     790 </span>            :                 facet-&gt;id, numvertices, numneighbors);</a>
<a name="791"><span class="lineNum">     791 </span><span class="lineNoCov">          0 :       qh_setprint(qh, qh-&gt;ferr, &quot;&quot;, facet-&gt;neighbors);</span></a>
<a name="792"><span class="lineNum">     792 </span><span class="lineNoCov">          0 :       waserror= True;</span></a>
<a name="793"><span class="lineNum">     793 </span>            :     }</a>
<a name="794"><span class="lineNum">     794 </span>            :   }else { /* non-simplicial */</a>
<a name="795"><span class="lineNum">     795 </span><span class="lineNoCov">          0 :     if (!newmerge</span></a>
<a name="796"><span class="lineNum">     796 </span><span class="lineNoCov">          0 :     &amp;&amp;(numvertices &lt; qh-&gt;hull_dim || numneighbors &lt; qh-&gt;hull_dim)</span></a>
<a name="797"><span class="lineNum">     797 </span><span class="lineNoCov">          0 :     &amp;&amp; !facet-&gt;degenerate &amp;&amp; !facet-&gt;redundant) {</span></a>
<a name="798"><span class="lineNum">     798 </span><span class="lineNoCov">          0 :       qh_fprintf(qh, qh-&gt;ferr, 6124, &quot;qhull internal error (qh_checkfacet): for facet f%d, #vertices %d or #neighbors %d &lt; qh-&gt;hull_dim\n&quot;,</span></a>
<a name="799"><span class="lineNum">     799 </span>            :          facet-&gt;id, numvertices, numneighbors);</a>
<a name="800"><span class="lineNum">     800 </span><span class="lineNoCov">          0 :        waserror= True;</span></a>
<a name="801"><span class="lineNum">     801 </span>            :     }</a>
<a name="802"><span class="lineNum">     802 </span>            :     /* in 3-d, can get a vertex twice in an edge list, e.g., RBOX 1000 s W1e-13 t995849315 D2 | QHULL d Tc Tv TP624 TW1e-13 T4 */</a>
<a name="803"><span class="lineNum">     803 </span><span class="lineNoCov">          0 :     if (numridges &lt; numneighbors</span></a>
<a name="804"><span class="lineNum">     804 </span><span class="lineNoCov">          0 :     ||(qh-&gt;hull_dim == 3 &amp;&amp; numvertices &gt; numridges &amp;&amp; !qh-&gt;NEWfacets)</span></a>
<a name="805"><span class="lineNum">     805 </span><span class="lineNoCov">          0 :     ||(qh-&gt;hull_dim == 2 &amp;&amp; numridges + numvertices + numneighbors != 6)) {</span></a>
<a name="806"><span class="lineNum">     806 </span><span class="lineNoCov">          0 :       if (!facet-&gt;degenerate &amp;&amp; !facet-&gt;redundant) {</span></a>
<a name="807"><span class="lineNum">     807 </span><span class="lineNoCov">          0 :         qh_fprintf(qh, qh-&gt;ferr, 6125, &quot;qhull internal error (qh_checkfacet): for facet f%d, #ridges %d &lt; #neighbors %d or(3-d) &gt; #vertices %d or(2-d) not all 2\n&quot;,</span></a>
<a name="808"><span class="lineNum">     808 </span>            :             facet-&gt;id, numridges, numneighbors, numvertices);</a>
<a name="809"><span class="lineNum">     809 </span><span class="lineNoCov">          0 :         waserror= True;</span></a>
<a name="810"><span class="lineNum">     810 </span>            :       }</a>
<a name="811"><span class="lineNum">     811 </span>            :     }</a>
<a name="812"><span class="lineNum">     812 </span>            :   }</a>
<a name="813"><span class="lineNum">     813 </span><span class="lineCov">        128 :   FOREACHneighbor_(facet) {</span></a>
<a name="814"><span class="lineNum">     814 </span><span class="lineCov">         96 :     if (neighbor == qh_MERGEridge || neighbor == qh_DUPLICATEridge) {</span></a>
<a name="815"><span class="lineNum">     815 </span><span class="lineNoCov">          0 :       qh_fprintf(qh, qh-&gt;ferr, 6126, &quot;qhull internal error (qh_checkfacet): facet f%d still has a MERGEridge or DUPLICATEridge neighbor\n&quot;, facet-&gt;id);</span></a>
<a name="816"><span class="lineNum">     816 </span><span class="lineNoCov">          0 :       qh_errexit(qh, qh_ERRqhull, facet, NULL);</span></a>
<a name="817"><span class="lineNum">     817 </span>            :     }</a>
<a name="818"><span class="lineNum">     818 </span><span class="lineCov">         96 :     if (neighbor-&gt;visible) {</span></a>
<a name="819"><span class="lineNum">     819 </span><span class="lineNoCov">          0 :       qh_fprintf(qh, qh-&gt;ferr, 6401, &quot;qhull internal error (qh_checkfacet): facet f%d has deleted neighbor f%d (qh.visible_list)\n&quot;,</span></a>
<a name="820"><span class="lineNum">     820 </span>            :         facet-&gt;id, neighbor-&gt;id);</a>
<a name="821"><span class="lineNum">     821 </span><span class="lineNoCov">          0 :       errother= neighbor;</span></a>
<a name="822"><span class="lineNum">     822 </span><span class="lineNoCov">          0 :       waserror= True;</span></a>
<a name="823"><span class="lineNum">     823 </span>            :     }</a>
<a name="824"><span class="lineNum">     824 </span><span class="lineCov">         96 :     neighbor-&gt;seen= True;</span></a>
<a name="825"><span class="lineNum">     825 </span>            :   }</a>
<a name="826"><span class="lineNum">     826 </span><span class="lineCov">        128 :   FOREACHneighbor_(facet) {</span></a>
<a name="827"><span class="lineNum">     827 </span><span class="lineCov">         96 :     if (!qh_setin(neighbor-&gt;neighbors, facet)) {</span></a>
<a name="828"><span class="lineNum">     828 </span><span class="lineNoCov">          0 :       qh_fprintf(qh, qh-&gt;ferr, 6127, &quot;qhull internal error (qh_checkfacet): facet f%d has neighbor f%d, but f%d does not have neighbor f%d\n&quot;,</span></a>
<a name="829"><span class="lineNum">     829 </span>            :               facet-&gt;id, neighbor-&gt;id, neighbor-&gt;id, facet-&gt;id);</a>
<a name="830"><span class="lineNum">     830 </span><span class="lineNoCov">          0 :       errother= neighbor;</span></a>
<a name="831"><span class="lineNum">     831 </span><span class="lineNoCov">          0 :       waserror= True;</span></a>
<a name="832"><span class="lineNum">     832 </span>            :     }</a>
<a name="833"><span class="lineNum">     833 </span><span class="lineCov">         96 :     if (!neighbor-&gt;seen) {</span></a>
<a name="834"><span class="lineNum">     834 </span><span class="lineNoCov">          0 :       qh_fprintf(qh, qh-&gt;ferr, 6128, &quot;qhull internal error (qh_checkfacet): facet f%d has a duplicate neighbor f%d\n&quot;,</span></a>
<a name="835"><span class="lineNum">     835 </span>            :               facet-&gt;id, neighbor-&gt;id);</a>
<a name="836"><span class="lineNum">     836 </span><span class="lineNoCov">          0 :       errother= neighbor;</span></a>
<a name="837"><span class="lineNum">     837 </span><span class="lineNoCov">          0 :       waserror= True;</span></a>
<a name="838"><span class="lineNum">     838 </span>            :     }</a>
<a name="839"><span class="lineNum">     839 </span><span class="lineCov">         96 :     neighbor-&gt;seen= False;</span></a>
<a name="840"><span class="lineNum">     840 </span>            :   }</a>
<a name="841"><span class="lineNum">     841 </span><span class="lineCov">         32 :   FOREACHridge_(facet-&gt;ridges) {</span></a>
<a name="842"><span class="lineNum">     842 </span><span class="lineNoCov">          0 :     qh_setcheck(qh, ridge-&gt;vertices, &quot;vertices for r&quot;, ridge-&gt;id);</span></a>
<a name="843"><span class="lineNum">     843 </span><span class="lineNoCov">          0 :     ridge-&gt;seen= False;</span></a>
<a name="844"><span class="lineNum">     844 </span>            :   }</a>
<a name="845"><span class="lineNum">     845 </span><span class="lineCov">         32 :   FOREACHridge_(facet-&gt;ridges) {</span></a>
<a name="846"><span class="lineNum">     846 </span><span class="lineNoCov">          0 :     if (ridge-&gt;seen) {</span></a>
<a name="847"><span class="lineNum">     847 </span><span class="lineNoCov">          0 :       qh_fprintf(qh, qh-&gt;ferr, 6129, &quot;qhull internal error (qh_checkfacet): facet f%d has a duplicate ridge r%d\n&quot;,</span></a>
<a name="848"><span class="lineNum">     848 </span>            :               facet-&gt;id, ridge-&gt;id);</a>
<a name="849"><span class="lineNum">     849 </span><span class="lineNoCov">          0 :       errridge= ridge;</span></a>
<a name="850"><span class="lineNum">     850 </span><span class="lineNoCov">          0 :       waserror= True;</span></a>
<a name="851"><span class="lineNum">     851 </span>            :     }</a>
<a name="852"><span class="lineNum">     852 </span><span class="lineNoCov">          0 :     ridge-&gt;seen= True;</span></a>
<a name="853"><span class="lineNum">     853 </span><span class="lineNoCov">          0 :     numRvertices= qh_setsize(qh, ridge-&gt;vertices);</span></a>
<a name="854"><span class="lineNum">     854 </span><span class="lineNoCov">          0 :     if (numRvertices != qh-&gt;hull_dim - 1) {</span></a>
<a name="855"><span class="lineNum">     855 </span><span class="lineNoCov">          0 :       qh_fprintf(qh, qh-&gt;ferr, 6130, &quot;qhull internal error (qh_checkfacet): ridge between f%d and f%d has %d vertices\n&quot;,</span></a>
<a name="856"><span class="lineNum">     856 </span><span class="lineNoCov">          0 :                 ridge-&gt;top-&gt;id, ridge-&gt;bottom-&gt;id, numRvertices);</span></a>
<a name="857"><span class="lineNum">     857 </span><span class="lineNoCov">          0 :       errridge= ridge;</span></a>
<a name="858"><span class="lineNum">     858 </span><span class="lineNoCov">          0 :       waserror= True;</span></a>
<a name="859"><span class="lineNum">     859 </span>            :     }</a>
<a name="860"><span class="lineNum">     860 </span><span class="lineNoCov">          0 :     neighbor= otherfacet_(ridge, facet);</span></a>
<a name="861"><span class="lineNum">     861 </span><span class="lineNoCov">          0 :     neighbor-&gt;seen= True;</span></a>
<a name="862"><span class="lineNum">     862 </span><span class="lineNoCov">          0 :     if (!qh_setin(facet-&gt;neighbors, neighbor)) {</span></a>
<a name="863"><span class="lineNum">     863 </span><span class="lineNoCov">          0 :       qh_fprintf(qh, qh-&gt;ferr, 6131, &quot;qhull internal error (qh_checkfacet): for facet f%d, neighbor f%d of ridge r%d not in facet\n&quot;,</span></a>
<a name="864"><span class="lineNum">     864 </span>            :            facet-&gt;id, neighbor-&gt;id, ridge-&gt;id);</a>
<a name="865"><span class="lineNum">     865 </span><span class="lineNoCov">          0 :       errridge= ridge;</span></a>
<a name="866"><span class="lineNum">     866 </span><span class="lineNoCov">          0 :       waserror= True;</span></a>
<a name="867"><span class="lineNum">     867 </span>            :     }</a>
<a name="868"><span class="lineNum">     868 </span><span class="lineNoCov">          0 :     if (!facet-&gt;newfacet &amp;&amp; !neighbor-&gt;newfacet) {</span></a>
<a name="869"><span class="lineNum">     869 </span><span class="lineNoCov">          0 :       if ((!ridge-&gt;tested) | ridge-&gt;nonconvex | ridge-&gt;mergevertex) {</span></a>
<a name="870"><span class="lineNum">     870 </span><span class="lineNoCov">          0 :         qh_fprintf(qh, qh-&gt;ferr, 6384, &quot;qhull internal error (qh_checkfacet): ridge r%d is nonconvex (%d), mergevertex (%d) or not tested (%d) for facet f%d, neighbor f%d\n&quot;,</span></a>
<a name="871"><span class="lineNum">     871 </span><span class="lineNoCov">          0 :           ridge-&gt;id, ridge-&gt;nonconvex, ridge-&gt;mergevertex, ridge-&gt;tested, facet-&gt;id, neighbor-&gt;id);</span></a>
<a name="872"><span class="lineNum">     872 </span><span class="lineNoCov">          0 :         errridge= ridge;</span></a>
<a name="873"><span class="lineNum">     873 </span><span class="lineNoCov">          0 :         waserror= True;</span></a>
<a name="874"><span class="lineNum">     874 </span>            :       }</a>
<a name="875"><span class="lineNum">     875 </span>            :     }</a>
<a name="876"><span class="lineNum">     876 </span>            :   }</a>
<a name="877"><span class="lineNum">     877 </span><span class="lineCov">         32 :   if (!facet-&gt;simplicial) {</span></a>
<a name="878"><span class="lineNum">     878 </span><span class="lineNoCov">          0 :     FOREACHneighbor_(facet) {</span></a>
<a name="879"><span class="lineNum">     879 </span><span class="lineNoCov">          0 :       if (!neighbor-&gt;seen) {</span></a>
<a name="880"><span class="lineNum">     880 </span><span class="lineNoCov">          0 :         qh_fprintf(qh, qh-&gt;ferr, 6132, &quot;qhull internal error (qh_checkfacet): facet f%d does not have a ridge for neighbor f%d\n&quot;,</span></a>
<a name="881"><span class="lineNum">     881 </span>            :               facet-&gt;id, neighbor-&gt;id);</a>
<a name="882"><span class="lineNum">     882 </span><span class="lineNoCov">          0 :         errother= neighbor;</span></a>
<a name="883"><span class="lineNum">     883 </span><span class="lineNoCov">          0 :         waserror= True;</span></a>
<a name="884"><span class="lineNum">     884 </span>            :       }</a>
<a name="885"><span class="lineNum">     885 </span><span class="lineNoCov">          0 :       intersection= qh_vertexintersect_new(qh, facet-&gt;vertices, neighbor-&gt;vertices);</span></a>
<a name="886"><span class="lineNum">     886 </span><span class="lineNoCov">          0 :       qh_settemppush(qh, intersection);</span></a>
<a name="887"><span class="lineNum">     887 </span><span class="lineNoCov">          0 :       FOREACHvertex_(facet-&gt;vertices) {</span></a>
<a name="888"><span class="lineNum">     888 </span><span class="lineNoCov">          0 :         vertex-&gt;seen= False;</span></a>
<a name="889"><span class="lineNum">     889 </span><span class="lineNoCov">          0 :         vertex-&gt;seen2= False;</span></a>
<a name="890"><span class="lineNum">     890 </span>            :       }</a>
<a name="891"><span class="lineNum">     891 </span><span class="lineNoCov">          0 :       FOREACHvertex_(intersection)</span></a>
<a name="892"><span class="lineNum">     892 </span><span class="lineNoCov">          0 :         vertex-&gt;seen= True;</span></a>
<a name="893"><span class="lineNum">     893 </span><span class="lineNoCov">          0 :       FOREACHridge_(facet-&gt;ridges) {</span></a>
<a name="894"><span class="lineNum">     894 </span><span class="lineNoCov">          0 :         if (neighbor != otherfacet_(ridge, facet))</span></a>
<a name="895"><span class="lineNum">     895 </span><span class="lineNoCov">          0 :             continue;</span></a>
<a name="896"><span class="lineNum">     896 </span><span class="lineNoCov">          0 :         FOREACHvertex_(ridge-&gt;vertices) {</span></a>
<a name="897"><span class="lineNum">     897 </span><span class="lineNoCov">          0 :           if (!vertex-&gt;seen) {</span></a>
<a name="898"><span class="lineNum">     898 </span><span class="lineNoCov">          0 :             qh_fprintf(qh, qh-&gt;ferr, 6133, &quot;qhull internal error (qh_checkfacet): vertex v%d in r%d not in f%d intersect f%d\n&quot;,</span></a>
<a name="899"><span class="lineNum">     899 </span>            :                   vertex-&gt;id, ridge-&gt;id, facet-&gt;id, neighbor-&gt;id);</a>
<a name="900"><span class="lineNum">     900 </span><span class="lineNoCov">          0 :             qh_errexit(qh, qh_ERRqhull, facet, ridge);</span></a>
<a name="901"><span class="lineNum">     901 </span>            :           }</a>
<a name="902"><span class="lineNum">     902 </span><span class="lineNoCov">          0 :           vertex-&gt;seen2= True;</span></a>
<a name="903"><span class="lineNum">     903 </span>            :         }</a>
<a name="904"><span class="lineNum">     904 </span>            :       }</a>
<a name="905"><span class="lineNum">     905 </span><span class="lineNoCov">          0 :       if (!newmerge) {</span></a>
<a name="906"><span class="lineNum">     906 </span><span class="lineNoCov">          0 :         FOREACHvertex_(intersection) {</span></a>
<a name="907"><span class="lineNum">     907 </span><span class="lineNoCov">          0 :           if (!vertex-&gt;seen2) {</span></a>
<a name="908"><span class="lineNum">     908 </span><span class="lineNoCov">          0 :             if (!qh-&gt;MERGING) {</span></a>
<a name="909"><span class="lineNum">     909 </span><span class="lineNoCov">          0 :               qh_fprintf(qh, qh-&gt;ferr, 6420, &quot;qhull topology error (qh_checkfacet): vertex v%d in f%d intersect f%d but not in a ridge.  Last point was p%d\n&quot;,</span></a>
<a name="910"><span class="lineNum">     910 </span>            :                      vertex-&gt;id, facet-&gt;id, neighbor-&gt;id, qh-&gt;furthest_id);</a>
<a name="911"><span class="lineNum">     911 </span><span class="lineNoCov">          0 :               if (!qh-&gt;FORCEoutput) {</span></a>
<a name="912"><span class="lineNum">     912 </span><span class="lineNoCov">          0 :                 qh_errprint(qh, &quot;ERRONEOUS&quot;, facet, neighbor, NULL, vertex);</span></a>
<a name="913"><span class="lineNum">     913 </span><span class="lineNoCov">          0 :                 qh_errexit(qh, qh_ERRtopology, NULL, NULL);</span></a>
<a name="914"><span class="lineNum">     914 </span>            :               }</a>
<a name="915"><span class="lineNum">     915 </span>            :             }else {</a>
<a name="916"><span class="lineNum">     916 </span><span class="lineNoCov">          0 :               trace4((qh, qh-&gt;ferr, 4025, &quot;qh_checkfacet: vertex v%d in f%d intersect f%d but not in a ridge.  Repaired by qh_remove_extravertices in qh_reducevertices\n&quot;,</span></a>
<a name="917"><span class="lineNum">     917 </span>            :                 vertex-&gt;id, facet-&gt;id, neighbor-&gt;id));</a>
<a name="918"><span class="lineNum">     918 </span>            :             }</a>
<a name="919"><span class="lineNum">     919 </span>            :           }</a>
<a name="920"><span class="lineNum">     920 </span>            :         }</a>
<a name="921"><span class="lineNum">     921 </span>            :       }</a>
<a name="922"><span class="lineNum">     922 </span><span class="lineNoCov">          0 :       qh_settempfree(qh, &amp;intersection);</span></a>
<a name="923"><span class="lineNum">     923 </span>            :     }</a>
<a name="924"><span class="lineNum">     924 </span>            :   }else { /* simplicial */</a>
<a name="925"><span class="lineNum">     925 </span><span class="lineCov">        128 :     FOREACHneighbor_(facet) {</span></a>
<a name="926"><span class="lineNum">     926 </span><span class="lineCov">         96 :       if (neighbor-&gt;simplicial &amp;&amp; !facet-&gt;degenerate &amp;&amp; !neighbor-&gt;degenerate) {</span></a>
<a name="927"><span class="lineNum">     927 </span><span class="lineCov">         96 :         skipA= SETindex_(facet-&gt;neighbors, neighbor);</span></a>
<a name="928"><span class="lineNum">     928 </span><span class="lineCov">         96 :         skipB= qh_setindex(neighbor-&gt;neighbors, facet);</span></a>
<a name="929"><span class="lineNum">     929 </span><span class="lineCov">         96 :         if (skipA&lt;0 || skipB&lt;0 || !qh_setequal_skip(facet-&gt;vertices, skipA, neighbor-&gt;vertices, skipB)) {</span></a>
<a name="930"><span class="lineNum">     930 </span><span class="lineNoCov">          0 :           qh_fprintf(qh, qh-&gt;ferr, 6135, &quot;qhull internal error (qh_checkfacet): facet f%d skip %d and neighbor f%d skip %d do not match \n&quot;,</span></a>
<a name="931"><span class="lineNum">     931 </span>            :                    facet-&gt;id, skipA, neighbor-&gt;id, skipB);</a>
<a name="932"><span class="lineNum">     932 </span><span class="lineNoCov">          0 :           errother= neighbor;</span></a>
<a name="933"><span class="lineNum">     933 </span><span class="lineNoCov">          0 :           waserror= True;</span></a>
<a name="934"><span class="lineNum">     934 </span>            :         }</a>
<a name="935"><span class="lineNum">     935 </span>            :       }</a>
<a name="936"><span class="lineNum">     936 </span>            :     }</a>
<a name="937"><span class="lineNum">     937 </span>            :   }</a>
<a name="938"><span class="lineNum">     938 </span><span class="lineCov">         32 :   if (!newmerge &amp;&amp; qh-&gt;CHECKduplicates &amp;&amp; qh-&gt;hull_dim &lt; 5 &amp;&amp; (qh-&gt;IStracing &gt; 2 || qh-&gt;CHECKfrequently)) {</span></a>
<a name="939"><span class="lineNum">     939 </span><span class="lineNoCov">          0 :     FOREACHridge_i_(qh, facet-&gt;ridges) {           /* expensive, if was merge and qh_maybe_duplicateridges hasn't been called yet */</span></a>
<a name="940"><span class="lineNum">     940 </span><span class="lineNoCov">          0 :       if (!ridge-&gt;mergevertex) {</span></a>
<a name="941"><span class="lineNum">     941 </span><span class="lineNoCov">          0 :         for (i=ridge_i+1; i &lt; ridge_n; i++) {</span></a>
<a name="942"><span class="lineNum">     942 </span><span class="lineNoCov">          0 :           ridge2= SETelemt_(facet-&gt;ridges, i, ridgeT);</span></a>
<a name="943"><span class="lineNum">     943 </span><span class="lineNoCov">          0 :           if (SETelem_(ridge-&gt;vertices, last_v) == SETelem_(ridge2-&gt;vertices, last_v)) { /* SETfirst is likely to be the same */</span></a>
<a name="944"><span class="lineNum">     944 </span><span class="lineNoCov">          0 :             if (SETfirst_(ridge-&gt;vertices) == SETfirst_(ridge2-&gt;vertices)) {</span></a>
<a name="945"><span class="lineNum">     945 </span><span class="lineNoCov">          0 :               if (qh_setequal(ridge-&gt;vertices, ridge2-&gt;vertices)) {</span></a>
<a name="946"><span class="lineNum">     946 </span><span class="lineNoCov">          0 :                 qh_fprintf(qh, qh-&gt;ferr, 6294, &quot;qhull internal error (qh_checkfacet): ridges r%d and r%d (f%d) have the same vertices\n&quot;, /* same as duplicate ridge */</span></a>
<a name="947"><span class="lineNum">     947 </span>            :                     ridge-&gt;id, ridge2-&gt;id, facet-&gt;id);</a>
<a name="948"><span class="lineNum">     948 </span><span class="lineNoCov">          0 :                 errridge= ridge;</span></a>
<a name="949"><span class="lineNum">     949 </span><span class="lineNoCov">          0 :                 waserror= True;</span></a>
<a name="950"><span class="lineNum">     950 </span>            :               }</a>
<a name="951"><span class="lineNum">     951 </span>            :             }</a>
<a name="952"><span class="lineNum">     952 </span>            :           }</a>
<a name="953"><span class="lineNum">     953 </span>            :         }</a>
<a name="954"><span class="lineNum">     954 </span>            :       }</a>
<a name="955"><span class="lineNum">     955 </span>            :     }</a>
<a name="956"><span class="lineNum">     956 </span>            :   }</a>
<a name="957"><span class="lineNum">     957 </span><span class="lineCov">         32 :   if (waserror) {</span></a>
<a name="958"><span class="lineNum">     958 </span><span class="lineNoCov">          0 :     qh_errprint(qh, &quot;ERRONEOUS&quot;, facet, errother, errridge, NULL);</span></a>
<a name="959"><span class="lineNum">     959 </span><span class="lineNoCov">          0 :     *waserrorp= True;</span></a>
<a name="960"><span class="lineNum">     960 </span>            :   }</a>
<a name="961"><span class="lineNum">     961 </span><span class="lineCov">         32 : } /* checkfacet */</span></a>
<a name="962"><span class="lineNum">     962 </span>            : </a>
<a name="963"><span class="lineNum">     963 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="964"><span class="lineNum">     964 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;checkflipped_all&quot;&gt;-&lt;/a&gt;</a>
<a name="965"><span class="lineNum">     965 </span>            : </a>
<a name="966"><span class="lineNum">     966 </span>            :   qh_checkflipped_all(qh, facetlist )</a>
<a name="967"><span class="lineNum">     967 </span>            :     checks orientation of facets in list against interior point</a>
<a name="968"><span class="lineNum">     968 </span>            : </a>
<a name="969"><span class="lineNum">     969 </span>            :   notes:</a>
<a name="970"><span class="lineNum">     970 </span>            :     called by qh_checkoutput</a>
<a name="971"><span class="lineNum">     971 </span>            : */</a>
<a name="972"><span class="lineNum">     972 </span><span class="lineNoCov">          0 : void qh_checkflipped_all(qhT *qh, facetT *facetlist) {</span></a>
<a name="973"><span class="lineNum">     973 </span>            :   facetT *facet;</a>
<a name="974"><span class="lineNum">     974 </span><span class="lineNoCov">          0 :   boolT waserror= False;</span></a>
<a name="975"><span class="lineNum">     975 </span>            :   realT dist;</a>
<a name="976"><span class="lineNum">     976 </span>            : </a>
<a name="977"><span class="lineNum">     977 </span><span class="lineNoCov">          0 :   if (facetlist == qh-&gt;facet_list)</span></a>
<a name="978"><span class="lineNum">     978 </span><span class="lineNoCov">          0 :     zzval_(Zflippedfacets)= 0;</span></a>
<a name="979"><span class="lineNum">     979 </span><span class="lineNoCov">          0 :   FORALLfacet_(facetlist) {</span></a>
<a name="980"><span class="lineNum">     980 </span><span class="lineNoCov">          0 :     if (facet-&gt;normal &amp;&amp; !qh_checkflipped(qh, facet, &amp;dist, !qh_ALL)) {</span></a>
<a name="981"><span class="lineNum">     981 </span><span class="lineNoCov">          0 :       qh_fprintf(qh, qh-&gt;ferr, 6136, &quot;qhull precision error: facet f%d is flipped, distance= %6.12g\n&quot;,</span></a>
<a name="982"><span class="lineNum">     982 </span>            :               facet-&gt;id, dist);</a>
<a name="983"><span class="lineNum">     983 </span><span class="lineNoCov">          0 :       if (!qh-&gt;FORCEoutput) {</span></a>
<a name="984"><span class="lineNum">     984 </span><span class="lineNoCov">          0 :         qh_errprint(qh, &quot;ERRONEOUS&quot;, facet, NULL, NULL, NULL);</span></a>
<a name="985"><span class="lineNum">     985 </span><span class="lineNoCov">          0 :         waserror= True;</span></a>
<a name="986"><span class="lineNum">     986 </span>            :       }</a>
<a name="987"><span class="lineNum">     987 </span>            :     }</a>
<a name="988"><span class="lineNum">     988 </span>            :   }</a>
<a name="989"><span class="lineNum">     989 </span><span class="lineNoCov">          0 :   if (waserror) {</span></a>
<a name="990"><span class="lineNum">     990 </span><span class="lineNoCov">          0 :     qh_fprintf(qh, qh-&gt;ferr, 8101, &quot;\n\</span></a>
<a name="991"><span class="lineNum">     991 </span>            : A flipped facet occurs when its distance to the interior point is\n\</a>
<a name="992"><span class="lineNum">     992 </span><span class="lineNoCov">          0 : greater than or equal to %2.2g, the maximum roundoff error.\n&quot;, -qh-&gt;DISTround);</span></a>
<a name="993"><span class="lineNum">     993 </span><span class="lineNoCov">          0 :     qh_errexit(qh, qh_ERRprec, NULL, NULL);</span></a>
<a name="994"><span class="lineNum">     994 </span>            :   }</a>
<a name="995"><span class="lineNum">     995 </span><span class="lineNoCov">          0 : } /* checkflipped_all */</span></a>
<a name="996"><span class="lineNum">     996 </span>            : </a>
<a name="997"><span class="lineNum">     997 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="998"><span class="lineNum">     998 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;checklists&quot;&gt;-&lt;/a&gt;</a>
<a name="999"><span class="lineNum">     999 </span>            : </a>
<a name="1000"><span class="lineNum">    1000 </span>            :   qh_checklists(qh, facetlist )</a>
<a name="1001"><span class="lineNum">    1001 </span>            :     Check and repair facetlist and qh.vertex_list for infinite loops or overwritten facets</a>
<a name="1002"><span class="lineNum">    1002 </span>            :     Checks that qh.newvertex_list is on qh.vertex_list</a>
<a name="1003"><span class="lineNum">    1003 </span>            :     if facetlist is qh.facet_list</a>
<a name="1004"><span class="lineNum">    1004 </span>            :       Checks that qh.visible_list and qh.newfacet_list are on qh.facet_list</a>
<a name="1005"><span class="lineNum">    1005 </span>            :     Updates qh.facetvisit and qh.vertexvisit</a>
<a name="1006"><span class="lineNum">    1006 </span>            : </a>
<a name="1007"><span class="lineNum">    1007 </span>            :   returns:</a>
<a name="1008"><span class="lineNum">    1008 </span>            :     True if no errors found</a>
<a name="1009"><span class="lineNum">    1009 </span>            :     If false, repairs erroneous lists to prevent infinite loops by FORALL macros</a>
<a name="1010"><span class="lineNum">    1010 </span>            : </a>
<a name="1011"><span class="lineNum">    1011 </span>            :   notes:</a>
<a name="1012"><span class="lineNum">    1012 </span>            :     called by qh_buildtracing, qh_checkpolygon, qh_collectstatistics, qh_printfacetlist, qh_printsummary</a>
<a name="1013"><span class="lineNum">    1013 </span>            :     not called by qh_printlists</a>
<a name="1014"><span class="lineNum">    1014 </span>            : </a>
<a name="1015"><span class="lineNum">    1015 </span>            :   design:</a>
<a name="1016"><span class="lineNum">    1016 </span>            :     if facetlist</a>
<a name="1017"><span class="lineNum">    1017 </span>            :       check qh.facet_tail</a>
<a name="1018"><span class="lineNum">    1018 </span>            :       for each facet</a>
<a name="1019"><span class="lineNum">    1019 </span>            :         check for infinite loop or overwritten facet</a>
<a name="1020"><span class="lineNum">    1020 </span>            :         check previous facet</a>
<a name="1021"><span class="lineNum">    1021 </span>            :       if facetlist is qh.facet_list</a>
<a name="1022"><span class="lineNum">    1022 </span>            :         check qh.next_facet, qh.visible_list and qh.newfacet_list</a>
<a name="1023"><span class="lineNum">    1023 </span>            :     if vertexlist</a>
<a name="1024"><span class="lineNum">    1024 </span>            :       check qh.vertex_tail</a>
<a name="1025"><span class="lineNum">    1025 </span>            :       for each vertex</a>
<a name="1026"><span class="lineNum">    1026 </span>            :         check for infinite loop or overwritten vertex</a>
<a name="1027"><span class="lineNum">    1027 </span>            :         check previous vertex</a>
<a name="1028"><span class="lineNum">    1028 </span>            :       check qh.newvertex_list</a>
<a name="1029"><span class="lineNum">    1029 </span>            : */</a>
<a name="1030"><span class="lineNum">    1030 </span><span class="lineCov">          8 : boolT qh_checklists(qhT *qh, facetT *facetlist) {</span></a>
<a name="1031"><span class="lineNum">    1031 </span><span class="lineCov">          8 :   facetT *facet, *errorfacet= NULL, *errorfacet2= NULL, *previousfacet;</span></a>
<a name="1032"><span class="lineNum">    1032 </span><span class="lineCov">          8 :   vertexT *vertex, *vertexlist, *previousvertex, *errorvertex= NULL;</span></a>
<a name="1033"><span class="lineNum">    1033 </span><span class="lineCov">          8 :   boolT waserror= False, newseen= False, nextseen= False, newvertexseen= False, visibleseen= False;</span></a>
<a name="1034"><span class="lineNum">    1034 </span>            : </a>
<a name="1035"><span class="lineNum">    1035 </span><span class="lineCov">          8 :   if (facetlist == qh-&gt;newfacet_list || facetlist == qh-&gt;visible_list) {</span></a>
<a name="1036"><span class="lineNum">    1036 </span><span class="lineNoCov">          0 :     vertexlist= qh-&gt;vertex_list;</span></a>
<a name="1037"><span class="lineNum">    1037 </span><span class="lineNoCov">          0 :     previousvertex= NULL;</span></a>
<a name="1038"><span class="lineNum">    1038 </span><span class="lineNoCov">          0 :     trace2((qh, qh-&gt;ferr, 2110, &quot;qh_checklists: check qh.%s_list f%d and qh.vertex_list v%d\n&quot;,</span></a>
<a name="1039"><span class="lineNum">    1039 </span>            :         (facetlist == qh-&gt;newfacet_list ? &quot;newfacet&quot; : &quot;visible&quot;), facetlist-&gt;id, getid_(vertexlist)));</a>
<a name="1040"><span class="lineNum">    1040 </span>            :   }else {</a>
<a name="1041"><span class="lineNum">    1041 </span><span class="lineCov">          8 :     vertexlist= qh-&gt;vertex_list;</span></a>
<a name="1042"><span class="lineNum">    1042 </span><span class="lineCov">          8 :     previousvertex= NULL;</span></a>
<a name="1043"><span class="lineNum">    1043 </span><span class="lineCov">          8 :     trace2((qh, qh-&gt;ferr, 2111, &quot;qh_checklists: check %slist f%d and qh.vertex_list v%d\n&quot;,</span></a>
<a name="1044"><span class="lineNum">    1044 </span>            :         (facetlist == qh-&gt;facet_list ? &quot;qh.facet_&quot; : &quot;facet&quot;), getid_(facetlist), getid_(vertexlist)));</a>
<a name="1045"><span class="lineNum">    1045 </span>            :   }</a>
<a name="1046"><span class="lineNum">    1046 </span><span class="lineCov">          8 :   if (facetlist) {</span></a>
<a name="1047"><span class="lineNum">    1047 </span><span class="lineCov">          8 :     if (qh-&gt;facet_tail == NULL || qh-&gt;facet_tail-&gt;id != 0 || qh-&gt;facet_tail-&gt;next != NULL) {</span></a>
<a name="1048"><span class="lineNum">    1048 </span><span class="lineNoCov">          0 :       qh_fprintf(qh, qh-&gt;ferr, 6397, &quot;qhull internal error (qh_checklists): either qh.facet_tail f%d is NULL, or its id is not 0, or its next is not NULL\n&quot;,</span></a>
<a name="1049"><span class="lineNum">    1049 </span><span class="lineNoCov">          0 :           getid_(qh-&gt;facet_tail));</span></a>
<a name="1050"><span class="lineNum">    1050 </span><span class="lineNoCov">          0 :       qh_errexit(qh, qh_ERRqhull, qh-&gt;facet_tail, NULL);</span></a>
<a name="1051"><span class="lineNum">    1051 </span>            :     }</a>
<a name="1052"><span class="lineNum">    1052 </span><span class="lineCov">          8 :     previousfacet= (facetlist == qh-&gt;facet_list ? NULL : facetlist-&gt;previous);</span></a>
<a name="1053"><span class="lineNum">    1053 </span><span class="lineCov">          8 :     qh-&gt;visit_id++;</span></a>
<a name="1054"><span class="lineNum">    1054 </span><span class="lineCov">         40 :     FORALLfacet_(facetlist) {</span></a>
<a name="1055"><span class="lineNum">    1055 </span><span class="lineCov">         32 :       if (facet-&gt;visitid &gt;= qh-&gt;visit_id || facet-&gt;id &gt;= qh-&gt;facet_id) {</span></a>
<a name="1056"><span class="lineNum">    1056 </span><span class="lineNoCov">          0 :         waserror= True;</span></a>
<a name="1057"><span class="lineNum">    1057 </span><span class="lineNoCov">          0 :         errorfacet= facet;</span></a>
<a name="1058"><span class="lineNum">    1058 </span><span class="lineNoCov">          0 :         errorfacet2= previousfacet;</span></a>
<a name="1059"><span class="lineNum">    1059 </span><span class="lineNoCov">          0 :         if (facet-&gt;visitid == qh-&gt;visit_id)</span></a>
<a name="1060"><span class="lineNum">    1060 </span><span class="lineNoCov">          0 :           qh_fprintf(qh, qh-&gt;ferr, 6039, &quot;qhull internal error (qh_checklists): f%d already in facetlist causing an infinite loop ... f%d &gt; f%d ... &gt; f%d &gt; f%d.  Truncate facetlist at f%d\n&quot;,</span></a>
<a name="1061"><span class="lineNum">    1061 </span><span class="lineNoCov">          0 :             facet-&gt;id, facet-&gt;id, facet-&gt;next-&gt;id, getid_(previousfacet), facet-&gt;id, getid_(previousfacet));</span></a>
<a name="1062"><span class="lineNum">    1062 </span>            :         else</a>
<a name="1063"><span class="lineNum">    1063 </span><span class="lineNoCov">          0 :           qh_fprintf(qh, qh-&gt;ferr, 6350, &quot;qhull internal error (qh_checklists): unknown or overwritten facet f%d, either id &gt;= qh.facet_id (%d) or f.visitid %u &gt; qh.visit_id %u.  Facetlist terminated at previous facet f%d\n&quot;,</span></a>
<a name="1064"><span class="lineNum">    1064 </span><span class="lineNoCov">          0 :               facet-&gt;id, qh-&gt;facet_id, facet-&gt;visitid, qh-&gt;visit_id, getid_(previousfacet));</span></a>
<a name="1065"><span class="lineNum">    1065 </span><span class="lineNoCov">          0 :         if (previousfacet)</span></a>
<a name="1066"><span class="lineNum">    1066 </span><span class="lineNoCov">          0 :           previousfacet-&gt;next= qh-&gt;facet_tail;</span></a>
<a name="1067"><span class="lineNum">    1067 </span>            :         else</a>
<a name="1068"><span class="lineNum">    1068 </span><span class="lineNoCov">          0 :           facetlist= qh-&gt;facet_tail;</span></a>
<a name="1069"><span class="lineNum">    1069 </span><span class="lineNoCov">          0 :         break;</span></a>
<a name="1070"><span class="lineNum">    1070 </span>            :       }</a>
<a name="1071"><span class="lineNum">    1071 </span><span class="lineCov">         32 :       facet-&gt;visitid= qh-&gt;visit_id;</span></a>
<a name="1072"><span class="lineNum">    1072 </span><span class="lineCov">         32 :       if (facet-&gt;previous != previousfacet) {</span></a>
<a name="1073"><span class="lineNum">    1073 </span><span class="lineNoCov">          0 :         qh_fprintf(qh, qh-&gt;ferr, 6416, &quot;qhull internal error (qh_checklists): expecting f%d.previous == f%d.  Got f%d\n&quot;,</span></a>
<a name="1074"><span class="lineNum">    1074 </span><span class="lineNoCov">          0 :           facet-&gt;id, getid_(previousfacet), getid_(facet-&gt;previous));</span></a>
<a name="1075"><span class="lineNum">    1075 </span><span class="lineNoCov">          0 :         waserror= True;</span></a>
<a name="1076"><span class="lineNum">    1076 </span><span class="lineNoCov">          0 :         errorfacet= facet;</span></a>
<a name="1077"><span class="lineNum">    1077 </span><span class="lineNoCov">          0 :         errorfacet2= facet-&gt;previous;</span></a>
<a name="1078"><span class="lineNum">    1078 </span>            :       }</a>
<a name="1079"><span class="lineNum">    1079 </span><span class="lineCov">         32 :       previousfacet= facet;</span></a>
<a name="1080"><span class="lineNum">    1080 </span><span class="lineCov">         32 :       if (facetlist == qh-&gt;facet_list) {</span></a>
<a name="1081"><span class="lineNum">    1081 </span><span class="lineCov">         32 :         if (facet == qh-&gt;visible_list) {</span></a>
<a name="1082"><span class="lineNum">    1082 </span><span class="lineNoCov">          0 :           if(newseen){</span></a>
<a name="1083"><span class="lineNum">    1083 </span><span class="lineNoCov">          0 :             qh_fprintf(qh, qh-&gt;ferr, 6285, &quot;qhull internal error (qh_checklists): qh.visible_list f%d is after qh.newfacet_list f%d.  It should be at, before, or NULL\n&quot;,</span></a>
<a name="1084"><span class="lineNum">    1084 </span><span class="lineNoCov">          0 :               facet-&gt;id, getid_(qh-&gt;newfacet_list));</span></a>
<a name="1085"><span class="lineNum">    1085 </span><span class="lineNoCov">          0 :             waserror= True;</span></a>
<a name="1086"><span class="lineNum">    1086 </span><span class="lineNoCov">          0 :             errorfacet= facet;</span></a>
<a name="1087"><span class="lineNum">    1087 </span><span class="lineNoCov">          0 :             errorfacet2= qh-&gt;newfacet_list;</span></a>
<a name="1088"><span class="lineNum">    1088 </span>            :           }</a>
<a name="1089"><span class="lineNum">    1089 </span><span class="lineNoCov">          0 :           visibleseen= True;</span></a>
<a name="1090"><span class="lineNum">    1090 </span>            :         }</a>
<a name="1091"><span class="lineNum">    1091 </span><span class="lineCov">         32 :         if (facet == qh-&gt;newfacet_list)</span></a>
<a name="1092"><span class="lineNum">    1092 </span><span class="lineNoCov">          0 :           newseen= True;</span></a>
<a name="1093"><span class="lineNum">    1093 </span><span class="lineCov">         32 :         if (facet == qh-&gt;facet_next)</span></a>
<a name="1094"><span class="lineNum">    1094 </span><span class="lineCov">          8 :           nextseen= True;</span></a>
<a name="1095"><span class="lineNum">    1095 </span>            :       }</a>
<a name="1096"><span class="lineNum">    1096 </span>            :     }</a>
<a name="1097"><span class="lineNum">    1097 </span><span class="lineCov">          8 :     if (facetlist == qh-&gt;facet_list) {</span></a>
<a name="1098"><span class="lineNum">    1098 </span><span class="lineCov">          8 :       if (!nextseen &amp;&amp; qh-&gt;facet_next &amp;&amp; qh-&gt;facet_next-&gt;next) {</span></a>
<a name="1099"><span class="lineNum">    1099 </span><span class="lineNoCov">          0 :         qh_fprintf(qh, qh-&gt;ferr, 6369, &quot;qhull internal error (qh_checklists): qh.facet_next f%d for qh_addpoint is not on qh.facet_list f%d\n&quot;,</span></a>
<a name="1100"><span class="lineNum">    1100 </span><span class="lineNoCov">          0 :           qh-&gt;facet_next-&gt;id, facetlist-&gt;id);</span></a>
<a name="1101"><span class="lineNum">    1101 </span><span class="lineNoCov">          0 :         waserror= True;</span></a>
<a name="1102"><span class="lineNum">    1102 </span><span class="lineNoCov">          0 :         errorfacet= qh-&gt;facet_next;</span></a>
<a name="1103"><span class="lineNum">    1103 </span><span class="lineNoCov">          0 :         errorfacet2= facetlist;</span></a>
<a name="1104"><span class="lineNum">    1104 </span>            :       }</a>
<a name="1105"><span class="lineNum">    1105 </span><span class="lineCov">          8 :       if (!newseen &amp;&amp; qh-&gt;newfacet_list &amp;&amp; qh-&gt;newfacet_list-&gt;next) {</span></a>
<a name="1106"><span class="lineNum">    1106 </span><span class="lineNoCov">          0 :         qh_fprintf(qh, qh-&gt;ferr, 6286, &quot;qhull internal error (qh_checklists): qh.newfacet_list f%d is not on qh.facet_list f%d\n&quot;,</span></a>
<a name="1107"><span class="lineNum">    1107 </span><span class="lineNoCov">          0 :           qh-&gt;newfacet_list-&gt;id, facetlist-&gt;id);</span></a>
<a name="1108"><span class="lineNum">    1108 </span><span class="lineNoCov">          0 :         waserror= True;</span></a>
<a name="1109"><span class="lineNum">    1109 </span><span class="lineNoCov">          0 :         errorfacet= qh-&gt;newfacet_list;</span></a>
<a name="1110"><span class="lineNum">    1110 </span><span class="lineNoCov">          0 :         errorfacet2= facetlist;</span></a>
<a name="1111"><span class="lineNum">    1111 </span>            :       }</a>
<a name="1112"><span class="lineNum">    1112 </span><span class="lineCov">          8 :       if (!visibleseen &amp;&amp; qh-&gt;visible_list &amp;&amp; qh-&gt;visible_list-&gt;next) {</span></a>
<a name="1113"><span class="lineNum">    1113 </span><span class="lineNoCov">          0 :         qh_fprintf(qh, qh-&gt;ferr, 6138, &quot;qhull internal error (qh_checklists): qh.visible_list f%d is not on qh.facet_list f%d\n&quot;,</span></a>
<a name="1114"><span class="lineNum">    1114 </span><span class="lineNoCov">          0 :           qh-&gt;visible_list-&gt;id, facetlist-&gt;id);</span></a>
<a name="1115"><span class="lineNum">    1115 </span><span class="lineNoCov">          0 :         waserror= True;</span></a>
<a name="1116"><span class="lineNum">    1116 </span><span class="lineNoCov">          0 :         errorfacet= qh-&gt;visible_list;</span></a>
<a name="1117"><span class="lineNum">    1117 </span><span class="lineNoCov">          0 :         errorfacet2= facetlist;</span></a>
<a name="1118"><span class="lineNum">    1118 </span>            :       }</a>
<a name="1119"><span class="lineNum">    1119 </span>            :     }</a>
<a name="1120"><span class="lineNum">    1120 </span>            :   }</a>
<a name="1121"><span class="lineNum">    1121 </span><span class="lineCov">          8 :   if (vertexlist) {</span></a>
<a name="1122"><span class="lineNum">    1122 </span><span class="lineCov">          8 :     if (qh-&gt;vertex_tail == NULL || qh-&gt;vertex_tail-&gt;id != 0 || qh-&gt;vertex_tail-&gt;next != NULL) {</span></a>
<a name="1123"><span class="lineNum">    1123 </span><span class="lineNoCov">          0 :       qh_fprintf(qh, qh-&gt;ferr, 6366, &quot;qhull internal error (qh_checklists): either qh.vertex_tail v%d is NULL, or its id is not 0, or its next is not NULL\n&quot;,</span></a>
<a name="1124"><span class="lineNum">    1124 </span><span class="lineNoCov">          0 :            getid_(qh-&gt;vertex_tail));</span></a>
<a name="1125"><span class="lineNum">    1125 </span><span class="lineNoCov">          0 :       qh_errprint(qh, &quot;ERRONEOUS&quot;, errorfacet, errorfacet2, NULL, qh-&gt;vertex_tail);</span></a>
<a name="1126"><span class="lineNum">    1126 </span><span class="lineNoCov">          0 :       qh_errexit(qh, qh_ERRqhull, NULL, NULL);</span></a>
<a name="1127"><span class="lineNum">    1127 </span>            :     }</a>
<a name="1128"><span class="lineNum">    1128 </span><span class="lineCov">          8 :     qh-&gt;vertex_visit++;</span></a>
<a name="1129"><span class="lineNum">    1129 </span><span class="lineCov">         40 :     FORALLvertex_(vertexlist) {</span></a>
<a name="1130"><span class="lineNum">    1130 </span><span class="lineCov">         32 :       if (vertex-&gt;visitid &gt;= qh-&gt;vertex_visit || vertex-&gt;id &gt;= qh-&gt;vertex_id) {</span></a>
<a name="1131"><span class="lineNum">    1131 </span><span class="lineNoCov">          0 :         waserror= True;</span></a>
<a name="1132"><span class="lineNum">    1132 </span><span class="lineNoCov">          0 :         errorvertex= vertex;</span></a>
<a name="1133"><span class="lineNum">    1133 </span><span class="lineNoCov">          0 :         if (vertex-&gt;visitid == qh-&gt;visit_id)</span></a>
<a name="1134"><span class="lineNum">    1134 </span><span class="lineNoCov">          0 :           qh_fprintf(qh, qh-&gt;ferr, 6367, &quot;qhull internal error (qh_checklists): v%d already in vertexlist causing an infinite loop ... v%d &gt; v%d ... &gt; v%d &gt; v%d.  Truncate vertexlist at v%d\n&quot;,</span></a>
<a name="1135"><span class="lineNum">    1135 </span><span class="lineNoCov">          0 :             vertex-&gt;id, vertex-&gt;id, vertex-&gt;next-&gt;id, getid_(previousvertex), vertex-&gt;id, getid_(previousvertex));</span></a>
<a name="1136"><span class="lineNum">    1136 </span>            :         else</a>
<a name="1137"><span class="lineNum">    1137 </span><span class="lineNoCov">          0 :           qh_fprintf(qh, qh-&gt;ferr, 6368, &quot;qhull internal error (qh_checklists): unknown or overwritten vertex v%d, either id &gt;= qh.vertex_id (%d) or v.visitid %u &gt; qh.visit_id %u.  vertexlist terminated at previous vertex v%d\n&quot;,</span></a>
<a name="1138"><span class="lineNum">    1138 </span><span class="lineNoCov">          0 :             vertex-&gt;id, qh-&gt;vertex_id, vertex-&gt;visitid, qh-&gt;visit_id, getid_(previousvertex));</span></a>
<a name="1139"><span class="lineNum">    1139 </span><span class="lineNoCov">          0 :         if (previousvertex)</span></a>
<a name="1140"><span class="lineNum">    1140 </span><span class="lineNoCov">          0 :           previousvertex-&gt;next= qh-&gt;vertex_tail;</span></a>
<a name="1141"><span class="lineNum">    1141 </span>            :         else</a>
<a name="1142"><span class="lineNum">    1142 </span><span class="lineNoCov">          0 :           vertexlist= qh-&gt;vertex_tail;</span></a>
<a name="1143"><span class="lineNum">    1143 </span><span class="lineNoCov">          0 :         break;</span></a>
<a name="1144"><span class="lineNum">    1144 </span>            :       }</a>
<a name="1145"><span class="lineNum">    1145 </span><span class="lineCov">         32 :       vertex-&gt;visitid= qh-&gt;vertex_visit;</span></a>
<a name="1146"><span class="lineNum">    1146 </span><span class="lineCov">         32 :       if (vertex-&gt;previous != previousvertex) {</span></a>
<a name="1147"><span class="lineNum">    1147 </span><span class="lineNoCov">          0 :         qh_fprintf(qh, qh-&gt;ferr, 6427, &quot;qhull internal error (qh_checklists): expecting v%d.previous == v%d.  Got v%d\n&quot;,</span></a>
<a name="1148"><span class="lineNum">    1148 </span><span class="lineNoCov">          0 :               vertex-&gt;id, previousvertex, getid_(vertex-&gt;previous));</span></a>
<a name="1149"><span class="lineNum">    1149 </span><span class="lineNoCov">          0 :         waserror= True;</span></a>
<a name="1150"><span class="lineNum">    1150 </span><span class="lineNoCov">          0 :         errorvertex= vertex;</span></a>
<a name="1151"><span class="lineNum">    1151 </span>            :       }</a>
<a name="1152"><span class="lineNum">    1152 </span><span class="lineCov">         32 :       previousvertex= vertex;</span></a>
<a name="1153"><span class="lineNum">    1153 </span><span class="lineCov">         32 :       if(vertex == qh-&gt;newvertex_list)</span></a>
<a name="1154"><span class="lineNum">    1154 </span><span class="lineNoCov">          0 :         newvertexseen= True;</span></a>
<a name="1155"><span class="lineNum">    1155 </span>            :     }</a>
<a name="1156"><span class="lineNum">    1156 </span><span class="lineCov">          8 :     if(!newvertexseen &amp;&amp; qh-&gt;newvertex_list &amp;&amp; qh-&gt;newvertex_list-&gt;next) {</span></a>
<a name="1157"><span class="lineNum">    1157 </span><span class="lineNoCov">          0 :       qh_fprintf(qh, qh-&gt;ferr, 6287, &quot;qhull internal error (qh_checklists): new vertex list v%d is not on vertex list\n&quot;, qh-&gt;newvertex_list-&gt;id);</span></a>
<a name="1158"><span class="lineNum">    1158 </span><span class="lineNoCov">          0 :       waserror= True;</span></a>
<a name="1159"><span class="lineNum">    1159 </span><span class="lineNoCov">          0 :       errorvertex= qh-&gt;newvertex_list;</span></a>
<a name="1160"><span class="lineNum">    1160 </span>            :     }</a>
<a name="1161"><span class="lineNum">    1161 </span>            :   }</a>
<a name="1162"><span class="lineNum">    1162 </span><span class="lineCov">          8 :   if (waserror) {</span></a>
<a name="1163"><span class="lineNum">    1163 </span><span class="lineNoCov">          0 :     qh_errprint(qh, &quot;ERRONEOUS&quot;, errorfacet, errorfacet2, NULL, errorvertex);</span></a>
<a name="1164"><span class="lineNum">    1164 </span><span class="lineNoCov">          0 :     return False;</span></a>
<a name="1165"><span class="lineNum">    1165 </span>            :   }</a>
<a name="1166"><span class="lineNum">    1166 </span><span class="lineCov">          8 :   return True;</span></a>
<a name="1167"><span class="lineNum">    1167 </span>            : } /* checklists */</a>
<a name="1168"><span class="lineNum">    1168 </span>            : </a>
<a name="1169"><span class="lineNum">    1169 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="1170"><span class="lineNum">    1170 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;checkpolygon&quot;&gt;-&lt;/a&gt;</a>
<a name="1171"><span class="lineNum">    1171 </span>            : </a>
<a name="1172"><span class="lineNum">    1172 </span>            :   qh_checkpolygon(qh, facetlist )</a>
<a name="1173"><span class="lineNum">    1173 </span>            :     checks the correctness of the structure</a>
<a name="1174"><span class="lineNum">    1174 </span>            : </a>
<a name="1175"><span class="lineNum">    1175 </span>            :   notes:</a>
<a name="1176"><span class="lineNum">    1176 </span>            :     called by qh_addpoint, qh_all_vertexmerge, qh_check_output, qh_initialhull, qh_prepare_output, qh_triangulate</a>
<a name="1177"><span class="lineNum">    1177 </span>            :     call with qh.facet_list or qh.newfacet_list or another list</a>
<a name="1178"><span class="lineNum">    1178 </span>            :     checks num_facets and num_vertices if qh.facet_list</a>
<a name="1179"><span class="lineNum">    1179 </span>            : </a>
<a name="1180"><span class="lineNum">    1180 </span>            :   design:</a>
<a name="1181"><span class="lineNum">    1181 </span>            :     check and repair lists for infinite loop</a>
<a name="1182"><span class="lineNum">    1182 </span>            :     for each facet</a>
<a name="1183"><span class="lineNum">    1183 </span>            :       check f.newfacet and f.visible</a>
<a name="1184"><span class="lineNum">    1184 </span>            :       check facet and outside set if qh.NEWtentative and not f.newfacet, or not f.visible</a>
<a name="1185"><span class="lineNum">    1185 </span>            :     initializes vertexlist for qh.facet_list or qh.newfacet_list</a>
<a name="1186"><span class="lineNum">    1186 </span>            :     for each vertex</a>
<a name="1187"><span class="lineNum">    1187 </span>            :       check vertex</a>
<a name="1188"><span class="lineNum">    1188 </span>            :       check v.newfacet</a>
<a name="1189"><span class="lineNum">    1189 </span>            :     for each facet</a>
<a name="1190"><span class="lineNum">    1190 </span>            :       count f.ridges</a>
<a name="1191"><span class="lineNum">    1191 </span>            :       check and count f.vertices</a>
<a name="1192"><span class="lineNum">    1192 </span>            :     if checking qh.facet_list</a>
<a name="1193"><span class="lineNum">    1193 </span>            :       check facet count</a>
<a name="1194"><span class="lineNum">    1194 </span>            :       if qh.VERTEXneighbors</a>
<a name="1195"><span class="lineNum">    1195 </span>            :         check and count v.neighbors for all vertices</a>
<a name="1196"><span class="lineNum">    1196 </span>            :         check v.neighbors count and report possible causes of mismatch</a>
<a name="1197"><span class="lineNum">    1197 </span>            :         check that facets are in their v.neighbors</a>
<a name="1198"><span class="lineNum">    1198 </span>            :       check vertex count</a>
<a name="1199"><span class="lineNum">    1199 </span>            : */</a>
<a name="1200"><span class="lineNum">    1200 </span><span class="lineCov">          8 : void qh_checkpolygon(qhT *qh, facetT *facetlist) {</span></a>
<a name="1201"><span class="lineNum">    1201 </span>            :   facetT *facet, *neighbor, **neighborp;</a>
<a name="1202"><span class="lineNum">    1202 </span><span class="lineCov">          8 :   facetT *errorfacet= NULL, *errorfacet2= NULL;</span></a>
<a name="1203"><span class="lineNum">    1203 </span>            :   vertexT *vertex, **vertexp, *vertexlist;</a>
<a name="1204"><span class="lineNum">    1204 </span><span class="lineCov">          8 :   int numfacets= 0, numvertices= 0, numridges= 0;</span></a>
<a name="1205"><span class="lineNum">    1205 </span><span class="lineCov">          8 :   int totvneighbors= 0, totfacetvertices= 0;</span></a>
<a name="1206"><span class="lineNum">    1206 </span><span class="lineCov">          8 :   boolT waserror= False, newseen= False, newvertexseen= False, nextseen= False, visibleseen= False;</span></a>
<a name="1207"><span class="lineNum">    1207 </span>            :   boolT checkfacet;</a>
<a name="1208"><span class="lineNum">    1208 </span>            : </a>
<a name="1209"><span class="lineNum">    1209 </span><span class="lineCov">          8 :   trace1((qh, qh-&gt;ferr, 1027, &quot;qh_checkpolygon: check all facets from f%d, qh.NEWtentative? %d\n&quot;, facetlist-&gt;id, qh-&gt;NEWtentative));</span></a>
<a name="1210"><span class="lineNum">    1210 </span><span class="lineCov">          8 :   if (!qh_checklists(qh, facetlist)) {</span></a>
<a name="1211"><span class="lineNum">    1211 </span><span class="lineNoCov">          0 :     waserror= True;</span></a>
<a name="1212"><span class="lineNum">    1212 </span><span class="lineNoCov">          0 :     qh_fprintf(qh, qh-&gt;ferr, 6374, &quot;qhull internal error: qh_checklists failed in qh_checkpolygon\n&quot;);</span></a>
<a name="1213"><span class="lineNum">    1213 </span><span class="lineNoCov">          0 :     if (qh-&gt;num_facets &lt; 4000)</span></a>
<a name="1214"><span class="lineNum">    1214 </span><span class="lineNoCov">          0 :       qh_printlists(qh);</span></a>
<a name="1215"><span class="lineNum">    1215 </span>            :   }</a>
<a name="1216"><span class="lineNum">    1216 </span><span class="lineCov">          8 :   if (facetlist != qh-&gt;facet_list || qh-&gt;ONLYgood)</span></a>
<a name="1217"><span class="lineNum">    1217 </span><span class="lineNoCov">          0 :     nextseen= True; /* allow f.outsideset */</span></a>
<a name="1218"><span class="lineNum">    1218 </span><span class="lineCov">         40 :   FORALLfacet_(facetlist) {</span></a>
<a name="1219"><span class="lineNum">    1219 </span><span class="lineCov">         32 :     if (facet == qh-&gt;visible_list)</span></a>
<a name="1220"><span class="lineNum">    1220 </span><span class="lineNoCov">          0 :       visibleseen= True;</span></a>
<a name="1221"><span class="lineNum">    1221 </span><span class="lineCov">         32 :     if (facet == qh-&gt;newfacet_list)</span></a>
<a name="1222"><span class="lineNum">    1222 </span><span class="lineNoCov">          0 :       newseen= True;</span></a>
<a name="1223"><span class="lineNum">    1223 </span><span class="lineCov">         32 :     if (facet-&gt;newfacet &amp;&amp; !newseen &amp;&amp; !visibleseen) {</span></a>
<a name="1224"><span class="lineNum">    1224 </span><span class="lineNoCov">          0 :         qh_fprintf(qh, qh-&gt;ferr, 6289, &quot;qhull internal error (qh_checkpolygon): f%d is 'newfacet' but it is not on qh.newfacet_list f%d or visible_list f%d\n&quot;,  facet-&gt;id, getid_(qh-&gt;newfacet_list), getid_(qh-&gt;visible_list));</span></a>
<a name="1225"><span class="lineNum">    1225 </span><span class="lineNoCov">          0 :         qh_errexit(qh, qh_ERRqhull, facet, NULL);</span></a>
<a name="1226"><span class="lineNum">    1226 </span>            :     }</a>
<a name="1227"><span class="lineNum">    1227 </span><span class="lineCov">         32 :     if (!facet-&gt;newfacet &amp;&amp; newseen) {</span></a>
<a name="1228"><span class="lineNum">    1228 </span><span class="lineNoCov">          0 :         qh_fprintf(qh, qh-&gt;ferr, 6292, &quot;qhull internal error (qh_checkpolygon): f%d is on qh.newfacet_list f%d but it is not 'newfacet'\n&quot;,  facet-&gt;id, getid_(qh-&gt;newfacet_list));</span></a>
<a name="1229"><span class="lineNum">    1229 </span><span class="lineNoCov">          0 :         qh_errexit(qh, qh_ERRqhull, facet, NULL);</span></a>
<a name="1230"><span class="lineNum">    1230 </span>            :     }</a>
<a name="1231"><span class="lineNum">    1231 </span><span class="lineCov">         32 :     if (facet-&gt;visible != (visibleseen &amp; !newseen)) {</span></a>
<a name="1232"><span class="lineNum">    1232 </span><span class="lineNoCov">          0 :       if(facet-&gt;visible)</span></a>
<a name="1233"><span class="lineNum">    1233 </span><span class="lineNoCov">          0 :         qh_fprintf(qh, qh-&gt;ferr, 6290, &quot;qhull internal error (qh_checkpolygon): f%d is 'visible' but it is not on qh.visible_list f%d\n&quot;, facet-&gt;id, getid_(qh-&gt;visible_list));</span></a>
<a name="1234"><span class="lineNum">    1234 </span>            :       else</a>
<a name="1235"><span class="lineNum">    1235 </span><span class="lineNoCov">          0 :         qh_fprintf(qh, qh-&gt;ferr, 6291, &quot;qhull internal error (qh_checkpolygon): f%d is on qh.visible_list f%d but it is not 'visible'\n&quot;, facet-&gt;id, qh-&gt;newfacet_list-&gt;id);</span></a>
<a name="1236"><span class="lineNum">    1236 </span><span class="lineNoCov">          0 :       qh_errexit(qh, qh_ERRqhull, facet, NULL);</span></a>
<a name="1237"><span class="lineNum">    1237 </span>            :     }</a>
<a name="1238"><span class="lineNum">    1238 </span><span class="lineCov">         32 :     if (qh-&gt;NEWtentative) {</span></a>
<a name="1239"><span class="lineNum">    1239 </span><span class="lineNoCov">          0 :       checkfacet= !facet-&gt;newfacet;</span></a>
<a name="1240"><span class="lineNum">    1240 </span>            :     }else {</a>
<a name="1241"><span class="lineNum">    1241 </span><span class="lineCov">         32 :       checkfacet= !facet-&gt;visible;</span></a>
<a name="1242"><span class="lineNum">    1242 </span>            :     }</a>
<a name="1243"><span class="lineNum">    1243 </span><span class="lineCov">         32 :     if(checkfacet) {</span></a>
<a name="1244"><span class="lineNum">    1244 </span><span class="lineCov">         32 :       if (!nextseen) {</span></a>
<a name="1245"><span class="lineNum">    1245 </span><span class="lineCov">          8 :         if (facet == qh-&gt;facet_next)  /* previous facets do not have outsideset */</span></a>
<a name="1246"><span class="lineNum">    1246 </span><span class="lineCov">          8 :           nextseen= True;</span></a>
<a name="1247"><span class="lineNum">    1247 </span><span class="lineNoCov">          0 :         else if (qh_setsize(qh, facet-&gt;outsideset)) {</span></a>
<a name="1248"><span class="lineNum">    1248 </span><span class="lineNoCov">          0 :           if (!qh-&gt;NARROWhull</span></a>
<a name="1249"><span class="lineNum">    1249 </span>            : #if !qh_COMPUTEfurthest</a>
<a name="1250"><span class="lineNum">    1250 </span><span class="lineNoCov">          0 :           || facet-&gt;furthestdist &gt;= qh-&gt;MINoutside</span></a>
<a name="1251"><span class="lineNum">    1251 </span>            : #endif</a>
<a name="1252"><span class="lineNum">    1252 </span>            :           ) {</a>
<a name="1253"><span class="lineNum">    1253 </span><span class="lineNoCov">          0 :             qh_fprintf(qh, qh-&gt;ferr, 6137, &quot;qhull internal error (qh_checkpolygon): f%d has outside points before qh.facet_next f%d\n&quot;,</span></a>
<a name="1254"><span class="lineNum">    1254 </span><span class="lineNoCov">          0 :                      facet-&gt;id, getid_(qh-&gt;facet_next));</span></a>
<a name="1255"><span class="lineNum">    1255 </span><span class="lineNoCov">          0 :             qh_errexit2(qh, qh_ERRqhull, facet, qh-&gt;facet_next);</span></a>
<a name="1256"><span class="lineNum">    1256 </span>            :           }</a>
<a name="1257"><span class="lineNum">    1257 </span>            :         }</a>
<a name="1258"><span class="lineNum">    1258 </span>            :       }</a>
<a name="1259"><span class="lineNum">    1259 </span><span class="lineCov">         32 :       numfacets++;</span></a>
<a name="1260"><span class="lineNum">    1260 </span><span class="lineCov">         32 :       qh_checkfacet(qh, facet, False, &amp;waserror);</span></a>
<a name="1261"><span class="lineNum">    1261 </span><span class="lineNoCov">          0 :     }else if (facet-&gt;visible &amp;&amp; qh-&gt;NEWfacets) {</span></a>
<a name="1262"><span class="lineNum">    1262 </span><span class="lineNoCov">          0 :       if (!SETempty_(facet-&gt;neighbors) || !SETempty_(facet-&gt;ridges)) {</span></a>
<a name="1263"><span class="lineNum">    1263 </span><span class="lineNoCov">          0 :         qh_fprintf(qh, qh-&gt;ferr, 6376, &quot;qhull internal error (qh_checkpolygon): expecting empty f.neighbors and f.ridges for visible facet f%d.  Got %d neighbors and %d ridges\n&quot;,</span></a>
<a name="1264"><span class="lineNum">    1264 </span>            :           facet-&gt;id, qh_setsize(qh, facet-&gt;neighbors), qh_setsize(qh, facet-&gt;ridges));</a>
<a name="1265"><span class="lineNum">    1265 </span><span class="lineNoCov">          0 :         qh_errexit(qh, qh_ERRqhull, facet, NULL);</span></a>
<a name="1266"><span class="lineNum">    1266 </span>            :       }</a>
<a name="1267"><span class="lineNum">    1267 </span>            :     }</a>
<a name="1268"><span class="lineNum">    1268 </span>            :   }</a>
<a name="1269"><span class="lineNum">    1269 </span><span class="lineCov">          8 :   if (facetlist == qh-&gt;facet_list) {</span></a>
<a name="1270"><span class="lineNum">    1270 </span><span class="lineCov">          8 :     vertexlist= qh-&gt;vertex_list;</span></a>
<a name="1271"><span class="lineNum">    1271 </span><span class="lineNoCov">          0 :   }else if (facetlist == qh-&gt;newfacet_list) {</span></a>
<a name="1272"><span class="lineNum">    1272 </span><span class="lineNoCov">          0 :     vertexlist= qh-&gt;newvertex_list;</span></a>
<a name="1273"><span class="lineNum">    1273 </span>            :   }else {</a>
<a name="1274"><span class="lineNum">    1274 </span><span class="lineNoCov">          0 :     vertexlist= NULL;</span></a>
<a name="1275"><span class="lineNum">    1275 </span>            :   }</a>
<a name="1276"><span class="lineNum">    1276 </span><span class="lineCov">         40 :   FORALLvertex_(vertexlist) {</span></a>
<a name="1277"><span class="lineNum">    1277 </span><span class="lineCov">         32 :     qh_checkvertex(qh, vertex, !qh_ALL, &amp;waserror);</span></a>
<a name="1278"><span class="lineNum">    1278 </span><span class="lineCov">         32 :     if(vertex == qh-&gt;newvertex_list)</span></a>
<a name="1279"><span class="lineNum">    1279 </span><span class="lineNoCov">          0 :       newvertexseen= True;</span></a>
<a name="1280"><span class="lineNum">    1280 </span><span class="lineCov">         32 :     vertex-&gt;seen= False;</span></a>
<a name="1281"><span class="lineNum">    1281 </span><span class="lineCov">         32 :     vertex-&gt;visitid= 0;</span></a>
<a name="1282"><span class="lineNum">    1282 </span><span class="lineCov">         32 :     if(vertex-&gt;newfacet &amp;&amp; !newvertexseen &amp;&amp; !vertex-&gt;deleted) {</span></a>
<a name="1283"><span class="lineNum">    1283 </span><span class="lineNoCov">          0 :       qh_fprintf(qh, qh-&gt;ferr, 6288, &quot;qhull internal error (qh_checkpolygon): v%d is 'newfacet' but it is not on new vertex list v%d\n&quot;, vertex-&gt;id, getid_(qh-&gt;newvertex_list));</span></a>
<a name="1284"><span class="lineNum">    1284 </span><span class="lineNoCov">          0 :       qh_errexit(qh, qh_ERRqhull, qh-&gt;visible_list, NULL);</span></a>
<a name="1285"><span class="lineNum">    1285 </span>            :     }</a>
<a name="1286"><span class="lineNum">    1286 </span>            :   }</a>
<a name="1287"><span class="lineNum">    1287 </span><span class="lineCov">         40 :   FORALLfacet_(facetlist) {</span></a>
<a name="1288"><span class="lineNum">    1288 </span><span class="lineCov">         32 :     if (facet-&gt;visible)</span></a>
<a name="1289"><span class="lineNum">    1289 </span><span class="lineNoCov">          0 :       continue;</span></a>
<a name="1290"><span class="lineNum">    1290 </span><span class="lineCov">         32 :     if (facet-&gt;simplicial)</span></a>
<a name="1291"><span class="lineNum">    1291 </span><span class="lineCov">         32 :       numridges += qh-&gt;hull_dim;</span></a>
<a name="1292"><span class="lineNum">    1292 </span>            :     else</a>
<a name="1293"><span class="lineNum">    1293 </span><span class="lineNoCov">          0 :       numridges += qh_setsize(qh, facet-&gt;ridges);</span></a>
<a name="1294"><span class="lineNum">    1294 </span><span class="lineCov">        128 :     FOREACHvertex_(facet-&gt;vertices) {</span></a>
<a name="1295"><span class="lineNum">    1295 </span><span class="lineCov">         96 :       vertex-&gt;visitid++;</span></a>
<a name="1296"><span class="lineNum">    1296 </span><span class="lineCov">         96 :       if (!vertex-&gt;seen) {</span></a>
<a name="1297"><span class="lineNum">    1297 </span><span class="lineCov">         32 :         vertex-&gt;seen= True;</span></a>
<a name="1298"><span class="lineNum">    1298 </span><span class="lineCov">         32 :         numvertices++;</span></a>
<a name="1299"><span class="lineNum">    1299 </span><span class="lineCov">         32 :         if (qh_pointid(qh, vertex-&gt;point) == qh_IDunknown) {</span></a>
<a name="1300"><span class="lineNum">    1300 </span><span class="lineNoCov">          0 :           qh_fprintf(qh, qh-&gt;ferr, 6139, &quot;qhull internal error (qh_checkpolygon): unknown point %p for vertex v%d first_point %p\n&quot;,</span></a>
<a name="1301"><span class="lineNum">    1301 </span>            :                    vertex-&gt;point, vertex-&gt;id, qh-&gt;first_point);</a>
<a name="1302"><span class="lineNum">    1302 </span><span class="lineNoCov">          0 :           waserror= True;</span></a>
<a name="1303"><span class="lineNum">    1303 </span>            :         }</a>
<a name="1304"><span class="lineNum">    1304 </span>            :       }</a>
<a name="1305"><span class="lineNum">    1305 </span>            :     }</a>
<a name="1306"><span class="lineNum">    1306 </span>            :   }</a>
<a name="1307"><span class="lineNum">    1307 </span><span class="lineCov">          8 :   qh-&gt;vertex_visit += (unsigned int)numfacets;</span></a>
<a name="1308"><span class="lineNum">    1308 </span><span class="lineCov">          8 :   if (facetlist == qh-&gt;facet_list) {</span></a>
<a name="1309"><span class="lineNum">    1309 </span><span class="lineCov">          8 :     if (numfacets != qh-&gt;num_facets - qh-&gt;num_visible) {</span></a>
<a name="1310"><span class="lineNum">    1310 </span><span class="lineNoCov">          0 :       qh_fprintf(qh, qh-&gt;ferr, 6140, &quot;qhull internal error (qh_checkpolygon): actual number of facets is %d, cumulative facet count is %d - %d visible facets\n&quot;,</span></a>
<a name="1311"><span class="lineNum">    1311 </span>            :               numfacets, qh-&gt;num_facets, qh-&gt;num_visible);</a>
<a name="1312"><span class="lineNum">    1312 </span><span class="lineNoCov">          0 :       waserror= True;</span></a>
<a name="1313"><span class="lineNum">    1313 </span>            :     }</a>
<a name="1314"><span class="lineNum">    1314 </span><span class="lineCov">          8 :     qh-&gt;vertex_visit++;</span></a>
<a name="1315"><span class="lineNum">    1315 </span><span class="lineCov">          8 :     if (qh-&gt;VERTEXneighbors) {</span></a>
<a name="1316"><span class="lineNum">    1316 </span><span class="lineNoCov">          0 :       FORALLvertices {</span></a>
<a name="1317"><span class="lineNum">    1317 </span><span class="lineNoCov">          0 :         if (!vertex-&gt;neighbors) {</span></a>
<a name="1318"><span class="lineNum">    1318 </span><span class="lineNoCov">          0 :           qh_fprintf(qh, qh-&gt;ferr, 6407, &quot;qhull internal error (qh_checkpolygon): missing vertex neighbors for v%d\n&quot;, vertex-&gt;id);</span></a>
<a name="1319"><span class="lineNum">    1319 </span><span class="lineNoCov">          0 :           waserror= True;</span></a>
<a name="1320"><span class="lineNum">    1320 </span>            :         }</a>
<a name="1321"><span class="lineNum">    1321 </span><span class="lineNoCov">          0 :         qh_setcheck(qh, vertex-&gt;neighbors, &quot;neighbors for v&quot;, vertex-&gt;id);</span></a>
<a name="1322"><span class="lineNum">    1322 </span><span class="lineNoCov">          0 :         if (vertex-&gt;deleted)</span></a>
<a name="1323"><span class="lineNum">    1323 </span><span class="lineNoCov">          0 :           continue;</span></a>
<a name="1324"><span class="lineNum">    1324 </span><span class="lineNoCov">          0 :         totvneighbors += qh_setsize(qh, vertex-&gt;neighbors);</span></a>
<a name="1325"><span class="lineNum">    1325 </span>            :       }</a>
<a name="1326"><span class="lineNum">    1326 </span><span class="lineNoCov">          0 :       FORALLfacet_(facetlist) {</span></a>
<a name="1327"><span class="lineNum">    1327 </span><span class="lineNoCov">          0 :         if (!facet-&gt;visible)</span></a>
<a name="1328"><span class="lineNum">    1328 </span><span class="lineNoCov">          0 :           totfacetvertices += qh_setsize(qh, facet-&gt;vertices);</span></a>
<a name="1329"><span class="lineNum">    1329 </span>            :       }</a>
<a name="1330"><span class="lineNum">    1330 </span><span class="lineNoCov">          0 :       if (totvneighbors != totfacetvertices) {</span></a>
<a name="1331"><span class="lineNum">    1331 </span><span class="lineNoCov">          0 :         qh_fprintf(qh, qh-&gt;ferr, 6141, &quot;qhull internal error (qh_checkpolygon): vertex neighbors inconsistent (tot_vneighbors %d != tot_facetvertices %d).  Maybe duplicate or missing vertex\n&quot;,</span></a>
<a name="1332"><span class="lineNum">    1332 </span>            :                 totvneighbors, totfacetvertices);</a>
<a name="1333"><span class="lineNum">    1333 </span><span class="lineNoCov">          0 :         waserror= True;</span></a>
<a name="1334"><span class="lineNum">    1334 </span><span class="lineNoCov">          0 :         FORALLvertices {</span></a>
<a name="1335"><span class="lineNum">    1335 </span><span class="lineNoCov">          0 :           if (vertex-&gt;deleted)</span></a>
<a name="1336"><span class="lineNum">    1336 </span><span class="lineNoCov">          0 :             continue;</span></a>
<a name="1337"><span class="lineNum">    1337 </span><span class="lineNoCov">          0 :           qh-&gt;visit_id++;</span></a>
<a name="1338"><span class="lineNum">    1338 </span><span class="lineNoCov">          0 :           FOREACHneighbor_(vertex) {</span></a>
<a name="1339"><span class="lineNum">    1339 </span><span class="lineNoCov">          0 :             if (neighbor-&gt;visitid==qh-&gt;visit_id) {</span></a>
<a name="1340"><span class="lineNum">    1340 </span><span class="lineNoCov">          0 :               qh_fprintf(qh, qh-&gt;ferr, 6275, &quot;qhull internal error (qh_checkpolygon): facet f%d occurs twice in neighbors of vertex v%d\n&quot;,</span></a>
<a name="1341"><span class="lineNum">    1341 </span>            :                   neighbor-&gt;id, vertex-&gt;id);</a>
<a name="1342"><span class="lineNum">    1342 </span><span class="lineNoCov">          0 :               errorfacet2= errorfacet;</span></a>
<a name="1343"><span class="lineNum">    1343 </span><span class="lineNoCov">          0 :               errorfacet= neighbor;</span></a>
<a name="1344"><span class="lineNum">    1344 </span>            :             }</a>
<a name="1345"><span class="lineNum">    1345 </span><span class="lineNoCov">          0 :             neighbor-&gt;visitid= qh-&gt;visit_id;</span></a>
<a name="1346"><span class="lineNum">    1346 </span><span class="lineNoCov">          0 :             if (!qh_setin(neighbor-&gt;vertices, vertex)) {</span></a>
<a name="1347"><span class="lineNum">    1347 </span><span class="lineNoCov">          0 :               qh_fprintf(qh, qh-&gt;ferr, 6276, &quot;qhull internal error (qh_checkpolygon): facet f%d is a neighbor of vertex v%d but v%d is not a vertex of f%d\n&quot;,</span></a>
<a name="1348"><span class="lineNum">    1348 </span>            :                   neighbor-&gt;id, vertex-&gt;id, vertex-&gt;id, neighbor-&gt;id);</a>
<a name="1349"><span class="lineNum">    1349 </span><span class="lineNoCov">          0 :               errorfacet2= errorfacet;</span></a>
<a name="1350"><span class="lineNum">    1350 </span><span class="lineNoCov">          0 :               errorfacet= neighbor;</span></a>
<a name="1351"><span class="lineNum">    1351 </span>            :             }</a>
<a name="1352"><span class="lineNum">    1352 </span>            :           }</a>
<a name="1353"><span class="lineNum">    1353 </span>            :         }</a>
<a name="1354"><span class="lineNum">    1354 </span><span class="lineNoCov">          0 :         FORALLfacet_(facetlist){</span></a>
<a name="1355"><span class="lineNum">    1355 </span><span class="lineNoCov">          0 :           if (!facet-&gt;visible) {</span></a>
<a name="1356"><span class="lineNum">    1356 </span>            :             /* vertices are inverse sorted and are unlikely to be duplicated */</a>
<a name="1357"><span class="lineNum">    1357 </span><span class="lineNoCov">          0 :             FOREACHvertex_(facet-&gt;vertices){</span></a>
<a name="1358"><span class="lineNum">    1358 </span><span class="lineNoCov">          0 :               if (!qh_setin(vertex-&gt;neighbors, facet)) {</span></a>
<a name="1359"><span class="lineNum">    1359 </span><span class="lineNoCov">          0 :                 qh_fprintf(qh, qh-&gt;ferr, 6277, &quot;qhull internal error (qh_checkpolygon): v%d is a vertex of facet f%d but f%d is not a neighbor of v%d\n&quot;,</span></a>
<a name="1360"><span class="lineNum">    1360 </span>            :                   vertex-&gt;id, facet-&gt;id, facet-&gt;id, vertex-&gt;id);</a>
<a name="1361"><span class="lineNum">    1361 </span><span class="lineNoCov">          0 :                 errorfacet2= errorfacet;</span></a>
<a name="1362"><span class="lineNum">    1362 </span><span class="lineNoCov">          0 :                 errorfacet= facet;</span></a>
<a name="1363"><span class="lineNum">    1363 </span>            :               }</a>
<a name="1364"><span class="lineNum">    1364 </span>            :             }</a>
<a name="1365"><span class="lineNum">    1365 </span>            :           }</a>
<a name="1366"><span class="lineNum">    1366 </span>            :         }</a>
<a name="1367"><span class="lineNum">    1367 </span>            :       }</a>
<a name="1368"><span class="lineNum">    1368 </span>            :     }</a>
<a name="1369"><span class="lineNum">    1369 </span><span class="lineCov">          8 :     if (numvertices != qh-&gt;num_vertices - qh_setsize(qh, qh-&gt;del_vertices)) {</span></a>
<a name="1370"><span class="lineNum">    1370 </span><span class="lineNoCov">          0 :       qh_fprintf(qh, qh-&gt;ferr, 6142, &quot;qhull internal error (qh_checkpolygon): actual number of vertices is %d, cumulative vertex count is %d\n&quot;,</span></a>
<a name="1371"><span class="lineNum">    1371 </span><span class="lineNoCov">          0 :               numvertices, qh-&gt;num_vertices - qh_setsize(qh, qh-&gt;del_vertices));</span></a>
<a name="1372"><span class="lineNum">    1372 </span><span class="lineNoCov">          0 :       waserror= True;</span></a>
<a name="1373"><span class="lineNum">    1373 </span>            :     }</a>
<a name="1374"><span class="lineNum">    1374 </span><span class="lineCov">          8 :     if (qh-&gt;hull_dim == 2 &amp;&amp; numvertices != numfacets) {</span></a>
<a name="1375"><span class="lineNum">    1375 </span><span class="lineNoCov">          0 :       qh_fprintf(qh, qh-&gt;ferr, 6143, &quot;qhull internal error (qh_checkpolygon): #vertices %d != #facets %d\n&quot;,</span></a>
<a name="1376"><span class="lineNum">    1376 </span>            :         numvertices, numfacets);</a>
<a name="1377"><span class="lineNum">    1377 </span><span class="lineNoCov">          0 :       waserror= True;</span></a>
<a name="1378"><span class="lineNum">    1378 </span>            :     }</a>
<a name="1379"><span class="lineNum">    1379 </span><span class="lineCov">          8 :     if (qh-&gt;hull_dim == 3 &amp;&amp; numvertices + numfacets - numridges/2 != 2) {</span></a>
<a name="1380"><span class="lineNum">    1380 </span><span class="lineNoCov">          0 :       qh_fprintf(qh, qh-&gt;ferr, 7063, &quot;qhull warning: #vertices %d + #facets %d - #edges %d != 2.  A vertex appears twice in a edge list.  May occur during merging.\n&quot;,</span></a>
<a name="1381"><span class="lineNum">    1381 </span>            :           numvertices, numfacets, numridges/2);</a>
<a name="1382"><span class="lineNum">    1382 </span>            :       /* occurs if lots of merging and a vertex ends up twice in an edge list.  e.g., RBOX 1000 s W1e-13 t995849315 D2 | QHULL d Tc Tv */</a>
<a name="1383"><span class="lineNum">    1383 </span>            :     }</a>
<a name="1384"><span class="lineNum">    1384 </span>            :   }</a>
<a name="1385"><span class="lineNum">    1385 </span><span class="lineCov">          8 :   if (waserror)</span></a>
<a name="1386"><span class="lineNum">    1386 </span><span class="lineNoCov">          0 :     qh_errexit2(qh, qh_ERRqhull, errorfacet, errorfacet2);</span></a>
<a name="1387"><span class="lineNum">    1387 </span><span class="lineCov">          8 : } /* checkpolygon */</span></a>
<a name="1388"><span class="lineNum">    1388 </span>            : </a>
<a name="1389"><span class="lineNum">    1389 </span>            : </a>
<a name="1390"><span class="lineNum">    1390 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="1391"><span class="lineNum">    1391 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;checkvertex&quot;&gt;-&lt;/a&gt;</a>
<a name="1392"><span class="lineNum">    1392 </span>            : </a>
<a name="1393"><span class="lineNum">    1393 </span>            :   qh_checkvertex(qh, vertex, allchecks, &amp;waserror )</a>
<a name="1394"><span class="lineNum">    1394 </span>            :     check vertex for consistency</a>
<a name="1395"><span class="lineNum">    1395 </span>            :     if allchecks, checks vertex-&gt;neighbors</a>
<a name="1396"><span class="lineNum">    1396 </span>            : </a>
<a name="1397"><span class="lineNum">    1397 </span>            :   returns:</a>
<a name="1398"><span class="lineNum">    1398 </span>            :     sets waserror if any error occurs</a>
<a name="1399"><span class="lineNum">    1399 </span>            : </a>
<a name="1400"><span class="lineNum">    1400 </span>            :   notes:</a>
<a name="1401"><span class="lineNum">    1401 </span>            :     called by qh_tracemerge and qh_checkpolygon</a>
<a name="1402"><span class="lineNum">    1402 </span>            :     neighbors checked efficiently in qh_checkpolygon</a>
<a name="1403"><span class="lineNum">    1403 </span>            : */</a>
<a name="1404"><span class="lineNum">    1404 </span><span class="lineCov">         32 : void qh_checkvertex(qhT *qh, vertexT *vertex, boolT allchecks, boolT *waserrorp) {</span></a>
<a name="1405"><span class="lineNum">    1405 </span><span class="lineCov">         32 :   boolT waserror= False;</span></a>
<a name="1406"><span class="lineNum">    1406 </span><span class="lineCov">         32 :   facetT *neighbor, **neighborp, *errfacet=NULL;</span></a>
<a name="1407"><span class="lineNum">    1407 </span>            : </a>
<a name="1408"><span class="lineNum">    1408 </span><span class="lineCov">         32 :   if (qh_pointid(qh, vertex-&gt;point) == qh_IDunknown) {</span></a>
<a name="1409"><span class="lineNum">    1409 </span><span class="lineNoCov">          0 :     qh_fprintf(qh, qh-&gt;ferr, 6144, &quot;qhull internal error (qh_checkvertex): unknown point id %p\n&quot;, vertex-&gt;point);</span></a>
<a name="1410"><span class="lineNum">    1410 </span><span class="lineNoCov">          0 :     waserror= True;</span></a>
<a name="1411"><span class="lineNum">    1411 </span>            :   }</a>
<a name="1412"><span class="lineNum">    1412 </span><span class="lineCov">         32 :   if (vertex-&gt;id &gt;= qh-&gt;vertex_id) {</span></a>
<a name="1413"><span class="lineNum">    1413 </span><span class="lineNoCov">          0 :     qh_fprintf(qh, qh-&gt;ferr, 6145, &quot;qhull internal error (qh_checkvertex): unknown vertex id v%d &gt;= qh.vertex_id (%d)\n&quot;, vertex-&gt;id, qh-&gt;vertex_id);</span></a>
<a name="1414"><span class="lineNum">    1414 </span><span class="lineNoCov">          0 :     waserror= True;</span></a>
<a name="1415"><span class="lineNum">    1415 </span>            :   }</a>
<a name="1416"><span class="lineNum">    1416 </span><span class="lineCov">         32 :   if (vertex-&gt;visitid &gt; qh-&gt;vertex_visit) {</span></a>
<a name="1417"><span class="lineNum">    1417 </span><span class="lineNoCov">          0 :     qh_fprintf(qh, qh-&gt;ferr, 6413, &quot;qhull internal error (qh_checkvertex): expecting v%d.visitid &lt;= qh.vertex_visit (%d).  Got visitid %d\n&quot;, vertex-&gt;id, qh-&gt;vertex_visit, vertex-&gt;visitid);</span></a>
<a name="1418"><span class="lineNum">    1418 </span><span class="lineNoCov">          0 :     waserror= True;</span></a>
<a name="1419"><span class="lineNum">    1419 </span>            :   }</a>
<a name="1420"><span class="lineNum">    1420 </span><span class="lineCov">         32 :   if (allchecks &amp;&amp; !waserror &amp;&amp; !vertex-&gt;deleted) {</span></a>
<a name="1421"><span class="lineNum">    1421 </span><span class="lineNoCov">          0 :     if (qh_setsize(qh, vertex-&gt;neighbors)) {</span></a>
<a name="1422"><span class="lineNum">    1422 </span><span class="lineNoCov">          0 :       FOREACHneighbor_(vertex) {</span></a>
<a name="1423"><span class="lineNum">    1423 </span><span class="lineNoCov">          0 :         if (!qh_setin(neighbor-&gt;vertices, vertex)) {</span></a>
<a name="1424"><span class="lineNum">    1424 </span><span class="lineNoCov">          0 :           qh_fprintf(qh, qh-&gt;ferr, 6146, &quot;qhull internal error (qh_checkvertex): neighbor f%d does not contain v%d\n&quot;, neighbor-&gt;id, vertex-&gt;id);</span></a>
<a name="1425"><span class="lineNum">    1425 </span><span class="lineNoCov">          0 :           errfacet= neighbor;</span></a>
<a name="1426"><span class="lineNum">    1426 </span><span class="lineNoCov">          0 :           waserror= True;</span></a>
<a name="1427"><span class="lineNum">    1427 </span>            :         }</a>
<a name="1428"><span class="lineNum">    1428 </span>            :       }</a>
<a name="1429"><span class="lineNum">    1429 </span>            :     }</a>
<a name="1430"><span class="lineNum">    1430 </span>            :   }</a>
<a name="1431"><span class="lineNum">    1431 </span><span class="lineCov">         32 :   if (waserror) {</span></a>
<a name="1432"><span class="lineNum">    1432 </span><span class="lineNoCov">          0 :     qh_errprint(qh, &quot;ERRONEOUS&quot;, NULL, NULL, NULL, vertex);</span></a>
<a name="1433"><span class="lineNum">    1433 </span><span class="lineNoCov">          0 :     if (errfacet)</span></a>
<a name="1434"><span class="lineNum">    1434 </span><span class="lineNoCov">          0 :       qh_errexit(qh, qh_ERRqhull, errfacet, NULL);</span></a>
<a name="1435"><span class="lineNum">    1435 </span><span class="lineNoCov">          0 :     *waserrorp= True;</span></a>
<a name="1436"><span class="lineNum">    1436 </span>            :   }</a>
<a name="1437"><span class="lineNum">    1437 </span><span class="lineCov">         32 : } /* checkvertex */</span></a>
<a name="1438"><span class="lineNum">    1438 </span>            : </a>
<a name="1439"><span class="lineNum">    1439 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="1440"><span class="lineNum">    1440 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;clearcenters&quot;&gt;-&lt;/a&gt;</a>
<a name="1441"><span class="lineNum">    1441 </span>            : </a>
<a name="1442"><span class="lineNum">    1442 </span>            :   qh_clearcenters(qh, type )</a>
<a name="1443"><span class="lineNum">    1443 </span>            :     clear old data from facet-&gt;center</a>
<a name="1444"><span class="lineNum">    1444 </span>            : </a>
<a name="1445"><span class="lineNum">    1445 </span>            :   notes:</a>
<a name="1446"><span class="lineNum">    1446 </span>            :     sets new centertype</a>
<a name="1447"><span class="lineNum">    1447 </span>            :     nop if CENTERtype is the same</a>
<a name="1448"><span class="lineNum">    1448 </span>            : */</a>
<a name="1449"><span class="lineNum">    1449 </span><span class="lineNoCov">          0 : void qh_clearcenters(qhT *qh, qh_CENTER type) {</span></a>
<a name="1450"><span class="lineNum">    1450 </span>            :   facetT *facet;</a>
<a name="1451"><span class="lineNum">    1451 </span>            : </a>
<a name="1452"><span class="lineNum">    1452 </span><span class="lineNoCov">          0 :   if (qh-&gt;CENTERtype != type) {</span></a>
<a name="1453"><span class="lineNum">    1453 </span><span class="lineNoCov">          0 :     FORALLfacets {</span></a>
<a name="1454"><span class="lineNum">    1454 </span><span class="lineNoCov">          0 :       if (facet-&gt;tricoplanar &amp;&amp; !facet-&gt;keepcentrum)</span></a>
<a name="1455"><span class="lineNum">    1455 </span><span class="lineNoCov">          0 :           facet-&gt;center= NULL;  /* center is owned by the -&gt;keepcentrum facet */</span></a>
<a name="1456"><span class="lineNum">    1456 </span><span class="lineNoCov">          0 :       else if (qh-&gt;CENTERtype == qh_ASvoronoi){</span></a>
<a name="1457"><span class="lineNum">    1457 </span><span class="lineNoCov">          0 :         if (facet-&gt;center) {</span></a>
<a name="1458"><span class="lineNum">    1458 </span><span class="lineNoCov">          0 :           qh_memfree(qh, facet-&gt;center, qh-&gt;center_size);</span></a>
<a name="1459"><span class="lineNum">    1459 </span><span class="lineNoCov">          0 :           facet-&gt;center= NULL;</span></a>
<a name="1460"><span class="lineNum">    1460 </span>            :         }</a>
<a name="1461"><span class="lineNum">    1461 </span>            :       }else /* qh.CENTERtype == qh_AScentrum */ {</a>
<a name="1462"><span class="lineNum">    1462 </span><span class="lineNoCov">          0 :         if (facet-&gt;center) {</span></a>
<a name="1463"><span class="lineNum">    1463 </span><span class="lineNoCov">          0 :           qh_memfree(qh, facet-&gt;center, qh-&gt;normal_size);</span></a>
<a name="1464"><span class="lineNum">    1464 </span><span class="lineNoCov">          0 :           facet-&gt;center= NULL;</span></a>
<a name="1465"><span class="lineNum">    1465 </span>            :         }</a>
<a name="1466"><span class="lineNum">    1466 </span>            :       }</a>
<a name="1467"><span class="lineNum">    1467 </span>            :     }</a>
<a name="1468"><span class="lineNum">    1468 </span><span class="lineNoCov">          0 :     qh-&gt;CENTERtype= type;</span></a>
<a name="1469"><span class="lineNum">    1469 </span>            :   }</a>
<a name="1470"><span class="lineNum">    1470 </span><span class="lineNoCov">          0 :   trace2((qh, qh-&gt;ferr, 2043, &quot;qh_clearcenters: switched to center type %d\n&quot;, type));</span></a>
<a name="1471"><span class="lineNum">    1471 </span><span class="lineNoCov">          0 : } /* clearcenters */</span></a>
<a name="1472"><span class="lineNum">    1472 </span>            : </a>
<a name="1473"><span class="lineNum">    1473 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="1474"><span class="lineNum">    1474 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;createsimplex&quot;&gt;-&lt;/a&gt;</a>
<a name="1475"><span class="lineNum">    1475 </span>            : </a>
<a name="1476"><span class="lineNum">    1476 </span>            :   qh_createsimplex(qh, vertices )</a>
<a name="1477"><span class="lineNum">    1477 </span>            :     creates a simplex from a set of vertices</a>
<a name="1478"><span class="lineNum">    1478 </span>            : </a>
<a name="1479"><span class="lineNum">    1479 </span>            :   returns:</a>
<a name="1480"><span class="lineNum">    1480 </span>            :     initializes qh.facet_list to the simplex</a>
<a name="1481"><span class="lineNum">    1481 </span>            : </a>
<a name="1482"><span class="lineNum">    1482 </span>            :   notes:</a>
<a name="1483"><span class="lineNum">    1483 </span>            :     only called by qh_initialhull</a>
<a name="1484"><span class="lineNum">    1484 </span>            : </a>
<a name="1485"><span class="lineNum">    1485 </span>            :   design:</a>
<a name="1486"><span class="lineNum">    1486 </span>            :     for each vertex</a>
<a name="1487"><span class="lineNum">    1487 </span>            :       create a new facet</a>
<a name="1488"><span class="lineNum">    1488 </span>            :     for each new facet</a>
<a name="1489"><span class="lineNum">    1489 </span>            :       create its neighbor set</a>
<a name="1490"><span class="lineNum">    1490 </span>            : */</a>
<a name="1491"><span class="lineNum">    1491 </span><span class="lineCov">          9 : void qh_createsimplex(qhT *qh, setT *vertices /* qh.facet_list */) {</span></a>
<a name="1492"><span class="lineNum">    1492 </span><span class="lineCov">          9 :   facetT *facet= NULL, *newfacet;</span></a>
<a name="1493"><span class="lineNum">    1493 </span><span class="lineCov">          9 :   boolT toporient= True;</span></a>
<a name="1494"><span class="lineNum">    1494 </span>            :   int vertex_i, vertex_n, nth;</a>
<a name="1495"><span class="lineNum">    1495 </span><span class="lineCov">          9 :   setT *newfacets= qh_settemp(qh, qh-&gt;hull_dim+1);</span></a>
<a name="1496"><span class="lineNum">    1496 </span>            :   vertexT *vertex;</a>
<a name="1497"><span class="lineNum">    1497 </span>            : </a>
<a name="1498"><span class="lineNum">    1498 </span><span class="lineCov">         45 :   FOREACHvertex_i_(qh, vertices) {</span></a>
<a name="1499"><span class="lineNum">    1499 </span><span class="lineCov">         36 :     newfacet= qh_newfacet(qh);</span></a>
<a name="1500"><span class="lineNum">    1500 </span><span class="lineCov">         36 :     newfacet-&gt;vertices= qh_setnew_delnthsorted(qh, vertices, vertex_n, vertex_i, 0);</span></a>
<a name="1501"><span class="lineNum">    1501 </span><span class="lineCov">         36 :     if (toporient)</span></a>
<a name="1502"><span class="lineNum">    1502 </span><span class="lineCov">         18 :       newfacet-&gt;toporient= True;</span></a>
<a name="1503"><span class="lineNum">    1503 </span><span class="lineCov">         36 :     qh_appendfacet(qh, newfacet);</span></a>
<a name="1504"><span class="lineNum">    1504 </span><span class="lineCov">         36 :     newfacet-&gt;newfacet= True;</span></a>
<a name="1505"><span class="lineNum">    1505 </span><span class="lineCov">         36 :     qh_appendvertex(qh, vertex);</span></a>
<a name="1506"><span class="lineNum">    1506 </span><span class="lineCov">         36 :     qh_setappend(qh, &amp;newfacets, newfacet);</span></a>
<a name="1507"><span class="lineNum">    1507 </span><span class="lineCov">         36 :     toporient ^= True;</span></a>
<a name="1508"><span class="lineNum">    1508 </span>            :   }</a>
<a name="1509"><span class="lineNum">    1509 </span><span class="lineCov">         45 :   FORALLnew_facets {</span></a>
<a name="1510"><span class="lineNum">    1510 </span><span class="lineCov">         36 :     nth= 0;</span></a>
<a name="1511"><span class="lineNum">    1511 </span><span class="lineCov">        180 :     FORALLfacet_(qh-&gt;newfacet_list) {</span></a>
<a name="1512"><span class="lineNum">    1512 </span><span class="lineCov">        144 :       if (facet != newfacet)</span></a>
<a name="1513"><span class="lineNum">    1513 </span><span class="lineCov">        108 :         SETelem_(newfacet-&gt;neighbors, nth++)= facet;</span></a>
<a name="1514"><span class="lineNum">    1514 </span>            :     }</a>
<a name="1515"><span class="lineNum">    1515 </span><span class="lineCov">         36 :     qh_settruncate(qh, newfacet-&gt;neighbors, qh-&gt;hull_dim);</span></a>
<a name="1516"><span class="lineNum">    1516 </span>            :   }</a>
<a name="1517"><span class="lineNum">    1517 </span><span class="lineCov">          9 :   qh_settempfree(qh, &amp;newfacets);</span></a>
<a name="1518"><span class="lineNum">    1518 </span><span class="lineCov">          9 :   trace1((qh, qh-&gt;ferr, 1028, &quot;qh_createsimplex: created simplex\n&quot;));</span></a>
<a name="1519"><span class="lineNum">    1519 </span><span class="lineCov">          9 : } /* createsimplex */</span></a>
<a name="1520"><span class="lineNum">    1520 </span>            : </a>
<a name="1521"><span class="lineNum">    1521 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="1522"><span class="lineNum">    1522 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;delridge&quot;&gt;-&lt;/a&gt;</a>
<a name="1523"><span class="lineNum">    1523 </span>            : </a>
<a name="1524"><span class="lineNum">    1524 </span>            :   qh_delridge(qh, ridge )</a>
<a name="1525"><span class="lineNum">    1525 </span>            :     delete a ridge's vertices and frees its memory</a>
<a name="1526"><span class="lineNum">    1526 </span>            : </a>
<a name="1527"><span class="lineNum">    1527 </span>            :   notes:</a>
<a name="1528"><span class="lineNum">    1528 </span>            :     assumes r.top-&gt;ridges and r.bottom-&gt;ridges have been updated</a>
<a name="1529"><span class="lineNum">    1529 </span>            : */</a>
<a name="1530"><span class="lineNum">    1530 </span><span class="lineCov">      60838 : void qh_delridge(qhT *qh, ridgeT *ridge) {</span></a>
<a name="1531"><span class="lineNum">    1531 </span>            : </a>
<a name="1532"><span class="lineNum">    1532 </span><span class="lineCov">      60838 :   if (ridge == qh-&gt;traceridge)</span></a>
<a name="1533"><span class="lineNum">    1533 </span><span class="lineNoCov">          0 :     qh-&gt;traceridge= NULL;</span></a>
<a name="1534"><span class="lineNum">    1534 </span><span class="lineCov">      60838 :   qh_setfree(qh, &amp;(ridge-&gt;vertices));</span></a>
<a name="1535"><span class="lineNum">    1535 </span><span class="lineCov">      60838 :   qh_memfree(qh, ridge, (int)sizeof(ridgeT));</span></a>
<a name="1536"><span class="lineNum">    1536 </span><span class="lineCov">      60838 : } /* delridge */</span></a>
<a name="1537"><span class="lineNum">    1537 </span>            : </a>
<a name="1538"><span class="lineNum">    1538 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="1539"><span class="lineNum">    1539 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;delvertex&quot;&gt;-&lt;/a&gt;</a>
<a name="1540"><span class="lineNum">    1540 </span>            : </a>
<a name="1541"><span class="lineNum">    1541 </span>            :   qh_delvertex(qh, vertex )</a>
<a name="1542"><span class="lineNum">    1542 </span>            :     deletes a vertex and frees its memory</a>
<a name="1543"><span class="lineNum">    1543 </span>            : </a>
<a name="1544"><span class="lineNum">    1544 </span>            :   notes:</a>
<a name="1545"><span class="lineNum">    1545 </span>            :     assumes vertex-&gt;adjacencies have been updated if needed</a>
<a name="1546"><span class="lineNum">    1546 </span>            :     unlinks from vertex_list</a>
<a name="1547"><span class="lineNum">    1547 </span>            : */</a>
<a name="1548"><span class="lineNum">    1548 </span><span class="lineNoCov">          0 : void qh_delvertex(qhT *qh, vertexT *vertex) {</span></a>
<a name="1549"><span class="lineNum">    1549 </span>            : </a>
<a name="1550"><span class="lineNum">    1550 </span><span class="lineNoCov">          0 :   if (vertex-&gt;deleted &amp;&amp; !vertex-&gt;partitioned &amp;&amp; !qh-&gt;NOerrexit) {</span></a>
<a name="1551"><span class="lineNum">    1551 </span><span class="lineNoCov">          0 :     qh_fprintf(qh, qh-&gt;ferr, 6395, &quot;qhull internal error (qh_delvertex): vertex v%d was deleted but it was not partitioned as a coplanar point\n&quot;,</span></a>
<a name="1552"><span class="lineNum">    1552 </span>            :       vertex-&gt;id);</a>
<a name="1553"><span class="lineNum">    1553 </span><span class="lineNoCov">          0 :     qh_errexit(qh, qh_ERRqhull, NULL, NULL);</span></a>
<a name="1554"><span class="lineNum">    1554 </span>            :   }</a>
<a name="1555"><span class="lineNum">    1555 </span><span class="lineNoCov">          0 :   if (vertex == qh-&gt;tracevertex)</span></a>
<a name="1556"><span class="lineNum">    1556 </span><span class="lineNoCov">          0 :     qh-&gt;tracevertex= NULL;</span></a>
<a name="1557"><span class="lineNum">    1557 </span><span class="lineNoCov">          0 :   qh_removevertex(qh, vertex);</span></a>
<a name="1558"><span class="lineNum">    1558 </span><span class="lineNoCov">          0 :   qh_setfree(qh, &amp;vertex-&gt;neighbors);</span></a>
<a name="1559"><span class="lineNum">    1559 </span><span class="lineNoCov">          0 :   qh_memfree(qh, vertex, (int)sizeof(vertexT));</span></a>
<a name="1560"><span class="lineNum">    1560 </span><span class="lineNoCov">          0 : } /* delvertex */</span></a>
<a name="1561"><span class="lineNum">    1561 </span>            : </a>
<a name="1562"><span class="lineNum">    1562 </span>            : </a>
<a name="1563"><span class="lineNum">    1563 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="1564"><span class="lineNum">    1564 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;facet3vertex&quot;&gt;-&lt;/a&gt;</a>
<a name="1565"><span class="lineNum">    1565 </span>            : </a>
<a name="1566"><span class="lineNum">    1566 </span>            :   qh_facet3vertex(qh )</a>
<a name="1567"><span class="lineNum">    1567 </span>            :     return temporary set of 3-d vertices in qh_ORIENTclock order</a>
<a name="1568"><span class="lineNum">    1568 </span>            : </a>
<a name="1569"><span class="lineNum">    1569 </span>            :   design:</a>
<a name="1570"><span class="lineNum">    1570 </span>            :     if simplicial facet</a>
<a name="1571"><span class="lineNum">    1571 </span>            :       build set from facet-&gt;vertices with facet-&gt;toporient</a>
<a name="1572"><span class="lineNum">    1572 </span>            :     else</a>
<a name="1573"><span class="lineNum">    1573 </span>            :       for each ridge in order</a>
<a name="1574"><span class="lineNum">    1574 </span>            :         build set from ridge's vertices</a>
<a name="1575"><span class="lineNum">    1575 </span>            : */</a>
<a name="1576"><span class="lineNum">    1576 </span><span class="lineNoCov">          0 : setT *qh_facet3vertex(qhT *qh, facetT *facet) {</span></a>
<a name="1577"><span class="lineNum">    1577 </span>            :   ridgeT *ridge, *firstridge;</a>
<a name="1578"><span class="lineNum">    1578 </span>            :   vertexT *vertex;</a>
<a name="1579"><span class="lineNum">    1579 </span><span class="lineNoCov">          0 :   int cntvertices, cntprojected=0;</span></a>
<a name="1580"><span class="lineNum">    1580 </span>            :   setT *vertices;</a>
<a name="1581"><span class="lineNum">    1581 </span>            : </a>
<a name="1582"><span class="lineNum">    1582 </span><span class="lineNoCov">          0 :   cntvertices= qh_setsize(qh, facet-&gt;vertices);</span></a>
<a name="1583"><span class="lineNum">    1583 </span><span class="lineNoCov">          0 :   vertices= qh_settemp(qh, cntvertices);</span></a>
<a name="1584"><span class="lineNum">    1584 </span><span class="lineNoCov">          0 :   if (facet-&gt;simplicial) {</span></a>
<a name="1585"><span class="lineNum">    1585 </span><span class="lineNoCov">          0 :     if (cntvertices != 3) {</span></a>
<a name="1586"><span class="lineNum">    1586 </span><span class="lineNoCov">          0 :       qh_fprintf(qh, qh-&gt;ferr, 6147, &quot;qhull internal error (qh_facet3vertex): only %d vertices for simplicial facet f%d\n&quot;,</span></a>
<a name="1587"><span class="lineNum">    1587 </span>            :                   cntvertices, facet-&gt;id);</a>
<a name="1588"><span class="lineNum">    1588 </span><span class="lineNoCov">          0 :       qh_errexit(qh, qh_ERRqhull, facet, NULL);</span></a>
<a name="1589"><span class="lineNum">    1589 </span>            :     }</a>
<a name="1590"><span class="lineNum">    1590 </span><span class="lineNoCov">          0 :     qh_setappend(qh, &amp;vertices, SETfirst_(facet-&gt;vertices));</span></a>
<a name="1591"><span class="lineNum">    1591 </span><span class="lineNoCov">          0 :     if (facet-&gt;toporient ^ qh_ORIENTclock)</span></a>
<a name="1592"><span class="lineNum">    1592 </span><span class="lineNoCov">          0 :       qh_setappend(qh, &amp;vertices, SETsecond_(facet-&gt;vertices));</span></a>
<a name="1593"><span class="lineNum">    1593 </span>            :     else</a>
<a name="1594"><span class="lineNum">    1594 </span><span class="lineNoCov">          0 :       qh_setaddnth(qh, &amp;vertices, 0, SETsecond_(facet-&gt;vertices));</span></a>
<a name="1595"><span class="lineNum">    1595 </span><span class="lineNoCov">          0 :     qh_setappend(qh, &amp;vertices, SETelem_(facet-&gt;vertices, 2));</span></a>
<a name="1596"><span class="lineNum">    1596 </span>            :   }else {</a>
<a name="1597"><span class="lineNum">    1597 </span><span class="lineNoCov">          0 :     ridge= firstridge= SETfirstt_(facet-&gt;ridges, ridgeT);   /* no infinite */</span></a>
<a name="1598"><span class="lineNum">    1598 </span><span class="lineNoCov">          0 :     while ((ridge= qh_nextridge3d(ridge, facet, &amp;vertex))) {</span></a>
<a name="1599"><span class="lineNum">    1599 </span><span class="lineNoCov">          0 :       qh_setappend(qh, &amp;vertices, vertex);</span></a>
<a name="1600"><span class="lineNum">    1600 </span><span class="lineNoCov">          0 :       if (++cntprojected &gt; cntvertices || ridge == firstridge)</span></a>
<a name="1601"><span class="lineNum">    1601 </span>            :         break;</a>
<a name="1602"><span class="lineNum">    1602 </span>            :     }</a>
<a name="1603"><span class="lineNum">    1603 </span><span class="lineNoCov">          0 :     if (!ridge || cntprojected != cntvertices) {</span></a>
<a name="1604"><span class="lineNum">    1604 </span><span class="lineNoCov">          0 :       qh_fprintf(qh, qh-&gt;ferr, 6148, &quot;qhull internal error (qh_facet3vertex): ridges for facet %d don't match up.  got at least %d\n&quot;,</span></a>
<a name="1605"><span class="lineNum">    1605 </span>            :                   facet-&gt;id, cntprojected);</a>
<a name="1606"><span class="lineNum">    1606 </span><span class="lineNoCov">          0 :       qh_errexit(qh, qh_ERRqhull, facet, ridge);</span></a>
<a name="1607"><span class="lineNum">    1607 </span>            :     }</a>
<a name="1608"><span class="lineNum">    1608 </span>            :   }</a>
<a name="1609"><span class="lineNum">    1609 </span><span class="lineNoCov">          0 :   return vertices;</span></a>
<a name="1610"><span class="lineNum">    1610 </span>            : } /* facet3vertex */</a>
<a name="1611"><span class="lineNum">    1611 </span>            : </a>
<a name="1612"><span class="lineNum">    1612 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="1613"><span class="lineNum">    1613 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;findbestfacet&quot;&gt;-&lt;/a&gt;</a>
<a name="1614"><span class="lineNum">    1614 </span>            : </a>
<a name="1615"><span class="lineNum">    1615 </span>            :   qh_findbestfacet(qh, point, bestoutside, bestdist, isoutside )</a>
<a name="1616"><span class="lineNum">    1616 </span>            :     find facet that is furthest below a point</a>
<a name="1617"><span class="lineNum">    1617 </span>            : </a>
<a name="1618"><span class="lineNum">    1618 </span>            :     for Delaunay triangulations,</a>
<a name="1619"><span class="lineNum">    1619 </span>            :       Use qh_setdelaunay() to lift point to paraboloid and scale by 'Qbb' if needed</a>
<a name="1620"><span class="lineNum">    1620 </span>            :       Do not use options 'Qbk', 'QBk', or 'QbB' since they scale the coordinates.</a>
<a name="1621"><span class="lineNum">    1621 </span>            : </a>
<a name="1622"><span class="lineNum">    1622 </span>            :   returns:</a>
<a name="1623"><span class="lineNum">    1623 </span>            :     if bestoutside is set (e.g., qh_ALL)</a>
<a name="1624"><span class="lineNum">    1624 </span>            :       returns best facet that is not upperdelaunay</a>
<a name="1625"><span class="lineNum">    1625 </span>            :       if Delaunay and inside, point is outside circumsphere of bestfacet</a>
<a name="1626"><span class="lineNum">    1626 </span>            :     else</a>
<a name="1627"><span class="lineNum">    1627 </span>            :       returns first facet below point</a>
<a name="1628"><span class="lineNum">    1628 </span>            :       if point is inside, returns nearest, !upperdelaunay facet</a>
<a name="1629"><span class="lineNum">    1629 </span>            :     distance to facet</a>
<a name="1630"><span class="lineNum">    1630 </span>            :     isoutside set if outside of facet</a>
<a name="1631"><span class="lineNum">    1631 </span>            : </a>
<a name="1632"><span class="lineNum">    1632 </span>            :   notes:</a>
<a name="1633"><span class="lineNum">    1633 </span>            :     Distance is measured by distance to the facet's hyperplane.  For</a>
<a name="1634"><span class="lineNum">    1634 </span>            :     Delaunay facets, this is not the same as the containing facet.  It may</a>
<a name="1635"><span class="lineNum">    1635 </span>            :     be an adjacent facet or a different tricoplanar facet.  See</a>
<a name="1636"><span class="lineNum">    1636 </span>            :     &lt;a href=&quot;../html/qh-code.htm#findfacet&quot;&gt;locate a facet with qh_findbestfacet()&lt;/a&gt;</a>
<a name="1637"><span class="lineNum">    1637 </span>            : </a>
<a name="1638"><span class="lineNum">    1638 </span>            :     For tricoplanar facets, this finds one of the tricoplanar facets closest</a>
<a name="1639"><span class="lineNum">    1639 </span>            :     to the point.</a>
<a name="1640"><span class="lineNum">    1640 </span>            : </a>
<a name="1641"><span class="lineNum">    1641 </span>            :     If inside, qh_findbestfacet performs an exhaustive search</a>
<a name="1642"><span class="lineNum">    1642 </span>            :        this may be too conservative.  Sometimes it is clearly required.</a>
<a name="1643"><span class="lineNum">    1643 </span>            : </a>
<a name="1644"><span class="lineNum">    1644 </span>            :     qh_findbestfacet is not used by qhull.</a>
<a name="1645"><span class="lineNum">    1645 </span>            :     uses qh.visit_id and qh.coplanarset</a>
<a name="1646"><span class="lineNum">    1646 </span>            : </a>
<a name="1647"><span class="lineNum">    1647 </span>            :   see:</a>
<a name="1648"><span class="lineNum">    1648 </span>            :     &lt;a href=&quot;geom_r.c#findbest&quot;&gt;qh_findbest&lt;/a&gt;</a>
<a name="1649"><span class="lineNum">    1649 </span>            : */</a>
<a name="1650"><span class="lineNum">    1650 </span><span class="lineNoCov">          0 : facetT *qh_findbestfacet(qhT *qh, pointT *point, boolT bestoutside,</span></a>
<a name="1651"><span class="lineNum">    1651 </span>            :            realT *bestdist, boolT *isoutside) {</a>
<a name="1652"><span class="lineNum">    1652 </span><span class="lineNoCov">          0 :   facetT *bestfacet= NULL;</span></a>
<a name="1653"><span class="lineNum">    1653 </span><span class="lineNoCov">          0 :   int numpart, totpart= 0;</span></a>
<a name="1654"><span class="lineNum">    1654 </span>            : </a>
<a name="1655"><span class="lineNum">    1655 </span><span class="lineNoCov">          0 :   bestfacet= qh_findbest(qh, point, qh-&gt;facet_list,</span></a>
<a name="1656"><span class="lineNum">    1656 </span>            :                             bestoutside, !qh_ISnewfacets, bestoutside /* qh_NOupper */,</a>
<a name="1657"><span class="lineNum">    1657 </span>            :                             bestdist, isoutside, &amp;totpart);</a>
<a name="1658"><span class="lineNum">    1658 </span><span class="lineNoCov">          0 :   if (*bestdist &lt; -qh-&gt;DISTround) {</span></a>
<a name="1659"><span class="lineNum">    1659 </span><span class="lineNoCov">          0 :     bestfacet= qh_findfacet_all(qh, point, !qh_NOupper, bestdist, isoutside, &amp;numpart);</span></a>
<a name="1660"><span class="lineNum">    1660 </span><span class="lineNoCov">          0 :     totpart += numpart;</span></a>
<a name="1661"><span class="lineNum">    1661 </span><span class="lineNoCov">          0 :     if ((isoutside &amp;&amp; *isoutside &amp;&amp; bestoutside)</span></a>
<a name="1662"><span class="lineNum">    1662 </span><span class="lineNoCov">          0 :     || (isoutside &amp;&amp; !*isoutside &amp;&amp; bestfacet-&gt;upperdelaunay)) {</span></a>
<a name="1663"><span class="lineNum">    1663 </span><span class="lineNoCov">          0 :       bestfacet= qh_findbest(qh, point, bestfacet,</span></a>
<a name="1664"><span class="lineNum">    1664 </span>            :                             bestoutside, False, bestoutside,</a>
<a name="1665"><span class="lineNum">    1665 </span>            :                             bestdist, isoutside, &amp;totpart);</a>
<a name="1666"><span class="lineNum">    1666 </span><span class="lineNoCov">          0 :       totpart += numpart;</span></a>
<a name="1667"><span class="lineNum">    1667 </span>            :     }</a>
<a name="1668"><span class="lineNum">    1668 </span>            :   }</a>
<a name="1669"><span class="lineNum">    1669 </span><span class="lineNoCov">          0 :   trace3((qh, qh-&gt;ferr, 3014, &quot;qh_findbestfacet: f%d dist %2.2g isoutside %d totpart %d\n&quot;,</span></a>
<a name="1670"><span class="lineNum">    1670 </span>            :           bestfacet-&gt;id, *bestdist, (isoutside ? *isoutside : UINT_MAX), totpart));</a>
<a name="1671"><span class="lineNum">    1671 </span><span class="lineNoCov">          0 :   return bestfacet;</span></a>
<a name="1672"><span class="lineNum">    1672 </span>            : } /* findbestfacet */</a>
<a name="1673"><span class="lineNum">    1673 </span>            : </a>
<a name="1674"><span class="lineNum">    1674 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="1675"><span class="lineNum">    1675 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;findbestlower&quot;&gt;-&lt;/a&gt;</a>
<a name="1676"><span class="lineNum">    1676 </span>            : </a>
<a name="1677"><span class="lineNum">    1677 </span>            :   qh_findbestlower(qh, facet, point, bestdist, numpart )</a>
<a name="1678"><span class="lineNum">    1678 </span>            :     returns best non-upper, non-flipped neighbor of facet for point</a>
<a name="1679"><span class="lineNum">    1679 </span>            :     if needed, searches vertex neighbors</a>
<a name="1680"><span class="lineNum">    1680 </span>            : </a>
<a name="1681"><span class="lineNum">    1681 </span>            :   returns:</a>
<a name="1682"><span class="lineNum">    1682 </span>            :     returns bestdist and updates numpart</a>
<a name="1683"><span class="lineNum">    1683 </span>            : </a>
<a name="1684"><span class="lineNum">    1684 </span>            :   notes:</a>
<a name="1685"><span class="lineNum">    1685 </span>            :     called by qh_findbest() for points above an upperdelaunay facet</a>
<a name="1686"><span class="lineNum">    1686 </span>            :     if Delaunay and inside, point is outside of circumsphere of bestfacet</a>
<a name="1687"><span class="lineNum">    1687 </span>            : </a>
<a name="1688"><span class="lineNum">    1688 </span>            : */</a>
<a name="1689"><span class="lineNum">    1689 </span><span class="lineNoCov">          0 : facetT *qh_findbestlower(qhT *qh, facetT *upperfacet, pointT *point, realT *bestdistp, int *numpart) {</span></a>
<a name="1690"><span class="lineNum">    1690 </span><span class="lineNoCov">          0 :   facetT *neighbor, **neighborp, *bestfacet= NULL;</span></a>
<a name="1691"><span class="lineNum">    1691 </span><span class="lineNoCov">          0 :   realT bestdist= -REALmax/2 /* avoid underflow */;</span></a>
<a name="1692"><span class="lineNum">    1692 </span>            :   realT dist;</a>
<a name="1693"><span class="lineNum">    1693 </span>            :   vertexT *vertex;</a>
<a name="1694"><span class="lineNum">    1694 </span><span class="lineNoCov">          0 :   boolT isoutside= False;  /* not used */</span></a>
<a name="1695"><span class="lineNum">    1695 </span>            : </a>
<a name="1696"><span class="lineNum">    1696 </span><span class="lineNoCov">          0 :   zinc_(Zbestlower);</span></a>
<a name="1697"><span class="lineNum">    1697 </span><span class="lineNoCov">          0 :   FOREACHneighbor_(upperfacet) {</span></a>
<a name="1698"><span class="lineNum">    1698 </span><span class="lineNoCov">          0 :     if (neighbor-&gt;upperdelaunay || neighbor-&gt;flipped)</span></a>
<a name="1699"><span class="lineNum">    1699 </span><span class="lineNoCov">          0 :       continue;</span></a>
<a name="1700"><span class="lineNum">    1700 </span><span class="lineNoCov">          0 :     (*numpart)++;</span></a>
<a name="1701"><span class="lineNum">    1701 </span><span class="lineNoCov">          0 :     qh_distplane(qh, point, neighbor, &amp;dist);</span></a>
<a name="1702"><span class="lineNum">    1702 </span><span class="lineNoCov">          0 :     if (dist &gt; bestdist) {</span></a>
<a name="1703"><span class="lineNum">    1703 </span><span class="lineNoCov">          0 :       bestfacet= neighbor;</span></a>
<a name="1704"><span class="lineNum">    1704 </span><span class="lineNoCov">          0 :       bestdist= dist;</span></a>
<a name="1705"><span class="lineNum">    1705 </span>            :     }</a>
<a name="1706"><span class="lineNum">    1706 </span>            :   }</a>
<a name="1707"><span class="lineNum">    1707 </span><span class="lineNoCov">          0 :   if (!bestfacet) {</span></a>
<a name="1708"><span class="lineNum">    1708 </span><span class="lineNoCov">          0 :     zinc_(Zbestlowerv);</span></a>
<a name="1709"><span class="lineNum">    1709 </span>            :     /* rarely called, numpart does not count nearvertex computations */</a>
<a name="1710"><span class="lineNum">    1710 </span><span class="lineNoCov">          0 :     vertex= qh_nearvertex(qh, upperfacet, point, &amp;dist);</span></a>
<a name="1711"><span class="lineNum">    1711 </span><span class="lineNoCov">          0 :     qh_vertexneighbors(qh);</span></a>
<a name="1712"><span class="lineNum">    1712 </span><span class="lineNoCov">          0 :     FOREACHneighbor_(vertex) {</span></a>
<a name="1713"><span class="lineNum">    1713 </span><span class="lineNoCov">          0 :       if (neighbor-&gt;upperdelaunay || neighbor-&gt;flipped)</span></a>
<a name="1714"><span class="lineNum">    1714 </span><span class="lineNoCov">          0 :         continue;</span></a>
<a name="1715"><span class="lineNum">    1715 </span><span class="lineNoCov">          0 :       (*numpart)++;</span></a>
<a name="1716"><span class="lineNum">    1716 </span><span class="lineNoCov">          0 :       qh_distplane(qh, point, neighbor, &amp;dist);</span></a>
<a name="1717"><span class="lineNum">    1717 </span><span class="lineNoCov">          0 :       if (dist &gt; bestdist) {</span></a>
<a name="1718"><span class="lineNum">    1718 </span><span class="lineNoCov">          0 :         bestfacet= neighbor;</span></a>
<a name="1719"><span class="lineNum">    1719 </span><span class="lineNoCov">          0 :         bestdist= dist;</span></a>
<a name="1720"><span class="lineNum">    1720 </span>            :       }</a>
<a name="1721"><span class="lineNum">    1721 </span>            :     }</a>
<a name="1722"><span class="lineNum">    1722 </span>            :   }</a>
<a name="1723"><span class="lineNum">    1723 </span><span class="lineNoCov">          0 :   if (!bestfacet) {</span></a>
<a name="1724"><span class="lineNum">    1724 </span><span class="lineNoCov">          0 :     zinc_(Zbestlowerall);  /* invoked once per point in outsideset */</span></a>
<a name="1725"><span class="lineNum">    1725 </span><span class="lineNoCov">          0 :     zmax_(Zbestloweralln, qh-&gt;num_facets);</span></a>
<a name="1726"><span class="lineNum">    1726 </span>            :     /* [dec'15] Previously reported as QH6228 */</a>
<a name="1727"><span class="lineNum">    1727 </span><span class="lineNoCov">          0 :     trace3((qh, qh-&gt;ferr, 3025, &quot;qh_findbestlower: all neighbors of facet %d are flipped or upper Delaunay.  Search all facets\n&quot;,</span></a>
<a name="1728"><span class="lineNum">    1728 </span>            :         upperfacet-&gt;id));</a>
<a name="1729"><span class="lineNum">    1729 </span>            :     /* rarely called */</a>
<a name="1730"><span class="lineNum">    1730 </span><span class="lineNoCov">          0 :     bestfacet= qh_findfacet_all(qh, point, qh_NOupper, &amp;bestdist, &amp;isoutside, numpart);</span></a>
<a name="1731"><span class="lineNum">    1731 </span>            :   }</a>
<a name="1732"><span class="lineNum">    1732 </span><span class="lineNoCov">          0 :   *bestdistp= bestdist;</span></a>
<a name="1733"><span class="lineNum">    1733 </span><span class="lineNoCov">          0 :   trace3((qh, qh-&gt;ferr, 3015, &quot;qh_findbestlower: f%d dist %2.2g for f%d p%d\n&quot;,</span></a>
<a name="1734"><span class="lineNum">    1734 </span>            :           bestfacet-&gt;id, bestdist, upperfacet-&gt;id, qh_pointid(qh, point)));</a>
<a name="1735"><span class="lineNum">    1735 </span><span class="lineNoCov">          0 :   return bestfacet;</span></a>
<a name="1736"><span class="lineNum">    1736 </span>            : } /* findbestlower */</a>
<a name="1737"><span class="lineNum">    1737 </span>            : </a>
<a name="1738"><span class="lineNum">    1738 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="1739"><span class="lineNum">    1739 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;findfacet_all&quot;&gt;-&lt;/a&gt;</a>
<a name="1740"><span class="lineNum">    1740 </span>            : </a>
<a name="1741"><span class="lineNum">    1741 </span>            :   qh_findfacet_all(qh, point, noupper, bestdist, isoutside, numpart )</a>
<a name="1742"><span class="lineNum">    1742 </span>            :     exhaustive search for facet below a point</a>
<a name="1743"><span class="lineNum">    1743 </span>            :     ignore flipped and visible facets, f.normal==NULL, and if noupper, f.upperdelaunay facets</a>
<a name="1744"><span class="lineNum">    1744 </span>            : </a>
<a name="1745"><span class="lineNum">    1745 </span>            :     for Delaunay triangulations,</a>
<a name="1746"><span class="lineNum">    1746 </span>            :       Use qh_setdelaunay() to lift point to paraboloid and scale by 'Qbb' if needed</a>
<a name="1747"><span class="lineNum">    1747 </span>            :       Do not use options 'Qbk', 'QBk', or 'QbB' since they scale the coordinates.</a>
<a name="1748"><span class="lineNum">    1748 </span>            : </a>
<a name="1749"><span class="lineNum">    1749 </span>            :   returns:</a>
<a name="1750"><span class="lineNum">    1750 </span>            :     returns first facet below point</a>
<a name="1751"><span class="lineNum">    1751 </span>            :     if point is inside,</a>
<a name="1752"><span class="lineNum">    1752 </span>            :       returns nearest facet</a>
<a name="1753"><span class="lineNum">    1753 </span>            :     distance to facet</a>
<a name="1754"><span class="lineNum">    1754 </span>            :     isoutside if point is outside of the hull</a>
<a name="1755"><span class="lineNum">    1755 </span>            :     number of distance tests</a>
<a name="1756"><span class="lineNum">    1756 </span>            : </a>
<a name="1757"><span class="lineNum">    1757 </span>            :   notes:</a>
<a name="1758"><span class="lineNum">    1758 </span>            :     called by qh_findbestlower if all neighbors are flipped or upper Delaunay (QH3025)</a>
<a name="1759"><span class="lineNum">    1759 </span>            :     primarily for library users (qh_findbestfacet), rarely used by Qhull</a>
<a name="1760"><span class="lineNum">    1760 </span>            : */</a>
<a name="1761"><span class="lineNum">    1761 </span><span class="lineNoCov">          0 : facetT *qh_findfacet_all(qhT *qh, pointT *point, boolT noupper, realT *bestdist, boolT *isoutside,</span></a>
<a name="1762"><span class="lineNum">    1762 </span>            :                           int *numpart) {</a>
<a name="1763"><span class="lineNum">    1763 </span><span class="lineNoCov">          0 :   facetT *bestfacet= NULL, *facet;</span></a>
<a name="1764"><span class="lineNum">    1764 </span>            :   realT dist;</a>
<a name="1765"><span class="lineNum">    1765 </span><span class="lineNoCov">          0 :   int totpart= 0;</span></a>
<a name="1766"><span class="lineNum">    1766 </span>            : </a>
<a name="1767"><span class="lineNum">    1767 </span><span class="lineNoCov">          0 :   *bestdist= -REALmax;</span></a>
<a name="1768"><span class="lineNum">    1768 </span><span class="lineNoCov">          0 :   *isoutside= False;</span></a>
<a name="1769"><span class="lineNum">    1769 </span><span class="lineNoCov">          0 :   FORALLfacets {</span></a>
<a name="1770"><span class="lineNum">    1770 </span><span class="lineNoCov">          0 :     if (facet-&gt;flipped || !facet-&gt;normal || facet-&gt;visible)</span></a>
<a name="1771"><span class="lineNum">    1771 </span><span class="lineNoCov">          0 :       continue;</span></a>
<a name="1772"><span class="lineNum">    1772 </span><span class="lineNoCov">          0 :     if (noupper &amp;&amp; facet-&gt;upperdelaunay)</span></a>
<a name="1773"><span class="lineNum">    1773 </span><span class="lineNoCov">          0 :       continue;</span></a>
<a name="1774"><span class="lineNum">    1774 </span><span class="lineNoCov">          0 :     totpart++;</span></a>
<a name="1775"><span class="lineNum">    1775 </span><span class="lineNoCov">          0 :     qh_distplane(qh, point, facet, &amp;dist);</span></a>
<a name="1776"><span class="lineNum">    1776 </span><span class="lineNoCov">          0 :     if (dist &gt; *bestdist) {</span></a>
<a name="1777"><span class="lineNum">    1777 </span><span class="lineNoCov">          0 :       *bestdist= dist;</span></a>
<a name="1778"><span class="lineNum">    1778 </span><span class="lineNoCov">          0 :       bestfacet= facet;</span></a>
<a name="1779"><span class="lineNum">    1779 </span><span class="lineNoCov">          0 :       if (dist &gt; qh-&gt;MINoutside) {</span></a>
<a name="1780"><span class="lineNum">    1780 </span><span class="lineNoCov">          0 :         *isoutside= True;</span></a>
<a name="1781"><span class="lineNum">    1781 </span><span class="lineNoCov">          0 :         break;</span></a>
<a name="1782"><span class="lineNum">    1782 </span>            :       }</a>
<a name="1783"><span class="lineNum">    1783 </span>            :     }</a>
<a name="1784"><span class="lineNum">    1784 </span>            :   }</a>
<a name="1785"><span class="lineNum">    1785 </span><span class="lineNoCov">          0 :   *numpart= totpart;</span></a>
<a name="1786"><span class="lineNum">    1786 </span><span class="lineNoCov">          0 :   trace3((qh, qh-&gt;ferr, 3016, &quot;qh_findfacet_all: p%d, noupper? %d, f%d, dist %2.2g, isoutside %d, totpart %d\n&quot;,</span></a>
<a name="1787"><span class="lineNum">    1787 </span>            :       qh_pointid(qh, point), noupper, getid_(bestfacet), *bestdist, *isoutside, totpart));</a>
<a name="1788"><span class="lineNum">    1788 </span><span class="lineNoCov">          0 :   return bestfacet;</span></a>
<a name="1789"><span class="lineNum">    1789 </span>            : } /* findfacet_all */</a>
<a name="1790"><span class="lineNum">    1790 </span>            : </a>
<a name="1791"><span class="lineNum">    1791 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="1792"><span class="lineNum">    1792 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;findgood&quot;&gt;-&lt;/a&gt;</a>
<a name="1793"><span class="lineNum">    1793 </span>            : </a>
<a name="1794"><span class="lineNum">    1794 </span>            :   qh_findgood(qh, facetlist, goodhorizon )</a>
<a name="1795"><span class="lineNum">    1795 </span>            :     identify good facets for qh.PRINTgood and qh_buildcone_onlygood</a>
<a name="1796"><span class="lineNum">    1796 </span>            :     goodhorizon is count of good, horizon facets from qh_find_horizon, otherwise 0 from qh_findgood_all</a>
<a name="1797"><span class="lineNum">    1797 </span>            :     if not qh.MERGING and qh.GOODvertex&gt;0</a>
<a name="1798"><span class="lineNum">    1798 </span>            :       facet includes point as vertex</a>
<a name="1799"><span class="lineNum">    1799 </span>            :       if !match, returns goodhorizon</a>
<a name="1800"><span class="lineNum">    1800 </span>            :     if qh.GOODpoint</a>
<a name="1801"><span class="lineNum">    1801 </span>            :       facet is visible or coplanar (&gt;0) or not visible (&lt;0)</a>
<a name="1802"><span class="lineNum">    1802 </span>            :     if qh.GOODthreshold</a>
<a name="1803"><span class="lineNum">    1803 </span>            :       facet-&gt;normal matches threshold</a>
<a name="1804"><span class="lineNum">    1804 </span>            :     if !goodhorizon and !match,</a>
<a name="1805"><span class="lineNum">    1805 </span>            :       selects facet with closest angle to thresholds</a>
<a name="1806"><span class="lineNum">    1806 </span>            :       sets GOODclosest</a>
<a name="1807"><span class="lineNum">    1807 </span>            : </a>
<a name="1808"><span class="lineNum">    1808 </span>            :   returns:</a>
<a name="1809"><span class="lineNum">    1809 </span>            :     number of new, good facets found</a>
<a name="1810"><span class="lineNum">    1810 </span>            :     determines facet-&gt;good</a>
<a name="1811"><span class="lineNum">    1811 </span>            :     may update qh.GOODclosest</a>
<a name="1812"><span class="lineNum">    1812 </span>            : </a>
<a name="1813"><span class="lineNum">    1813 </span>            :   notes:</a>
<a name="1814"><span class="lineNum">    1814 </span>            :     called from qh_initbuild, qh_buildcone_onlygood, and qh_findgood_all</a>
<a name="1815"><span class="lineNum">    1815 </span>            :     qh_findgood_all (called from qh_prepare_output) further reduces the good region</a>
<a name="1816"><span class="lineNum">    1816 </span>            : </a>
<a name="1817"><span class="lineNum">    1817 </span>            :   design:</a>
<a name="1818"><span class="lineNum">    1818 </span>            :     count good facets</a>
<a name="1819"><span class="lineNum">    1819 </span>            :     if not merging, clear good facets that fail qh.GOODvertex ('QVn', but not 'QV-n')</a>
<a name="1820"><span class="lineNum">    1820 </span>            :     clear good facets that fail qh.GOODpoint ('QGn' or 'QG-n')</a>
<a name="1821"><span class="lineNum">    1821 </span>            :     clear good facets that fail qh.GOODthreshold</a>
<a name="1822"><span class="lineNum">    1822 </span>            :     if !goodhorizon and !find f.good,</a>
<a name="1823"><span class="lineNum">    1823 </span>            :       sets GOODclosest to facet with closest angle to thresholds</a>
<a name="1824"><span class="lineNum">    1824 </span>            : */</a>
<a name="1825"><span class="lineNum">    1825 </span><span class="lineCov">          8 : int qh_findgood(qhT *qh, facetT *facetlist, int goodhorizon) {</span></a>
<a name="1826"><span class="lineNum">    1826 </span><span class="lineCov">          8 :   facetT *facet, *bestfacet= NULL;</span></a>
<a name="1827"><span class="lineNum">    1827 </span><span class="lineCov">          8 :   realT angle, bestangle= REALmax, dist;</span></a>
<a name="1828"><span class="lineNum">    1828 </span><span class="lineCov">          8 :   int  numgood=0;</span></a>
<a name="1829"><span class="lineNum">    1829 </span>            : </a>
<a name="1830"><span class="lineNum">    1830 </span><span class="lineCov">      29380 :   FORALLfacet_(facetlist) {</span></a>
<a name="1831"><span class="lineNum">    1831 </span><span class="lineCov">      29372 :     if (facet-&gt;good)</span></a>
<a name="1832"><span class="lineNum">    1832 </span><span class="lineCov">      29372 :       numgood++;</span></a>
<a name="1833"><span class="lineNum">    1833 </span>            :   }</a>
<a name="1834"><span class="lineNum">    1834 </span><span class="lineCov">          8 :   if (qh-&gt;GOODvertex&gt;0 &amp;&amp; !qh-&gt;MERGING) {</span></a>
<a name="1835"><span class="lineNum">    1835 </span><span class="lineNoCov">          0 :     FORALLfacet_(facetlist) {</span></a>
<a name="1836"><span class="lineNum">    1836 </span><span class="lineNoCov">          0 :       if (facet-&gt;good &amp;&amp; !qh_isvertex(qh-&gt;GOODvertexp, facet-&gt;vertices)) {</span></a>
<a name="1837"><span class="lineNum">    1837 </span><span class="lineNoCov">          0 :         facet-&gt;good= False;</span></a>
<a name="1838"><span class="lineNum">    1838 </span><span class="lineNoCov">          0 :         numgood--;</span></a>
<a name="1839"><span class="lineNum">    1839 </span>            :       }</a>
<a name="1840"><span class="lineNum">    1840 </span>            :     }</a>
<a name="1841"><span class="lineNum">    1841 </span>            :   }</a>
<a name="1842"><span class="lineNum">    1842 </span><span class="lineCov">          8 :   if (qh-&gt;GOODpoint &amp;&amp; numgood) {</span></a>
<a name="1843"><span class="lineNum">    1843 </span><span class="lineNoCov">          0 :     FORALLfacet_(facetlist) {</span></a>
<a name="1844"><span class="lineNum">    1844 </span><span class="lineNoCov">          0 :       if (facet-&gt;good &amp;&amp; facet-&gt;normal) {</span></a>
<a name="1845"><span class="lineNum">    1845 </span><span class="lineNoCov">          0 :         zinc_(Zdistgood);</span></a>
<a name="1846"><span class="lineNum">    1846 </span><span class="lineNoCov">          0 :         qh_distplane(qh, qh-&gt;GOODpointp, facet, &amp;dist);</span></a>
<a name="1847"><span class="lineNum">    1847 </span><span class="lineNoCov">          0 :         if ((qh-&gt;GOODpoint &gt; 0) ^ (dist &gt; 0.0)) {</span></a>
<a name="1848"><span class="lineNum">    1848 </span><span class="lineNoCov">          0 :           facet-&gt;good= False;</span></a>
<a name="1849"><span class="lineNum">    1849 </span><span class="lineNoCov">          0 :           numgood--;</span></a>
<a name="1850"><span class="lineNum">    1850 </span>            :         }</a>
<a name="1851"><span class="lineNum">    1851 </span>            :       }</a>
<a name="1852"><span class="lineNum">    1852 </span>            :     }</a>
<a name="1853"><span class="lineNum">    1853 </span>            :   }</a>
<a name="1854"><span class="lineNum">    1854 </span><span class="lineCov">          8 :   if (qh-&gt;GOODthreshold &amp;&amp; (numgood || goodhorizon || qh-&gt;GOODclosest)) {</span></a>
<a name="1855"><span class="lineNum">    1855 </span><span class="lineNoCov">          0 :     FORALLfacet_(facetlist) {</span></a>
<a name="1856"><span class="lineNum">    1856 </span><span class="lineNoCov">          0 :       if (facet-&gt;good &amp;&amp; facet-&gt;normal) {</span></a>
<a name="1857"><span class="lineNum">    1857 </span><span class="lineNoCov">          0 :         if (!qh_inthresholds(qh, facet-&gt;normal, &amp;angle)) {</span></a>
<a name="1858"><span class="lineNum">    1858 </span><span class="lineNoCov">          0 :           facet-&gt;good= False;</span></a>
<a name="1859"><span class="lineNum">    1859 </span><span class="lineNoCov">          0 :           numgood--;</span></a>
<a name="1860"><span class="lineNum">    1860 </span><span class="lineNoCov">          0 :           if (angle &lt; bestangle) {</span></a>
<a name="1861"><span class="lineNum">    1861 </span><span class="lineNoCov">          0 :             bestangle= angle;</span></a>
<a name="1862"><span class="lineNum">    1862 </span><span class="lineNoCov">          0 :             bestfacet= facet;</span></a>
<a name="1863"><span class="lineNum">    1863 </span>            :           }</a>
<a name="1864"><span class="lineNum">    1864 </span>            :         }</a>
<a name="1865"><span class="lineNum">    1865 </span>            :       }</a>
<a name="1866"><span class="lineNum">    1866 </span>            :     }</a>
<a name="1867"><span class="lineNum">    1867 </span><span class="lineNoCov">          0 :     if (numgood == 0 &amp;&amp; (goodhorizon == 0 || qh-&gt;GOODclosest)) {</span></a>
<a name="1868"><span class="lineNum">    1868 </span><span class="lineNoCov">          0 :       if (qh-&gt;GOODclosest) {</span></a>
<a name="1869"><span class="lineNum">    1869 </span><span class="lineNoCov">          0 :         if (qh-&gt;GOODclosest-&gt;visible)</span></a>
<a name="1870"><span class="lineNum">    1870 </span><span class="lineNoCov">          0 :           qh-&gt;GOODclosest= NULL;</span></a>
<a name="1871"><span class="lineNum">    1871 </span>            :         else {</a>
<a name="1872"><span class="lineNum">    1872 </span><span class="lineNoCov">          0 :           int ret = qh_inthresholds(qh, qh-&gt;GOODclosest-&gt;normal, &amp;angle);</span></a>
<a name="1873"><span class="lineNum">    1873 </span>            :           QHULL_UNUSED(ret);</a>
<a name="1874"><span class="lineNum">    1874 </span><span class="lineNoCov">          0 :           if (angle &lt; bestangle)</span></a>
<a name="1875"><span class="lineNum">    1875 </span><span class="lineNoCov">          0 :             bestfacet= qh-&gt;GOODclosest;</span></a>
<a name="1876"><span class="lineNum">    1876 </span>            :         }</a>
<a name="1877"><span class="lineNum">    1877 </span>            :       }</a>
<a name="1878"><span class="lineNum">    1878 </span><span class="lineNoCov">          0 :       if (bestfacet &amp;&amp; bestfacet != qh-&gt;GOODclosest) {   /* numgood == 0 */</span></a>
<a name="1879"><span class="lineNum">    1879 </span><span class="lineNoCov">          0 :         if (qh-&gt;GOODclosest)</span></a>
<a name="1880"><span class="lineNum">    1880 </span><span class="lineNoCov">          0 :           qh-&gt;GOODclosest-&gt;good= False;</span></a>
<a name="1881"><span class="lineNum">    1881 </span><span class="lineNoCov">          0 :         qh-&gt;GOODclosest= bestfacet;</span></a>
<a name="1882"><span class="lineNum">    1882 </span><span class="lineNoCov">          0 :         bestfacet-&gt;good= True;</span></a>
<a name="1883"><span class="lineNum">    1883 </span><span class="lineNoCov">          0 :         numgood++;</span></a>
<a name="1884"><span class="lineNum">    1884 </span><span class="lineNoCov">          0 :         trace2((qh, qh-&gt;ferr, 2044, &quot;qh_findgood: f%d is closest(%2.2g) to thresholds\n&quot;,</span></a>
<a name="1885"><span class="lineNum">    1885 </span>            :            bestfacet-&gt;id, bestangle));</a>
<a name="1886"><span class="lineNum">    1886 </span><span class="lineNoCov">          0 :         return numgood;</span></a>
<a name="1887"><span class="lineNum">    1887 </span>            :       }</a>
<a name="1888"><span class="lineNum">    1888 </span><span class="lineNoCov">          0 :     }else if (qh-&gt;GOODclosest) { /* numgood &gt; 0 */</span></a>
<a name="1889"><span class="lineNum">    1889 </span><span class="lineNoCov">          0 :       qh-&gt;GOODclosest-&gt;good= False;</span></a>
<a name="1890"><span class="lineNum">    1890 </span><span class="lineNoCov">          0 :       qh-&gt;GOODclosest= NULL;</span></a>
<a name="1891"><span class="lineNum">    1891 </span>            :     }</a>
<a name="1892"><span class="lineNum">    1892 </span>            :   }</a>
<a name="1893"><span class="lineNum">    1893 </span><span class="lineCov">          8 :   zadd_(Zgoodfacet, numgood);</span></a>
<a name="1894"><span class="lineNum">    1894 </span><span class="lineCov">          8 :   trace2((qh, qh-&gt;ferr, 2045, &quot;qh_findgood: found %d good facets with %d good horizon and qh.GOODclosest f%d\n&quot;,</span></a>
<a name="1895"><span class="lineNum">    1895 </span>            :                numgood, goodhorizon, getid_(qh-&gt;GOODclosest)));</a>
<a name="1896"><span class="lineNum">    1896 </span><span class="lineCov">          8 :   if (!numgood &amp;&amp; qh-&gt;GOODvertex&gt;0 &amp;&amp; !qh-&gt;MERGING)</span></a>
<a name="1897"><span class="lineNum">    1897 </span><span class="lineNoCov">          0 :     return goodhorizon;</span></a>
<a name="1898"><span class="lineNum">    1898 </span><span class="lineCov">          8 :   return numgood;</span></a>
<a name="1899"><span class="lineNum">    1899 </span>            : } /* findgood */</a>
<a name="1900"><span class="lineNum">    1900 </span>            : </a>
<a name="1901"><span class="lineNum">    1901 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="1902"><span class="lineNum">    1902 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;findgood_all&quot;&gt;-&lt;/a&gt;</a>
<a name="1903"><span class="lineNum">    1903 </span>            : </a>
<a name="1904"><span class="lineNum">    1904 </span>            :   qh_findgood_all(qh, facetlist )</a>
<a name="1905"><span class="lineNum">    1905 </span>            :     apply other constraints for good facets (used by qh.PRINTgood)</a>
<a name="1906"><span class="lineNum">    1906 </span>            :     if qh.GOODvertex</a>
<a name="1907"><span class="lineNum">    1907 </span>            :       facet includes (&gt;0) or doesn't include (&lt;0) point as vertex</a>
<a name="1908"><span class="lineNum">    1908 </span>            :       if last good facet and ONLYgood, prints warning and continues</a>
<a name="1909"><span class="lineNum">    1909 </span>            :     if qh.SPLITthresholds (e.g., qh.DELAUNAY)</a>
<a name="1910"><span class="lineNum">    1910 </span>            :       facet-&gt;normal matches threshold, or if none, the closest one</a>
<a name="1911"><span class="lineNum">    1911 </span>            :     calls qh_findgood</a>
<a name="1912"><span class="lineNum">    1912 </span>            :     nop if good not used</a>
<a name="1913"><span class="lineNum">    1913 </span>            : </a>
<a name="1914"><span class="lineNum">    1914 </span>            :   returns:</a>
<a name="1915"><span class="lineNum">    1915 </span>            :     clears facet-&gt;good if not good</a>
<a name="1916"><span class="lineNum">    1916 </span>            :     sets qh.num_good</a>
<a name="1917"><span class="lineNum">    1917 </span>            : </a>
<a name="1918"><span class="lineNum">    1918 </span>            :   notes:</a>
<a name="1919"><span class="lineNum">    1919 </span>            :     called by qh_prepare_output and qh_printneighborhood</a>
<a name="1920"><span class="lineNum">    1920 </span>            :     unless qh.ONLYgood, calls qh_findgood first</a>
<a name="1921"><span class="lineNum">    1921 </span>            : </a>
<a name="1922"><span class="lineNum">    1922 </span>            :   design:</a>
<a name="1923"><span class="lineNum">    1923 </span>            :     uses qh_findgood to mark good facets</a>
<a name="1924"><span class="lineNum">    1924 </span>            :     clear f.good for failed qh.GOODvertex</a>
<a name="1925"><span class="lineNum">    1925 </span>            :     clear f.good for failed qh.SPLITthreholds</a>
<a name="1926"><span class="lineNum">    1926 </span>            :        if no more good facets, select best of qh.SPLITthresholds</a>
<a name="1927"><span class="lineNum">    1927 </span>            : */</a>
<a name="1928"><span class="lineNum">    1928 </span><span class="lineCov">          8 : void qh_findgood_all(qhT *qh, facetT *facetlist) {</span></a>
<a name="1929"><span class="lineNum">    1929 </span><span class="lineCov">          8 :   facetT *facet, *bestfacet=NULL;</span></a>
<a name="1930"><span class="lineNum">    1930 </span><span class="lineCov">          8 :   realT angle, bestangle= REALmax;</span></a>
<a name="1931"><span class="lineNum">    1931 </span><span class="lineCov">          8 :   int  numgood=0, startgood;</span></a>
<a name="1932"><span class="lineNum">    1932 </span>            : </a>
<a name="1933"><span class="lineNum">    1933 </span><span class="lineCov">          8 :   if (!qh-&gt;GOODvertex &amp;&amp; !qh-&gt;GOODthreshold &amp;&amp; !qh-&gt;GOODpoint</span></a>
<a name="1934"><span class="lineNum">    1934 </span><span class="lineCov">          8 :   &amp;&amp; !qh-&gt;SPLITthresholds)</span></a>
<a name="1935"><span class="lineNum">    1935 </span><span class="lineNoCov">          0 :     return;</span></a>
<a name="1936"><span class="lineNum">    1936 </span><span class="lineCov">          8 :   if (!qh-&gt;ONLYgood)</span></a>
<a name="1937"><span class="lineNum">    1937 </span><span class="lineCov">          8 :     qh_findgood(qh, qh-&gt;facet_list, 0);</span></a>
<a name="1938"><span class="lineNum">    1938 </span><span class="lineCov">      29380 :   FORALLfacet_(facetlist) {</span></a>
<a name="1939"><span class="lineNum">    1939 </span><span class="lineCov">      29372 :     if (facet-&gt;good)</span></a>
<a name="1940"><span class="lineNum">    1940 </span><span class="lineCov">      29372 :       numgood++;</span></a>
<a name="1941"><span class="lineNum">    1941 </span>            :   }</a>
<a name="1942"><span class="lineNum">    1942 </span><span class="lineCov">          8 :   if (qh-&gt;GOODvertex &lt;0 || (qh-&gt;GOODvertex &gt; 0 &amp;&amp; qh-&gt;MERGING)) {</span></a>
<a name="1943"><span class="lineNum">    1943 </span><span class="lineNoCov">          0 :     FORALLfacet_(facetlist) {</span></a>
<a name="1944"><span class="lineNum">    1944 </span><span class="lineNoCov">          0 :       if (facet-&gt;good &amp;&amp; ((qh-&gt;GOODvertex &gt; 0) ^ !!qh_isvertex(qh-&gt;GOODvertexp, facet-&gt;vertices))) { /* convert to bool */</span></a>
<a name="1945"><span class="lineNum">    1945 </span><span class="lineNoCov">          0 :         if (!--numgood) {</span></a>
<a name="1946"><span class="lineNum">    1946 </span><span class="lineNoCov">          0 :           if (qh-&gt;ONLYgood) {</span></a>
<a name="1947"><span class="lineNum">    1947 </span><span class="lineNoCov">          0 :             qh_fprintf(qh, qh-&gt;ferr, 7064, &quot;qhull warning: good vertex p%d does not match last good facet f%d.  Ignored.\n&quot;,</span></a>
<a name="1948"><span class="lineNum">    1948 </span>            :                qh_pointid(qh, qh-&gt;GOODvertexp), facet-&gt;id);</a>
<a name="1949"><span class="lineNum">    1949 </span><span class="lineNoCov">          0 :             return;</span></a>
<a name="1950"><span class="lineNum">    1950 </span><span class="lineNoCov">          0 :           }else if (qh-&gt;GOODvertex &gt; 0)</span></a>
<a name="1951"><span class="lineNum">    1951 </span><span class="lineNoCov">          0 :             qh_fprintf(qh, qh-&gt;ferr, 7065, &quot;qhull warning: point p%d is not a vertex('QV%d').\n&quot;,</span></a>
<a name="1952"><span class="lineNum">    1952 </span><span class="lineNoCov">          0 :                 qh-&gt;GOODvertex-1, qh-&gt;GOODvertex-1);</span></a>
<a name="1953"><span class="lineNum">    1953 </span>            :           else</a>
<a name="1954"><span class="lineNum">    1954 </span><span class="lineNoCov">          0 :             qh_fprintf(qh, qh-&gt;ferr, 7066, &quot;qhull warning: point p%d is a vertex for every facet('QV-%d').\n&quot;,</span></a>
<a name="1955"><span class="lineNum">    1955 </span><span class="lineNoCov">          0 :                 -qh-&gt;GOODvertex - 1, -qh-&gt;GOODvertex - 1);</span></a>
<a name="1956"><span class="lineNum">    1956 </span>            :         }</a>
<a name="1957"><span class="lineNum">    1957 </span><span class="lineNoCov">          0 :         facet-&gt;good= False;</span></a>
<a name="1958"><span class="lineNum">    1958 </span>            :       }</a>
<a name="1959"><span class="lineNum">    1959 </span>            :     }</a>
<a name="1960"><span class="lineNum">    1960 </span>            :   }</a>
<a name="1961"><span class="lineNum">    1961 </span><span class="lineCov">          8 :   startgood= numgood;</span></a>
<a name="1962"><span class="lineNum">    1962 </span><span class="lineCov">          8 :   if (qh-&gt;SPLITthresholds) {</span></a>
<a name="1963"><span class="lineNum">    1963 </span><span class="lineCov">      29380 :     FORALLfacet_(facetlist) {</span></a>
<a name="1964"><span class="lineNum">    1964 </span><span class="lineCov">      29372 :       if (facet-&gt;good) {</span></a>
<a name="1965"><span class="lineNum">    1965 </span><span class="lineCov">      29372 :         if (!qh_inthresholds(qh, facet-&gt;normal, &amp;angle)) {</span></a>
<a name="1966"><span class="lineNum">    1966 </span><span class="lineCov">        520 :           facet-&gt;good= False;</span></a>
<a name="1967"><span class="lineNum">    1967 </span><span class="lineCov">        520 :           numgood--;</span></a>
<a name="1968"><span class="lineNum">    1968 </span><span class="lineCov">        520 :           if (angle &lt; bestangle) {</span></a>
<a name="1969"><span class="lineNum">    1969 </span><span class="lineCov">         21 :             bestangle= angle;</span></a>
<a name="1970"><span class="lineNum">    1970 </span><span class="lineCov">         21 :             bestfacet= facet;</span></a>
<a name="1971"><span class="lineNum">    1971 </span>            :           }</a>
<a name="1972"><span class="lineNum">    1972 </span>            :         }</a>
<a name="1973"><span class="lineNum">    1973 </span>            :       }</a>
<a name="1974"><span class="lineNum">    1974 </span>            :     }</a>
<a name="1975"><span class="lineNum">    1975 </span><span class="lineCov">          8 :     if (!numgood &amp;&amp; bestfacet) {</span></a>
<a name="1976"><span class="lineNum">    1976 </span><span class="lineNoCov">          0 :       bestfacet-&gt;good= True;</span></a>
<a name="1977"><span class="lineNum">    1977 </span><span class="lineNoCov">          0 :       numgood++;</span></a>
<a name="1978"><span class="lineNum">    1978 </span><span class="lineNoCov">          0 :       trace0((qh, qh-&gt;ferr, 23, &quot;qh_findgood_all: f%d is closest(%2.2g) to split thresholds\n&quot;,</span></a>
<a name="1979"><span class="lineNum">    1979 </span>            :            bestfacet-&gt;id, bestangle));</a>
<a name="1980"><span class="lineNum">    1980 </span><span class="lineNoCov">          0 :       return;</span></a>
<a name="1981"><span class="lineNum">    1981 </span>            :     }</a>
<a name="1982"><span class="lineNum">    1982 </span>            :   }</a>
<a name="1983"><span class="lineNum">    1983 </span><span class="lineCov">          8 :   if (numgood == 1 &amp;&amp; !qh-&gt;PRINTgood &amp;&amp; qh-&gt;GOODclosest &amp;&amp; qh-&gt;GOODclosest-&gt;good) {</span></a>
<a name="1984"><span class="lineNum">    1984 </span><span class="lineNoCov">          0 :     trace2((qh, qh-&gt;ferr, 2109, &quot;qh_findgood_all: undo selection of qh.GOODclosest f%d since it would fail qh_inthresholds in qh_skipfacet\n&quot;,</span></a>
<a name="1985"><span class="lineNum">    1985 </span>            :       qh-&gt;GOODclosest-&gt;id));</a>
<a name="1986"><span class="lineNum">    1986 </span><span class="lineNoCov">          0 :     qh-&gt;GOODclosest-&gt;good= False;</span></a>
<a name="1987"><span class="lineNum">    1987 </span><span class="lineNoCov">          0 :     numgood= 0;</span></a>
<a name="1988"><span class="lineNum">    1988 </span>            :   }</a>
<a name="1989"><span class="lineNum">    1989 </span><span class="lineCov">          8 :   qh-&gt;num_good= numgood;</span></a>
<a name="1990"><span class="lineNum">    1990 </span><span class="lineCov">          8 :   trace0((qh, qh-&gt;ferr, 24, &quot;qh_findgood_all: %d good facets remain out of %d facets\n&quot;,</span></a>
<a name="1991"><span class="lineNum">    1991 </span>            :         numgood, startgood));</a>
<a name="1992"><span class="lineNum">    1992 </span>            : } /* findgood_all */</a>
<a name="1993"><span class="lineNum">    1993 </span>            : </a>
<a name="1994"><span class="lineNum">    1994 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="1995"><span class="lineNum">    1995 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;furthestnext&quot;&gt;-&lt;/a&gt;</a>
<a name="1996"><span class="lineNum">    1996 </span>            : </a>
<a name="1997"><span class="lineNum">    1997 </span>            :   qh_furthestnext()</a>
<a name="1998"><span class="lineNum">    1998 </span>            :     set qh.facet_next to facet with furthest of all furthest points</a>
<a name="1999"><span class="lineNum">    1999 </span>            :     searches all facets on qh.facet_list</a>
<a name="2000"><span class="lineNum">    2000 </span>            : </a>
<a name="2001"><span class="lineNum">    2001 </span>            :   notes:</a>
<a name="2002"><span class="lineNum">    2002 </span>            :     this may help avoid precision problems</a>
<a name="2003"><span class="lineNum">    2003 </span>            : */</a>
<a name="2004"><span class="lineNum">    2004 </span><span class="lineCov">          8 : void qh_furthestnext(qhT *qh /* qh.facet_list */) {</span></a>
<a name="2005"><span class="lineNum">    2005 </span><span class="lineCov">          8 :   facetT *facet, *bestfacet= NULL;</span></a>
<a name="2006"><span class="lineNum">    2006 </span><span class="lineCov">          8 :   realT dist, bestdist= -REALmax;</span></a>
<a name="2007"><span class="lineNum">    2007 </span>            : </a>
<a name="2008"><span class="lineNum">    2008 </span><span class="lineCov">         40 :   FORALLfacets {</span></a>
<a name="2009"><span class="lineNum">    2009 </span><span class="lineCov">         32 :     if (facet-&gt;outsideset) {</span></a>
<a name="2010"><span class="lineNum">    2010 </span>            : #if qh_COMPUTEfurthest</a>
<a name="2011"><span class="lineNum">    2011 </span>            :       pointT *furthest;</a>
<a name="2012"><span class="lineNum">    2012 </span>            :       furthest= (pointT *)qh_setlast(facet-&gt;outsideset);</a>
<a name="2013"><span class="lineNum">    2013 </span>            :       zinc_(Zcomputefurthest);</a>
<a name="2014"><span class="lineNum">    2014 </span>            :       qh_distplane(qh, furthest, facet, &amp;dist);</a>
<a name="2015"><span class="lineNum">    2015 </span>            : #else</a>
<a name="2016"><span class="lineNum">    2016 </span><span class="lineCov">         16 :       dist= facet-&gt;furthestdist;</span></a>
<a name="2017"><span class="lineNum">    2017 </span>            : #endif</a>
<a name="2018"><span class="lineNum">    2018 </span><span class="lineCov">         16 :       if (dist &gt; bestdist) {</span></a>
<a name="2019"><span class="lineNum">    2019 </span><span class="lineCov">         16 :         bestfacet= facet;</span></a>
<a name="2020"><span class="lineNum">    2020 </span><span class="lineCov">         16 :         bestdist= dist;</span></a>
<a name="2021"><span class="lineNum">    2021 </span>            :       }</a>
<a name="2022"><span class="lineNum">    2022 </span>            :     }</a>
<a name="2023"><span class="lineNum">    2023 </span>            :   }</a>
<a name="2024"><span class="lineNum">    2024 </span><span class="lineCov">          8 :   if (bestfacet) {</span></a>
<a name="2025"><span class="lineNum">    2025 </span><span class="lineCov">          8 :     qh_removefacet(qh, bestfacet);</span></a>
<a name="2026"><span class="lineNum">    2026 </span><span class="lineCov">          8 :     qh_prependfacet(qh, bestfacet, &amp;qh-&gt;facet_next);</span></a>
<a name="2027"><span class="lineNum">    2027 </span><span class="lineCov">          8 :     trace1((qh, qh-&gt;ferr, 1029, &quot;qh_furthestnext: made f%d next facet(dist %.2g)\n&quot;,</span></a>
<a name="2028"><span class="lineNum">    2028 </span>            :             bestfacet-&gt;id, bestdist));</a>
<a name="2029"><span class="lineNum">    2029 </span>            :   }</a>
<a name="2030"><span class="lineNum">    2030 </span><span class="lineCov">          8 : } /* furthestnext */</span></a>
<a name="2031"><span class="lineNum">    2031 </span>            : </a>
<a name="2032"><span class="lineNum">    2032 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="2033"><span class="lineNum">    2033 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;furthestout&quot;&gt;-&lt;/a&gt;</a>
<a name="2034"><span class="lineNum">    2034 </span>            : </a>
<a name="2035"><span class="lineNum">    2035 </span>            :   qh_furthestout(qh, facet )</a>
<a name="2036"><span class="lineNum">    2036 </span>            :     make furthest outside point the last point of outsideset</a>
<a name="2037"><span class="lineNum">    2037 </span>            : </a>
<a name="2038"><span class="lineNum">    2038 </span>            :   returns:</a>
<a name="2039"><span class="lineNum">    2039 </span>            :     updates facet-&gt;outsideset</a>
<a name="2040"><span class="lineNum">    2040 </span>            :     clears facet-&gt;notfurthest</a>
<a name="2041"><span class="lineNum">    2041 </span>            :     sets facet-&gt;furthestdist</a>
<a name="2042"><span class="lineNum">    2042 </span>            : </a>
<a name="2043"><span class="lineNum">    2043 </span>            :   design:</a>
<a name="2044"><span class="lineNum">    2044 </span>            :     determine best point of outsideset</a>
<a name="2045"><span class="lineNum">    2045 </span>            :     make it the last point of outsideset</a>
<a name="2046"><span class="lineNum">    2046 </span>            : */</a>
<a name="2047"><span class="lineNum">    2047 </span><span class="lineNoCov">          0 : void qh_furthestout(qhT *qh, facetT *facet) {</span></a>
<a name="2048"><span class="lineNum">    2048 </span><span class="lineNoCov">          0 :   pointT *point, **pointp, *bestpoint= NULL;</span></a>
<a name="2049"><span class="lineNum">    2049 </span><span class="lineNoCov">          0 :   realT dist, bestdist= -REALmax;</span></a>
<a name="2050"><span class="lineNum">    2050 </span>            : </a>
<a name="2051"><span class="lineNum">    2051 </span><span class="lineNoCov">          0 :   FOREACHpoint_(facet-&gt;outsideset) {</span></a>
<a name="2052"><span class="lineNum">    2052 </span><span class="lineNoCov">          0 :     qh_distplane(qh, point, facet, &amp;dist);</span></a>
<a name="2053"><span class="lineNum">    2053 </span><span class="lineNoCov">          0 :     zinc_(Zcomputefurthest);</span></a>
<a name="2054"><span class="lineNum">    2054 </span><span class="lineNoCov">          0 :     if (dist &gt; bestdist) {</span></a>
<a name="2055"><span class="lineNum">    2055 </span><span class="lineNoCov">          0 :       bestpoint= point;</span></a>
<a name="2056"><span class="lineNum">    2056 </span><span class="lineNoCov">          0 :       bestdist= dist;</span></a>
<a name="2057"><span class="lineNum">    2057 </span>            :     }</a>
<a name="2058"><span class="lineNum">    2058 </span>            :   }</a>
<a name="2059"><span class="lineNum">    2059 </span><span class="lineNoCov">          0 :   if (bestpoint) {</span></a>
<a name="2060"><span class="lineNum">    2060 </span><span class="lineNoCov">          0 :     qh_setdel(facet-&gt;outsideset, point);</span></a>
<a name="2061"><span class="lineNum">    2061 </span><span class="lineNoCov">          0 :     qh_setappend(qh, &amp;facet-&gt;outsideset, point);</span></a>
<a name="2062"><span class="lineNum">    2062 </span>            : #if !qh_COMPUTEfurthest</a>
<a name="2063"><span class="lineNum">    2063 </span><span class="lineNoCov">          0 :     facet-&gt;furthestdist= bestdist;</span></a>
<a name="2064"><span class="lineNum">    2064 </span>            : #endif</a>
<a name="2065"><span class="lineNum">    2065 </span>            :   }</a>
<a name="2066"><span class="lineNum">    2066 </span><span class="lineNoCov">          0 :   facet-&gt;notfurthest= False;</span></a>
<a name="2067"><span class="lineNum">    2067 </span><span class="lineNoCov">          0 :   trace3((qh, qh-&gt;ferr, 3017, &quot;qh_furthestout: p%d is furthest outside point of f%d\n&quot;,</span></a>
<a name="2068"><span class="lineNum">    2068 </span>            :           qh_pointid(qh, point), facet-&gt;id));</a>
<a name="2069"><span class="lineNum">    2069 </span><span class="lineNoCov">          0 : } /* furthestout */</span></a>
<a name="2070"><span class="lineNum">    2070 </span>            : </a>
<a name="2071"><span class="lineNum">    2071 </span>            : </a>
<a name="2072"><span class="lineNum">    2072 </span>            : /*-&lt;a                             href=&quot;qh-qhull_r.htm#TOC&quot;</a>
<a name="2073"><span class="lineNum">    2073 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;infiniteloop&quot;&gt;-&lt;/a&gt;</a>
<a name="2074"><span class="lineNum">    2074 </span>            : </a>
<a name="2075"><span class="lineNum">    2075 </span>            :   qh_infiniteloop(qh, facet )</a>
<a name="2076"><span class="lineNum">    2076 </span>            :     report infinite loop error due to facet</a>
<a name="2077"><span class="lineNum">    2077 </span>            : */</a>
<a name="2078"><span class="lineNum">    2078 </span><span class="lineNoCov">          0 : void qh_infiniteloop(qhT *qh, facetT *facet) {</span></a>
<a name="2079"><span class="lineNum">    2079 </span>            : </a>
<a name="2080"><span class="lineNum">    2080 </span><span class="lineNoCov">          0 :   qh_fprintf(qh, qh-&gt;ferr, 6149, &quot;qhull internal error (qh_infiniteloop): potential infinite loop detected.  If visible, f.replace. If newfacet, f.samecycle\n&quot;);</span></a>
<a name="2081"><span class="lineNum">    2081 </span><span class="lineNoCov">          0 :   qh_errexit(qh, qh_ERRqhull, facet, NULL);</span></a>
<a name="2082"><span class="lineNum">    2082 </span><span class="lineNoCov">          0 : } /* qh_infiniteloop */</span></a>
<a name="2083"><span class="lineNum">    2083 </span>            : </a>
<a name="2084"><span class="lineNum">    2084 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="2085"><span class="lineNum">    2085 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;initbuild&quot;&gt;-&lt;/a&gt;</a>
<a name="2086"><span class="lineNum">    2086 </span>            : </a>
<a name="2087"><span class="lineNum">    2087 </span>            :   qh_initbuild()</a>
<a name="2088"><span class="lineNum">    2088 </span>            :     initialize hull and outside sets with point array</a>
<a name="2089"><span class="lineNum">    2089 </span>            :     qh.FIRSTpoint/qh.NUMpoints is point array</a>
<a name="2090"><span class="lineNum">    2090 </span>            :     if qh.GOODpoint</a>
<a name="2091"><span class="lineNum">    2091 </span>            :       adds qh.GOODpoint to initial hull</a>
<a name="2092"><span class="lineNum">    2092 </span>            : </a>
<a name="2093"><span class="lineNum">    2093 </span>            :   returns:</a>
<a name="2094"><span class="lineNum">    2094 </span>            :     qh_facetlist with initial hull</a>
<a name="2095"><span class="lineNum">    2095 </span>            :     points partitioned into outside sets, coplanar sets, or inside</a>
<a name="2096"><span class="lineNum">    2096 </span>            :     initializes qh.GOODpointp, qh.GOODvertexp,</a>
<a name="2097"><span class="lineNum">    2097 </span>            : </a>
<a name="2098"><span class="lineNum">    2098 </span>            :   design:</a>
<a name="2099"><span class="lineNum">    2099 </span>            :     initialize global variables used during qh_buildhull</a>
<a name="2100"><span class="lineNum">    2100 </span>            :     determine precision constants and points with max/min coordinate values</a>
<a name="2101"><span class="lineNum">    2101 </span>            :       if qh.SCALElast, scale last coordinate(for 'd')</a>
<a name="2102"><span class="lineNum">    2102 </span>            :     initialize qh.newfacet_list, qh.facet_tail</a>
<a name="2103"><span class="lineNum">    2103 </span>            :     initialize qh.vertex_list, qh.newvertex_list, qh.vertex_tail</a>
<a name="2104"><span class="lineNum">    2104 </span>            :     determine initial vertices</a>
<a name="2105"><span class="lineNum">    2105 </span>            :     build initial simplex</a>
<a name="2106"><span class="lineNum">    2106 </span>            :     partition input points into facets of initial simplex</a>
<a name="2107"><span class="lineNum">    2107 </span>            :     set up lists</a>
<a name="2108"><span class="lineNum">    2108 </span>            :     if qh.ONLYgood</a>
<a name="2109"><span class="lineNum">    2109 </span>            :       check consistency</a>
<a name="2110"><span class="lineNum">    2110 </span>            :       add qh.GOODvertex if defined</a>
<a name="2111"><span class="lineNum">    2111 </span>            : */</a>
<a name="2112"><span class="lineNum">    2112 </span><span class="lineCov">          9 : void qh_initbuild(qhT *qh) {</span></a>
<a name="2113"><span class="lineNum">    2113 </span>            :   setT *maxpoints, *vertices;</a>
<a name="2114"><span class="lineNum">    2114 </span>            :   facetT *facet;</a>
<a name="2115"><span class="lineNum">    2115 </span>            :   int i, numpart;</a>
<a name="2116"><span class="lineNum">    2116 </span>            :   realT dist;</a>
<a name="2117"><span class="lineNum">    2117 </span>            :   boolT isoutside;</a>
<a name="2118"><span class="lineNum">    2118 </span>            : </a>
<a name="2119"><span class="lineNum">    2119 </span><span class="lineCov">          9 :   if (qh-&gt;PRINTstatistics) {</span></a>
<a name="2120"><span class="lineNum">    2120 </span><span class="lineNoCov">          0 :     qh_fprintf(qh, qh-&gt;ferr, 9350, &quot;qhull %s Statistics: %s | %s\n&quot;,</span></a>
<a name="2121"><span class="lineNum">    2121 </span><span class="lineNoCov">          0 :       qh_version, qh-&gt;rbox_command, qh-&gt;qhull_command);</span></a>
<a name="2122"><span class="lineNum">    2122 </span><span class="lineNoCov">          0 :     fflush(NULL);</span></a>
<a name="2123"><span class="lineNum">    2123 </span>            :   }</a>
<a name="2124"><span class="lineNum">    2124 </span><span class="lineCov">          9 :   qh-&gt;furthest_id= qh_IDunknown;</span></a>
<a name="2125"><span class="lineNum">    2125 </span><span class="lineCov">          9 :   qh-&gt;lastreport= 0;</span></a>
<a name="2126"><span class="lineNum">    2126 </span><span class="lineCov">          9 :   qh-&gt;lastfacets= 0;</span></a>
<a name="2127"><span class="lineNum">    2127 </span><span class="lineCov">          9 :   qh-&gt;lastmerges= 0;</span></a>
<a name="2128"><span class="lineNum">    2128 </span><span class="lineCov">          9 :   qh-&gt;lastplanes= 0;</span></a>
<a name="2129"><span class="lineNum">    2129 </span><span class="lineCov">          9 :   qh-&gt;lastdist= 0;</span></a>
<a name="2130"><span class="lineNum">    2130 </span><span class="lineCov">          9 :   qh-&gt;facet_id= qh-&gt;vertex_id= qh-&gt;ridge_id= 0;</span></a>
<a name="2131"><span class="lineNum">    2131 </span><span class="lineCov">          9 :   qh-&gt;visit_id= qh-&gt;vertex_visit= 0;</span></a>
<a name="2132"><span class="lineNum">    2132 </span><span class="lineCov">          9 :   qh-&gt;maxoutdone= False;</span></a>
<a name="2133"><span class="lineNum">    2133 </span>            : </a>
<a name="2134"><span class="lineNum">    2134 </span><span class="lineCov">          9 :   if (qh-&gt;GOODpoint &gt; 0)</span></a>
<a name="2135"><span class="lineNum">    2135 </span><span class="lineNoCov">          0 :     qh-&gt;GOODpointp= qh_point(qh, qh-&gt;GOODpoint-1);</span></a>
<a name="2136"><span class="lineNum">    2136 </span><span class="lineCov">          9 :   else if (qh-&gt;GOODpoint &lt; 0)</span></a>
<a name="2137"><span class="lineNum">    2137 </span><span class="lineNoCov">          0 :     qh-&gt;GOODpointp= qh_point(qh, -qh-&gt;GOODpoint-1);</span></a>
<a name="2138"><span class="lineNum">    2138 </span><span class="lineCov">          9 :   if (qh-&gt;GOODvertex &gt; 0)</span></a>
<a name="2139"><span class="lineNum">    2139 </span><span class="lineNoCov">          0 :     qh-&gt;GOODvertexp= qh_point(qh, qh-&gt;GOODvertex-1);</span></a>
<a name="2140"><span class="lineNum">    2140 </span><span class="lineCov">          9 :   else if (qh-&gt;GOODvertex &lt; 0)</span></a>
<a name="2141"><span class="lineNum">    2141 </span><span class="lineNoCov">          0 :     qh-&gt;GOODvertexp= qh_point(qh, -qh-&gt;GOODvertex-1);</span></a>
<a name="2142"><span class="lineNum">    2142 </span><span class="lineCov">          9 :   if ((qh-&gt;GOODpoint</span></a>
<a name="2143"><span class="lineNum">    2143 </span><span class="lineNoCov">          0 :        &amp;&amp; (qh-&gt;GOODpointp &lt; qh-&gt;first_point  /* also catches !GOODpointp */</span></a>
<a name="2144"><span class="lineNum">    2144 </span><span class="lineNoCov">          0 :            || qh-&gt;GOODpointp &gt; qh_point(qh, qh-&gt;num_points-1)))</span></a>
<a name="2145"><span class="lineNum">    2145 </span><span class="lineCov">          9 :   || (qh-&gt;GOODvertex</span></a>
<a name="2146"><span class="lineNum">    2146 </span><span class="lineNoCov">          0 :        &amp;&amp; (qh-&gt;GOODvertexp &lt; qh-&gt;first_point  /* also catches !GOODvertexp */</span></a>
<a name="2147"><span class="lineNum">    2147 </span><span class="lineNoCov">          0 :            || qh-&gt;GOODvertexp &gt; qh_point(qh, qh-&gt;num_points-1)))) {</span></a>
<a name="2148"><span class="lineNum">    2148 </span><span class="lineNoCov">          0 :     qh_fprintf(qh, qh-&gt;ferr, 6150, &quot;qhull input error: either QGn or QVn point is &gt; p%d\n&quot;,</span></a>
<a name="2149"><span class="lineNum">    2149 </span><span class="lineNoCov">          0 :              qh-&gt;num_points-1);</span></a>
<a name="2150"><span class="lineNum">    2150 </span><span class="lineNoCov">          0 :     qh_errexit(qh, qh_ERRinput, NULL, NULL);</span></a>
<a name="2151"><span class="lineNum">    2151 </span>            :   }</a>
<a name="2152"><span class="lineNum">    2152 </span><span class="lineCov">          9 :   maxpoints= qh_maxmin(qh, qh-&gt;first_point, qh-&gt;num_points, qh-&gt;hull_dim);</span></a>
<a name="2153"><span class="lineNum">    2153 </span><span class="lineCov">          9 :   if (qh-&gt;SCALElast)</span></a>
<a name="2154"><span class="lineNum">    2154 </span><span class="lineCov">          9 :     qh_scalelast(qh, qh-&gt;first_point, qh-&gt;num_points, qh-&gt;hull_dim, qh-&gt;MINlastcoord, qh-&gt;MAXlastcoord, qh-&gt;MAXabs_coord);</span></a>
<a name="2155"><span class="lineNum">    2155 </span><span class="lineCov">          9 :   qh_detroundoff(qh);</span></a>
<a name="2156"><span class="lineNum">    2156 </span><span class="lineCov">          9 :   if (qh-&gt;DELAUNAY &amp;&amp; qh-&gt;upper_threshold[qh-&gt;hull_dim-1] &gt; REALmax/2</span></a>
<a name="2157"><span class="lineNum">    2157 </span><span class="lineCov">          9 :                   &amp;&amp; qh-&gt;lower_threshold[qh-&gt;hull_dim-1] &lt; -REALmax/2) {</span></a>
<a name="2158"><span class="lineNum">    2158 </span><span class="lineCov">        270 :     for (i=qh_PRINTEND; i--; ) {</span></a>
<a name="2159"><span class="lineNum">    2159 </span><span class="lineCov">        261 :       if (qh-&gt;PRINTout[i] == qh_PRINTgeom &amp;&amp; qh-&gt;DROPdim &lt; 0</span></a>
<a name="2160"><span class="lineNum">    2160 </span><span class="lineNoCov">          0 :           &amp;&amp; !qh-&gt;GOODthreshold &amp;&amp; !qh-&gt;SPLITthresholds)</span></a>
<a name="2161"><span class="lineNum">    2161 </span><span class="lineNoCov">          0 :         break;  /* in this case, don't set upper_threshold */</span></a>
<a name="2162"><span class="lineNum">    2162 </span>            :     }</a>
<a name="2163"><span class="lineNum">    2163 </span><span class="lineCov">          9 :     if (i &lt; 0) {</span></a>
<a name="2164"><span class="lineNum">    2164 </span><span class="lineCov">          9 :       if (qh-&gt;UPPERdelaunay) { /* matches qh.upperdelaunay in qh_setfacetplane */</span></a>
<a name="2165"><span class="lineNum">    2165 </span><span class="lineNoCov">          0 :         qh-&gt;lower_threshold[qh-&gt;hull_dim-1]= qh-&gt;ANGLEround * qh_ZEROdelaunay;</span></a>
<a name="2166"><span class="lineNum">    2166 </span><span class="lineNoCov">          0 :         qh-&gt;GOODthreshold= True;</span></a>
<a name="2167"><span class="lineNum">    2167 </span>            :       }else {</a>
<a name="2168"><span class="lineNum">    2168 </span><span class="lineCov">          9 :         qh-&gt;upper_threshold[qh-&gt;hull_dim-1]= -qh-&gt;ANGLEround * qh_ZEROdelaunay;</span></a>
<a name="2169"><span class="lineNum">    2169 </span><span class="lineCov">          9 :         if (!qh-&gt;GOODthreshold)</span></a>
<a name="2170"><span class="lineNum">    2170 </span><span class="lineCov">          9 :           qh-&gt;SPLITthresholds= True; /* build upper-convex hull even if Qg */</span></a>
<a name="2171"><span class="lineNum">    2171 </span>            :           /* qh_initqhull_globals errors if Qg without Pdk/etc. */</a>
<a name="2172"><span class="lineNum">    2172 </span>            :       }</a>
<a name="2173"><span class="lineNum">    2173 </span>            :     }</a>
<a name="2174"><span class="lineNum">    2174 </span>            :   }</a>
<a name="2175"><span class="lineNum">    2175 </span><span class="lineCov">          9 :   trace4((qh, qh-&gt;ferr, 4091, &quot;qh_initbuild: create sentinels for qh.facet_tail and qh.vertex_tail\n&quot;));</span></a>
<a name="2176"><span class="lineNum">    2176 </span><span class="lineCov">          9 :   qh-&gt;facet_list= qh-&gt;newfacet_list= qh-&gt;facet_tail= qh_newfacet(qh);</span></a>
<a name="2177"><span class="lineNum">    2177 </span><span class="lineCov">          9 :   qh-&gt;num_facets= qh-&gt;num_vertices= qh-&gt;num_visible= 0;</span></a>
<a name="2178"><span class="lineNum">    2178 </span><span class="lineCov">          9 :   qh-&gt;vertex_list= qh-&gt;newvertex_list= qh-&gt;vertex_tail= qh_newvertex(qh, NULL);</span></a>
<a name="2179"><span class="lineNum">    2179 </span><span class="lineCov">          9 :   vertices= qh_initialvertices(qh, qh-&gt;hull_dim, maxpoints, qh-&gt;first_point, qh-&gt;num_points);</span></a>
<a name="2180"><span class="lineNum">    2180 </span><span class="lineCov">          9 :   qh_initialhull(qh, vertices);  /* initial qh-&gt;facet_list */</span></a>
<a name="2181"><span class="lineNum">    2181 </span><span class="lineCov">          8 :   qh_partitionall(qh, vertices, qh-&gt;first_point, qh-&gt;num_points);</span></a>
<a name="2182"><span class="lineNum">    2182 </span><span class="lineCov">          8 :   if (qh-&gt;PRINToptions1st || qh-&gt;TRACElevel || qh-&gt;IStracing) {</span></a>
<a name="2183"><span class="lineNum">    2183 </span><span class="lineNoCov">          0 :     if (qh-&gt;TRACElevel || qh-&gt;IStracing)</span></a>
<a name="2184"><span class="lineNum">    2184 </span><span class="lineNoCov">          0 :       qh_fprintf(qh, qh-&gt;ferr, 8103, &quot;\nTrace level T%d, IStracing %d, point TP%d, merge TM%d, dist TW%2.2g, qh.tracefacet_id %d, traceridge_id %d, tracevertex_id %d, last qh.RERUN %d, %s | %s\n&quot;,</span></a>
<a name="2185"><span class="lineNum">    2185 </span><span class="lineNoCov">          0 :          qh-&gt;TRACElevel, qh-&gt;IStracing, qh-&gt;TRACEpoint, qh-&gt;TRACEmerge, qh-&gt;TRACEdist, qh-&gt;tracefacet_id, qh-&gt;traceridge_id, qh-&gt;tracevertex_id, qh-&gt;TRACElastrun, qh-&gt;rbox_command, qh-&gt;qhull_command);</span></a>
<a name="2186"><span class="lineNum">    2186 </span><span class="lineNoCov">          0 :     qh_fprintf(qh, qh-&gt;ferr, 8104, &quot;Options selected for Qhull %s:\n%s\n&quot;, qh_version, qh-&gt;qhull_options);</span></a>
<a name="2187"><span class="lineNum">    2187 </span>            :   }</a>
<a name="2188"><span class="lineNum">    2188 </span><span class="lineCov">          8 :   qh_resetlists(qh, False, qh_RESETvisible /* qh.visible_list newvertex_list qh.newfacet_list */);</span></a>
<a name="2189"><span class="lineNum">    2189 </span><span class="lineCov">          8 :   qh-&gt;facet_next= qh-&gt;facet_list;</span></a>
<a name="2190"><span class="lineNum">    2190 </span><span class="lineCov">          8 :   qh_furthestnext(qh /* qh.facet_list */);</span></a>
<a name="2191"><span class="lineNum">    2191 </span><span class="lineCov">          8 :   if (qh-&gt;PREmerge) {</span></a>
<a name="2192"><span class="lineNum">    2192 </span><span class="lineCov">          8 :     qh-&gt;cos_max= qh-&gt;premerge_cos;</span></a>
<a name="2193"><span class="lineNum">    2193 </span><span class="lineCov">          8 :     qh-&gt;centrum_radius= qh-&gt;premerge_centrum; /* overwritten by qh_premerge */</span></a>
<a name="2194"><span class="lineNum">    2194 </span>            :   }</a>
<a name="2195"><span class="lineNum">    2195 </span><span class="lineCov">          8 :   if (qh-&gt;ONLYgood) {</span></a>
<a name="2196"><span class="lineNum">    2196 </span><span class="lineNoCov">          0 :     if (qh-&gt;GOODvertex &gt; 0 &amp;&amp; qh-&gt;MERGING) {</span></a>
<a name="2197"><span class="lineNum">    2197 </span><span class="lineNoCov">          0 :       qh_fprintf(qh, qh-&gt;ferr, 6151, &quot;qhull input error: 'Qg QVn' (only good vertex) does not work with merging.\nUse 'QJ' to joggle the input or 'Q0' to turn off merging.\n&quot;);</span></a>
<a name="2198"><span class="lineNum">    2198 </span><span class="lineNoCov">          0 :       qh_errexit(qh, qh_ERRinput, NULL, NULL);</span></a>
<a name="2199"><span class="lineNum">    2199 </span>            :     }</a>
<a name="2200"><span class="lineNum">    2200 </span><span class="lineNoCov">          0 :     if (!(qh-&gt;GOODthreshold || qh-&gt;GOODpoint</span></a>
<a name="2201"><span class="lineNum">    2201 </span><span class="lineNoCov">          0 :          || (!qh-&gt;MERGEexact &amp;&amp; !qh-&gt;PREmerge &amp;&amp; qh-&gt;GOODvertexp))) {</span></a>
<a name="2202"><span class="lineNum">    2202 </span><span class="lineNoCov">          0 :       qh_fprintf(qh, qh-&gt;ferr, 6152, &quot;qhull input error: 'Qg' (ONLYgood) needs a good threshold('Pd0D0'), a good point(QGn or QG-n), or a good vertex with 'QJ' or 'Q0' (QVn).\n&quot;);</span></a>
<a name="2203"><span class="lineNum">    2203 </span><span class="lineNoCov">          0 :       qh_errexit(qh, qh_ERRinput, NULL, NULL);</span></a>
<a name="2204"><span class="lineNum">    2204 </span>            :     }</a>
<a name="2205"><span class="lineNum">    2205 </span><span class="lineNoCov">          0 :     if (qh-&gt;GOODvertex &gt; 0  &amp;&amp; !qh-&gt;MERGING  /* matches qh_partitionall */</span></a>
<a name="2206"><span class="lineNum">    2206 </span><span class="lineNoCov">          0 :     &amp;&amp; !qh_isvertex(qh-&gt;GOODvertexp, vertices)) {</span></a>
<a name="2207"><span class="lineNum">    2207 </span><span class="lineNoCov">          0 :       facet= qh_findbestnew(qh, qh-&gt;GOODvertexp, qh-&gt;facet_list,</span></a>
<a name="2208"><span class="lineNum">    2208 </span>            :                           &amp;dist, !qh_ALL, &amp;isoutside, &amp;numpart);</a>
<a name="2209"><span class="lineNum">    2209 </span><span class="lineNoCov">          0 :       zadd_(Zdistgood, numpart);</span></a>
<a name="2210"><span class="lineNum">    2210 </span><span class="lineNoCov">          0 :       if (!isoutside) {</span></a>
<a name="2211"><span class="lineNum">    2211 </span><span class="lineNoCov">          0 :         qh_fprintf(qh, qh-&gt;ferr, 6153, &quot;qhull input error: point for QV%d is inside initial simplex.  It can not be made a vertex.\n&quot;,</span></a>
<a name="2212"><span class="lineNum">    2212 </span>            :                qh_pointid(qh, qh-&gt;GOODvertexp));</a>
<a name="2213"><span class="lineNum">    2213 </span><span class="lineNoCov">          0 :         qh_errexit(qh, qh_ERRinput, NULL, NULL);</span></a>
<a name="2214"><span class="lineNum">    2214 </span>            :       }</a>
<a name="2215"><span class="lineNum">    2215 </span><span class="lineNoCov">          0 :       if (!qh_addpoint(qh, qh-&gt;GOODvertexp, facet, False)) {</span></a>
<a name="2216"><span class="lineNum">    2216 </span><span class="lineNoCov">          0 :         qh_settempfree(qh, &amp;vertices);</span></a>
<a name="2217"><span class="lineNum">    2217 </span><span class="lineNoCov">          0 :         qh_settempfree(qh, &amp;maxpoints);</span></a>
<a name="2218"><span class="lineNum">    2218 </span><span class="lineNoCov">          0 :         return;</span></a>
<a name="2219"><span class="lineNum">    2219 </span>            :       }</a>
<a name="2220"><span class="lineNum">    2220 </span>            :     }</a>
<a name="2221"><span class="lineNum">    2221 </span><span class="lineNoCov">          0 :     qh_findgood(qh, qh-&gt;facet_list, 0);</span></a>
<a name="2222"><span class="lineNum">    2222 </span>            :   }</a>
<a name="2223"><span class="lineNum">    2223 </span><span class="lineCov">          8 :   qh_settempfree(qh, &amp;vertices);</span></a>
<a name="2224"><span class="lineNum">    2224 </span><span class="lineCov">          8 :   qh_settempfree(qh, &amp;maxpoints);</span></a>
<a name="2225"><span class="lineNum">    2225 </span><span class="lineCov">          8 :   trace1((qh, qh-&gt;ferr, 1030, &quot;qh_initbuild: initial hull created and points partitioned\n&quot;));</span></a>
<a name="2226"><span class="lineNum">    2226 </span>            : } /* initbuild */</a>
<a name="2227"><span class="lineNum">    2227 </span>            : </a>
<a name="2228"><span class="lineNum">    2228 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="2229"><span class="lineNum">    2229 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;initialhull&quot;&gt;-&lt;/a&gt;</a>
<a name="2230"><span class="lineNum">    2230 </span>            : </a>
<a name="2231"><span class="lineNum">    2231 </span>            :   qh_initialhull(qh, vertices )</a>
<a name="2232"><span class="lineNum">    2232 </span>            :     constructs the initial hull as a DIM3 simplex of vertices</a>
<a name="2233"><span class="lineNum">    2233 </span>            : </a>
<a name="2234"><span class="lineNum">    2234 </span>            :   notes:</a>
<a name="2235"><span class="lineNum">    2235 </span>            :     only called by qh_initbuild</a>
<a name="2236"><span class="lineNum">    2236 </span>            : </a>
<a name="2237"><span class="lineNum">    2237 </span>            :   design:</a>
<a name="2238"><span class="lineNum">    2238 </span>            :     creates a simplex (initializes lists)</a>
<a name="2239"><span class="lineNum">    2239 </span>            :     determines orientation of simplex</a>
<a name="2240"><span class="lineNum">    2240 </span>            :     sets hyperplanes for facets</a>
<a name="2241"><span class="lineNum">    2241 </span>            :     doubles checks orientation (in case of axis-parallel facets with Gaussian elimination)</a>
<a name="2242"><span class="lineNum">    2242 </span>            :     checks for flipped facets and qh.NARROWhull</a>
<a name="2243"><span class="lineNum">    2243 </span>            :     checks the result</a>
<a name="2244"><span class="lineNum">    2244 </span>            : */</a>
<a name="2245"><span class="lineNum">    2245 </span><span class="lineCov">          9 : void qh_initialhull(qhT *qh, setT *vertices) {</span></a>
<a name="2246"><span class="lineNum">    2246 </span>            :   facetT *facet, *firstfacet, *neighbor, **neighborp;</a>
<a name="2247"><span class="lineNum">    2247 </span><span class="lineCov">          9 :   realT angle, minangle= REALmax, dist;</span></a>
<a name="2248"><span class="lineNum">    2248 </span>            : </a>
<a name="2249"><span class="lineNum">    2249 </span><span class="lineCov">          9 :   qh_createsimplex(qh, vertices /* qh.facet_list */);</span></a>
<a name="2250"><span class="lineNum">    2250 </span><span class="lineCov">          9 :   qh_resetlists(qh, False, qh_RESETvisible);</span></a>
<a name="2251"><span class="lineNum">    2251 </span><span class="lineCov">          9 :   qh-&gt;facet_next= qh-&gt;facet_list;      /* advance facet when processed */</span></a>
<a name="2252"><span class="lineNum">    2252 </span><span class="lineCov">          9 :   qh-&gt;interior_point= qh_getcenter(qh, vertices);</span></a>
<a name="2253"><span class="lineNum">    2253 </span><span class="lineCov">          9 :   if (qh-&gt;IStracing) {</span></a>
<a name="2254"><span class="lineNum">    2254 </span><span class="lineNoCov">          0 :     qh_fprintf(qh, qh-&gt;ferr, 8105, &quot;qh_initialhull: &quot;);</span></a>
<a name="2255"><span class="lineNum">    2255 </span><span class="lineNoCov">          0 :     qh_printpoint(qh, qh-&gt;ferr, &quot;qh.interior_point&quot;, qh-&gt;interior_point);</span></a>
<a name="2256"><span class="lineNum">    2256 </span>            :   }</a>
<a name="2257"><span class="lineNum">    2257 </span><span class="lineCov">          9 :   firstfacet= qh-&gt;facet_list;</span></a>
<a name="2258"><span class="lineNum">    2258 </span><span class="lineCov">          9 :   qh_setfacetplane(qh, firstfacet);   /* qh_joggle_restart if flipped */</span></a>
<a name="2259"><span class="lineNum">    2259 </span><span class="lineCov">          9 :   if (firstfacet-&gt;flipped) {</span></a>
<a name="2260"><span class="lineNum">    2260 </span><span class="lineCov">          6 :     trace1((qh, qh-&gt;ferr, 1065, &quot;qh_initialhull: ignore f%d flipped.  Test qh.interior_point (p-2) for clearly flipped\n&quot;, firstfacet-&gt;id));</span></a>
<a name="2261"><span class="lineNum">    2261 </span><span class="lineCov">          6 :     firstfacet-&gt;flipped= False;</span></a>
<a name="2262"><span class="lineNum">    2262 </span>            :   }</a>
<a name="2263"><span class="lineNum">    2263 </span><span class="lineCov">          9 :   zzinc_(Zdistcheck);</span></a>
<a name="2264"><span class="lineNum">    2264 </span><span class="lineCov">          9 :   qh_distplane(qh, qh-&gt;interior_point, firstfacet, &amp;dist);</span></a>
<a name="2265"><span class="lineNum">    2265 </span><span class="lineCov">          9 :   if (dist &gt; qh-&gt;DISTround) {  /* clearly flipped */</span></a>
<a name="2266"><span class="lineNum">    2266 </span><span class="lineCov">          5 :     trace1((qh, qh-&gt;ferr, 1060, &quot;qh_initialhull: initial orientation incorrect, qh.interior_point is %2.2g from f%d.  Reversing orientation of all facets\n&quot;,</span></a>
<a name="2267"><span class="lineNum">    2267 </span>            :           dist, firstfacet-&gt;id));</a>
<a name="2268"><span class="lineNum">    2268 </span><span class="lineCov">         25 :     FORALLfacets</span></a>
<a name="2269"><span class="lineNum">    2269 </span><span class="lineCov">         20 :       facet-&gt;toporient ^= (unsigned char)True;</span></a>
<a name="2270"><span class="lineNum">    2270 </span><span class="lineCov">          5 :     qh_setfacetplane(qh, firstfacet);</span></a>
<a name="2271"><span class="lineNum">    2271 </span>            :   }</a>
<a name="2272"><span class="lineNum">    2272 </span><span class="lineCov">         45 :   FORALLfacets {</span></a>
<a name="2273"><span class="lineNum">    2273 </span><span class="lineCov">         36 :     if (facet != firstfacet)</span></a>
<a name="2274"><span class="lineNum">    2274 </span><span class="lineCov">         27 :       qh_setfacetplane(qh, facet);    /* qh_joggle_restart if flipped */</span></a>
<a name="2275"><span class="lineNum">    2275 </span>            :   }</a>
<a name="2276"><span class="lineNum">    2276 </span><span class="lineCov">         45 :   FORALLfacets {</span></a>
<a name="2277"><span class="lineNum">    2277 </span><span class="lineCov">         36 :     if (facet-&gt;flipped) {</span></a>
<a name="2278"><span class="lineNum">    2278 </span><span class="lineCov">          3 :       trace1((qh, qh-&gt;ferr, 1066, &quot;qh_initialhull: ignore f%d flipped.  Test qh.interior_point (p-2) for clearly flipped\n&quot;, facet-&gt;id));</span></a>
<a name="2279"><span class="lineNum">    2279 </span><span class="lineCov">          3 :       facet-&gt;flipped= False;</span></a>
<a name="2280"><span class="lineNum">    2280 </span>            :     }</a>
<a name="2281"><span class="lineNum">    2281 </span><span class="lineCov">         36 :     zzinc_(Zdistcheck);</span></a>
<a name="2282"><span class="lineNum">    2282 </span><span class="lineCov">         36 :     qh_distplane(qh, qh-&gt;interior_point, facet, &amp;dist);  /* duplicates qh_setfacetplane */</span></a>
<a name="2283"><span class="lineNum">    2283 </span><span class="lineCov">         36 :     if (dist &gt; qh-&gt;DISTround) {  /* clearly flipped, due to axis-parallel facet or coplanar firstfacet */</span></a>
<a name="2284"><span class="lineNum">    2284 </span><span class="lineNoCov">          0 :       trace1((qh, qh-&gt;ferr, 1031, &quot;qh_initialhull: initial orientation incorrect, qh.interior_point is %2.2g from f%d.  Either axis-parallel facet or coplanar firstfacet f%d.  Force outside orientation of all facets\n&quot;));</span></a>
<a name="2285"><span class="lineNum">    2285 </span><span class="lineNoCov">          0 :       FORALLfacets { /* reuse facet, then 'break' */</span></a>
<a name="2286"><span class="lineNum">    2286 </span><span class="lineNoCov">          0 :         facet-&gt;flipped= False;</span></a>
<a name="2287"><span class="lineNum">    2287 </span><span class="lineNoCov">          0 :         facet-&gt;toporient ^= (unsigned char)True;</span></a>
<a name="2288"><span class="lineNum">    2288 </span><span class="lineNoCov">          0 :         qh_orientoutside(qh, facet);  /* force outside orientation for f.normal */</span></a>
<a name="2289"><span class="lineNum">    2289 </span>            :       }</a>
<a name="2290"><span class="lineNum">    2290 </span><span class="lineNoCov">          0 :       break;</span></a>
<a name="2291"><span class="lineNum">    2291 </span>            :     }</a>
<a name="2292"><span class="lineNum">    2292 </span>            :   }</a>
<a name="2293"><span class="lineNum">    2293 </span><span class="lineCov">         41 :   FORALLfacets {</span></a>
<a name="2294"><span class="lineNum">    2294 </span><span class="lineCov">         33 :     if (!qh_checkflipped(qh, facet, NULL, qh_ALL)) {</span></a>
<a name="2295"><span class="lineNum">    2295 </span><span class="lineCov">          1 :       if (qh-&gt;DELAUNAY &amp;&amp; ! qh-&gt;ATinfinity) {</span></a>
<a name="2296"><span class="lineNum">    2296 </span><span class="lineNoCov">          0 :         qh_joggle_restart(qh, &quot;initial Delaunay cocircular or cospherical&quot;);</span></a>
<a name="2297"><span class="lineNum">    2297 </span><span class="lineNoCov">          0 :         if (qh-&gt;UPPERdelaunay)</span></a>
<a name="2298"><span class="lineNum">    2298 </span><span class="lineNoCov">          0 :           qh_fprintf(qh, qh-&gt;ferr, 6240, &quot;Qhull precision error: initial Delaunay input sites are cocircular or cospherical.  Option 'Qs' searches all points.  Use option 'QJ' to joggle the input, otherwise cannot compute the upper Delaunay triangulation or upper Voronoi diagram of cocircular/cospherical points.\n&quot;);</span></a>
<a name="2299"><span class="lineNum">    2299 </span>            :         else</a>
<a name="2300"><span class="lineNum">    2300 </span><span class="lineNoCov">          0 :           qh_fprintf(qh, qh-&gt;ferr, 6239, &quot;Qhull precision error: initial Delaunay input sites are cocircular or cospherical.  Use option 'Qz' for the Delaunay triangulation or Voronoi diagram of cocircular/cospherical points; it adds a point \&quot;at infinity\&quot;.  Alternatively use option 'QJ' to joggle the input.  Use option 'Qs' to search all points for the initial simplex.\n&quot;);</span></a>
<a name="2301"><span class="lineNum">    2301 </span><span class="lineNoCov">          0 :         qh_printvertexlist(qh, qh-&gt;ferr, &quot;\ninput sites with last coordinate projected to a paraboloid\n&quot;, qh-&gt;facet_list, NULL, qh_ALL);</span></a>
<a name="2302"><span class="lineNum">    2302 </span><span class="lineNoCov">          0 :         qh_errexit(qh, qh_ERRinput, NULL, NULL);</span></a>
<a name="2303"><span class="lineNum">    2303 </span>            :       }else {</a>
<a name="2304"><span class="lineNum">    2304 </span><span class="lineCov">          1 :         qh_joggle_restart(qh, &quot;initial simplex is flat&quot;);</span></a>
<a name="2305"><span class="lineNum">    2305 </span><span class="lineCov">          1 :         qh_fprintf(qh, qh-&gt;ferr, 6154, &quot;Qhull precision error: Initial simplex is flat (facet %d is coplanar with the interior point)\n&quot;,</span></a>
<a name="2306"><span class="lineNum">    2306 </span>            :                    facet-&gt;id);</a>
<a name="2307"><span class="lineNum">    2307 </span><span class="lineCov">          1 :         qh_errexit(qh, qh_ERRsingular, NULL, NULL);  /* calls qh_printhelp_singular */</span></a>
<a name="2308"><span class="lineNum">    2308 </span>            :       }</a>
<a name="2309"><span class="lineNum">    2309 </span>            :     }</a>
<a name="2310"><span class="lineNum">    2310 </span><span class="lineCov">        128 :     FOREACHneighbor_(facet) {</span></a>
<a name="2311"><span class="lineNum">    2311 </span><span class="lineCov">         96 :       angle= qh_getangle(qh, facet-&gt;normal, neighbor-&gt;normal);</span></a>
<a name="2312"><span class="lineNum">    2312 </span><span class="lineCov">         96 :       minimize_( minangle, angle);</span></a>
<a name="2313"><span class="lineNum">    2313 </span>            :     }</a>
<a name="2314"><span class="lineNum">    2314 </span>            :   }</a>
<a name="2315"><span class="lineNum">    2315 </span><span class="lineCov">          8 :   if (minangle &lt; qh_MAXnarrow &amp;&amp; !qh-&gt;NOnarrow) {</span></a>
<a name="2316"><span class="lineNum">    2316 </span><span class="lineNoCov">          0 :     realT diff= 1.0 + minangle;</span></a>
<a name="2317"><span class="lineNum">    2317 </span>            : </a>
<a name="2318"><span class="lineNum">    2318 </span><span class="lineNoCov">          0 :     qh-&gt;NARROWhull= True;</span></a>
<a name="2319"><span class="lineNum">    2319 </span><span class="lineNoCov">          0 :     qh_option(qh, &quot;_narrow-hull&quot;, NULL, &amp;diff);</span></a>
<a name="2320"><span class="lineNum">    2320 </span><span class="lineNoCov">          0 :     if (minangle &lt; qh_WARNnarrow &amp;&amp; !qh-&gt;RERUN &amp;&amp; qh-&gt;PRINTprecision)</span></a>
<a name="2321"><span class="lineNum">    2321 </span><span class="lineNoCov">          0 :       qh_printhelp_narrowhull(qh, qh-&gt;ferr, minangle);</span></a>
<a name="2322"><span class="lineNum">    2322 </span>            :   }</a>
<a name="2323"><span class="lineNum">    2323 </span><span class="lineCov">          8 :   zzval_(Zprocessed)= qh-&gt;hull_dim+1;</span></a>
<a name="2324"><span class="lineNum">    2324 </span><span class="lineCov">          8 :   qh_checkpolygon(qh, qh-&gt;facet_list);</span></a>
<a name="2325"><span class="lineNum">    2325 </span><span class="lineCov">          8 :   qh_checkconvex(qh, qh-&gt;facet_list, qh_DATAfault);</span></a>
<a name="2326"><span class="lineNum">    2326 </span><span class="lineCov">          8 :   if (qh-&gt;IStracing &gt;= 1) {</span></a>
<a name="2327"><span class="lineNum">    2327 </span><span class="lineNoCov">          0 :     qh_fprintf(qh, qh-&gt;ferr, 8105, &quot;qh_initialhull: simplex constructed\n&quot;);</span></a>
<a name="2328"><span class="lineNum">    2328 </span>            :   }</a>
<a name="2329"><span class="lineNum">    2329 </span><span class="lineCov">          8 : } /* initialhull */</span></a>
<a name="2330"><span class="lineNum">    2330 </span>            : </a>
<a name="2331"><span class="lineNum">    2331 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="2332"><span class="lineNum">    2332 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;initialvertices&quot;&gt;-&lt;/a&gt;</a>
<a name="2333"><span class="lineNum">    2333 </span>            : </a>
<a name="2334"><span class="lineNum">    2334 </span>            :   qh_initialvertices(qh, dim, maxpoints, points, numpoints )</a>
<a name="2335"><span class="lineNum">    2335 </span>            :     determines a non-singular set of initial vertices</a>
<a name="2336"><span class="lineNum">    2336 </span>            :     maxpoints may include duplicate points</a>
<a name="2337"><span class="lineNum">    2337 </span>            : </a>
<a name="2338"><span class="lineNum">    2338 </span>            :   returns:</a>
<a name="2339"><span class="lineNum">    2339 </span>            :     temporary set of dim+1 vertices in descending order by vertex id</a>
<a name="2340"><span class="lineNum">    2340 </span>            :     if qh.RANDOMoutside &amp;&amp; !qh.ALLpoints</a>
<a name="2341"><span class="lineNum">    2341 </span>            :       picks random points</a>
<a name="2342"><span class="lineNum">    2342 </span>            :     if dim &gt;= qh_INITIALmax,</a>
<a name="2343"><span class="lineNum">    2343 </span>            :       uses min/max x and max points with non-zero determinants</a>
<a name="2344"><span class="lineNum">    2344 </span>            : </a>
<a name="2345"><span class="lineNum">    2345 </span>            :   notes:</a>
<a name="2346"><span class="lineNum">    2346 </span>            :     unless qh.ALLpoints,</a>
<a name="2347"><span class="lineNum">    2347 </span>            :       uses maxpoints as long as determinate is non-zero</a>
<a name="2348"><span class="lineNum">    2348 </span>            : */</a>
<a name="2349"><span class="lineNum">    2349 </span><span class="lineCov">          9 : setT *qh_initialvertices(qhT *qh, int dim, setT *maxpoints, pointT *points, int numpoints) {</span></a>
<a name="2350"><span class="lineNum">    2350 </span>            :   pointT *point, **pointp;</a>
<a name="2351"><span class="lineNum">    2351 </span>            :   setT *vertices, *simplex, *tested;</a>
<a name="2352"><span class="lineNum">    2352 </span>            :   realT randr;</a>
<a name="2353"><span class="lineNum">    2353 </span>            :   int idx, point_i, point_n, k;</a>
<a name="2354"><span class="lineNum">    2354 </span><span class="lineCov">          9 :   boolT nearzero= False;</span></a>
<a name="2355"><span class="lineNum">    2355 </span>            : </a>
<a name="2356"><span class="lineNum">    2356 </span><span class="lineCov">          9 :   vertices= qh_settemp(qh, dim + 1);</span></a>
<a name="2357"><span class="lineNum">    2357 </span><span class="lineCov">          9 :   simplex= qh_settemp(qh, dim + 1);</span></a>
<a name="2358"><span class="lineNum">    2358 </span><span class="lineCov">          9 :   if (qh-&gt;ALLpoints)</span></a>
<a name="2359"><span class="lineNum">    2359 </span><span class="lineNoCov">          0 :     qh_maxsimplex(qh, dim, NULL, points, numpoints, &amp;simplex);</span></a>
<a name="2360"><span class="lineNum">    2360 </span><span class="lineCov">          9 :   else if (qh-&gt;RANDOMoutside) {</span></a>
<a name="2361"><span class="lineNum">    2361 </span><span class="lineNoCov">          0 :     while (qh_setsize(qh, simplex) != dim+1) {</span></a>
<a name="2362"><span class="lineNum">    2362 </span><span class="lineNoCov">          0 :       randr= qh_RANDOMint;</span></a>
<a name="2363"><span class="lineNum">    2363 </span><span class="lineNoCov">          0 :       randr= randr/(qh_RANDOMmax+1);</span></a>
<a name="2364"><span class="lineNum">    2364 </span><span class="lineNoCov">          0 :       randr= floor(qh-&gt;num_points * randr);</span></a>
<a name="2365"><span class="lineNum">    2365 </span><span class="lineNoCov">          0 :       idx= (int)randr;</span></a>
<a name="2366"><span class="lineNum">    2366 </span><span class="lineNoCov">          0 :       while (qh_setin(simplex, qh_point(qh, idx))) {</span></a>
<a name="2367"><span class="lineNum">    2367 </span><span class="lineNoCov">          0 :         idx++; /* in case qh_RANDOMint always returns the same value */</span></a>
<a name="2368"><span class="lineNum">    2368 </span><span class="lineNoCov">          0 :         idx= idx &lt; qh-&gt;num_points ? idx : 0;</span></a>
<a name="2369"><span class="lineNum">    2369 </span>            :       }</a>
<a name="2370"><span class="lineNum">    2370 </span><span class="lineNoCov">          0 :       qh_setappend(qh, &amp;simplex, qh_point(qh, idx));</span></a>
<a name="2371"><span class="lineNum">    2371 </span>            :     }</a>
<a name="2372"><span class="lineNum">    2372 </span><span class="lineCov">          9 :   }else if (qh-&gt;hull_dim &gt;= qh_INITIALmax) {</span></a>
<a name="2373"><span class="lineNum">    2373 </span><span class="lineNoCov">          0 :     tested= qh_settemp(qh, dim+1);</span></a>
<a name="2374"><span class="lineNum">    2374 </span><span class="lineNoCov">          0 :     qh_setappend(qh, &amp;simplex, SETfirst_(maxpoints));   /* max and min X coord */</span></a>
<a name="2375"><span class="lineNum">    2375 </span><span class="lineNoCov">          0 :     qh_setappend(qh, &amp;simplex, SETsecond_(maxpoints));</span></a>
<a name="2376"><span class="lineNum">    2376 </span><span class="lineNoCov">          0 :     qh_maxsimplex(qh, fmin_(qh_INITIALsearch, dim), maxpoints, points, numpoints, &amp;simplex);</span></a>
<a name="2377"><span class="lineNum">    2377 </span><span class="lineNoCov">          0 :     k= qh_setsize(qh, simplex);</span></a>
<a name="2378"><span class="lineNum">    2378 </span><span class="lineNoCov">          0 :     FOREACHpoint_i_(qh, maxpoints) {</span></a>
<a name="2379"><span class="lineNum">    2379 </span><span class="lineNoCov">          0 :       if (k &gt;= dim)  /* qh_maxsimplex for last point */</span></a>
<a name="2380"><span class="lineNum">    2380 </span><span class="lineNoCov">          0 :         break;</span></a>
<a name="2381"><span class="lineNum">    2381 </span><span class="lineNoCov">          0 :       if (point_i &amp; 0x1) {     /* first try up to dim, max. coord. points */</span></a>
<a name="2382"><span class="lineNum">    2382 </span><span class="lineNoCov">          0 :         if (!qh_setin(simplex, point) &amp;&amp; !qh_setin(tested, point)){</span></a>
<a name="2383"><span class="lineNum">    2383 </span><span class="lineNoCov">          0 :           qh_detsimplex(qh, point, simplex, k, &amp;nearzero);</span></a>
<a name="2384"><span class="lineNum">    2384 </span><span class="lineNoCov">          0 :           if (nearzero)</span></a>
<a name="2385"><span class="lineNum">    2385 </span><span class="lineNoCov">          0 :             qh_setappend(qh, &amp;tested, point);</span></a>
<a name="2386"><span class="lineNum">    2386 </span>            :           else {</a>
<a name="2387"><span class="lineNum">    2387 </span><span class="lineNoCov">          0 :             qh_setappend(qh, &amp;simplex, point);</span></a>
<a name="2388"><span class="lineNum">    2388 </span><span class="lineNoCov">          0 :             k++;</span></a>
<a name="2389"><span class="lineNum">    2389 </span>            :           }</a>
<a name="2390"><span class="lineNum">    2390 </span>            :         }</a>
<a name="2391"><span class="lineNum">    2391 </span>            :       }</a>
<a name="2392"><span class="lineNum">    2392 </span>            :     }</a>
<a name="2393"><span class="lineNum">    2393 </span><span class="lineNoCov">          0 :     FOREACHpoint_i_(qh, maxpoints) {</span></a>
<a name="2394"><span class="lineNum">    2394 </span><span class="lineNoCov">          0 :       if (k &gt;= dim)  /* qh_maxsimplex for last point */</span></a>
<a name="2395"><span class="lineNum">    2395 </span><span class="lineNoCov">          0 :         break;</span></a>
<a name="2396"><span class="lineNum">    2396 </span><span class="lineNoCov">          0 :       if ((point_i &amp; 0x1) == 0) {  /* then test min. coord points */</span></a>
<a name="2397"><span class="lineNum">    2397 </span><span class="lineNoCov">          0 :         if (!qh_setin(simplex, point) &amp;&amp; !qh_setin(tested, point)){</span></a>
<a name="2398"><span class="lineNum">    2398 </span><span class="lineNoCov">          0 :           qh_detsimplex(qh, point, simplex, k, &amp;nearzero);</span></a>
<a name="2399"><span class="lineNum">    2399 </span><span class="lineNoCov">          0 :           if (nearzero)</span></a>
<a name="2400"><span class="lineNum">    2400 </span><span class="lineNoCov">          0 :             qh_setappend(qh, &amp;tested, point);</span></a>
<a name="2401"><span class="lineNum">    2401 </span>            :           else {</a>
<a name="2402"><span class="lineNum">    2402 </span><span class="lineNoCov">          0 :             qh_setappend(qh, &amp;simplex, point);</span></a>
<a name="2403"><span class="lineNum">    2403 </span><span class="lineNoCov">          0 :             k++;</span></a>
<a name="2404"><span class="lineNum">    2404 </span>            :           }</a>
<a name="2405"><span class="lineNum">    2405 </span>            :         }</a>
<a name="2406"><span class="lineNum">    2406 </span>            :       }</a>
<a name="2407"><span class="lineNum">    2407 </span>            :     }</a>
<a name="2408"><span class="lineNum">    2408 </span>            :     /* remove tested points from maxpoints */</a>
<a name="2409"><span class="lineNum">    2409 </span><span class="lineNoCov">          0 :     FOREACHpoint_i_(qh, maxpoints) {</span></a>
<a name="2410"><span class="lineNum">    2410 </span><span class="lineNoCov">          0 :       if (qh_setin(simplex, point) || qh_setin(tested, point))</span></a>
<a name="2411"><span class="lineNum">    2411 </span><span class="lineNoCov">          0 :         SETelem_(maxpoints, point_i)= NULL;</span></a>
<a name="2412"><span class="lineNum">    2412 </span>            :     }</a>
<a name="2413"><span class="lineNum">    2413 </span><span class="lineNoCov">          0 :     qh_setcompact(qh, maxpoints);</span></a>
<a name="2414"><span class="lineNum">    2414 </span><span class="lineNoCov">          0 :     idx= 0;</span></a>
<a name="2415"><span class="lineNum">    2415 </span><span class="lineNoCov">          0 :     while (k &lt; dim &amp;&amp; (point= qh_point(qh, idx++))) {</span></a>
<a name="2416"><span class="lineNum">    2416 </span><span class="lineNoCov">          0 :       if (!qh_setin(simplex, point) &amp;&amp; !qh_setin(tested, point)){</span></a>
<a name="2417"><span class="lineNum">    2417 </span><span class="lineNoCov">          0 :         qh_detsimplex(qh, point, simplex, k, &amp;nearzero);</span></a>
<a name="2418"><span class="lineNum">    2418 </span><span class="lineNoCov">          0 :         if (!nearzero){</span></a>
<a name="2419"><span class="lineNum">    2419 </span><span class="lineNoCov">          0 :           qh_setappend(qh, &amp;simplex, point);</span></a>
<a name="2420"><span class="lineNum">    2420 </span><span class="lineNoCov">          0 :           k++;</span></a>
<a name="2421"><span class="lineNum">    2421 </span>            :         }</a>
<a name="2422"><span class="lineNum">    2422 </span>            :       }</a>
<a name="2423"><span class="lineNum">    2423 </span>            :     }</a>
<a name="2424"><span class="lineNum">    2424 </span><span class="lineNoCov">          0 :     qh_settempfree(qh, &amp;tested);</span></a>
<a name="2425"><span class="lineNum">    2425 </span><span class="lineNoCov">          0 :     qh_maxsimplex(qh, dim, maxpoints, points, numpoints, &amp;simplex);</span></a>
<a name="2426"><span class="lineNum">    2426 </span>            :   }else /* qh.hull_dim &lt; qh_INITIALmax */</a>
<a name="2427"><span class="lineNum">    2427 </span><span class="lineCov">          9 :     qh_maxsimplex(qh, dim, maxpoints, points, numpoints, &amp;simplex);</span></a>
<a name="2428"><span class="lineNum">    2428 </span><span class="lineCov">         45 :   FOREACHpoint_(simplex)</span></a>
<a name="2429"><span class="lineNum">    2429 </span><span class="lineCov">         36 :     qh_setaddnth(qh, &amp;vertices, 0, qh_newvertex(qh, point)); /* descending order */</span></a>
<a name="2430"><span class="lineNum">    2430 </span><span class="lineCov">          9 :   qh_settempfree(qh, &amp;simplex);</span></a>
<a name="2431"><span class="lineNum">    2431 </span><span class="lineCov">          9 :   return vertices;</span></a>
<a name="2432"><span class="lineNum">    2432 </span>            : } /* initialvertices */</a>
<a name="2433"><span class="lineNum">    2433 </span>            : </a>
<a name="2434"><span class="lineNum">    2434 </span>            : </a>
<a name="2435"><span class="lineNum">    2435 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="2436"><span class="lineNum">    2436 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;isvertex&quot;&gt;-&lt;/a&gt;</a>
<a name="2437"><span class="lineNum">    2437 </span>            : </a>
<a name="2438"><span class="lineNum">    2438 </span>            :   qh_isvertex( point, vertices )</a>
<a name="2439"><span class="lineNum">    2439 </span>            :     returns vertex if point is in vertex set, else returns NULL</a>
<a name="2440"><span class="lineNum">    2440 </span>            : </a>
<a name="2441"><span class="lineNum">    2441 </span>            :   notes:</a>
<a name="2442"><span class="lineNum">    2442 </span>            :     for qh.GOODvertex</a>
<a name="2443"><span class="lineNum">    2443 </span>            : */</a>
<a name="2444"><span class="lineNum">    2444 </span><span class="lineNoCov">          0 : vertexT *qh_isvertex(pointT *point, setT *vertices) {</span></a>
<a name="2445"><span class="lineNum">    2445 </span>            :   vertexT *vertex, **vertexp;</a>
<a name="2446"><span class="lineNum">    2446 </span>            : </a>
<a name="2447"><span class="lineNum">    2447 </span><span class="lineNoCov">          0 :   FOREACHvertex_(vertices) {</span></a>
<a name="2448"><span class="lineNum">    2448 </span><span class="lineNoCov">          0 :     if (vertex-&gt;point == point)</span></a>
<a name="2449"><span class="lineNum">    2449 </span><span class="lineNoCov">          0 :       return vertex;</span></a>
<a name="2450"><span class="lineNum">    2450 </span>            :   }</a>
<a name="2451"><span class="lineNum">    2451 </span><span class="lineNoCov">          0 :   return NULL;</span></a>
<a name="2452"><span class="lineNum">    2452 </span>            : } /* isvertex */</a>
<a name="2453"><span class="lineNum">    2453 </span>            : </a>
<a name="2454"><span class="lineNum">    2454 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="2455"><span class="lineNum">    2455 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;makenewfacets&quot;&gt;-&lt;/a&gt;</a>
<a name="2456"><span class="lineNum">    2456 </span>            : </a>
<a name="2457"><span class="lineNum">    2457 </span>            :   qh_makenewfacets(qh, point )</a>
<a name="2458"><span class="lineNum">    2458 </span>            :     make new facets from point and qh.visible_list</a>
<a name="2459"><span class="lineNum">    2459 </span>            : </a>
<a name="2460"><span class="lineNum">    2460 </span>            :   returns:</a>
<a name="2461"><span class="lineNum">    2461 </span>            :     apex (point) of the new facets</a>
<a name="2462"><span class="lineNum">    2462 </span>            :     qh.newfacet_list= list of new facets with hyperplanes and -&gt;newfacet</a>
<a name="2463"><span class="lineNum">    2463 </span>            :     qh.newvertex_list= list of vertices in new facets with -&gt;newfacet set</a>
<a name="2464"><span class="lineNum">    2464 </span>            : </a>
<a name="2465"><span class="lineNum">    2465 </span>            :     if (qh.NEWtentative)</a>
<a name="2466"><span class="lineNum">    2466 </span>            :       newfacets reference horizon facets, but not vice versa</a>
<a name="2467"><span class="lineNum">    2467 </span>            :       ridges reference non-simplicial horizon ridges, but not vice versa</a>
<a name="2468"><span class="lineNum">    2468 </span>            :       does not change existing facets</a>
<a name="2469"><span class="lineNum">    2469 </span>            :     else</a>
<a name="2470"><span class="lineNum">    2470 </span>            :       sets qh.NEWfacets</a>
<a name="2471"><span class="lineNum">    2471 </span>            :       new facets attached to horizon facets and ridges</a>
<a name="2472"><span class="lineNum">    2472 </span>            :       for visible facets,</a>
<a name="2473"><span class="lineNum">    2473 </span>            :         visible-&gt;r.replace is corresponding new facet</a>
<a name="2474"><span class="lineNum">    2474 </span>            : </a>
<a name="2475"><span class="lineNum">    2475 </span>            :   see also:</a>
<a name="2476"><span class="lineNum">    2476 </span>            :     qh_makenewplanes() -- make hyperplanes for facets</a>
<a name="2477"><span class="lineNum">    2477 </span>            :     qh_attachnewfacets() -- attachnewfacets if not done here qh-&gt;NEWtentative</a>
<a name="2478"><span class="lineNum">    2478 </span>            :     qh_matchnewfacets() -- match up neighbors</a>
<a name="2479"><span class="lineNum">    2479 </span>            :     qh_update_vertexneighbors() -- update vertex neighbors and delvertices</a>
<a name="2480"><span class="lineNum">    2480 </span>            :     qh_deletevisible() -- delete visible facets</a>
<a name="2481"><span class="lineNum">    2481 </span>            :     qh_checkpolygon() --check the result</a>
<a name="2482"><span class="lineNum">    2482 </span>            :     qh_triangulate() -- triangulate a non-simplicial facet</a>
<a name="2483"><span class="lineNum">    2483 </span>            : </a>
<a name="2484"><span class="lineNum">    2484 </span>            :   design:</a>
<a name="2485"><span class="lineNum">    2485 </span>            :     for each visible facet</a>
<a name="2486"><span class="lineNum">    2486 </span>            :       make new facets to its horizon facets</a>
<a name="2487"><span class="lineNum">    2487 </span>            :       update its f.replace</a>
<a name="2488"><span class="lineNum">    2488 </span>            :       clear its neighbor set</a>
<a name="2489"><span class="lineNum">    2489 </span>            : */</a>
<a name="2490"><span class="lineNum">    2490 </span><span class="lineCov">      14670 : vertexT *qh_makenewfacets(qhT *qh, pointT *point /* qh.visible_list */) {</span></a>
<a name="2491"><span class="lineNum">    2491 </span><span class="lineCov">      14670 :   facetT *visible, *newfacet= NULL, *newfacet2= NULL, *neighbor, **neighborp;</span></a>
<a name="2492"><span class="lineNum">    2492 </span>            :   vertexT *apex;</a>
<a name="2493"><span class="lineNum">    2493 </span><span class="lineCov">      14670 :   int numnew=0;</span></a>
<a name="2494"><span class="lineNum">    2494 </span>            : </a>
<a name="2495"><span class="lineNum">    2495 </span><span class="lineCov">      14670 :   if (qh-&gt;CHECKfrequently) {</span></a>
<a name="2496"><span class="lineNum">    2496 </span><span class="lineNoCov">          0 :     qh_checkdelridge(qh);</span></a>
<a name="2497"><span class="lineNum">    2497 </span>            :   }</a>
<a name="2498"><span class="lineNum">    2498 </span><span class="lineCov">      14670 :   qh-&gt;newfacet_list= qh-&gt;facet_tail;</span></a>
<a name="2499"><span class="lineNum">    2499 </span><span class="lineCov">      14670 :   qh-&gt;newvertex_list= qh-&gt;vertex_tail;</span></a>
<a name="2500"><span class="lineNum">    2500 </span><span class="lineCov">      14670 :   apex= qh_newvertex(qh, point);</span></a>
<a name="2501"><span class="lineNum">    2501 </span><span class="lineCov">      14670 :   qh_appendvertex(qh, apex);</span></a>
<a name="2502"><span class="lineNum">    2502 </span><span class="lineCov">      14670 :   qh-&gt;visit_id++;</span></a>
<a name="2503"><span class="lineNum">    2503 </span><span class="lineCov">      53589 :   FORALLvisible_facets {</span></a>
<a name="2504"><span class="lineNum">    2504 </span><span class="lineCov">     160856 :     FOREACHneighbor_(visible)</span></a>
<a name="2505"><span class="lineNum">    2505 </span><span class="lineCov">     121937 :       neighbor-&gt;seen= False;</span></a>
<a name="2506"><span class="lineNum">    2506 </span><span class="lineCov">      38919 :     if (visible-&gt;ridges) {</span></a>
<a name="2507"><span class="lineNum">    2507 </span><span class="lineCov">      17675 :       visible-&gt;visitid= qh-&gt;visit_id;</span></a>
<a name="2508"><span class="lineNum">    2508 </span><span class="lineCov">      17675 :       newfacet2= qh_makenew_nonsimplicial(qh, visible, apex, &amp;numnew);</span></a>
<a name="2509"><span class="lineNum">    2509 </span>            :     }</a>
<a name="2510"><span class="lineNum">    2510 </span><span class="lineCov">      38919 :     if (visible-&gt;simplicial)</span></a>
<a name="2511"><span class="lineNum">    2511 </span><span class="lineCov">      34075 :       newfacet= qh_makenew_simplicial(qh, visible, apex, &amp;numnew);</span></a>
<a name="2512"><span class="lineNum">    2512 </span><span class="lineCov">      38919 :     if (!qh-&gt;NEWtentative) {</span></a>
<a name="2513"><span class="lineNum">    2513 </span><span class="lineCov">      38919 :       if (newfacet2)  /* newfacet is null if all ridges defined */</span></a>
<a name="2514"><span class="lineNum">    2514 </span><span class="lineCov">      17500 :         newfacet= newfacet2;</span></a>
<a name="2515"><span class="lineNum">    2515 </span><span class="lineCov">      38919 :       if (newfacet)</span></a>
<a name="2516"><span class="lineNum">    2516 </span><span class="lineCov">      38105 :         visible-&gt;f.replace= newfacet;</span></a>
<a name="2517"><span class="lineNum">    2517 </span>            :       else</a>
<a name="2518"><span class="lineNum">    2518 </span><span class="lineCov">        814 :         zinc_(Zinsidevisible);</span></a>
<a name="2519"><span class="lineNum">    2519 </span><span class="lineCov">      38919 :       if (visible-&gt;ridges)      /* ridges and neighbors are no longer valid for visible facet */</span></a>
<a name="2520"><span class="lineNum">    2520 </span><span class="lineCov">      17675 :         SETfirst_(visible-&gt;ridges)= NULL;</span></a>
<a name="2521"><span class="lineNum">    2521 </span><span class="lineCov">      38919 :       SETfirst_(visible-&gt;neighbors)= NULL;</span></a>
<a name="2522"><span class="lineNum">    2522 </span>            :     }</a>
<a name="2523"><span class="lineNum">    2523 </span>            :   }</a>
<a name="2524"><span class="lineNum">    2524 </span><span class="lineCov">      14670 :   if (!qh-&gt;NEWtentative)</span></a>
<a name="2525"><span class="lineNum">    2525 </span><span class="lineCov">      14670 :     qh-&gt;NEWfacets= True;</span></a>
<a name="2526"><span class="lineNum">    2526 </span><span class="lineCov">      14670 :   trace1((qh, qh-&gt;ferr, 1032, &quot;qh_makenewfacets: created %d new facets f%d..f%d from point p%d to horizon\n&quot;,</span></a>
<a name="2527"><span class="lineNum">    2527 </span>            :     numnew, qh-&gt;first_newfacet, qh-&gt;facet_id-1, qh_pointid(qh, point)));</a>
<a name="2528"><span class="lineNum">    2528 </span><span class="lineCov">      14670 :   if (qh-&gt;IStracing &gt;= 4)</span></a>
<a name="2529"><span class="lineNum">    2529 </span><span class="lineNoCov">          0 :     qh_printfacetlist(qh, qh-&gt;newfacet_list, NULL, qh_ALL);</span></a>
<a name="2530"><span class="lineNum">    2530 </span><span class="lineCov">      14670 :   return apex;</span></a>
<a name="2531"><span class="lineNum">    2531 </span>            : } /* makenewfacets */</a>
<a name="2532"><span class="lineNum">    2532 </span>            : </a>
<a name="2533"><span class="lineNum">    2533 </span>            : #ifndef qh_NOmerge</a>
<a name="2534"><span class="lineNum">    2534 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="2535"><span class="lineNum">    2535 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;matchdupridge&quot;&gt;-&lt;/a&gt;</a>
<a name="2536"><span class="lineNum">    2536 </span>            : </a>
<a name="2537"><span class="lineNum">    2537 </span>            :   qh_matchdupridge(qh, atfacet, atskip, hashsize, hashcount )</a>
<a name="2538"><span class="lineNum">    2538 </span>            :     match duplicate ridges in qh.hash_table for atfacet@atskip</a>
<a name="2539"><span class="lineNum">    2539 </span>            :     duplicates marked with -&gt;dupridge and qh_DUPLICATEridge</a>
<a name="2540"><span class="lineNum">    2540 </span>            : </a>
<a name="2541"><span class="lineNum">    2541 </span>            :   returns:</a>
<a name="2542"><span class="lineNum">    2542 </span>            :     vertex-facet distance (&gt;0.0) for qh_MERGEridge ridge</a>
<a name="2543"><span class="lineNum">    2543 </span>            :     updates hashcount</a>
<a name="2544"><span class="lineNum">    2544 </span>            :     set newfacet, facet, matchfacet's hyperplane (removes from mergecycle of coplanarhorizon facets)</a>
<a name="2545"><span class="lineNum">    2545 </span>            : </a>
<a name="2546"><span class="lineNum">    2546 </span>            :   see also:</a>
<a name="2547"><span class="lineNum">    2547 </span>            :     qh_matchneighbor</a>
<a name="2548"><span class="lineNum">    2548 </span>            : </a>
<a name="2549"><span class="lineNum">    2549 </span>            :   notes:</a>
<a name="2550"><span class="lineNum">    2550 </span>            :     only called by qh_matchnewfacets for qh_buildcone and qh_triangulate_facet</a>
<a name="2551"><span class="lineNum">    2551 </span>            :     assumes atfacet is simplicial</a>
<a name="2552"><span class="lineNum">    2552 </span>            :     assumes atfacet-&gt;neighbors @ atskip == qh_DUPLICATEridge</a>
<a name="2553"><span class="lineNum">    2553 </span>            :     usually keeps ridge with the widest merge</a>
<a name="2554"><span class="lineNum">    2554 </span>            :     both MRGdupridge and MRGflipped are required merges -- rbox 100 C1,2e-13 D4 t1 | qhull d Qbb</a>
<a name="2555"><span class="lineNum">    2555 </span>            :       can merge flipped f11842 skip 3 into f11862 skip 2 and vice versa (forced by goodmatch/goodmatch2)</a>
<a name="2556"><span class="lineNum">    2556 </span>            :          blocks -- cannot merge f11862 skip 2 and f11863 skip2 (the widest merge)</a>
<a name="2557"><span class="lineNum">    2557 </span>            :          must block -- can merge f11843 skip 3 into f11842 flipped skip 3, but not vice versa</a>
<a name="2558"><span class="lineNum">    2558 </span>            :       can merge f11843 skip 3 into f11863 skip 2, but not vice versa</a>
<a name="2559"><span class="lineNum">    2559 </span>            :     working/unused.h: [jan'19] Dropped qh_matchdupridge_coplanarhorizon, it was the same or slightly worse.  Complex addition, rarely occurs</a>
<a name="2560"><span class="lineNum">    2560 </span>            : </a>
<a name="2561"><span class="lineNum">    2561 </span>            :   design:</a>
<a name="2562"><span class="lineNum">    2562 </span>            :     compute hash value for atfacet and atskip</a>
<a name="2563"><span class="lineNum">    2563 </span>            :     repeat twice -- once to make best matches, once to match the rest</a>
<a name="2564"><span class="lineNum">    2564 </span>            :       for each possible facet in qh.hash_table</a>
<a name="2565"><span class="lineNum">    2565 </span>            :         if it is a matching facet with the same orientation and pass 2</a>
<a name="2566"><span class="lineNum">    2566 </span>            :           make match</a>
<a name="2567"><span class="lineNum">    2567 </span>            :           unless tricoplanar, mark match for merging (qh_MERGEridge)</a>
<a name="2568"><span class="lineNum">    2568 </span>            :           [e.g., tricoplanar RBOX s 1000 t993602376 | QHULL C-1e-3 d Qbb FA Qt]</a>
<a name="2569"><span class="lineNum">    2569 </span>            :         if it is a matching facet with the same orientation and pass 1</a>
<a name="2570"><span class="lineNum">    2570 </span>            :           test if this is a better match</a>
<a name="2571"><span class="lineNum">    2571 </span>            :       if pass 1,</a>
<a name="2572"><span class="lineNum">    2572 </span>            :         make best match (it will not be merged)</a>
<a name="2573"><span class="lineNum">    2573 </span>            :         set newfacet, facet, matchfacet's hyperplane (removes from mergecycle of coplanarhorizon facets)</a>
<a name="2574"><span class="lineNum">    2574 </span>            : </a>
<a name="2575"><span class="lineNum">    2575 </span>            : */</a>
<a name="2576"><span class="lineNum">    2576 </span><span class="lineNoCov">          0 : coordT qh_matchdupridge(qhT *qh, facetT *atfacet, int atskip, int hashsize, int *hashcount) {</span></a>
<a name="2577"><span class="lineNum">    2577 </span><span class="lineNoCov">          0 :   boolT same, ismatch, isduplicate= False;</span></a>
<a name="2578"><span class="lineNum">    2578 </span>            :   int hash, scan;</a>
<a name="2579"><span class="lineNum">    2579 </span>            :   facetT *facet, *newfacet, *nextfacet;</a>
<a name="2580"><span class="lineNum">    2580 </span><span class="lineNoCov">          0 :   facetT *maxmatch= NULL, *maxmatch2= NULL, *goodmatch= NULL, *goodmatch2= NULL;</span></a>
<a name="2581"><span class="lineNum">    2581 </span><span class="lineNoCov">          0 :   int skip, newskip, nextskip= 0, makematch;</span></a>
<a name="2582"><span class="lineNum">    2582 </span><span class="lineNoCov">          0 :   int maxskip= 0, maxskip2= 0, goodskip= 0, goodskip2= 0;</span></a>
<a name="2583"><span class="lineNum">    2583 </span><span class="lineNoCov">          0 :   coordT maxdist= -REALmax, maxdist2= 0.0, dupdist, dupdist2, low, high, maxgood, gooddist= 0.0;</span></a>
<a name="2584"><span class="lineNum">    2584 </span>            : </a>
<a name="2585"><span class="lineNum">    2585 </span><span class="lineNoCov">          0 :   maxgood= qh_WIDEdupridge * (qh-&gt;ONEmerge + qh-&gt;DISTround);</span></a>
<a name="2586"><span class="lineNum">    2586 </span><span class="lineNoCov">          0 :   hash= qh_gethash(qh, hashsize, atfacet-&gt;vertices, qh-&gt;hull_dim, 1,</span></a>
<a name="2587"><span class="lineNum">    2587 </span><span class="lineNoCov">          0 :                      SETelem_(atfacet-&gt;vertices, atskip));</span></a>
<a name="2588"><span class="lineNum">    2588 </span><span class="lineNoCov">          0 :   trace2((qh, qh-&gt;ferr, 2046, &quot;qh_matchdupridge: find dupridge matches for f%d skip %d hash %d hashcount %d\n&quot;,</span></a>
<a name="2589"><span class="lineNum">    2589 </span>            :           atfacet-&gt;id, atskip, hash, *hashcount));</a>
<a name="2590"><span class="lineNum">    2590 </span><span class="lineNoCov">          0 :   for (makematch=0; makematch &lt; 2; makematch++) { /* makematch is false on the first pass and 1 on the second */</span></a>
<a name="2591"><span class="lineNum">    2591 </span><span class="lineNoCov">          0 :     qh-&gt;visit_id++;</span></a>
<a name="2592"><span class="lineNum">    2592 </span><span class="lineNoCov">          0 :     for (newfacet=atfacet, newskip=atskip; newfacet; newfacet= nextfacet, newskip= nextskip) {</span></a>
<a name="2593"><span class="lineNum">    2593 </span><span class="lineNoCov">          0 :       zinc_(Zhashlookup);</span></a>
<a name="2594"><span class="lineNum">    2594 </span><span class="lineNoCov">          0 :       nextfacet= NULL; /* exit when ismatch found */</span></a>
<a name="2595"><span class="lineNum">    2595 </span><span class="lineNoCov">          0 :       newfacet-&gt;visitid= qh-&gt;visit_id;</span></a>
<a name="2596"><span class="lineNum">    2596 </span><span class="lineNoCov">          0 :       for (scan=hash; (facet= SETelemt_(qh-&gt;hash_table, scan, facetT));</span></a>
<a name="2597"><span class="lineNum">    2597 </span><span class="lineNoCov">          0 :            scan= (++scan &gt;= hashsize ? 0 : scan)) {</span></a>
<a name="2598"><span class="lineNum">    2598 </span><span class="lineNoCov">          0 :         if (!facet-&gt;dupridge || facet-&gt;visitid == qh-&gt;visit_id)</span></a>
<a name="2599"><span class="lineNum">    2599 </span><span class="lineNoCov">          0 :           continue;</span></a>
<a name="2600"><span class="lineNum">    2600 </span><span class="lineNoCov">          0 :         zinc_(Zhashtests);</span></a>
<a name="2601"><span class="lineNum">    2601 </span><span class="lineNoCov">          0 :         if (qh_matchvertices(qh, 1, newfacet-&gt;vertices, newskip, facet-&gt;vertices, &amp;skip, &amp;same)) {</span></a>
<a name="2602"><span class="lineNum">    2602 </span><span class="lineNoCov">          0 :           if (SETelem_(newfacet-&gt;vertices, newskip) == SETelem_(facet-&gt;vertices, skip)) {</span></a>
<a name="2603"><span class="lineNum">    2603 </span><span class="lineNoCov">          0 :             trace3((qh, qh-&gt;ferr, 3053, &quot;qh_matchdupridge: duplicate ridge due to duplicate facets (f%d skip %d and f%d skip %d) previously reported as QH7084.  Maximize dupdist to force vertex merge\n&quot;,</span></a>
<a name="2604"><span class="lineNum">    2604 </span>            :               newfacet-&gt;id, newskip, facet-&gt;id, skip));</a>
<a name="2605"><span class="lineNum">    2605 </span><span class="lineNoCov">          0 :             isduplicate= True;</span></a>
<a name="2606"><span class="lineNum">    2606 </span>            :           }</a>
<a name="2607"><span class="lineNum">    2607 </span><span class="lineNoCov">          0 :           ismatch= (same == (boolT)(newfacet-&gt;toporient ^ facet-&gt;toporient));</span></a>
<a name="2608"><span class="lineNum">    2608 </span><span class="lineNoCov">          0 :           if (SETelemt_(facet-&gt;neighbors, skip, facetT) != qh_DUPLICATEridge) {</span></a>
<a name="2609"><span class="lineNum">    2609 </span><span class="lineNoCov">          0 :             if (!makematch) {  /* occurs if many merges, e.g., rbox 100 W0 C2,1e-13 D6 t1546872462 | qhull C0 Qt Tcv */</span></a>
<a name="2610"><span class="lineNum">    2610 </span><span class="lineNoCov">          0 :               qh_fprintf(qh, qh-&gt;ferr, 6155, &quot;qhull topology error (qh_matchdupridge): missing qh_DUPLICATEridge at f%d skip %d for new f%d skip %d hash %d ismatch %d.  Set by qh_matchneighbor\n&quot;,</span></a>
<a name="2611"><span class="lineNum">    2611 </span>            :                 facet-&gt;id, skip, newfacet-&gt;id, newskip, hash, ismatch);</a>
<a name="2612"><span class="lineNum">    2612 </span><span class="lineNoCov">          0 :               qh_errexit2(qh, qh_ERRtopology, facet, newfacet);</span></a>
<a name="2613"><span class="lineNum">    2613 </span>            :             }</a>
<a name="2614"><span class="lineNum">    2614 </span><span class="lineNoCov">          0 :           }else if (!ismatch) {</span></a>
<a name="2615"><span class="lineNum">    2615 </span><span class="lineNoCov">          0 :             nextfacet= facet;</span></a>
<a name="2616"><span class="lineNum">    2616 </span><span class="lineNoCov">          0 :             nextskip= skip;</span></a>
<a name="2617"><span class="lineNum">    2617 </span><span class="lineNoCov">          0 :           }else if (SETelemt_(newfacet-&gt;neighbors, newskip, facetT) == qh_DUPLICATEridge) {</span></a>
<a name="2618"><span class="lineNum">    2618 </span><span class="lineNoCov">          0 :             if (makematch) {</span></a>
<a name="2619"><span class="lineNum">    2619 </span><span class="lineNoCov">          0 :               if (newfacet-&gt;tricoplanar) {</span></a>
<a name="2620"><span class="lineNum">    2620 </span><span class="lineNoCov">          0 :                 SETelem_(facet-&gt;neighbors, skip)= newfacet;</span></a>
<a name="2621"><span class="lineNum">    2621 </span><span class="lineNoCov">          0 :                 SETelem_(newfacet-&gt;neighbors, newskip)= facet;</span></a>
<a name="2622"><span class="lineNum">    2622 </span><span class="lineNoCov">          0 :                 *hashcount -= 2; /* removed two unmatched facets */</span></a>
<a name="2623"><span class="lineNum">    2623 </span><span class="lineNoCov">          0 :                 trace2((qh, qh-&gt;ferr, 2075, &quot;qh_matchdupridge: allow tricoplanar dupridge for new f%d skip %d and f%d skip %d\n&quot;,</span></a>
<a name="2624"><span class="lineNum">    2624 </span>            :                     newfacet-&gt;id, newskip, facet-&gt;id, skip));</a>
<a name="2625"><span class="lineNum">    2625 </span><span class="lineNoCov">          0 :               }else if (goodmatch &amp;&amp; goodmatch2) {</span></a>
<a name="2626"><span class="lineNum">    2626 </span><span class="lineNoCov">          0 :                 SETelem_(goodmatch2-&gt;neighbors, goodskip2)= qh_MERGEridge;  /* undo selection of goodmatch */</span></a>
<a name="2627"><span class="lineNum">    2627 </span><span class="lineNoCov">          0 :                 SETelem_(facet-&gt;neighbors, skip)= newfacet;</span></a>
<a name="2628"><span class="lineNum">    2628 </span><span class="lineNoCov">          0 :                 SETelem_(newfacet-&gt;neighbors, newskip)= facet;</span></a>
<a name="2629"><span class="lineNum">    2629 </span><span class="lineNoCov">          0 :                 *hashcount -= 2; /* removed two unmatched facets */</span></a>
<a name="2630"><span class="lineNum">    2630 </span><span class="lineNoCov">          0 :                 trace2((qh, qh-&gt;ferr, 2105, &quot;qh_matchdupridge: make good forced merge of dupridge f%d skip %d into f%d skip %d, keep new f%d skip %d and f%d skip %d, dist %4.4g\n&quot;,</span></a>
<a name="2631"><span class="lineNum">    2631 </span>            :                   goodmatch-&gt;id, goodskip, goodmatch2-&gt;id, goodskip2, newfacet-&gt;id, newskip, facet-&gt;id, skip, gooddist));</a>
<a name="2632"><span class="lineNum">    2632 </span><span class="lineNoCov">          0 :                 goodmatch2= NULL;</span></a>
<a name="2633"><span class="lineNum">    2633 </span>            :               }else {</a>
<a name="2634"><span class="lineNum">    2634 </span><span class="lineNoCov">          0 :                 SETelem_(facet-&gt;neighbors, skip)= newfacet;</span></a>
<a name="2635"><span class="lineNum">    2635 </span><span class="lineNoCov">          0 :                 SETelem_(newfacet-&gt;neighbors, newskip)= qh_MERGEridge;  /* resolved by qh_mark_dupridges */</span></a>
<a name="2636"><span class="lineNum">    2636 </span><span class="lineNoCov">          0 :                 *hashcount -= 2; /* removed two unmatched facets */</span></a>
<a name="2637"><span class="lineNum">    2637 </span><span class="lineNoCov">          0 :                 trace3((qh, qh-&gt;ferr, 3073, &quot;qh_matchdupridge: make forced merge of dupridge for new f%d skip %d and f%d skip %d, maxdist %4.4g in qh_forcedmerges\n&quot;,</span></a>
<a name="2638"><span class="lineNum">    2638 </span>            :                   newfacet-&gt;id, newskip, facet-&gt;id, skip, maxdist2));</a>
<a name="2639"><span class="lineNum">    2639 </span>            :               }</a>
<a name="2640"><span class="lineNum">    2640 </span>            :             }else { /* !makematch */</a>
<a name="2641"><span class="lineNum">    2641 </span><span class="lineNoCov">          0 :               if (!facet-&gt;normal)</span></a>
<a name="2642"><span class="lineNum">    2642 </span><span class="lineNoCov">          0 :                 qh_setfacetplane(qh, facet); /* qh_mergecycle will ignore 'mergehorizon' facets with normals, too many cases otherwise */</span></a>
<a name="2643"><span class="lineNum">    2643 </span><span class="lineNoCov">          0 :               if (!newfacet-&gt;normal)</span></a>
<a name="2644"><span class="lineNum">    2644 </span><span class="lineNoCov">          0 :                 qh_setfacetplane(qh, newfacet);</span></a>
<a name="2645"><span class="lineNum">    2645 </span><span class="lineNoCov">          0 :               dupdist= qh_getdistance(qh, facet, newfacet, &amp;low, &amp;high); /* ignore low/high */</span></a>
<a name="2646"><span class="lineNum">    2646 </span><span class="lineNoCov">          0 :               dupdist2= qh_getdistance(qh, newfacet, facet, &amp;low, &amp;high);</span></a>
<a name="2647"><span class="lineNum">    2647 </span><span class="lineNoCov">          0 :               if (isduplicate) {</span></a>
<a name="2648"><span class="lineNum">    2648 </span><span class="lineNoCov">          0 :                 goodmatch= NULL;</span></a>
<a name="2649"><span class="lineNum">    2649 </span><span class="lineNoCov">          0 :                 minimize_(dupdist, dupdist2);</span></a>
<a name="2650"><span class="lineNum">    2650 </span><span class="lineNoCov">          0 :                 maxdist= dupdist;</span></a>
<a name="2651"><span class="lineNum">    2651 </span><span class="lineNoCov">          0 :                 maxdist2= REALmax/2;</span></a>
<a name="2652"><span class="lineNum">    2652 </span><span class="lineNoCov">          0 :                 maxmatch= facet;</span></a>
<a name="2653"><span class="lineNum">    2653 </span><span class="lineNoCov">          0 :                 maxskip= skip;</span></a>
<a name="2654"><span class="lineNum">    2654 </span><span class="lineNoCov">          0 :                 maxmatch2= newfacet;</span></a>
<a name="2655"><span class="lineNum">    2655 </span><span class="lineNoCov">          0 :                 maxskip2= newskip;</span></a>
<a name="2656"><span class="lineNum">    2656 </span><span class="lineNoCov">          0 :                 break; /* force maxmatch */</span></a>
<a name="2657"><span class="lineNum">    2657 </span><span class="lineNoCov">          0 :               }else if (facet-&gt;flipped &amp;&amp; !newfacet-&gt;flipped &amp;&amp; dupdist &lt; maxgood) {</span></a>
<a name="2658"><span class="lineNum">    2658 </span><span class="lineNoCov">          0 :                 if (!goodmatch || !goodmatch-&gt;flipped || dupdist &lt; gooddist) {</span></a>
<a name="2659"><span class="lineNum">    2659 </span><span class="lineNoCov">          0 :                   goodmatch= facet;</span></a>
<a name="2660"><span class="lineNum">    2660 </span><span class="lineNoCov">          0 :                   goodskip= skip;</span></a>
<a name="2661"><span class="lineNum">    2661 </span><span class="lineNoCov">          0 :                   goodmatch2= newfacet;</span></a>
<a name="2662"><span class="lineNum">    2662 </span><span class="lineNoCov">          0 :                   goodskip2= newskip;</span></a>
<a name="2663"><span class="lineNum">    2663 </span><span class="lineNoCov">          0 :                   gooddist= dupdist;</span></a>
<a name="2664"><span class="lineNum">    2664 </span><span class="lineNoCov">          0 :                   trace3((qh, qh-&gt;ferr, 3070, &quot;qh_matchdupridge: try good dupridge flipped f%d skip %d into new f%d skip %d at dist %2.2g otherdist %2.2g\n&quot;,</span></a>
<a name="2665"><span class="lineNum">    2665 </span>            :                     goodmatch-&gt;id, goodskip, goodmatch2-&gt;id, goodskip2, gooddist, dupdist2));</a>
<a name="2666"><span class="lineNum">    2666 </span>            :                 }</a>
<a name="2667"><span class="lineNum">    2667 </span><span class="lineNoCov">          0 :               }else if (newfacet-&gt;flipped &amp;&amp; !facet-&gt;flipped &amp;&amp; dupdist2 &lt; maxgood) {</span></a>
<a name="2668"><span class="lineNum">    2668 </span><span class="lineNoCov">          0 :                 if (!goodmatch || !goodmatch-&gt;flipped || dupdist2 &lt; gooddist) {</span></a>
<a name="2669"><span class="lineNum">    2669 </span><span class="lineNoCov">          0 :                   goodmatch= newfacet;</span></a>
<a name="2670"><span class="lineNum">    2670 </span><span class="lineNoCov">          0 :                   goodskip= newskip;</span></a>
<a name="2671"><span class="lineNum">    2671 </span><span class="lineNoCov">          0 :                   goodmatch2= facet;</span></a>
<a name="2672"><span class="lineNum">    2672 </span><span class="lineNoCov">          0 :                   goodskip2= skip;</span></a>
<a name="2673"><span class="lineNum">    2673 </span><span class="lineNoCov">          0 :                   gooddist= dupdist2;</span></a>
<a name="2674"><span class="lineNum">    2674 </span><span class="lineNoCov">          0 :                   trace3((qh, qh-&gt;ferr, 3071, &quot;qh_matchdupridge: try good dupridge flipped new f%d skip %d into f%d skip %d at dist %2.2g otherdist %2.2g\n&quot;,</span></a>
<a name="2675"><span class="lineNum">    2675 </span>            :                     goodmatch-&gt;id, goodskip, goodmatch2-&gt;id, goodskip2, gooddist, dupdist));</a>
<a name="2676"><span class="lineNum">    2676 </span>            :                 }</a>
<a name="2677"><span class="lineNum">    2677 </span><span class="lineNoCov">          0 :               }else if (dupdist &lt; maxgood &amp;&amp; (!newfacet-&gt;flipped || facet-&gt;flipped)) { /* disallow not-flipped-&gt;flipped */</span></a>
<a name="2678"><span class="lineNum">    2678 </span><span class="lineNoCov">          0 :                 if (!goodmatch || (!goodmatch-&gt;flipped &amp;&amp; dupdist &lt; gooddist)) {</span></a>
<a name="2679"><span class="lineNum">    2679 </span><span class="lineNoCov">          0 :                   goodmatch= facet;</span></a>
<a name="2680"><span class="lineNum">    2680 </span><span class="lineNoCov">          0 :                   goodskip= skip;</span></a>
<a name="2681"><span class="lineNum">    2681 </span><span class="lineNoCov">          0 :                   goodmatch2= newfacet;</span></a>
<a name="2682"><span class="lineNum">    2682 </span><span class="lineNoCov">          0 :                   goodskip2= newskip;</span></a>
<a name="2683"><span class="lineNum">    2683 </span><span class="lineNoCov">          0 :                   gooddist= dupdist;</span></a>
<a name="2684"><span class="lineNum">    2684 </span><span class="lineNoCov">          0 :                   trace3((qh, qh-&gt;ferr, 3072, &quot;qh_matchdupridge: try good dupridge f%d skip %d into new f%d skip %d at dist %2.2g otherdist %2.2g\n&quot;,</span></a>
<a name="2685"><span class="lineNum">    2685 </span>            :                     goodmatch-&gt;id, goodskip, goodmatch2-&gt;id, goodskip2, gooddist, dupdist2));</a>
<a name="2686"><span class="lineNum">    2686 </span>            :                 }</a>
<a name="2687"><span class="lineNum">    2687 </span><span class="lineNoCov">          0 :               }else if (dupdist2 &lt; maxgood &amp;&amp; (!facet-&gt;flipped || newfacet-&gt;flipped)) { /* disallow not-flipped-&gt;flipped */</span></a>
<a name="2688"><span class="lineNum">    2688 </span><span class="lineNoCov">          0 :                 if (!goodmatch || (!goodmatch-&gt;flipped &amp;&amp; dupdist2 &lt; gooddist)) {</span></a>
<a name="2689"><span class="lineNum">    2689 </span><span class="lineNoCov">          0 :                   goodmatch= newfacet;</span></a>
<a name="2690"><span class="lineNum">    2690 </span><span class="lineNoCov">          0 :                   goodskip= newskip;</span></a>
<a name="2691"><span class="lineNum">    2691 </span><span class="lineNoCov">          0 :                   goodmatch2= facet;</span></a>
<a name="2692"><span class="lineNum">    2692 </span><span class="lineNoCov">          0 :                   goodskip2= skip;</span></a>
<a name="2693"><span class="lineNum">    2693 </span><span class="lineNoCov">          0 :                   gooddist= dupdist2;</span></a>
<a name="2694"><span class="lineNum">    2694 </span><span class="lineNoCov">          0 :                   trace3((qh, qh-&gt;ferr, 3018, &quot;qh_matchdupridge: try good dupridge new f%d skip %d into f%d skip %d at dist %2.2g otherdist %2.2g\n&quot;,</span></a>
<a name="2695"><span class="lineNum">    2695 </span>            :                     goodmatch-&gt;id, goodskip, goodmatch2-&gt;id, goodskip2, gooddist, dupdist));</a>
<a name="2696"><span class="lineNum">    2696 </span>            :                 }</a>
<a name="2697"><span class="lineNum">    2697 </span><span class="lineNoCov">          0 :               }else if (!goodmatch) { /* otherwise match the furthest apart facets */</span></a>
<a name="2698"><span class="lineNum">    2698 </span><span class="lineNoCov">          0 :                 if (!newfacet-&gt;flipped || facet-&gt;flipped) {</span></a>
<a name="2699"><span class="lineNum">    2699 </span><span class="lineNoCov">          0 :                   minimize_(dupdist, dupdist2);</span></a>
<a name="2700"><span class="lineNum">    2700 </span>            :                 }</a>
<a name="2701"><span class="lineNum">    2701 </span><span class="lineNoCov">          0 :                 if (dupdist &gt; maxdist) { /* could keep !flipped-&gt;flipped, but probably lost anyway */</span></a>
<a name="2702"><span class="lineNum">    2702 </span><span class="lineNoCov">          0 :                   maxdist2= maxdist;</span></a>
<a name="2703"><span class="lineNum">    2703 </span><span class="lineNoCov">          0 :                   maxdist= dupdist;</span></a>
<a name="2704"><span class="lineNum">    2704 </span><span class="lineNoCov">          0 :                   maxmatch= facet;</span></a>
<a name="2705"><span class="lineNum">    2705 </span><span class="lineNoCov">          0 :                   maxskip= skip;</span></a>
<a name="2706"><span class="lineNum">    2706 </span><span class="lineNoCov">          0 :                   maxmatch2= newfacet;</span></a>
<a name="2707"><span class="lineNum">    2707 </span><span class="lineNoCov">          0 :                   maxskip2= newskip;</span></a>
<a name="2708"><span class="lineNum">    2708 </span><span class="lineNoCov">          0 :                   trace3((qh, qh-&gt;ferr, 3055, &quot;qh_matchdupridge: try furthest dupridge f%d skip %d new f%d skip %d at dist %2.2g\n&quot;,</span></a>
<a name="2709"><span class="lineNum">    2709 </span>            :                     maxmatch-&gt;id, maxskip, maxmatch2-&gt;id, maxskip2, maxdist));</a>
<a name="2710"><span class="lineNum">    2710 </span><span class="lineNoCov">          0 :                 }else if (dupdist &gt; maxdist2)</span></a>
<a name="2711"><span class="lineNum">    2711 </span><span class="lineNoCov">          0 :                   maxdist2= dupdist;</span></a>
<a name="2712"><span class="lineNum">    2712 </span>            :               }</a>
<a name="2713"><span class="lineNum">    2713 </span>            :             }</a>
<a name="2714"><span class="lineNum">    2714 </span>            :           }</a>
<a name="2715"><span class="lineNum">    2715 </span>            :         }</a>
<a name="2716"><span class="lineNum">    2716 </span>            :       } /* end of foreach entry in qh.hash_table starting at 'hash' */</a>
<a name="2717"><span class="lineNum">    2717 </span><span class="lineNoCov">          0 :       if (makematch &amp;&amp; SETelemt_(newfacet-&gt;neighbors, newskip, facetT) == qh_DUPLICATEridge) {</span></a>
<a name="2718"><span class="lineNum">    2718 </span><span class="lineNoCov">          0 :         qh_fprintf(qh, qh-&gt;ferr, 6156, &quot;qhull internal error (qh_matchdupridge): no MERGEridge match for dupridge new f%d skip %d at hash %d..%d\n&quot;,</span></a>
<a name="2719"><span class="lineNum">    2719 </span>            :                     newfacet-&gt;id, newskip, hash, scan);</a>
<a name="2720"><span class="lineNum">    2720 </span><span class="lineNoCov">          0 :         qh_errexit(qh, qh_ERRqhull, newfacet, NULL);</span></a>
<a name="2721"><span class="lineNum">    2721 </span>            :       }</a>
<a name="2722"><span class="lineNum">    2722 </span>            :     } /* end of foreach newfacet at 'hash' */</a>
<a name="2723"><span class="lineNum">    2723 </span><span class="lineNoCov">          0 :     if (!makematch) {</span></a>
<a name="2724"><span class="lineNum">    2724 </span><span class="lineNoCov">          0 :       if (goodmatch) {</span></a>
<a name="2725"><span class="lineNum">    2725 </span><span class="lineNoCov">          0 :         SETelem_(goodmatch-&gt;neighbors, goodskip)= goodmatch2;</span></a>
<a name="2726"><span class="lineNum">    2726 </span><span class="lineNoCov">          0 :         SETelem_(goodmatch2-&gt;neighbors, goodskip2)= goodmatch;</span></a>
<a name="2727"><span class="lineNum">    2727 </span><span class="lineNoCov">          0 :         *hashcount -= 2; /* removed two unmatched facets */</span></a>
<a name="2728"><span class="lineNum">    2728 </span><span class="lineNoCov">          0 :         if (goodmatch-&gt;flipped) {</span></a>
<a name="2729"><span class="lineNum">    2729 </span><span class="lineNoCov">          0 :           if (!goodmatch2-&gt;flipped) {</span></a>
<a name="2730"><span class="lineNum">    2730 </span><span class="lineNoCov">          0 :             zzinc_(Zflipridge);</span></a>
<a name="2731"><span class="lineNum">    2731 </span>            :           }else {</a>
<a name="2732"><span class="lineNum">    2732 </span><span class="lineNoCov">          0 :             zzinc_(Zflipridge2);</span></a>
<a name="2733"><span class="lineNum">    2733 </span>            :             /* qh_joggle_restart called by qh_matchneighbor if qh_DUPLICATEridge */</a>
<a name="2734"><span class="lineNum">    2734 </span>            :           }</a>
<a name="2735"><span class="lineNum">    2735 </span>            :         }</a>
<a name="2736"><span class="lineNum">    2736 </span>            :         /* previously traced */</a>
<a name="2737"><span class="lineNum">    2737 </span><span class="lineNoCov">          0 :       }else if (maxmatch) {</span></a>
<a name="2738"><span class="lineNum">    2738 </span><span class="lineNoCov">          0 :         SETelem_(maxmatch-&gt;neighbors, maxskip)= maxmatch2; /* maxmatch!=NULL by QH6157 */</span></a>
<a name="2739"><span class="lineNum">    2739 </span><span class="lineNoCov">          0 :         SETelem_(maxmatch2-&gt;neighbors, maxskip2)= maxmatch;</span></a>
<a name="2740"><span class="lineNum">    2740 </span><span class="lineNoCov">          0 :         *hashcount -= 2; /* removed two unmatched facets */</span></a>
<a name="2741"><span class="lineNum">    2741 </span><span class="lineNoCov">          0 :         zzinc_(Zmultiridge);</span></a>
<a name="2742"><span class="lineNum">    2742 </span>            :         /* qh_joggle_restart called by qh_matchneighbor if qh_DUPLICATEridge */</a>
<a name="2743"><span class="lineNum">    2743 </span><span class="lineNoCov">          0 :         trace0((qh, qh-&gt;ferr, 25, &quot;qh_matchdupridge: keep dupridge f%d skip %d and f%d skip %d, dist %4.4g\n&quot;,</span></a>
<a name="2744"><span class="lineNum">    2744 </span>            :           maxmatch2-&gt;id, maxskip2, maxmatch-&gt;id, maxskip, maxdist));</a>
<a name="2745"><span class="lineNum">    2745 </span>            :       } else {</a>
<a name="2746"><span class="lineNum">    2746 </span><span class="lineNoCov">          0 :         qh_fprintf(qh, qh-&gt;ferr, 6157, &quot;qhull internal error (qh_matchdupridge): no maximum or good match for dupridge new f%d skip %d at hash %d..%d\n&quot;,</span></a>
<a name="2747"><span class="lineNum">    2747 </span>            :           atfacet-&gt;id, atskip, hash, scan);</a>
<a name="2748"><span class="lineNum">    2748 </span><span class="lineNoCov">          0 :         qh_errexit(qh, qh_ERRqhull, atfacet, NULL);</span></a>
<a name="2749"><span class="lineNum">    2749 </span>            :       }</a>
<a name="2750"><span class="lineNum">    2750 </span>            :     }</a>
<a name="2751"><span class="lineNum">    2751 </span>            :   }</a>
<a name="2752"><span class="lineNum">    2752 </span><span class="lineNoCov">          0 :   if (goodmatch)</span></a>
<a name="2753"><span class="lineNum">    2753 </span><span class="lineNoCov">          0 :     return gooddist;</span></a>
<a name="2754"><span class="lineNum">    2754 </span><span class="lineNoCov">          0 :   return maxdist2;</span></a>
<a name="2755"><span class="lineNum">    2755 </span>            : } /* matchdupridge */</a>
<a name="2756"><span class="lineNum">    2756 </span>            : </a>
<a name="2757"><span class="lineNum">    2757 </span>            : #else /* qh_NOmerge */</a>
<a name="2758"><span class="lineNum">    2758 </span>            : coordT qh_matchdupridge(qhT *qh, facetT *atfacet, int atskip, int hashsize, int *hashcount) {</a>
<a name="2759"><span class="lineNum">    2759 </span>            :   QHULL_UNUSED(qh)</a>
<a name="2760"><span class="lineNum">    2760 </span>            :   QHULL_UNUSED(atfacet)</a>
<a name="2761"><span class="lineNum">    2761 </span>            :   QHULL_UNUSED(atskip)</a>
<a name="2762"><span class="lineNum">    2762 </span>            :   QHULL_UNUSED(hashsize)</a>
<a name="2763"><span class="lineNum">    2763 </span>            :   QHULL_UNUSED(hashcount)</a>
<a name="2764"><span class="lineNum">    2764 </span>            : </a>
<a name="2765"><span class="lineNum">    2765 </span>            :   return 0.0;</a>
<a name="2766"><span class="lineNum">    2766 </span>            : }</a>
<a name="2767"><span class="lineNum">    2767 </span>            : #endif /* qh_NOmerge */</a>
<a name="2768"><span class="lineNum">    2768 </span>            : </a>
<a name="2769"><span class="lineNum">    2769 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="2770"><span class="lineNum">    2770 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;nearcoplanar&quot;&gt;-&lt;/a&gt;</a>
<a name="2771"><span class="lineNum">    2771 </span>            : </a>
<a name="2772"><span class="lineNum">    2772 </span>            :   qh_nearcoplanar()</a>
<a name="2773"><span class="lineNum">    2773 </span>            :     for all facets, remove near-inside points from facet-&gt;coplanarset&lt;/li&gt;</a>
<a name="2774"><span class="lineNum">    2774 </span>            :     coplanar points defined by innerplane from qh_outerinner()</a>
<a name="2775"><span class="lineNum">    2775 </span>            : </a>
<a name="2776"><span class="lineNum">    2776 </span>            :   returns:</a>
<a name="2777"><span class="lineNum">    2777 </span>            :     if qh-&gt;KEEPcoplanar &amp;&amp; !qh-&gt;KEEPinside</a>
<a name="2778"><span class="lineNum">    2778 </span>            :       facet-&gt;coplanarset only contains coplanar points</a>
<a name="2779"><span class="lineNum">    2779 </span>            :     if qh.JOGGLEmax</a>
<a name="2780"><span class="lineNum">    2780 </span>            :       drops inner plane by another qh.JOGGLEmax diagonal since a</a>
<a name="2781"><span class="lineNum">    2781 </span>            :         vertex could shift out while a coplanar point shifts in</a>
<a name="2782"><span class="lineNum">    2782 </span>            : </a>
<a name="2783"><span class="lineNum">    2783 </span>            :   notes:</a>
<a name="2784"><span class="lineNum">    2784 </span>            :     used for qh.PREmerge and qh.JOGGLEmax</a>
<a name="2785"><span class="lineNum">    2785 </span>            :     must agree with computation of qh.NEARcoplanar in qh_detroundoff</a>
<a name="2786"><span class="lineNum">    2786 </span>            : </a>
<a name="2787"><span class="lineNum">    2787 </span>            :   design:</a>
<a name="2788"><span class="lineNum">    2788 </span>            :     if not keeping coplanar or inside points</a>
<a name="2789"><span class="lineNum">    2789 </span>            :       free all coplanar sets</a>
<a name="2790"><span class="lineNum">    2790 </span>            :     else if not keeping both coplanar and inside points</a>
<a name="2791"><span class="lineNum">    2791 </span>            :       remove !coplanar or !inside points from coplanar sets</a>
<a name="2792"><span class="lineNum">    2792 </span>            : */</a>
<a name="2793"><span class="lineNum">    2793 </span><span class="lineCov">          8 : void qh_nearcoplanar(qhT *qh /* qh.facet_list */) {</span></a>
<a name="2794"><span class="lineNum">    2794 </span>            :   facetT *facet;</a>
<a name="2795"><span class="lineNum">    2795 </span>            :   pointT *point, **pointp;</a>
<a name="2796"><span class="lineNum">    2796 </span>            :   int numpart;</a>
<a name="2797"><span class="lineNum">    2797 </span>            :   realT dist, innerplane;</a>
<a name="2798"><span class="lineNum">    2798 </span>            : </a>
<a name="2799"><span class="lineNum">    2799 </span><span class="lineCov">          8 :   if (!qh-&gt;KEEPcoplanar &amp;&amp; !qh-&gt;KEEPinside) {</span></a>
<a name="2800"><span class="lineNum">    2800 </span><span class="lineNoCov">          0 :     FORALLfacets {</span></a>
<a name="2801"><span class="lineNum">    2801 </span><span class="lineNoCov">          0 :       if (facet-&gt;coplanarset)</span></a>
<a name="2802"><span class="lineNum">    2802 </span><span class="lineNoCov">          0 :         qh_setfree(qh, &amp;facet-&gt;coplanarset);</span></a>
<a name="2803"><span class="lineNum">    2803 </span>            :     }</a>
<a name="2804"><span class="lineNum">    2804 </span><span class="lineCov">          8 :   }else if (!qh-&gt;KEEPcoplanar || !qh-&gt;KEEPinside) {</span></a>
<a name="2805"><span class="lineNum">    2805 </span><span class="lineNoCov">          0 :     qh_outerinner(qh, NULL, NULL, &amp;innerplane);</span></a>
<a name="2806"><span class="lineNum">    2806 </span><span class="lineNoCov">          0 :     if (qh-&gt;JOGGLEmax &lt; REALmax/2)</span></a>
<a name="2807"><span class="lineNum">    2807 </span><span class="lineNoCov">          0 :       innerplane -= qh-&gt;JOGGLEmax * sqrt((realT)qh-&gt;hull_dim);</span></a>
<a name="2808"><span class="lineNum">    2808 </span><span class="lineNoCov">          0 :     numpart= 0;</span></a>
<a name="2809"><span class="lineNum">    2809 </span><span class="lineNoCov">          0 :     FORALLfacets {</span></a>
<a name="2810"><span class="lineNum">    2810 </span><span class="lineNoCov">          0 :       if (facet-&gt;coplanarset) {</span></a>
<a name="2811"><span class="lineNum">    2811 </span><span class="lineNoCov">          0 :         FOREACHpoint_(facet-&gt;coplanarset) {</span></a>
<a name="2812"><span class="lineNum">    2812 </span><span class="lineNoCov">          0 :           numpart++;</span></a>
<a name="2813"><span class="lineNum">    2813 </span><span class="lineNoCov">          0 :           qh_distplane(qh, point, facet, &amp;dist);</span></a>
<a name="2814"><span class="lineNum">    2814 </span><span class="lineNoCov">          0 :           if (dist &lt; innerplane) {</span></a>
<a name="2815"><span class="lineNum">    2815 </span><span class="lineNoCov">          0 :             if (!qh-&gt;KEEPinside)</span></a>
<a name="2816"><span class="lineNum">    2816 </span><span class="lineNoCov">          0 :               SETref_(point)= NULL;</span></a>
<a name="2817"><span class="lineNum">    2817 </span><span class="lineNoCov">          0 :           }else if (!qh-&gt;KEEPcoplanar)</span></a>
<a name="2818"><span class="lineNum">    2818 </span><span class="lineNoCov">          0 :             SETref_(point)= NULL;</span></a>
<a name="2819"><span class="lineNum">    2819 </span>            :         }</a>
<a name="2820"><span class="lineNum">    2820 </span><span class="lineNoCov">          0 :         qh_setcompact(qh, facet-&gt;coplanarset);</span></a>
<a name="2821"><span class="lineNum">    2821 </span>            :       }</a>
<a name="2822"><span class="lineNum">    2822 </span>            :     }</a>
<a name="2823"><span class="lineNum">    2823 </span><span class="lineNoCov">          0 :     zzadd_(Zcheckpart, numpart);</span></a>
<a name="2824"><span class="lineNum">    2824 </span>            :   }</a>
<a name="2825"><span class="lineNum">    2825 </span><span class="lineCov">          8 : } /* nearcoplanar */</span></a>
<a name="2826"><span class="lineNum">    2826 </span>            : </a>
<a name="2827"><span class="lineNum">    2827 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="2828"><span class="lineNum">    2828 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;nearvertex&quot;&gt;-&lt;/a&gt;</a>
<a name="2829"><span class="lineNum">    2829 </span>            : </a>
<a name="2830"><span class="lineNum">    2830 </span>            :   qh_nearvertex(qh, facet, point, bestdist )</a>
<a name="2831"><span class="lineNum">    2831 </span>            :     return nearest vertex in facet to point</a>
<a name="2832"><span class="lineNum">    2832 </span>            : </a>
<a name="2833"><span class="lineNum">    2833 </span>            :   returns:</a>
<a name="2834"><span class="lineNum">    2834 </span>            :     vertex and its distance</a>
<a name="2835"><span class="lineNum">    2835 </span>            : </a>
<a name="2836"><span class="lineNum">    2836 </span>            :   notes:</a>
<a name="2837"><span class="lineNum">    2837 </span>            :     if qh.DELAUNAY</a>
<a name="2838"><span class="lineNum">    2838 </span>            :       distance is measured in the input set</a>
<a name="2839"><span class="lineNum">    2839 </span>            :     searches neighboring tricoplanar facets (requires vertexneighbors)</a>
<a name="2840"><span class="lineNum">    2840 </span>            :       Slow implementation.  Recomputes vertex set for each point.</a>
<a name="2841"><span class="lineNum">    2841 </span>            :     The vertex set could be stored in the qh.keepcentrum facet.</a>
<a name="2842"><span class="lineNum">    2842 </span>            : */</a>
<a name="2843"><span class="lineNum">    2843 </span><span class="lineNoCov">          0 : vertexT *qh_nearvertex(qhT *qh, facetT *facet, pointT *point, realT *bestdistp) {</span></a>
<a name="2844"><span class="lineNum">    2844 </span><span class="lineNoCov">          0 :   realT bestdist= REALmax, dist;</span></a>
<a name="2845"><span class="lineNum">    2845 </span><span class="lineNoCov">          0 :   vertexT *bestvertex= NULL, *vertex, **vertexp, *apex;</span></a>
<a name="2846"><span class="lineNum">    2846 </span>            :   coordT *center;</a>
<a name="2847"><span class="lineNum">    2847 </span>            :   facetT *neighbor, **neighborp;</a>
<a name="2848"><span class="lineNum">    2848 </span>            :   setT *vertices;</a>
<a name="2849"><span class="lineNum">    2849 </span><span class="lineNoCov">          0 :   int dim= qh-&gt;hull_dim;</span></a>
<a name="2850"><span class="lineNum">    2850 </span>            : </a>
<a name="2851"><span class="lineNum">    2851 </span><span class="lineNoCov">          0 :   if (qh-&gt;DELAUNAY)</span></a>
<a name="2852"><span class="lineNum">    2852 </span><span class="lineNoCov">          0 :     dim--;</span></a>
<a name="2853"><span class="lineNum">    2853 </span><span class="lineNoCov">          0 :   if (facet-&gt;tricoplanar) {</span></a>
<a name="2854"><span class="lineNum">    2854 </span><span class="lineNoCov">          0 :     if (!qh-&gt;VERTEXneighbors || !facet-&gt;center) {</span></a>
<a name="2855"><span class="lineNum">    2855 </span><span class="lineNoCov">          0 :       qh_fprintf(qh, qh-&gt;ferr, 6158, &quot;qhull internal error (qh_nearvertex): qh.VERTEXneighbors and facet-&gt;center required for tricoplanar facets\n&quot;);</span></a>
<a name="2856"><span class="lineNum">    2856 </span><span class="lineNoCov">          0 :       qh_errexit(qh, qh_ERRqhull, facet, NULL);</span></a>
<a name="2857"><span class="lineNum">    2857 </span>            :     }</a>
<a name="2858"><span class="lineNum">    2858 </span><span class="lineNoCov">          0 :     vertices= qh_settemp(qh, qh-&gt;TEMPsize);</span></a>
<a name="2859"><span class="lineNum">    2859 </span><span class="lineNoCov">          0 :     apex= SETfirstt_(facet-&gt;vertices, vertexT);</span></a>
<a name="2860"><span class="lineNum">    2860 </span><span class="lineNoCov">          0 :     center= facet-&gt;center;</span></a>
<a name="2861"><span class="lineNum">    2861 </span><span class="lineNoCov">          0 :     FOREACHneighbor_(apex) {</span></a>
<a name="2862"><span class="lineNum">    2862 </span><span class="lineNoCov">          0 :       if (neighbor-&gt;center == center) {</span></a>
<a name="2863"><span class="lineNum">    2863 </span><span class="lineNoCov">          0 :         FOREACHvertex_(neighbor-&gt;vertices)</span></a>
<a name="2864"><span class="lineNum">    2864 </span><span class="lineNoCov">          0 :           qh_setappend(qh, &amp;vertices, vertex);</span></a>
<a name="2865"><span class="lineNum">    2865 </span>            :       }</a>
<a name="2866"><span class="lineNum">    2866 </span>            :     }</a>
<a name="2867"><span class="lineNum">    2867 </span>            :   }else</a>
<a name="2868"><span class="lineNum">    2868 </span><span class="lineNoCov">          0 :     vertices= facet-&gt;vertices;</span></a>
<a name="2869"><span class="lineNum">    2869 </span><span class="lineNoCov">          0 :   FOREACHvertex_(vertices) {</span></a>
<a name="2870"><span class="lineNum">    2870 </span><span class="lineNoCov">          0 :     dist= qh_pointdist(vertex-&gt;point, point, -dim);</span></a>
<a name="2871"><span class="lineNum">    2871 </span><span class="lineNoCov">          0 :     if (dist &lt; bestdist) {</span></a>
<a name="2872"><span class="lineNum">    2872 </span><span class="lineNoCov">          0 :       bestdist= dist;</span></a>
<a name="2873"><span class="lineNum">    2873 </span><span class="lineNoCov">          0 :       bestvertex= vertex;</span></a>
<a name="2874"><span class="lineNum">    2874 </span>            :     }</a>
<a name="2875"><span class="lineNum">    2875 </span>            :   }</a>
<a name="2876"><span class="lineNum">    2876 </span><span class="lineNoCov">          0 :   if (facet-&gt;tricoplanar)</span></a>
<a name="2877"><span class="lineNum">    2877 </span><span class="lineNoCov">          0 :     qh_settempfree(qh, &amp;vertices);</span></a>
<a name="2878"><span class="lineNum">    2878 </span><span class="lineNoCov">          0 :   *bestdistp= sqrt(bestdist);</span></a>
<a name="2879"><span class="lineNum">    2879 </span><span class="lineNoCov">          0 :   if (!bestvertex) {</span></a>
<a name="2880"><span class="lineNum">    2880 </span><span class="lineNoCov">          0 :       qh_fprintf(qh, qh-&gt;ferr, 6261, &quot;qhull internal error (qh_nearvertex): did not find bestvertex for f%d p%d\n&quot;, facet-&gt;id, qh_pointid(qh, point));</span></a>
<a name="2881"><span class="lineNum">    2881 </span><span class="lineNoCov">          0 :       qh_errexit(qh, qh_ERRqhull, facet, NULL);</span></a>
<a name="2882"><span class="lineNum">    2882 </span>            :   }</a>
<a name="2883"><span class="lineNum">    2883 </span>            :   /* coverity[var_deref_op] */</a>
<a name="2884"><span class="lineNum">    2884 </span><span class="lineNoCov">          0 :   trace3((qh, qh-&gt;ferr, 3019, &quot;qh_nearvertex: v%d dist %2.2g for f%d p%d\n&quot;,</span></a>
<a name="2885"><span class="lineNum">    2885 </span>            :         bestvertex-&gt;id, *bestdistp, facet-&gt;id, qh_pointid(qh, point))); /* bestvertex!=0 by QH2161 */</a>
<a name="2886"><span class="lineNum">    2886 </span><span class="lineNoCov">          0 :   return bestvertex;</span></a>
<a name="2887"><span class="lineNum">    2887 </span>            : } /* nearvertex */</a>
<a name="2888"><span class="lineNum">    2888 </span>            : </a>
<a name="2889"><span class="lineNum">    2889 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="2890"><span class="lineNum">    2890 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;newhashtable&quot;&gt;-&lt;/a&gt;</a>
<a name="2891"><span class="lineNum">    2891 </span>            : </a>
<a name="2892"><span class="lineNum">    2892 </span>            :   qh_newhashtable(qh, newsize )</a>
<a name="2893"><span class="lineNum">    2893 </span>            :     returns size of qh.hash_table of at least newsize slots</a>
<a name="2894"><span class="lineNum">    2894 </span>            : </a>
<a name="2895"><span class="lineNum">    2895 </span>            :   notes:</a>
<a name="2896"><span class="lineNum">    2896 </span>            :     assumes qh.hash_table is NULL</a>
<a name="2897"><span class="lineNum">    2897 </span>            :     qh_HASHfactor determines the number of extra slots</a>
<a name="2898"><span class="lineNum">    2898 </span>            :     size is not divisible by 2, 3, or 5</a>
<a name="2899"><span class="lineNum">    2899 </span>            : */</a>
<a name="2900"><span class="lineNum">    2900 </span><span class="lineCov">      29075 : int qh_newhashtable(qhT *qh, int newsize) {</span></a>
<a name="2901"><span class="lineNum">    2901 </span>            :   int size;</a>
<a name="2902"><span class="lineNum">    2902 </span>            : </a>
<a name="2903"><span class="lineNum">    2903 </span><span class="lineCov">      29075 :   size= ((newsize+1)*qh_HASHfactor) | 0x1;  /* odd number */</span></a>
<a name="2904"><span class="lineNum">    2904 </span>            :   while (True) {</a>
<a name="2905"><span class="lineNum">    2905 </span><span class="lineCov">      32410 :     if (newsize&lt;0 || size&lt;0) {</span></a>
<a name="2906"><span class="lineNum">    2906 </span><span class="lineNoCov">          0 :         qh_fprintf(qh, qh-&gt;qhmem.ferr, 6236, &quot;qhull error (qh_newhashtable): negative request (%d) or size (%d).  Did int overflow due to high-D?\n&quot;, newsize, size); /* WARN64 */</span></a>
<a name="2907"><span class="lineNum">    2907 </span><span class="lineNoCov">          0 :         qh_errexit(qh, qhmem_ERRmem, NULL, NULL);</span></a>
<a name="2908"><span class="lineNum">    2908 </span>            :     }</a>
<a name="2909"><span class="lineNum">    2909 </span><span class="lineCov">      32410 :     if ((size%3) &amp;&amp; (size%5))</span></a>
<a name="2910"><span class="lineNum">    2910 </span><span class="lineCov">      29075 :       break;</span></a>
<a name="2911"><span class="lineNum">    2911 </span><span class="lineCov">       3335 :     size += 2;</span></a>
<a name="2912"><span class="lineNum">    2912 </span>            :     /* loop terminates because there is an infinite number of primes */</a>
<a name="2913"><span class="lineNum">    2913 </span>            :   }</a>
<a name="2914"><span class="lineNum">    2914 </span><span class="lineCov">      29075 :   qh-&gt;hash_table= qh_setnew(qh, size);</span></a>
<a name="2915"><span class="lineNum">    2915 </span><span class="lineCov">      29075 :   qh_setzero(qh, qh-&gt;hash_table, 0, size);</span></a>
<a name="2916"><span class="lineNum">    2916 </span><span class="lineCov">      29075 :   return size;</span></a>
<a name="2917"><span class="lineNum">    2917 </span>            : } /* newhashtable */</a>
<a name="2918"><span class="lineNum">    2918 </span>            : </a>
<a name="2919"><span class="lineNum">    2919 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="2920"><span class="lineNum">    2920 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;newvertex&quot;&gt;-&lt;/a&gt;</a>
<a name="2921"><span class="lineNum">    2921 </span>            : </a>
<a name="2922"><span class="lineNum">    2922 </span>            :   qh_newvertex(qh, point )</a>
<a name="2923"><span class="lineNum">    2923 </span>            :     returns a new vertex for point</a>
<a name="2924"><span class="lineNum">    2924 </span>            : */</a>
<a name="2925"><span class="lineNum">    2925 </span><span class="lineCov">      14715 : vertexT *qh_newvertex(qhT *qh, pointT *point) {</span></a>
<a name="2926"><span class="lineNum">    2926 </span>            :   vertexT *vertex;</a>
<a name="2927"><span class="lineNum">    2927 </span>            : </a>
<a name="2928"><span class="lineNum">    2928 </span><span class="lineCov">      14715 :   zinc_(Ztotvertices);</span></a>
<a name="2929"><span class="lineNum">    2929 </span><span class="lineCov">      14715 :   vertex= (vertexT *)qh_memalloc(qh, (int)sizeof(vertexT));</span></a>
<a name="2930"><span class="lineNum">    2930 </span><span class="lineCov">      14715 :   memset((char *) vertex, (size_t)0, sizeof(vertexT));</span></a>
<a name="2931"><span class="lineNum">    2931 </span><span class="lineCov">      14715 :   if (qh-&gt;vertex_id == UINT_MAX) {</span></a>
<a name="2932"><span class="lineNum">    2932 </span><span class="lineNoCov">          0 :     qh_memfree(qh, vertex, (int)sizeof(vertexT));</span></a>
<a name="2933"><span class="lineNum">    2933 </span><span class="lineNoCov">          0 :     qh_fprintf(qh, qh-&gt;ferr, 6159, &quot;qhull error: 2^32 or more vertices.  vertexT.id field overflows.  Vertices would not be sorted correctly.\n&quot;);</span></a>
<a name="2934"><span class="lineNum">    2934 </span><span class="lineNoCov">          0 :     qh_errexit(qh, qh_ERRother, NULL, NULL);</span></a>
<a name="2935"><span class="lineNum">    2935 </span>            :   }</a>
<a name="2936"><span class="lineNum">    2936 </span><span class="lineCov">      14715 :   if (qh-&gt;vertex_id == qh-&gt;tracevertex_id)</span></a>
<a name="2937"><span class="lineNum">    2937 </span><span class="lineNoCov">          0 :     qh-&gt;tracevertex= vertex;</span></a>
<a name="2938"><span class="lineNum">    2938 </span><span class="lineCov">      14715 :   vertex-&gt;id= qh-&gt;vertex_id++;</span></a>
<a name="2939"><span class="lineNum">    2939 </span><span class="lineCov">      14715 :   vertex-&gt;point= point;</span></a>
<a name="2940"><span class="lineNum">    2940 </span><span class="lineCov">      14715 :   trace4((qh, qh-&gt;ferr, 4060, &quot;qh_newvertex: vertex p%d(v%d) created\n&quot;, qh_pointid(qh, vertex-&gt;point),</span></a>
<a name="2941"><span class="lineNum">    2941 </span>            :           vertex-&gt;id));</a>
<a name="2942"><span class="lineNum">    2942 </span><span class="lineCov">      14715 :   return(vertex);</span></a>
<a name="2943"><span class="lineNum">    2943 </span>            : } /* newvertex */</a>
<a name="2944"><span class="lineNum">    2944 </span>            : </a>
<a name="2945"><span class="lineNum">    2945 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="2946"><span class="lineNum">    2946 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;nextfacet2d&quot;&gt;-&lt;/a&gt;</a>
<a name="2947"><span class="lineNum">    2947 </span>            : </a>
<a name="2948"><span class="lineNum">    2948 </span>            :   qh_nextfacet2d( facet, &amp;nextvertex )</a>
<a name="2949"><span class="lineNum">    2949 </span>            :     return next facet and vertex for a 2d facet in qh_ORIENTclock order</a>
<a name="2950"><span class="lineNum">    2950 </span>            :     returns NULL on error</a>
<a name="2951"><span class="lineNum">    2951 </span>            : </a>
<a name="2952"><span class="lineNum">    2952 </span>            :   notes:</a>
<a name="2953"><span class="lineNum">    2953 </span>            :     in qh_ORIENTclock order (default counter-clockwise)</a>
<a name="2954"><span class="lineNum">    2954 </span>            :     nextvertex is in between the two facets</a>
<a name="2955"><span class="lineNum">    2955 </span>            :     does not use qhT or qh_errexit [QhullFacet.cpp]</a>
<a name="2956"><span class="lineNum">    2956 </span>            : </a>
<a name="2957"><span class="lineNum">    2957 </span>            :   design:</a>
<a name="2958"><span class="lineNum">    2958 </span>            :     see io_r.c/qh_printextremes_2d</a>
<a name="2959"><span class="lineNum">    2959 </span>            : */</a>
<a name="2960"><span class="lineNum">    2960 </span><span class="lineNoCov">          0 : facetT *qh_nextfacet2d(facetT *facet, vertexT **nextvertexp) {</span></a>
<a name="2961"><span class="lineNum">    2961 </span>            :   facetT *nextfacet;</a>
<a name="2962"><span class="lineNum">    2962 </span>            : </a>
<a name="2963"><span class="lineNum">    2963 </span><span class="lineNoCov">          0 :   if (facet-&gt;toporient ^ qh_ORIENTclock) {</span></a>
<a name="2964"><span class="lineNum">    2964 </span><span class="lineNoCov">          0 :     *nextvertexp= SETfirstt_(facet-&gt;vertices, vertexT);</span></a>
<a name="2965"><span class="lineNum">    2965 </span><span class="lineNoCov">          0 :     nextfacet= SETfirstt_(facet-&gt;neighbors, facetT);</span></a>
<a name="2966"><span class="lineNum">    2966 </span>            :   }else {</a>
<a name="2967"><span class="lineNum">    2967 </span><span class="lineNoCov">          0 :     *nextvertexp= SETsecondt_(facet-&gt;vertices, vertexT);</span></a>
<a name="2968"><span class="lineNum">    2968 </span><span class="lineNoCov">          0 :     nextfacet= SETsecondt_(facet-&gt;neighbors, facetT);</span></a>
<a name="2969"><span class="lineNum">    2969 </span>            :   }</a>
<a name="2970"><span class="lineNum">    2970 </span><span class="lineNoCov">          0 :   return nextfacet;</span></a>
<a name="2971"><span class="lineNum">    2971 </span>            : } /* nextfacet2d */</a>
<a name="2972"><span class="lineNum">    2972 </span>            : </a>
<a name="2973"><span class="lineNum">    2973 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="2974"><span class="lineNum">    2974 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;nextridge3d&quot;&gt;-&lt;/a&gt;</a>
<a name="2975"><span class="lineNum">    2975 </span>            : </a>
<a name="2976"><span class="lineNum">    2976 </span>            :   qh_nextridge3d( atridge, facet, &amp;vertex )</a>
<a name="2977"><span class="lineNum">    2977 </span>            :     return next ridge and vertex for a 3d facet</a>
<a name="2978"><span class="lineNum">    2978 </span>            :     returns NULL on error</a>
<a name="2979"><span class="lineNum">    2979 </span>            :     [for QhullFacet::nextRidge3d] Does not call qh_errexit nor access qhT.</a>
<a name="2980"><span class="lineNum">    2980 </span>            : </a>
<a name="2981"><span class="lineNum">    2981 </span>            :   notes:</a>
<a name="2982"><span class="lineNum">    2982 </span>            :     in qh_ORIENTclock order</a>
<a name="2983"><span class="lineNum">    2983 </span>            :     this is a O(n^2) implementation to trace all ridges</a>
<a name="2984"><span class="lineNum">    2984 </span>            :     be sure to stop on any 2nd visit</a>
<a name="2985"><span class="lineNum">    2985 </span>            :     same as QhullRidge::nextRidge3d</a>
<a name="2986"><span class="lineNum">    2986 </span>            :     does not use qhT or qh_errexit [QhullFacet.cpp]</a>
<a name="2987"><span class="lineNum">    2987 </span>            : </a>
<a name="2988"><span class="lineNum">    2988 </span>            :   design:</a>
<a name="2989"><span class="lineNum">    2989 </span>            :     for each ridge</a>
<a name="2990"><span class="lineNum">    2990 </span>            :       exit if it is the ridge after atridge</a>
<a name="2991"><span class="lineNum">    2991 </span>            : */</a>
<a name="2992"><span class="lineNum">    2992 </span><span class="lineNoCov">          0 : ridgeT *qh_nextridge3d(ridgeT *atridge, facetT *facet, vertexT **vertexp) {</span></a>
<a name="2993"><span class="lineNum">    2993 </span>            :   vertexT *atvertex, *vertex, *othervertex;</a>
<a name="2994"><span class="lineNum">    2994 </span>            :   ridgeT *ridge, **ridgep;</a>
<a name="2995"><span class="lineNum">    2995 </span>            : </a>
<a name="2996"><span class="lineNum">    2996 </span><span class="lineNoCov">          0 :   if ((atridge-&gt;top == facet) ^ qh_ORIENTclock)</span></a>
<a name="2997"><span class="lineNum">    2997 </span><span class="lineNoCov">          0 :     atvertex= SETsecondt_(atridge-&gt;vertices, vertexT);</span></a>
<a name="2998"><span class="lineNum">    2998 </span>            :   else</a>
<a name="2999"><span class="lineNum">    2999 </span><span class="lineNoCov">          0 :     atvertex= SETfirstt_(atridge-&gt;vertices, vertexT);</span></a>
<a name="3000"><span class="lineNum">    3000 </span><span class="lineNoCov">          0 :   FOREACHridge_(facet-&gt;ridges) {</span></a>
<a name="3001"><span class="lineNum">    3001 </span><span class="lineNoCov">          0 :     if (ridge == atridge)</span></a>
<a name="3002"><span class="lineNum">    3002 </span><span class="lineNoCov">          0 :       continue;</span></a>
<a name="3003"><span class="lineNum">    3003 </span><span class="lineNoCov">          0 :     if ((ridge-&gt;top == facet) ^ qh_ORIENTclock) {</span></a>
<a name="3004"><span class="lineNum">    3004 </span><span class="lineNoCov">          0 :       othervertex= SETsecondt_(ridge-&gt;vertices, vertexT);</span></a>
<a name="3005"><span class="lineNum">    3005 </span><span class="lineNoCov">          0 :       vertex= SETfirstt_(ridge-&gt;vertices, vertexT);</span></a>
<a name="3006"><span class="lineNum">    3006 </span>            :     }else {</a>
<a name="3007"><span class="lineNum">    3007 </span><span class="lineNoCov">          0 :       vertex= SETsecondt_(ridge-&gt;vertices, vertexT);</span></a>
<a name="3008"><span class="lineNum">    3008 </span><span class="lineNoCov">          0 :       othervertex= SETfirstt_(ridge-&gt;vertices, vertexT);</span></a>
<a name="3009"><span class="lineNum">    3009 </span>            :     }</a>
<a name="3010"><span class="lineNum">    3010 </span><span class="lineNoCov">          0 :     if (vertex == atvertex) {</span></a>
<a name="3011"><span class="lineNum">    3011 </span><span class="lineNoCov">          0 :       if (vertexp)</span></a>
<a name="3012"><span class="lineNum">    3012 </span><span class="lineNoCov">          0 :         *vertexp= othervertex;</span></a>
<a name="3013"><span class="lineNum">    3013 </span><span class="lineNoCov">          0 :       return ridge;</span></a>
<a name="3014"><span class="lineNum">    3014 </span>            :     }</a>
<a name="3015"><span class="lineNum">    3015 </span>            :   }</a>
<a name="3016"><span class="lineNum">    3016 </span><span class="lineNoCov">          0 :   return NULL;</span></a>
<a name="3017"><span class="lineNum">    3017 </span>            : } /* nextridge3d */</a>
<a name="3018"><span class="lineNum">    3018 </span>            : </a>
<a name="3019"><span class="lineNum">    3019 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="3020"><span class="lineNum">    3020 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;opposite_vertex&quot;&gt;-&lt;/a&gt;</a>
<a name="3021"><span class="lineNum">    3021 </span>            : </a>
<a name="3022"><span class="lineNum">    3022 </span>            :   qh_opposite_vertex(qh, facetA, neighbor )</a>
<a name="3023"><span class="lineNum">    3023 </span>            :     return the opposite vertex in facetA to neighbor</a>
<a name="3024"><span class="lineNum">    3024 </span>            : </a>
<a name="3025"><span class="lineNum">    3025 </span>            : */</a>
<a name="3026"><span class="lineNum">    3026 </span><span class="lineNoCov">          0 : vertexT *qh_opposite_vertex(qhT *qh, facetT *facetA,  facetT *neighbor) {</span></a>
<a name="3027"><span class="lineNum">    3027 </span><span class="lineNoCov">          0 :     vertexT *opposite= NULL;</span></a>
<a name="3028"><span class="lineNum">    3028 </span>            :     facetT *facet;</a>
<a name="3029"><span class="lineNum">    3029 </span>            :     int facet_i, facet_n;</a>
<a name="3030"><span class="lineNum">    3030 </span>            : </a>
<a name="3031"><span class="lineNum">    3031 </span><span class="lineNoCov">          0 :     if (facetA-&gt;simplicial) {</span></a>
<a name="3032"><span class="lineNum">    3032 </span><span class="lineNoCov">          0 :       FOREACHfacet_i_(qh, facetA-&gt;neighbors) {</span></a>
<a name="3033"><span class="lineNum">    3033 </span><span class="lineNoCov">          0 :         if (facet == neighbor) {</span></a>
<a name="3034"><span class="lineNum">    3034 </span><span class="lineNoCov">          0 :           opposite= SETelemt_(facetA-&gt;vertices, facet_i, vertexT);</span></a>
<a name="3035"><span class="lineNum">    3035 </span><span class="lineNoCov">          0 :           break;</span></a>
<a name="3036"><span class="lineNum">    3036 </span>            :         }</a>
<a name="3037"><span class="lineNum">    3037 </span>            :       }</a>
<a name="3038"><span class="lineNum">    3038 </span>            :     }</a>
<a name="3039"><span class="lineNum">    3039 </span><span class="lineNoCov">          0 :     if (!opposite) {</span></a>
<a name="3040"><span class="lineNum">    3040 </span><span class="lineNoCov">          0 :       qh_fprintf(qh, qh-&gt;ferr, 6396, &quot;qhull internal error (qh_opposite_vertex): opposite vertex in facet f%d to neighbor f%d is not defined.  Either is facet is not simplicial or neighbor not found\n&quot;,</span></a>
<a name="3041"><span class="lineNum">    3041 </span>            :         facetA-&gt;id, neighbor-&gt;id);</a>
<a name="3042"><span class="lineNum">    3042 </span><span class="lineNoCov">          0 :       qh_errexit2(qh, qh_ERRqhull, facetA, neighbor);</span></a>
<a name="3043"><span class="lineNum">    3043 </span>            :     }</a>
<a name="3044"><span class="lineNum">    3044 </span><span class="lineNoCov">          0 :     return opposite;</span></a>
<a name="3045"><span class="lineNum">    3045 </span>            : } /* opposite_vertex */</a>
<a name="3046"><span class="lineNum">    3046 </span>            : </a>
<a name="3047"><span class="lineNum">    3047 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="3048"><span class="lineNum">    3048 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;outcoplanar&quot;&gt;-&lt;/a&gt;</a>
<a name="3049"><span class="lineNum">    3049 </span>            : </a>
<a name="3050"><span class="lineNum">    3050 </span>            :   qh_outcoplanar()</a>
<a name="3051"><span class="lineNum">    3051 </span>            :     move points from all facets' outsidesets to their coplanarsets</a>
<a name="3052"><span class="lineNum">    3052 </span>            : </a>
<a name="3053"><span class="lineNum">    3053 </span>            :   notes:</a>
<a name="3054"><span class="lineNum">    3054 </span>            :     for post-processing under qh.NARROWhull</a>
<a name="3055"><span class="lineNum">    3055 </span>            : </a>
<a name="3056"><span class="lineNum">    3056 </span>            :   design:</a>
<a name="3057"><span class="lineNum">    3057 </span>            :     for each facet</a>
<a name="3058"><span class="lineNum">    3058 </span>            :       for each outside point for facet</a>
<a name="3059"><span class="lineNum">    3059 </span>            :         partition point into coplanar set</a>
<a name="3060"><span class="lineNum">    3060 </span>            : */</a>
<a name="3061"><span class="lineNum">    3061 </span><span class="lineNoCov">          0 : void qh_outcoplanar(qhT *qh /* facet_list */) {</span></a>
<a name="3062"><span class="lineNum">    3062 </span>            :   pointT *point, **pointp;</a>
<a name="3063"><span class="lineNum">    3063 </span>            :   facetT *facet;</a>
<a name="3064"><span class="lineNum">    3064 </span>            :   realT dist;</a>
<a name="3065"><span class="lineNum">    3065 </span>            : </a>
<a name="3066"><span class="lineNum">    3066 </span><span class="lineNoCov">          0 :   trace1((qh, qh-&gt;ferr, 1033, &quot;qh_outcoplanar: move outsideset to coplanarset for qh-&gt;NARROWhull\n&quot;));</span></a>
<a name="3067"><span class="lineNum">    3067 </span><span class="lineNoCov">          0 :   FORALLfacets {</span></a>
<a name="3068"><span class="lineNum">    3068 </span><span class="lineNoCov">          0 :     FOREACHpoint_(facet-&gt;outsideset) {</span></a>
<a name="3069"><span class="lineNum">    3069 </span><span class="lineNoCov">          0 :       qh-&gt;num_outside--;</span></a>
<a name="3070"><span class="lineNum">    3070 </span><span class="lineNoCov">          0 :       if (qh-&gt;KEEPcoplanar || qh-&gt;KEEPnearinside) {</span></a>
<a name="3071"><span class="lineNum">    3071 </span><span class="lineNoCov">          0 :         qh_distplane(qh, point, facet, &amp;dist);</span></a>
<a name="3072"><span class="lineNum">    3072 </span><span class="lineNoCov">          0 :         zinc_(Zpartition);</span></a>
<a name="3073"><span class="lineNum">    3073 </span><span class="lineNoCov">          0 :         qh_partitioncoplanar(qh, point, facet, &amp;dist, qh-&gt;findbestnew);</span></a>
<a name="3074"><span class="lineNum">    3074 </span>            :       }</a>
<a name="3075"><span class="lineNum">    3075 </span>            :     }</a>
<a name="3076"><span class="lineNum">    3076 </span><span class="lineNoCov">          0 :     qh_setfree(qh, &amp;facet-&gt;outsideset);</span></a>
<a name="3077"><span class="lineNum">    3077 </span>            :   }</a>
<a name="3078"><span class="lineNum">    3078 </span><span class="lineNoCov">          0 : } /* outcoplanar */</span></a>
<a name="3079"><span class="lineNum">    3079 </span>            : </a>
<a name="3080"><span class="lineNum">    3080 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="3081"><span class="lineNum">    3081 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;point&quot;&gt;-&lt;/a&gt;</a>
<a name="3082"><span class="lineNum">    3082 </span>            : </a>
<a name="3083"><span class="lineNum">    3083 </span>            :   qh_point(qh, id )</a>
<a name="3084"><span class="lineNum">    3084 </span>            :     return point for a point id, or NULL if unknown</a>
<a name="3085"><span class="lineNum">    3085 </span>            : </a>
<a name="3086"><span class="lineNum">    3086 </span>            :   alternative code:</a>
<a name="3087"><span class="lineNum">    3087 </span>            :     return((pointT *)((unsigned long)qh.first_point</a>
<a name="3088"><span class="lineNum">    3088 </span>            :            + (unsigned long)((id)*qh.normal_size)));</a>
<a name="3089"><span class="lineNum">    3089 </span>            : */</a>
<a name="3090"><span class="lineNum">    3090 </span><span class="lineCov">      14703 : pointT *qh_point(qhT *qh, int id) {</span></a>
<a name="3091"><span class="lineNum">    3091 </span>            : </a>
<a name="3092"><span class="lineNum">    3092 </span><span class="lineCov">      14703 :   if (id &lt; 0)</span></a>
<a name="3093"><span class="lineNum">    3093 </span><span class="lineNoCov">          0 :     return NULL;</span></a>
<a name="3094"><span class="lineNum">    3094 </span><span class="lineCov">      14703 :   if (id &lt; qh-&gt;num_points)</span></a>
<a name="3095"><span class="lineNum">    3095 </span><span class="lineCov">      14703 :     return qh-&gt;first_point + id * qh-&gt;hull_dim;</span></a>
<a name="3096"><span class="lineNum">    3096 </span><span class="lineNoCov">          0 :   id -= qh-&gt;num_points;</span></a>
<a name="3097"><span class="lineNum">    3097 </span><span class="lineNoCov">          0 :   if (id &lt; qh_setsize(qh, qh-&gt;other_points))</span></a>
<a name="3098"><span class="lineNum">    3098 </span><span class="lineNoCov">          0 :     return SETelemt_(qh-&gt;other_points, id, pointT);</span></a>
<a name="3099"><span class="lineNum">    3099 </span><span class="lineNoCov">          0 :   return NULL;</span></a>
<a name="3100"><span class="lineNum">    3100 </span>            : } /* point */</a>
<a name="3101"><span class="lineNum">    3101 </span>            : </a>
<a name="3102"><span class="lineNum">    3102 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="3103"><span class="lineNum">    3103 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;point_add&quot;&gt;-&lt;/a&gt;</a>
<a name="3104"><span class="lineNum">    3104 </span>            : </a>
<a name="3105"><span class="lineNum">    3105 </span>            :   qh_point_add(qh, set, point, elem )</a>
<a name="3106"><span class="lineNum">    3106 </span>            :     stores elem at set[point.id]</a>
<a name="3107"><span class="lineNum">    3107 </span>            : </a>
<a name="3108"><span class="lineNum">    3108 </span>            :   returns:</a>
<a name="3109"><span class="lineNum">    3109 </span>            :     access function for qh_pointfacet and qh_pointvertex</a>
<a name="3110"><span class="lineNum">    3110 </span>            : </a>
<a name="3111"><span class="lineNum">    3111 </span>            :   notes:</a>
<a name="3112"><span class="lineNum">    3112 </span>            :     checks point.id</a>
<a name="3113"><span class="lineNum">    3113 </span>            : */</a>
<a name="3114"><span class="lineNum">    3114 </span><span class="lineCov">      29405 : void qh_point_add(qhT *qh, setT *set, pointT *point, void *elem) {</span></a>
<a name="3115"><span class="lineNum">    3115 </span>            :   int id, size;</a>
<a name="3116"><span class="lineNum">    3116 </span>            : </a>
<a name="3117"><span class="lineNum">    3117 </span><span class="lineCov">      29405 :   SETreturnsize_(set, size);</span></a>
<a name="3118"><span class="lineNum">    3118 </span><span class="lineCov">      29405 :   if ((id= qh_pointid(qh, point)) &lt; 0)</span></a>
<a name="3119"><span class="lineNum">    3119 </span><span class="lineNoCov">          0 :     qh_fprintf(qh, qh-&gt;ferr, 7067, &quot;qhull internal warning (point_add): unknown point %p id %d\n&quot;,</span></a>
<a name="3120"><span class="lineNum">    3120 </span>            :       point, id);</a>
<a name="3121"><span class="lineNum">    3121 </span><span class="lineCov">      29405 :   else if (id &gt;= size) {</span></a>
<a name="3122"><span class="lineNum">    3122 </span><span class="lineNoCov">          0 :     qh_fprintf(qh, qh-&gt;ferr, 6160, &quot;qhull internal error (point_add): point p%d is out of bounds(%d)\n&quot;,</span></a>
<a name="3123"><span class="lineNum">    3123 </span>            :              id, size);</a>
<a name="3124"><span class="lineNum">    3124 </span><span class="lineNoCov">          0 :     qh_errexit(qh, qh_ERRqhull, NULL, NULL);</span></a>
<a name="3125"><span class="lineNum">    3125 </span>            :   }else</a>
<a name="3126"><span class="lineNum">    3126 </span><span class="lineCov">      29405 :     SETelem_(set, id)= elem;</span></a>
<a name="3127"><span class="lineNum">    3127 </span><span class="lineCov">      29405 : } /* point_add */</span></a>
<a name="3128"><span class="lineNum">    3128 </span>            : </a>
<a name="3129"><span class="lineNum">    3129 </span>            : </a>
<a name="3130"><span class="lineNum">    3130 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="3131"><span class="lineNum">    3131 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;pointfacet&quot;&gt;-&lt;/a&gt;</a>
<a name="3132"><span class="lineNum">    3132 </span>            : </a>
<a name="3133"><span class="lineNum">    3133 </span>            :   qh_pointfacet()</a>
<a name="3134"><span class="lineNum">    3134 </span>            :     return temporary set of facet for each point</a>
<a name="3135"><span class="lineNum">    3135 </span>            :     the set is indexed by point id</a>
<a name="3136"><span class="lineNum">    3136 </span>            :     at most one facet per point, arbitrary selection</a>
<a name="3137"><span class="lineNum">    3137 </span>            : </a>
<a name="3138"><span class="lineNum">    3138 </span>            :   notes:</a>
<a name="3139"><span class="lineNum">    3139 </span>            :     each point is assigned to at most one of vertices, coplanarset, or outsideset</a>
<a name="3140"><span class="lineNum">    3140 </span>            :     unassigned points are interior points or</a>
<a name="3141"><span class="lineNum">    3141 </span>            :     vertices assigned to one of its facets</a>
<a name="3142"><span class="lineNum">    3142 </span>            :     coplanarset assigned to the facet</a>
<a name="3143"><span class="lineNum">    3143 </span>            :     outside set assigned to the facet</a>
<a name="3144"><span class="lineNum">    3144 </span>            :     NULL if no facet for point (inside)</a>
<a name="3145"><span class="lineNum">    3145 </span>            :       includes qh.GOODpointp</a>
<a name="3146"><span class="lineNum">    3146 </span>            : </a>
<a name="3147"><span class="lineNum">    3147 </span>            :   access:</a>
<a name="3148"><span class="lineNum">    3148 </span>            :     FOREACHfacet_i_(qh, facets) { ... }</a>
<a name="3149"><span class="lineNum">    3149 </span>            :     SETelem_(facets, i)</a>
<a name="3150"><span class="lineNum">    3150 </span>            : </a>
<a name="3151"><span class="lineNum">    3151 </span>            :   design:</a>
<a name="3152"><span class="lineNum">    3152 </span>            :     for each facet</a>
<a name="3153"><span class="lineNum">    3153 </span>            :       add each vertex</a>
<a name="3154"><span class="lineNum">    3154 </span>            :       add each coplanar point</a>
<a name="3155"><span class="lineNum">    3155 </span>            :       add each outside point</a>
<a name="3156"><span class="lineNum">    3156 </span>            : */</a>
<a name="3157"><span class="lineNum">    3157 </span><span class="lineCov">          8 : setT *qh_pointfacet(qhT *qh /* qh.facet_list */) {</span></a>
<a name="3158"><span class="lineNum">    3158 </span><span class="lineCov">          8 :   int numpoints= qh-&gt;num_points + qh_setsize(qh, qh-&gt;other_points);</span></a>
<a name="3159"><span class="lineNum">    3159 </span>            :   setT *facets;</a>
<a name="3160"><span class="lineNum">    3160 </span>            :   facetT *facet;</a>
<a name="3161"><span class="lineNum">    3161 </span>            :   vertexT *vertex, **vertexp;</a>
<a name="3162"><span class="lineNum">    3162 </span>            :   pointT *point, **pointp;</a>
<a name="3163"><span class="lineNum">    3163 </span>            : </a>
<a name="3164"><span class="lineNum">    3164 </span><span class="lineCov">          8 :   facets= qh_settemp(qh, numpoints);</span></a>
<a name="3165"><span class="lineNum">    3165 </span><span class="lineCov">          8 :   qh_setzero(qh, facets, 0, numpoints);</span></a>
<a name="3166"><span class="lineNum">    3166 </span><span class="lineCov">          8 :   qh-&gt;vertex_visit++;</span></a>
<a name="3167"><span class="lineNum">    3167 </span><span class="lineCov">      14507 :   FORALLfacets {</span></a>
<a name="3168"><span class="lineNum">    3168 </span><span class="lineCov">      72869 :     FOREACHvertex_(facet-&gt;vertices) {</span></a>
<a name="3169"><span class="lineNum">    3169 </span><span class="lineCov">      58370 :       if (vertex-&gt;visitid != qh-&gt;vertex_visit) {</span></a>
<a name="3170"><span class="lineNum">    3170 </span><span class="lineCov">      14702 :         vertex-&gt;visitid= qh-&gt;vertex_visit;</span></a>
<a name="3171"><span class="lineNum">    3171 </span><span class="lineCov">      14702 :         qh_point_add(qh, facets, vertex-&gt;point, facet);</span></a>
<a name="3172"><span class="lineNum">    3172 </span>            :       }</a>
<a name="3173"><span class="lineNum">    3173 </span>            :     }</a>
<a name="3174"><span class="lineNum">    3174 </span><span class="lineCov">      14500 :     FOREACHpoint_(facet-&gt;coplanarset)</span></a>
<a name="3175"><span class="lineNum">    3175 </span><span class="lineCov">          1 :       qh_point_add(qh, facets, point, facet);</span></a>
<a name="3176"><span class="lineNum">    3176 </span><span class="lineCov">      14499 :     FOREACHpoint_(facet-&gt;outsideset)</span></a>
<a name="3177"><span class="lineNum">    3177 </span><span class="lineNoCov">          0 :       qh_point_add(qh, facets, point, facet);</span></a>
<a name="3178"><span class="lineNum">    3178 </span>            :   }</a>
<a name="3179"><span class="lineNum">    3179 </span><span class="lineCov">          8 :   return facets;</span></a>
<a name="3180"><span class="lineNum">    3180 </span>            : } /* pointfacet */</a>
<a name="3181"><span class="lineNum">    3181 </span>            : </a>
<a name="3182"><span class="lineNum">    3182 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="3183"><span class="lineNum">    3183 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;pointvertex&quot;&gt;-&lt;/a&gt;</a>
<a name="3184"><span class="lineNum">    3184 </span>            : </a>
<a name="3185"><span class="lineNum">    3185 </span>            :   qh_pointvertex(qh )</a>
<a name="3186"><span class="lineNum">    3186 </span>            :     return temporary set of vertices indexed by point id</a>
<a name="3187"><span class="lineNum">    3187 </span>            :     entry is NULL if no vertex for a point</a>
<a name="3188"><span class="lineNum">    3188 </span>            :       this will include qh.GOODpointp</a>
<a name="3189"><span class="lineNum">    3189 </span>            : </a>
<a name="3190"><span class="lineNum">    3190 </span>            :   access:</a>
<a name="3191"><span class="lineNum">    3191 </span>            :     FOREACHvertex_i_(qh, vertices) { ... }</a>
<a name="3192"><span class="lineNum">    3192 </span>            :     SETelem_(vertices, i)</a>
<a name="3193"><span class="lineNum">    3193 </span>            : */</a>
<a name="3194"><span class="lineNum">    3194 </span><span class="lineCov">          8 : setT *qh_pointvertex(qhT *qh /* qh.facet_list */) {</span></a>
<a name="3195"><span class="lineNum">    3195 </span><span class="lineCov">          8 :   int numpoints= qh-&gt;num_points + qh_setsize(qh, qh-&gt;other_points);</span></a>
<a name="3196"><span class="lineNum">    3196 </span>            :   setT *vertices;</a>
<a name="3197"><span class="lineNum">    3197 </span>            :   vertexT *vertex;</a>
<a name="3198"><span class="lineNum">    3198 </span>            : </a>
<a name="3199"><span class="lineNum">    3199 </span><span class="lineCov">          8 :   vertices= qh_settemp(qh, numpoints);</span></a>
<a name="3200"><span class="lineNum">    3200 </span><span class="lineCov">          8 :   qh_setzero(qh, vertices, 0, numpoints);</span></a>
<a name="3201"><span class="lineNum">    3201 </span><span class="lineCov">      14710 :   FORALLvertices</span></a>
<a name="3202"><span class="lineNum">    3202 </span><span class="lineCov">      14702 :     qh_point_add(qh, vertices, vertex-&gt;point, vertex);</span></a>
<a name="3203"><span class="lineNum">    3203 </span><span class="lineCov">          8 :   return vertices;</span></a>
<a name="3204"><span class="lineNum">    3204 </span>            : } /* pointvertex */</a>
<a name="3205"><span class="lineNum">    3205 </span>            : </a>
<a name="3206"><span class="lineNum">    3206 </span>            : </a>
<a name="3207"><span class="lineNum">    3207 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="3208"><span class="lineNum">    3208 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;prependfacet&quot;&gt;-&lt;/a&gt;</a>
<a name="3209"><span class="lineNum">    3209 </span>            : </a>
<a name="3210"><span class="lineNum">    3210 </span>            :   qh_prependfacet(qh, facet, facetlist )</a>
<a name="3211"><span class="lineNum">    3211 </span>            :     prepend facet to the start of a facetlist</a>
<a name="3212"><span class="lineNum">    3212 </span>            : </a>
<a name="3213"><span class="lineNum">    3213 </span>            :   returns:</a>
<a name="3214"><span class="lineNum">    3214 </span>            :     increments qh.numfacets</a>
<a name="3215"><span class="lineNum">    3215 </span>            :     updates facetlist, qh.facet_list, facet_next</a>
<a name="3216"><span class="lineNum">    3216 </span>            : </a>
<a name="3217"><span class="lineNum">    3217 </span>            :   notes:</a>
<a name="3218"><span class="lineNum">    3218 </span>            :     be careful of prepending since it can lose a pointer.</a>
<a name="3219"><span class="lineNum">    3219 </span>            :       e.g., can lose _next by deleting and then prepending before _next</a>
<a name="3220"><span class="lineNum">    3220 </span>            : */</a>
<a name="3221"><span class="lineNum">    3221 </span><span class="lineCov">      63276 : void qh_prependfacet(qhT *qh, facetT *facet, facetT **facetlist) {</span></a>
<a name="3222"><span class="lineNum">    3222 </span>            :   facetT *prevfacet, *list;</a>
<a name="3223"><span class="lineNum">    3223 </span>            : </a>
<a name="3224"><span class="lineNum">    3224 </span><span class="lineCov">      63276 :   trace4((qh, qh-&gt;ferr, 4061, &quot;qh_prependfacet: prepend f%d before f%d\n&quot;,</span></a>
<a name="3225"><span class="lineNum">    3225 </span>            :           facet-&gt;id, getid_(*facetlist)));</a>
<a name="3226"><span class="lineNum">    3226 </span><span class="lineCov">      63276 :   if (!*facetlist)</span></a>
<a name="3227"><span class="lineNum">    3227 </span><span class="lineCov">          2 :     (*facetlist)= qh-&gt;facet_tail;</span></a>
<a name="3228"><span class="lineNum">    3228 </span><span class="lineCov">      63276 :   list= *facetlist;</span></a>
<a name="3229"><span class="lineNum">    3229 </span><span class="lineCov">      63276 :   prevfacet= list-&gt;previous;</span></a>
<a name="3230"><span class="lineNum">    3230 </span><span class="lineCov">      63276 :   facet-&gt;previous= prevfacet;</span></a>
<a name="3231"><span class="lineNum">    3231 </span><span class="lineCov">      63276 :   if (prevfacet)</span></a>
<a name="3232"><span class="lineNum">    3232 </span><span class="lineCov">      63268 :     prevfacet-&gt;next= facet;</span></a>
<a name="3233"><span class="lineNum">    3233 </span><span class="lineCov">      63276 :   list-&gt;previous= facet;</span></a>
<a name="3234"><span class="lineNum">    3234 </span><span class="lineCov">      63276 :   facet-&gt;next= *facetlist;</span></a>
<a name="3235"><span class="lineNum">    3235 </span><span class="lineCov">      63276 :   if (qh-&gt;facet_list == list)  /* this may change *facetlist */</span></a>
<a name="3236"><span class="lineNum">    3236 </span><span class="lineCov">          8 :     qh-&gt;facet_list= facet;</span></a>
<a name="3237"><span class="lineNum">    3237 </span><span class="lineCov">      63276 :   if (qh-&gt;facet_next == list)</span></a>
<a name="3238"><span class="lineNum">    3238 </span><span class="lineCov">         10 :     qh-&gt;facet_next= facet;</span></a>
<a name="3239"><span class="lineNum">    3239 </span><span class="lineCov">      63276 :   *facetlist= facet;</span></a>
<a name="3240"><span class="lineNum">    3240 </span><span class="lineCov">      63276 :   qh-&gt;num_facets++;</span></a>
<a name="3241"><span class="lineNum">    3241 </span><span class="lineCov">      63276 : } /* prependfacet */</span></a>
<a name="3242"><span class="lineNum">    3242 </span>            : </a>
<a name="3243"><span class="lineNum">    3243 </span>            : </a>
<a name="3244"><span class="lineNum">    3244 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="3245"><span class="lineNum">    3245 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;printhashtable&quot;&gt;-&lt;/a&gt;</a>
<a name="3246"><span class="lineNum">    3246 </span>            : </a>
<a name="3247"><span class="lineNum">    3247 </span>            :   qh_printhashtable(qh, fp )</a>
<a name="3248"><span class="lineNum">    3248 </span>            :     print hash table to fp</a>
<a name="3249"><span class="lineNum">    3249 </span>            : </a>
<a name="3250"><span class="lineNum">    3250 </span>            :   notes:</a>
<a name="3251"><span class="lineNum">    3251 </span>            :     not in I/O to avoid bringing io_r.c in</a>
<a name="3252"><span class="lineNum">    3252 </span>            : </a>
<a name="3253"><span class="lineNum">    3253 </span>            :   design:</a>
<a name="3254"><span class="lineNum">    3254 </span>            :     for each hash entry</a>
<a name="3255"><span class="lineNum">    3255 </span>            :       if defined</a>
<a name="3256"><span class="lineNum">    3256 </span>            :         if unmatched or will merge (NULL, qh_MERGEridge, qh_DUPLICATEridge)</a>
<a name="3257"><span class="lineNum">    3257 </span>            :           print entry and neighbors</a>
<a name="3258"><span class="lineNum">    3258 </span>            : */</a>
<a name="3259"><span class="lineNum">    3259 </span><span class="lineNoCov">          0 : void qh_printhashtable(qhT *qh, FILE *fp) {</span></a>
<a name="3260"><span class="lineNum">    3260 </span>            :   facetT *facet, *neighbor;</a>
<a name="3261"><span class="lineNum">    3261 </span><span class="lineNoCov">          0 :   int id, facet_i, facet_n, neighbor_i= 0, neighbor_n= 0;</span></a>
<a name="3262"><span class="lineNum">    3262 </span>            :   vertexT *vertex, **vertexp;</a>
<a name="3263"><span class="lineNum">    3263 </span>            : </a>
<a name="3264"><span class="lineNum">    3264 </span><span class="lineNoCov">          0 :   FOREACHfacet_i_(qh, qh-&gt;hash_table) {</span></a>
<a name="3265"><span class="lineNum">    3265 </span><span class="lineNoCov">          0 :     if (facet) {</span></a>
<a name="3266"><span class="lineNum">    3266 </span><span class="lineNoCov">          0 :       FOREACHneighbor_i_(qh, facet) {</span></a>
<a name="3267"><span class="lineNum">    3267 </span><span class="lineNoCov">          0 :         if (!neighbor || neighbor == qh_MERGEridge || neighbor == qh_DUPLICATEridge)</span></a>
<a name="3268"><span class="lineNum">    3268 </span>            :           break;</a>
<a name="3269"><span class="lineNum">    3269 </span>            :       }</a>
<a name="3270"><span class="lineNum">    3270 </span><span class="lineNoCov">          0 :       if (neighbor_i == neighbor_n)</span></a>
<a name="3271"><span class="lineNum">    3271 </span><span class="lineNoCov">          0 :         continue;</span></a>
<a name="3272"><span class="lineNum">    3272 </span><span class="lineNoCov">          0 :       qh_fprintf(qh, fp, 9283, &quot;hash %d f%d &quot;, facet_i, facet-&gt;id);</span></a>
<a name="3273"><span class="lineNum">    3273 </span><span class="lineNoCov">          0 :       FOREACHvertex_(facet-&gt;vertices)</span></a>
<a name="3274"><span class="lineNum">    3274 </span><span class="lineNoCov">          0 :         qh_fprintf(qh, fp, 9284, &quot;v%d &quot;, vertex-&gt;id);</span></a>
<a name="3275"><span class="lineNum">    3275 </span><span class="lineNoCov">          0 :       qh_fprintf(qh, fp, 9285, &quot;\n neighbors:&quot;);</span></a>
<a name="3276"><span class="lineNum">    3276 </span><span class="lineNoCov">          0 :       FOREACHneighbor_i_(qh, facet) {</span></a>
<a name="3277"><span class="lineNum">    3277 </span><span class="lineNoCov">          0 :         if (neighbor == qh_MERGEridge)</span></a>
<a name="3278"><span class="lineNum">    3278 </span><span class="lineNoCov">          0 :           id= -3;</span></a>
<a name="3279"><span class="lineNum">    3279 </span><span class="lineNoCov">          0 :         else if (neighbor == qh_DUPLICATEridge)</span></a>
<a name="3280"><span class="lineNum">    3280 </span><span class="lineNoCov">          0 :           id= -2;</span></a>
<a name="3281"><span class="lineNum">    3281 </span>            :         else</a>
<a name="3282"><span class="lineNum">    3282 </span><span class="lineNoCov">          0 :           id= getid_(neighbor);</span></a>
<a name="3283"><span class="lineNum">    3283 </span><span class="lineNoCov">          0 :         qh_fprintf(qh, fp, 9286, &quot; %d&quot;, id);</span></a>
<a name="3284"><span class="lineNum">    3284 </span>            :       }</a>
<a name="3285"><span class="lineNum">    3285 </span><span class="lineNoCov">          0 :       qh_fprintf(qh, fp, 9287, &quot;\n&quot;);</span></a>
<a name="3286"><span class="lineNum">    3286 </span>            :     }</a>
<a name="3287"><span class="lineNum">    3287 </span>            :   }</a>
<a name="3288"><span class="lineNum">    3288 </span><span class="lineNoCov">          0 : } /* printhashtable */</span></a>
<a name="3289"><span class="lineNum">    3289 </span>            : </a>
<a name="3290"><span class="lineNum">    3290 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="3291"><span class="lineNum">    3291 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;printlists&quot;&gt;-&lt;/a&gt;</a>
<a name="3292"><span class="lineNum">    3292 </span>            : </a>
<a name="3293"><span class="lineNum">    3293 </span>            :   qh_printlists(qh)</a>
<a name="3294"><span class="lineNum">    3294 </span>            :     print out facet and vertex lists for debugging (without 'f/v' tags)</a>
<a name="3295"><span class="lineNum">    3295 </span>            : </a>
<a name="3296"><span class="lineNum">    3296 </span>            :   notes:</a>
<a name="3297"><span class="lineNum">    3297 </span>            :     not in I/O to avoid bringing io_r.c in</a>
<a name="3298"><span class="lineNum">    3298 </span>            : */</a>
<a name="3299"><span class="lineNum">    3299 </span><span class="lineNoCov">          0 : void qh_printlists(qhT *qh) {</span></a>
<a name="3300"><span class="lineNum">    3300 </span>            :   facetT *facet;</a>
<a name="3301"><span class="lineNum">    3301 </span>            :   vertexT *vertex;</a>
<a name="3302"><span class="lineNum">    3302 </span><span class="lineNoCov">          0 :   int count= 0;</span></a>
<a name="3303"><span class="lineNum">    3303 </span>            : </a>
<a name="3304"><span class="lineNum">    3304 </span><span class="lineNoCov">          0 :   qh_fprintf(qh, qh-&gt;ferr, 3062, &quot;qh_printlists: max_outside %2.2g all facets:&quot;, qh-&gt;max_outside);</span></a>
<a name="3305"><span class="lineNum">    3305 </span><span class="lineNoCov">          0 :   FORALLfacets{</span></a>
<a name="3306"><span class="lineNum">    3306 </span><span class="lineNoCov">          0 :     if (++count % 100 == 0)</span></a>
<a name="3307"><span class="lineNum">    3307 </span><span class="lineNoCov">          0 :       qh_fprintf(qh, qh-&gt;ferr, 8109, &quot;\n     &quot;);</span></a>
<a name="3308"><span class="lineNum">    3308 </span><span class="lineNoCov">          0 :     qh_fprintf(qh, qh-&gt;ferr, 8110, &quot; %d&quot;, facet-&gt;id);</span></a>
<a name="3309"><span class="lineNum">    3309 </span>            :   }</a>
<a name="3310"><span class="lineNum">    3310 </span><span class="lineNoCov">          0 :     qh_fprintf(qh, qh-&gt;ferr, 8111, &quot;\n  qh.visible_list f%d, newfacet_list f%d, facet_next f%d for qh_addpoint\n  qh.newvertex_list v%d all vertices:&quot;,</span></a>
<a name="3311"><span class="lineNum">    3311 </span><span class="lineNoCov">          0 :       getid_(qh-&gt;visible_list), getid_(qh-&gt;newfacet_list), getid_(qh-&gt;facet_next), getid_(qh-&gt;newvertex_list));</span></a>
<a name="3312"><span class="lineNum">    3312 </span><span class="lineNoCov">          0 :   count= 0;</span></a>
<a name="3313"><span class="lineNum">    3313 </span><span class="lineNoCov">          0 :   FORALLvertices{</span></a>
<a name="3314"><span class="lineNum">    3314 </span><span class="lineNoCov">          0 :     if (++count % 100 == 0)</span></a>
<a name="3315"><span class="lineNum">    3315 </span><span class="lineNoCov">          0 :       qh_fprintf(qh, qh-&gt;ferr, 8112, &quot;\n     &quot;);</span></a>
<a name="3316"><span class="lineNum">    3316 </span><span class="lineNoCov">          0 :     qh_fprintf(qh, qh-&gt;ferr, 8113, &quot; %d&quot;, vertex-&gt;id);</span></a>
<a name="3317"><span class="lineNum">    3317 </span>            :   }</a>
<a name="3318"><span class="lineNum">    3318 </span><span class="lineNoCov">          0 :   qh_fprintf(qh, qh-&gt;ferr, 8114, &quot;\n&quot;);</span></a>
<a name="3319"><span class="lineNum">    3319 </span><span class="lineNoCov">          0 : } /* printlists */</span></a>
<a name="3320"><span class="lineNum">    3320 </span>            : </a>
<a name="3321"><span class="lineNum">    3321 </span>            : /*-&lt;a                             href=&quot;qh-poly.htm#TOC&quot;</a>
<a name="3322"><span class="lineNum">    3322 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;addfacetvertex&quot;&gt;-&lt;/a&gt;</a>
<a name="3323"><span class="lineNum">    3323 </span>            : </a>
<a name="3324"><span class="lineNum">    3324 </span>            :   qh_replacefacetvertex(qh, facet, oldvertex, newvertex )</a>
<a name="3325"><span class="lineNum">    3325 </span>            :     replace oldvertex with newvertex in f.vertices</a>
<a name="3326"><span class="lineNum">    3326 </span>            :     vertices are inverse sorted by vertex-&gt;id</a>
<a name="3327"><span class="lineNum">    3327 </span>            : </a>
<a name="3328"><span class="lineNum">    3328 </span>            :   returns:</a>
<a name="3329"><span class="lineNum">    3329 </span>            :     toporient is flipped if an odd parity, position change</a>
<a name="3330"><span class="lineNum">    3330 </span>            : </a>
<a name="3331"><span class="lineNum">    3331 </span>            :   notes:</a>
<a name="3332"><span class="lineNum">    3332 </span>            :     for simplicial facets in qh_rename_adjacentvertex</a>
<a name="3333"><span class="lineNum">    3333 </span>            :     see qh_addfacetvertex</a>
<a name="3334"><span class="lineNum">    3334 </span>            : */</a>
<a name="3335"><span class="lineNum">    3335 </span><span class="lineNoCov">          0 : void qh_replacefacetvertex(qhT *qh, facetT *facet, vertexT *oldvertex, vertexT *newvertex) {</span></a>
<a name="3336"><span class="lineNum">    3336 </span>            :   vertexT *vertex;</a>
<a name="3337"><span class="lineNum">    3337 </span>            :   facetT *neighbor;</a>
<a name="3338"><span class="lineNum">    3338 </span><span class="lineNoCov">          0 :   int vertex_i, vertex_n= 0;</span></a>
<a name="3339"><span class="lineNum">    3339 </span><span class="lineNoCov">          0 :   int old_i= -1, new_i= -1;</span></a>
<a name="3340"><span class="lineNum">    3340 </span>            : </a>
<a name="3341"><span class="lineNum">    3341 </span><span class="lineNoCov">          0 :   trace3((qh, qh-&gt;ferr, 3038, &quot;qh_replacefacetvertex: replace v%d with v%d in f%d\n&quot;, oldvertex-&gt;id, newvertex-&gt;id, facet-&gt;id));</span></a>
<a name="3342"><span class="lineNum">    3342 </span><span class="lineNoCov">          0 :   if (!facet-&gt;simplicial) {</span></a>
<a name="3343"><span class="lineNum">    3343 </span><span class="lineNoCov">          0 :     qh_fprintf(qh, qh-&gt;ferr, 6283, &quot;qhull internal error (qh_replacefacetvertex): f%d is not simplicial\n&quot;, facet-&gt;id);</span></a>
<a name="3344"><span class="lineNum">    3344 </span><span class="lineNoCov">          0 :     qh_errexit(qh, qh_ERRqhull, facet, NULL);</span></a>
<a name="3345"><span class="lineNum">    3345 </span>            :   }</a>
<a name="3346"><span class="lineNum">    3346 </span><span class="lineNoCov">          0 :   FOREACHvertex_i_(qh, facet-&gt;vertices) {</span></a>
<a name="3347"><span class="lineNum">    3347 </span><span class="lineNoCov">          0 :     if (new_i == -1 &amp;&amp; vertex-&gt;id &lt; newvertex-&gt;id) {</span></a>
<a name="3348"><span class="lineNum">    3348 </span><span class="lineNoCov">          0 :       new_i= vertex_i;</span></a>
<a name="3349"><span class="lineNum">    3349 </span><span class="lineNoCov">          0 :     }else if (vertex-&gt;id == newvertex-&gt;id) {</span></a>
<a name="3350"><span class="lineNum">    3350 </span><span class="lineNoCov">          0 :       qh_fprintf(qh, qh-&gt;ferr, 6281, &quot;qhull internal error (qh_replacefacetvertex): f%d already contains new v%d\n&quot;, facet-&gt;id, newvertex-&gt;id);</span></a>
<a name="3351"><span class="lineNum">    3351 </span><span class="lineNoCov">          0 :       qh_errexit(qh, qh_ERRqhull, facet, NULL);</span></a>
<a name="3352"><span class="lineNum">    3352 </span>            :     }</a>
<a name="3353"><span class="lineNum">    3353 </span><span class="lineNoCov">          0 :     if (vertex-&gt;id == oldvertex-&gt;id) {</span></a>
<a name="3354"><span class="lineNum">    3354 </span><span class="lineNoCov">          0 :       old_i= vertex_i;</span></a>
<a name="3355"><span class="lineNum">    3355 </span>            :     }</a>
<a name="3356"><span class="lineNum">    3356 </span>            :   }</a>
<a name="3357"><span class="lineNum">    3357 </span><span class="lineNoCov">          0 :   if (old_i == -1) {</span></a>
<a name="3358"><span class="lineNum">    3358 </span><span class="lineNoCov">          0 :     qh_fprintf(qh, qh-&gt;ferr, 6282, &quot;qhull internal error (qh_replacefacetvertex): f%d does not contain old v%d\n&quot;, facet-&gt;id, oldvertex-&gt;id);</span></a>
<a name="3359"><span class="lineNum">    3359 </span><span class="lineNoCov">          0 :     qh_errexit(qh, qh_ERRqhull, facet, NULL);</span></a>
<a name="3360"><span class="lineNum">    3360 </span>            :   }</a>
<a name="3361"><span class="lineNum">    3361 </span><span class="lineNoCov">          0 :   if (new_i == -1) {</span></a>
<a name="3362"><span class="lineNum">    3362 </span><span class="lineNoCov">          0 :     new_i= vertex_n;</span></a>
<a name="3363"><span class="lineNum">    3363 </span>            :   }</a>
<a name="3364"><span class="lineNum">    3364 </span><span class="lineNoCov">          0 :   if (old_i &lt; new_i)</span></a>
<a name="3365"><span class="lineNum">    3365 </span><span class="lineNoCov">          0 :     new_i--;</span></a>
<a name="3366"><span class="lineNum">    3366 </span><span class="lineNoCov">          0 :   if ((old_i &amp; 0x1) != (new_i &amp; 0x1))</span></a>
<a name="3367"><span class="lineNum">    3367 </span><span class="lineNoCov">          0 :     facet-&gt;toporient ^= 1;</span></a>
<a name="3368"><span class="lineNum">    3368 </span><span class="lineNoCov">          0 :   qh_setdelnthsorted(qh, facet-&gt;vertices, old_i);</span></a>
<a name="3369"><span class="lineNum">    3369 </span><span class="lineNoCov">          0 :   qh_setaddnth(qh, &amp;facet-&gt;vertices, new_i, newvertex);</span></a>
<a name="3370"><span class="lineNum">    3370 </span><span class="lineNoCov">          0 :   neighbor= SETelemt_(facet-&gt;neighbors, old_i, facetT);</span></a>
<a name="3371"><span class="lineNum">    3371 </span><span class="lineNoCov">          0 :   qh_setdelnthsorted(qh, facet-&gt;neighbors, old_i);</span></a>
<a name="3372"><span class="lineNum">    3372 </span><span class="lineNoCov">          0 :   qh_setaddnth(qh, &amp;facet-&gt;neighbors, new_i, neighbor);</span></a>
<a name="3373"><span class="lineNum">    3373 </span><span class="lineNoCov">          0 : } /* replacefacetvertex */</span></a>
<a name="3374"><span class="lineNum">    3374 </span>            : </a>
<a name="3375"><span class="lineNum">    3375 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="3376"><span class="lineNum">    3376 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;resetlists&quot;&gt;-&lt;/a&gt;</a>
<a name="3377"><span class="lineNum">    3377 </span>            : </a>
<a name="3378"><span class="lineNum">    3378 </span>            :   qh_resetlists(qh, stats, qh_RESETvisible )</a>
<a name="3379"><span class="lineNum">    3379 </span>            :     reset newvertex_list, newfacet_list, visible_list, NEWfacets, NEWtentative</a>
<a name="3380"><span class="lineNum">    3380 </span>            :     if stats,</a>
<a name="3381"><span class="lineNum">    3381 </span>            :       maintains statistics</a>
<a name="3382"><span class="lineNum">    3382 </span>            :     if resetVisible,</a>
<a name="3383"><span class="lineNum">    3383 </span>            :       visible_list is restored to facet_list</a>
<a name="3384"><span class="lineNum">    3384 </span>            :       otherwise, f.visible/f.replace is retained</a>
<a name="3385"><span class="lineNum">    3385 </span>            : </a>
<a name="3386"><span class="lineNum">    3386 </span>            :   returns:</a>
<a name="3387"><span class="lineNum">    3387 </span>            :     newvertex_list, newfacet_list, visible_list are NULL</a>
<a name="3388"><span class="lineNum">    3388 </span>            : </a>
<a name="3389"><span class="lineNum">    3389 </span>            :   notes:</a>
<a name="3390"><span class="lineNum">    3390 </span>            :     To delete visible facets, call qh_deletevisible before qh_resetlists</a>
<a name="3391"><span class="lineNum">    3391 </span>            : */</a>
<a name="3392"><span class="lineNum">    3392 </span><span class="lineCov">      29100 : void qh_resetlists(qhT *qh, boolT stats, boolT resetVisible /* qh.newvertex_list newfacet_list visible_list */) {</span></a>
<a name="3393"><span class="lineNum">    3393 </span>            :   vertexT *vertex;</a>
<a name="3394"><span class="lineNum">    3394 </span>            :   facetT *newfacet, *visible;</a>
<a name="3395"><span class="lineNum">    3395 </span><span class="lineCov">      29100 :   int totnew=0, totver=0;</span></a>
<a name="3396"><span class="lineNum">    3396 </span>            : </a>
<a name="3397"><span class="lineNum">    3397 </span><span class="lineCov">      29100 :   trace2((qh, qh-&gt;ferr, 2066, &quot;qh_resetlists: reset newvertex_list v%d, newfacet_list f%d, visible_list f%d, facet_list f%d next f%d vertex_list v%d -- NEWfacets? %d, NEWtentative? %d, stats? %d\n&quot;,</span></a>
<a name="3398"><span class="lineNum">    3398 </span>            :     getid_(qh-&gt;newvertex_list), getid_(qh-&gt;newfacet_list), getid_(qh-&gt;visible_list), getid_(qh-&gt;facet_list), getid_(qh-&gt;facet_next), getid_(qh-&gt;vertex_list), qh-&gt;NEWfacets, qh-&gt;NEWtentative, stats));</a>
<a name="3399"><span class="lineNum">    3399 </span><span class="lineCov">      29100 :   if (stats) {</span></a>
<a name="3400"><span class="lineNum">    3400 </span><span class="lineCov">     151026 :     FORALLvertex_(qh-&gt;newvertex_list)</span></a>
<a name="3401"><span class="lineNum">    3401 </span><span class="lineCov">     136356 :       totver++;</span></a>
<a name="3402"><span class="lineNum">    3402 </span><span class="lineCov">      88109 :     FORALLnew_facets</span></a>
<a name="3403"><span class="lineNum">    3403 </span><span class="lineCov">      73439 :       totnew++;</span></a>
<a name="3404"><span class="lineNum">    3404 </span><span class="lineCov">      14670 :     zadd_(Zvisvertextot, totver);</span></a>
<a name="3405"><span class="lineNum">    3405 </span><span class="lineCov">      14670 :     zmax_(Zvisvertexmax, totver);</span></a>
<a name="3406"><span class="lineNum">    3406 </span><span class="lineCov">      14670 :     zadd_(Znewfacettot, totnew);</span></a>
<a name="3407"><span class="lineNum">    3407 </span><span class="lineCov">      14670 :     zmax_(Znewfacetmax, totnew);</span></a>
<a name="3408"><span class="lineNum">    3408 </span>            :   }</a>
<a name="3409"><span class="lineNum">    3409 </span><span class="lineCov">     180137 :   FORALLvertex_(qh-&gt;newvertex_list)</span></a>
<a name="3410"><span class="lineNum">    3410 </span><span class="lineCov">     151037 :     vertex-&gt;newfacet= False;</span></a>
<a name="3411"><span class="lineNum">    3411 </span><span class="lineCov">      29100 :   qh-&gt;newvertex_list= NULL;</span></a>
<a name="3412"><span class="lineNum">    3412 </span><span class="lineCov">      29100 :   qh-&gt;first_newfacet= 0;</span></a>
<a name="3413"><span class="lineNum">    3413 </span><span class="lineCov">     160663 :   FORALLnew_facets {</span></a>
<a name="3414"><span class="lineNum">    3414 </span><span class="lineCov">     131563 :     newfacet-&gt;newfacet= False;</span></a>
<a name="3415"><span class="lineNum">    3415 </span><span class="lineCov">     131563 :     newfacet-&gt;dupridge= False;</span></a>
<a name="3416"><span class="lineNum">    3416 </span>            :   }</a>
<a name="3417"><span class="lineNum">    3417 </span><span class="lineCov">      29100 :   qh-&gt;newfacet_list= NULL;</span></a>
<a name="3418"><span class="lineNum">    3418 </span><span class="lineCov">      29100 :   if (resetVisible) {</span></a>
<a name="3419"><span class="lineNum">    3419 </span><span class="lineCov">      14687 :     FORALLvisible_facets {</span></a>
<a name="3420"><span class="lineNum">    3420 </span><span class="lineNoCov">          0 :       visible-&gt;f.replace= NULL;</span></a>
<a name="3421"><span class="lineNum">    3421 </span><span class="lineNoCov">          0 :       visible-&gt;visible= False;</span></a>
<a name="3422"><span class="lineNum">    3422 </span>            :     }</a>
<a name="3423"><span class="lineNum">    3423 </span><span class="lineCov">      14687 :     qh-&gt;num_visible= 0;</span></a>
<a name="3424"><span class="lineNum">    3424 </span>            :   }</a>
<a name="3425"><span class="lineNum">    3425 </span><span class="lineCov">      29100 :   qh-&gt;visible_list= NULL;</span></a>
<a name="3426"><span class="lineNum">    3426 </span><span class="lineCov">      29100 :   qh-&gt;NEWfacets= False;</span></a>
<a name="3427"><span class="lineNum">    3427 </span><span class="lineCov">      29100 :   qh-&gt;NEWtentative= False;</span></a>
<a name="3428"><span class="lineNum">    3428 </span><span class="lineCov">      29100 : } /* resetlists */</span></a>
<a name="3429"><span class="lineNum">    3429 </span>            : </a>
<a name="3430"><span class="lineNum">    3430 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="3431"><span class="lineNum">    3431 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;setvoronoi_all&quot;&gt;-&lt;/a&gt;</a>
<a name="3432"><span class="lineNum">    3432 </span>            : </a>
<a name="3433"><span class="lineNum">    3433 </span>            :   qh_setvoronoi_all(qh)</a>
<a name="3434"><span class="lineNum">    3434 </span>            :     compute Voronoi centers for all facets</a>
<a name="3435"><span class="lineNum">    3435 </span>            :     includes upperDelaunay facets if qh.UPPERdelaunay ('Qu')</a>
<a name="3436"><span class="lineNum">    3436 </span>            : </a>
<a name="3437"><span class="lineNum">    3437 </span>            :   returns:</a>
<a name="3438"><span class="lineNum">    3438 </span>            :     facet-&gt;center is the Voronoi center</a>
<a name="3439"><span class="lineNum">    3439 </span>            : </a>
<a name="3440"><span class="lineNum">    3440 </span>            :   notes:</a>
<a name="3441"><span class="lineNum">    3441 </span>            :     unused/untested code: please email bradb@shore.net if this works ok for you</a>
<a name="3442"><span class="lineNum">    3442 </span>            : </a>
<a name="3443"><span class="lineNum">    3443 </span>            :   use:</a>
<a name="3444"><span class="lineNum">    3444 </span>            :     FORALLvertices {...} to locate the vertex for a point.</a>
<a name="3445"><span class="lineNum">    3445 </span>            :     FOREACHneighbor_(vertex) {...} to visit the Voronoi centers for a Voronoi cell.</a>
<a name="3446"><span class="lineNum">    3446 </span>            : */</a>
<a name="3447"><span class="lineNum">    3447 </span><span class="lineNoCov">          0 : void qh_setvoronoi_all(qhT *qh) {</span></a>
<a name="3448"><span class="lineNum">    3448 </span>            :   facetT *facet;</a>
<a name="3449"><span class="lineNum">    3449 </span>            : </a>
<a name="3450"><span class="lineNum">    3450 </span><span class="lineNoCov">          0 :   qh_clearcenters(qh, qh_ASvoronoi);</span></a>
<a name="3451"><span class="lineNum">    3451 </span><span class="lineNoCov">          0 :   qh_vertexneighbors(qh);</span></a>
<a name="3452"><span class="lineNum">    3452 </span>            : </a>
<a name="3453"><span class="lineNum">    3453 </span><span class="lineNoCov">          0 :   FORALLfacets {</span></a>
<a name="3454"><span class="lineNum">    3454 </span><span class="lineNoCov">          0 :     if (!facet-&gt;normal || !facet-&gt;upperdelaunay || qh-&gt;UPPERdelaunay) {</span></a>
<a name="3455"><span class="lineNum">    3455 </span><span class="lineNoCov">          0 :       if (!facet-&gt;center)</span></a>
<a name="3456"><span class="lineNum">    3456 </span><span class="lineNoCov">          0 :         facet-&gt;center= qh_facetcenter(qh, facet-&gt;vertices);</span></a>
<a name="3457"><span class="lineNum">    3457 </span>            :     }</a>
<a name="3458"><span class="lineNum">    3458 </span>            :   }</a>
<a name="3459"><span class="lineNum">    3459 </span><span class="lineNoCov">          0 : } /* setvoronoi_all */</span></a>
<a name="3460"><span class="lineNum">    3460 </span>            : </a>
<a name="3461"><span class="lineNum">    3461 </span>            : #ifndef qh_NOmerge</a>
<a name="3462"><span class="lineNum">    3462 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="3463"><span class="lineNum">    3463 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;triangulate&quot;&gt;-&lt;/a&gt;</a>
<a name="3464"><span class="lineNum">    3464 </span>            : </a>
<a name="3465"><span class="lineNum">    3465 </span>            :   qh_triangulate()</a>
<a name="3466"><span class="lineNum">    3466 </span>            :     triangulate non-simplicial facets on qh.facet_list,</a>
<a name="3467"><span class="lineNum">    3467 </span>            :     if qh-&gt;VORONOI, sets Voronoi centers of non-simplicial facets</a>
<a name="3468"><span class="lineNum">    3468 </span>            :     nop if hasTriangulation</a>
<a name="3469"><span class="lineNum">    3469 </span>            : </a>
<a name="3470"><span class="lineNum">    3470 </span>            :   returns:</a>
<a name="3471"><span class="lineNum">    3471 </span>            :     all facets simplicial</a>
<a name="3472"><span class="lineNum">    3472 </span>            :     each tricoplanar facet has -&gt;f.triowner == owner of -&gt;center,normal,etc.</a>
<a name="3473"><span class="lineNum">    3473 </span>            :     resets qh.newfacet_list and visible_list</a>
<a name="3474"><span class="lineNum">    3474 </span>            : </a>
<a name="3475"><span class="lineNum">    3475 </span>            :   notes:</a>
<a name="3476"><span class="lineNum">    3476 </span>            :     called by qh_prepare_output and user_eg2_r.c</a>
<a name="3477"><span class="lineNum">    3477 </span>            :     call after qh_check_output since may switch to Voronoi centers, and qh_checkconvex skips f.tricoplanar facets</a>
<a name="3478"><span class="lineNum">    3478 </span>            :     Output may overwrite -&gt;f.triowner with -&gt;f.area</a>
<a name="3479"><span class="lineNum">    3479 </span>            :     while running, 'triangulated_facet_list' is a list of</a>
<a name="3480"><span class="lineNum">    3480 </span>            :        one non-simplicial facet followed by its 'f.tricoplanar' triangulated facets</a>
<a name="3481"><span class="lineNum">    3481 </span>            :     See qh_buildcone</a>
<a name="3482"><span class="lineNum">    3482 </span>            : */</a>
<a name="3483"><span class="lineNum">    3483 </span><span class="lineCov">          8 : void qh_triangulate(qhT *qh /* qh.facet_list */) {</span></a>
<a name="3484"><span class="lineNum">    3484 </span>            :   facetT *facet, *nextfacet, *owner;</a>
<a name="3485"><span class="lineNum">    3485 </span><span class="lineCov">          8 :   facetT *neighbor, *visible= NULL, *facet1, *facet2, *triangulated_facet_list= NULL;</span></a>
<a name="3486"><span class="lineNum">    3486 </span><span class="lineCov">          8 :   facetT *orig_neighbor= NULL, *otherfacet;</span></a>
<a name="3487"><span class="lineNum">    3487 </span><span class="lineCov">          8 :   vertexT *triangulated_vertex_list= NULL;</span></a>
<a name="3488"><span class="lineNum">    3488 </span>            :   mergeT *merge;</a>
<a name="3489"><span class="lineNum">    3489 </span>            :   mergeType mergetype;</a>
<a name="3490"><span class="lineNum">    3490 </span>            :   int neighbor_i, neighbor_n;</a>
<a name="3491"><span class="lineNum">    3491 </span><span class="lineCov">          8 :   boolT onlygood= qh-&gt;ONLYgood;</span></a>
<a name="3492"><span class="lineNum">    3492 </span>            : </a>
<a name="3493"><span class="lineNum">    3493 </span><span class="lineCov">          8 :   if (qh-&gt;hasTriangulation)</span></a>
<a name="3494"><span class="lineNum">    3494 </span><span class="lineNoCov">          0 :       return;</span></a>
<a name="3495"><span class="lineNum">    3495 </span><span class="lineCov">          8 :   trace1((qh, qh-&gt;ferr, 1034, &quot;qh_triangulate: triangulate non-simplicial facets\n&quot;));</span></a>
<a name="3496"><span class="lineNum">    3496 </span><span class="lineCov">          8 :   if (qh-&gt;hull_dim == 2)</span></a>
<a name="3497"><span class="lineNum">    3497 </span><span class="lineNoCov">          0 :     return;</span></a>
<a name="3498"><span class="lineNum">    3498 </span><span class="lineCov">          8 :   if (qh-&gt;VORONOI) {  /* otherwise lose Voronoi centers [could rebuild vertex set from tricoplanar] */</span></a>
<a name="3499"><span class="lineNum">    3499 </span><span class="lineNoCov">          0 :     qh_clearcenters(qh, qh_ASvoronoi);</span></a>
<a name="3500"><span class="lineNum">    3500 </span><span class="lineNoCov">          0 :     qh_vertexneighbors(qh);</span></a>
<a name="3501"><span class="lineNum">    3501 </span>            :   }</a>
<a name="3502"><span class="lineNum">    3502 </span><span class="lineCov">          8 :   qh-&gt;ONLYgood= False; /* for makenew_nonsimplicial */</span></a>
<a name="3503"><span class="lineNum">    3503 </span><span class="lineCov">          8 :   qh-&gt;visit_id++;</span></a>
<a name="3504"><span class="lineNum">    3504 </span><span class="lineCov">          8 :   qh_initmergesets(qh /* qh.facet_mergeset,degen_mergeset,vertex_mergeset */);</span></a>
<a name="3505"><span class="lineNum">    3505 </span><span class="lineCov">          8 :   qh-&gt;newvertex_list= qh-&gt;vertex_tail;</span></a>
<a name="3506"><span class="lineNum">    3506 </span><span class="lineCov">      87000 :   for (facet=qh-&gt;facet_list; facet &amp;&amp; facet-&gt;next; facet= nextfacet) { /* non-simplicial facets moved to end */</span></a>
<a name="3507"><span class="lineNum">    3507 </span><span class="lineCov">      86992 :     nextfacet= facet-&gt;next;</span></a>
<a name="3508"><span class="lineNum">    3508 </span><span class="lineCov">      86992 :     if (facet-&gt;visible || facet-&gt;simplicial)</span></a>
<a name="3509"><span class="lineNum">    3509 </span><span class="lineCov">      72587 :       continue;</span></a>
<a name="3510"><span class="lineNum">    3510 </span>            :     /* triangulate all non-simplicial facets, otherwise merging does not work, e.g., RBOX c P-0.1 P+0.1 P+0.1 D3 | QHULL d Qt Tv */</a>
<a name="3511"><span class="lineNum">    3511 </span><span class="lineCov">      14405 :     if (!triangulated_facet_list)</span></a>
<a name="3512"><span class="lineNum">    3512 </span><span class="lineCov">          2 :       triangulated_facet_list= facet;  /* will be first triangulated facet */</span></a>
<a name="3513"><span class="lineNum">    3513 </span><span class="lineCov">      14405 :     qh_triangulate_facet(qh, facet, &amp;triangulated_vertex_list); /* qh_resetlists ! */</span></a>
<a name="3514"><span class="lineNum">    3514 </span>            :   }</a>
<a name="3515"><span class="lineNum">    3515 </span>            :   /* qh_checkpolygon invalid due to f.visible without qh.visible_list */</a>
<a name="3516"><span class="lineNum">    3516 </span><span class="lineCov">          8 :   trace2((qh, qh-&gt;ferr, 2047, &quot;qh_triangulate: delete null facets from facetlist f%d.  A null facet has the same first (apex) and second vertices\n&quot;, getid_(triangulated_facet_list)));</span></a>
<a name="3517"><span class="lineNum">    3517 </span><span class="lineCov">     101310 :   for (facet=triangulated_facet_list; facet &amp;&amp; facet-&gt;next; facet= nextfacet) {</span></a>
<a name="3518"><span class="lineNum">    3518 </span><span class="lineCov">     101302 :     nextfacet= facet-&gt;next;</span></a>
<a name="3519"><span class="lineNum">    3519 </span><span class="lineCov">     101302 :     if (facet-&gt;visible)</span></a>
<a name="3520"><span class="lineNum">    3520 </span><span class="lineCov">      43214 :       continue;</span></a>
<a name="3521"><span class="lineNum">    3521 </span><span class="lineCov">      58088 :     if (facet-&gt;ridges) {</span></a>
<a name="3522"><span class="lineNum">    3522 </span><span class="lineCov">      29040 :       if (qh_setsize(qh, facet-&gt;ridges) &gt; 0) {</span></a>
<a name="3523"><span class="lineNum">    3523 </span><span class="lineNoCov">          0 :         qh_fprintf(qh, qh-&gt;ferr, 6161, &quot;qhull internal error (qh_triangulate): ridges still defined for f%d\n&quot;, facet-&gt;id);</span></a>
<a name="3524"><span class="lineNum">    3524 </span><span class="lineNoCov">          0 :         qh_errexit(qh, qh_ERRqhull, facet, NULL);</span></a>
<a name="3525"><span class="lineNum">    3525 </span>            :       }</a>
<a name="3526"><span class="lineNum">    3526 </span><span class="lineCov">      29040 :       qh_setfree(qh, &amp;facet-&gt;ridges);</span></a>
<a name="3527"><span class="lineNum">    3527 </span>            :     }</a>
<a name="3528"><span class="lineNum">    3528 </span><span class="lineCov">      58088 :     if (SETfirst_(facet-&gt;vertices) == SETsecond_(facet-&gt;vertices)) {</span></a>
<a name="3529"><span class="lineNum">    3529 </span><span class="lineCov">      28810 :       zinc_(Ztrinull);</span></a>
<a name="3530"><span class="lineNum">    3530 </span><span class="lineCov">      28810 :       qh_triangulate_null(qh, facet); /* will delete facet */</span></a>
<a name="3531"><span class="lineNum">    3531 </span>            :     }</a>
<a name="3532"><span class="lineNum">    3532 </span>            :   }</a>
<a name="3533"><span class="lineNum">    3533 </span><span class="lineCov">          8 :   trace2((qh, qh-&gt;ferr, 2048, &quot;qh_triangulate: delete %d or more mirrored facets.  Mirrored facets have the same vertices due to a null facet\n&quot;, qh_setsize(qh, qh-&gt;degen_mergeset)));</span></a>
<a name="3534"><span class="lineNum">    3534 </span><span class="lineCov">          8 :   qh-&gt;visible_list= qh-&gt;facet_tail;</span></a>
<a name="3535"><span class="lineNum">    3535 </span><span class="lineCov">          8 :   while ((merge= (mergeT *)qh_setdellast(qh-&gt;degen_mergeset))) {</span></a>
<a name="3536"><span class="lineNum">    3536 </span><span class="lineNoCov">          0 :     facet1= merge-&gt;facet1;</span></a>
<a name="3537"><span class="lineNum">    3537 </span><span class="lineNoCov">          0 :     facet2= merge-&gt;facet2;</span></a>
<a name="3538"><span class="lineNum">    3538 </span><span class="lineNoCov">          0 :     mergetype= merge-&gt;mergetype;</span></a>
<a name="3539"><span class="lineNum">    3539 </span><span class="lineNoCov">          0 :     qh_memfree(qh, merge, (int)sizeof(mergeT));</span></a>
<a name="3540"><span class="lineNum">    3540 </span><span class="lineNoCov">          0 :     if (mergetype == MRGmirror) {</span></a>
<a name="3541"><span class="lineNum">    3541 </span><span class="lineNoCov">          0 :       zinc_(Ztrimirror);</span></a>
<a name="3542"><span class="lineNum">    3542 </span><span class="lineNoCov">          0 :       qh_triangulate_mirror(qh, facet1, facet2);  /* will delete both facets */</span></a>
<a name="3543"><span class="lineNum">    3543 </span>            :     }</a>
<a name="3544"><span class="lineNum">    3544 </span>            :   }</a>
<a name="3545"><span class="lineNum">    3545 </span><span class="lineCov">          8 :   qh_freemergesets(qh);</span></a>
<a name="3546"><span class="lineNum">    3546 </span><span class="lineCov">          8 :   trace2((qh, qh-&gt;ferr, 2049, &quot;qh_triangulate: update neighbor lists for vertices from v%d\n&quot;, getid_(triangulated_vertex_list)));</span></a>
<a name="3547"><span class="lineNum">    3547 </span><span class="lineCov">          8 :   qh-&gt;newvertex_list= triangulated_vertex_list;  /* all vertices of triangulated facets */</span></a>
<a name="3548"><span class="lineNum">    3548 </span><span class="lineCov">          8 :   qh-&gt;visible_list= NULL;</span></a>
<a name="3549"><span class="lineNum">    3549 </span><span class="lineCov">          8 :   qh_update_vertexneighbors(qh /* qh.newvertex_list, empty newfacet_list and visible_list */);</span></a>
<a name="3550"><span class="lineNum">    3550 </span><span class="lineCov">          8 :   qh_resetlists(qh, False, !qh_RESETvisible /* qh.newvertex_list, empty newfacet_list and visible_list */);</span></a>
<a name="3551"><span class="lineNum">    3551 </span>            : </a>
<a name="3552"><span class="lineNum">    3552 </span><span class="lineCov">          8 :   trace2((qh, qh-&gt;ferr, 2050, &quot;qh_triangulate: identify degenerate tricoplanar facets from f%d\n&quot;, getid_(triangulated_facet_list)));</span></a>
<a name="3553"><span class="lineNum">    3553 </span><span class="lineCov">          8 :   trace2((qh, qh-&gt;ferr, 2051, &quot;qh_triangulate: and replace facet-&gt;f.triowner with tricoplanar facets that own center, normal, etc.\n&quot;));</span></a>
<a name="3554"><span class="lineNum">    3554 </span><span class="lineCov">      72501 :   FORALLfacet_(triangulated_facet_list) {</span></a>
<a name="3555"><span class="lineNum">    3555 </span><span class="lineCov">      72493 :     if (facet-&gt;tricoplanar &amp;&amp; !facet-&gt;visible) {</span></a>
<a name="3556"><span class="lineNum">    3556 </span><span class="lineCov">     117112 :       FOREACHneighbor_i_(qh, facet) {</span></a>
<a name="3557"><span class="lineNum">    3557 </span><span class="lineCov">      87834 :         if (neighbor_i == 0) {  /* first iteration */</span></a>
<a name="3558"><span class="lineNum">    3558 </span><span class="lineCov">      29278 :           if (neighbor-&gt;tricoplanar)</span></a>
<a name="3559"><span class="lineNum">    3559 </span><span class="lineCov">      29272 :             orig_neighbor= neighbor-&gt;f.triowner;</span></a>
<a name="3560"><span class="lineNum">    3560 </span>            :           else</a>
<a name="3561"><span class="lineNum">    3561 </span><span class="lineCov">          6 :             orig_neighbor= neighbor;</span></a>
<a name="3562"><span class="lineNum">    3562 </span>            :         }else {</a>
<a name="3563"><span class="lineNum">    3563 </span><span class="lineCov">      58556 :           if (neighbor-&gt;tricoplanar)</span></a>
<a name="3564"><span class="lineNum">    3564 </span><span class="lineCov">      58554 :             otherfacet= neighbor-&gt;f.triowner;</span></a>
<a name="3565"><span class="lineNum">    3565 </span>            :           else</a>
<a name="3566"><span class="lineNum">    3566 </span><span class="lineCov">          2 :             otherfacet= neighbor;</span></a>
<a name="3567"><span class="lineNum">    3567 </span><span class="lineCov">      58556 :           if (orig_neighbor == otherfacet) {</span></a>
<a name="3568"><span class="lineNum">    3568 </span><span class="lineNoCov">          0 :             zinc_(Ztridegen);</span></a>
<a name="3569"><span class="lineNum">    3569 </span><span class="lineNoCov">          0 :             facet-&gt;degenerate= True;</span></a>
<a name="3570"><span class="lineNum">    3570 </span><span class="lineNoCov">          0 :             break;</span></a>
<a name="3571"><span class="lineNum">    3571 </span>            :           }</a>
<a name="3572"><span class="lineNum">    3572 </span>            :         }</a>
<a name="3573"><span class="lineNum">    3573 </span>            :       }</a>
<a name="3574"><span class="lineNum">    3574 </span>            :     }</a>
<a name="3575"><span class="lineNum">    3575 </span>            :   }</a>
<a name="3576"><span class="lineNum">    3576 </span><span class="lineCov">          8 :   if (qh-&gt;IStracing &gt;= 4)</span></a>
<a name="3577"><span class="lineNum">    3577 </span><span class="lineNoCov">          0 :     qh_printlists(qh);</span></a>
<a name="3578"><span class="lineNum">    3578 </span><span class="lineCov">          8 :   trace2((qh, qh-&gt;ferr, 2052, &quot;qh_triangulate: delete visible facets -- non-simplicial, null, and mirrored facets\n&quot;));</span></a>
<a name="3579"><span class="lineNum">    3579 </span><span class="lineCov">          8 :   owner= NULL;</span></a>
<a name="3580"><span class="lineNum">    3580 </span><span class="lineCov">          8 :   visible= NULL;</span></a>
<a name="3581"><span class="lineNum">    3581 </span><span class="lineCov">      86906 :   for (facet=triangulated_facet_list; facet &amp;&amp; facet-&gt;next; facet= nextfacet) {</span></a>
<a name="3582"><span class="lineNum">    3582 </span>            :     /* deleting facets, triangulated_facet_list is no longer valid */</a>
<a name="3583"><span class="lineNum">    3583 </span><span class="lineCov">      86898 :     nextfacet= facet-&gt;next;</span></a>
<a name="3584"><span class="lineNum">    3584 </span><span class="lineCov">      86898 :     if (facet-&gt;visible) {</span></a>
<a name="3585"><span class="lineNum">    3585 </span><span class="lineCov">      43215 :       if (facet-&gt;tricoplanar) { /* a null or mirrored facet */</span></a>
<a name="3586"><span class="lineNum">    3586 </span><span class="lineCov">      28810 :         qh_delfacet(qh, facet);</span></a>
<a name="3587"><span class="lineNum">    3587 </span><span class="lineCov">      28810 :         qh-&gt;num_visible--;</span></a>
<a name="3588"><span class="lineNum">    3588 </span>            :       }else {  /* a non-simplicial facet followed by its tricoplanars */</a>
<a name="3589"><span class="lineNum">    3589 </span><span class="lineCov">      14405 :         if (visible &amp;&amp; !owner) {</span></a>
<a name="3590"><span class="lineNum">    3590 </span>            :           /*  RBOX 200 s D5 t1001471447 | QHULL Qt C-0.01 Qx Qc Tv Qt -- f4483 had 6 vertices/neighbors and 8 ridges */</a>
<a name="3591"><span class="lineNum">    3591 </span><span class="lineNoCov">          0 :           trace2((qh, qh-&gt;ferr, 2053, &quot;qh_triangulate: delete f%d.  All tricoplanar facets degenerate for non-simplicial facet\n&quot;,</span></a>
<a name="3592"><span class="lineNum">    3592 </span>            :                        visible-&gt;id));</a>
<a name="3593"><span class="lineNum">    3593 </span><span class="lineNoCov">          0 :           qh_delfacet(qh, visible);</span></a>
<a name="3594"><span class="lineNum">    3594 </span><span class="lineNoCov">          0 :           qh-&gt;num_visible--;</span></a>
<a name="3595"><span class="lineNum">    3595 </span>            :         }</a>
<a name="3596"><span class="lineNum">    3596 </span><span class="lineCov">      14405 :         visible= facet;</span></a>
<a name="3597"><span class="lineNum">    3597 </span><span class="lineCov">      14405 :         owner= NULL;</span></a>
<a name="3598"><span class="lineNum">    3598 </span>            :       }</a>
<a name="3599"><span class="lineNum">    3599 </span><span class="lineCov">      43683 :     }else if (facet-&gt;tricoplanar) {</span></a>
<a name="3600"><span class="lineNum">    3600 </span><span class="lineCov">      43683 :       if (facet-&gt;f.triowner != visible || visible==NULL) {</span></a>
<a name="3601"><span class="lineNum">    3601 </span><span class="lineNoCov">          0 :         qh_fprintf(qh, qh-&gt;ferr, 6162, &quot;qhull internal error (qh_triangulate): tricoplanar facet f%d not owned by its visible, non-simplicial facet f%d\n&quot;, facet-&gt;id, getid_(visible));</span></a>
<a name="3602"><span class="lineNum">    3602 </span><span class="lineNoCov">          0 :         qh_errexit2(qh, qh_ERRqhull, facet, visible);</span></a>
<a name="3603"><span class="lineNum">    3603 </span>            :       }</a>
<a name="3604"><span class="lineNum">    3604 </span><span class="lineCov">      43683 :       if (owner)</span></a>
<a name="3605"><span class="lineNum">    3605 </span><span class="lineCov">      29278 :         facet-&gt;f.triowner= owner;</span></a>
<a name="3606"><span class="lineNum">    3606 </span><span class="lineCov">      14405 :       else if (!facet-&gt;degenerate) {</span></a>
<a name="3607"><span class="lineNum">    3607 </span><span class="lineCov">      14405 :         owner= facet;</span></a>
<a name="3608"><span class="lineNum">    3608 </span><span class="lineCov">      14405 :         nextfacet= visible-&gt;next; /* rescan tricoplanar facets with owner, visible!=0 by QH6162 */</span></a>
<a name="3609"><span class="lineNum">    3609 </span><span class="lineCov">      14405 :         facet-&gt;keepcentrum= True;  /* one facet owns -&gt;normal, etc. */</span></a>
<a name="3610"><span class="lineNum">    3610 </span><span class="lineCov">      14405 :         facet-&gt;coplanarset= visible-&gt;coplanarset;</span></a>
<a name="3611"><span class="lineNum">    3611 </span><span class="lineCov">      14405 :         facet-&gt;outsideset= visible-&gt;outsideset;</span></a>
<a name="3612"><span class="lineNum">    3612 </span><span class="lineCov">      14405 :         visible-&gt;coplanarset= NULL;</span></a>
<a name="3613"><span class="lineNum">    3613 </span><span class="lineCov">      14405 :         visible-&gt;outsideset= NULL;</span></a>
<a name="3614"><span class="lineNum">    3614 </span><span class="lineCov">      14405 :         if (!qh-&gt;TRInormals) { /* center and normal copied to tricoplanar facets */</span></a>
<a name="3615"><span class="lineNum">    3615 </span><span class="lineCov">      14405 :           visible-&gt;center= NULL;</span></a>
<a name="3616"><span class="lineNum">    3616 </span><span class="lineCov">      14405 :           visible-&gt;normal= NULL;</span></a>
<a name="3617"><span class="lineNum">    3617 </span>            :         }</a>
<a name="3618"><span class="lineNum">    3618 </span><span class="lineCov">      14405 :         qh_delfacet(qh, visible);</span></a>
<a name="3619"><span class="lineNum">    3619 </span><span class="lineCov">      14405 :         qh-&gt;num_visible--;</span></a>
<a name="3620"><span class="lineNum">    3620 </span>            :       }</a>
<a name="3621"><span class="lineNum">    3621 </span>            :     }</a>
<a name="3622"><span class="lineNum">    3622 </span><span class="lineCov">      86898 :     facet-&gt;degenerate= False; /* reset f.degenerate set by qh_triangulate*/</span></a>
<a name="3623"><span class="lineNum">    3623 </span>            :   }</a>
<a name="3624"><span class="lineNum">    3624 </span><span class="lineCov">          8 :   if (visible &amp;&amp; !owner) {</span></a>
<a name="3625"><span class="lineNum">    3625 </span><span class="lineNoCov">          0 :     trace2((qh, qh-&gt;ferr, 2054, &quot;qh_triangulate: all tricoplanar facets degenerate for last non-simplicial facet f%d\n&quot;,</span></a>
<a name="3626"><span class="lineNum">    3626 </span>            :                  visible-&gt;id));</a>
<a name="3627"><span class="lineNum">    3627 </span><span class="lineNoCov">          0 :     qh_delfacet(qh, visible);</span></a>
<a name="3628"><span class="lineNum">    3628 </span><span class="lineNoCov">          0 :     qh-&gt;num_visible--;</span></a>
<a name="3629"><span class="lineNum">    3629 </span>            :   }</a>
<a name="3630"><span class="lineNum">    3630 </span><span class="lineCov">          8 :   qh-&gt;ONLYgood= onlygood; /* restore value */</span></a>
<a name="3631"><span class="lineNum">    3631 </span><span class="lineCov">          8 :   if (qh-&gt;CHECKfrequently)</span></a>
<a name="3632"><span class="lineNum">    3632 </span><span class="lineNoCov">          0 :     qh_checkpolygon(qh, qh-&gt;facet_list);</span></a>
<a name="3633"><span class="lineNum">    3633 </span><span class="lineCov">          8 :   qh-&gt;hasTriangulation= True;</span></a>
<a name="3634"><span class="lineNum">    3634 </span>            : } /* triangulate */</a>
<a name="3635"><span class="lineNum">    3635 </span>            : </a>
<a name="3636"><span class="lineNum">    3636 </span>            : </a>
<a name="3637"><span class="lineNum">    3637 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="3638"><span class="lineNum">    3638 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;triangulate_facet&quot;&gt;-&lt;/a&gt;</a>
<a name="3639"><span class="lineNum">    3639 </span>            : </a>
<a name="3640"><span class="lineNum">    3640 </span>            :   qh_triangulate_facet(qh, facetA, &amp;firstVertex )</a>
<a name="3641"><span class="lineNum">    3641 </span>            :     triangulate a non-simplicial facet</a>
<a name="3642"><span class="lineNum">    3642 </span>            :       if qh.CENTERtype=qh_ASvoronoi, sets its Voronoi center</a>
<a name="3643"><span class="lineNum">    3643 </span>            :   returns:</a>
<a name="3644"><span class="lineNum">    3644 </span>            :     qh.newfacet_list == simplicial facets</a>
<a name="3645"><span class="lineNum">    3645 </span>            :       facet-&gt;tricoplanar set and -&gt;keepcentrum false</a>
<a name="3646"><span class="lineNum">    3646 </span>            :       facet-&gt;degenerate set if duplicated apex</a>
<a name="3647"><span class="lineNum">    3647 </span>            :       facet-&gt;f.trivisible set to facetA</a>
<a name="3648"><span class="lineNum">    3648 </span>            :       facet-&gt;center copied from facetA (created if qh_ASvoronoi)</a>
<a name="3649"><span class="lineNum">    3649 </span>            :         qh_eachvoronoi, qh_detvridge, qh_detvridge3 assume centers copied</a>
<a name="3650"><span class="lineNum">    3650 </span>            :       facet-&gt;normal,offset,maxoutside copied from facetA</a>
<a name="3651"><span class="lineNum">    3651 </span>            : </a>
<a name="3652"><span class="lineNum">    3652 </span>            :   notes:</a>
<a name="3653"><span class="lineNum">    3653 </span>            :       only called by qh_triangulate</a>
<a name="3654"><span class="lineNum">    3654 </span>            :       qh_makenew_nonsimplicial uses neighbor-&gt;seen for the same</a>
<a name="3655"><span class="lineNum">    3655 </span>            :       if qh.TRInormals, newfacet-&gt;normal will need qh_free</a>
<a name="3656"><span class="lineNum">    3656 </span>            :         if qh.TRInormals and qh_AScentrum, newfacet-&gt;center will need qh_free</a>
<a name="3657"><span class="lineNum">    3657 </span>            :         keepcentrum is also set on Zwidefacet in qh_mergefacet</a>
<a name="3658"><span class="lineNum">    3658 </span>            :         freed by qh_clearcenters</a>
<a name="3659"><span class="lineNum">    3659 </span>            : </a>
<a name="3660"><span class="lineNum">    3660 </span>            :   see also:</a>
<a name="3661"><span class="lineNum">    3661 </span>            :       qh_addpoint() -- add a point</a>
<a name="3662"><span class="lineNum">    3662 </span>            :       qh_makenewfacets() -- construct a cone of facets for a new vertex</a>
<a name="3663"><span class="lineNum">    3663 </span>            : </a>
<a name="3664"><span class="lineNum">    3664 </span>            :   design:</a>
<a name="3665"><span class="lineNum">    3665 </span>            :       if qh_ASvoronoi,</a>
<a name="3666"><span class="lineNum">    3666 </span>            :          compute Voronoi center (facet-&gt;center)</a>
<a name="3667"><span class="lineNum">    3667 </span>            :       select first vertex (highest ID to preserve ID ordering of -&gt;vertices)</a>
<a name="3668"><span class="lineNum">    3668 </span>            :       triangulate from vertex to ridges</a>
<a name="3669"><span class="lineNum">    3669 </span>            :       copy facet-&gt;center, normal, offset</a>
<a name="3670"><span class="lineNum">    3670 </span>            :       update vertex neighbors</a>
<a name="3671"><span class="lineNum">    3671 </span>            : */</a>
<a name="3672"><span class="lineNum">    3672 </span><span class="lineCov">      14405 : void qh_triangulate_facet(qhT *qh, facetT *facetA, vertexT **first_vertex) {</span></a>
<a name="3673"><span class="lineNum">    3673 </span>            :   facetT *newfacet;</a>
<a name="3674"><span class="lineNum">    3674 </span>            :   facetT *neighbor, **neighborp;</a>
<a name="3675"><span class="lineNum">    3675 </span>            :   vertexT *apex;</a>
<a name="3676"><span class="lineNum">    3676 </span><span class="lineCov">      14405 :   int numnew=0;</span></a>
<a name="3677"><span class="lineNum">    3677 </span>            : </a>
<a name="3678"><span class="lineNum">    3678 </span><span class="lineCov">      14405 :   trace3((qh, qh-&gt;ferr, 3020, &quot;qh_triangulate_facet: triangulate facet f%d\n&quot;, facetA-&gt;id));</span></a>
<a name="3679"><span class="lineNum">    3679 </span>            : </a>
<a name="3680"><span class="lineNum">    3680 </span><span class="lineCov">      14405 :   qh-&gt;first_newfacet= qh-&gt;facet_id;</span></a>
<a name="3681"><span class="lineNum">    3681 </span><span class="lineCov">      14405 :   if (qh-&gt;IStracing &gt;= 4)</span></a>
<a name="3682"><span class="lineNum">    3682 </span><span class="lineNoCov">          0 :     qh_printfacet(qh, qh-&gt;ferr, facetA);</span></a>
<a name="3683"><span class="lineNum">    3683 </span><span class="lineCov">      72493 :   FOREACHneighbor_(facetA) {</span></a>
<a name="3684"><span class="lineNum">    3684 </span><span class="lineCov">      58088 :     neighbor-&gt;seen= False;</span></a>
<a name="3685"><span class="lineNum">    3685 </span><span class="lineCov">      58088 :     neighbor-&gt;coplanarhorizon= False;</span></a>
<a name="3686"><span class="lineNum">    3686 </span>            :   }</a>
<a name="3687"><span class="lineNum">    3687 </span><span class="lineCov">      14405 :   if (qh-&gt;CENTERtype == qh_ASvoronoi &amp;&amp; !facetA-&gt;center  /* matches upperdelaunay in qh_setfacetplane() */</span></a>
<a name="3688"><span class="lineNum">    3688 </span><span class="lineNoCov">          0 :   &amp;&amp; fabs_(facetA-&gt;normal[qh-&gt;hull_dim -1]) &gt;= qh-&gt;ANGLEround * qh_ZEROdelaunay) {</span></a>
<a name="3689"><span class="lineNum">    3689 </span><span class="lineNoCov">          0 :     facetA-&gt;center= qh_facetcenter(qh, facetA-&gt;vertices);</span></a>
<a name="3690"><span class="lineNum">    3690 </span>            :   }</a>
<a name="3691"><span class="lineNum">    3691 </span><span class="lineCov">      14405 :   qh-&gt;visible_list= qh-&gt;newfacet_list= qh-&gt;facet_tail;</span></a>
<a name="3692"><span class="lineNum">    3692 </span><span class="lineCov">      14405 :   facetA-&gt;visitid= qh-&gt;visit_id;</span></a>
<a name="3693"><span class="lineNum">    3693 </span><span class="lineCov">      14405 :   apex= SETfirstt_(facetA-&gt;vertices, vertexT);</span></a>
<a name="3694"><span class="lineNum">    3694 </span><span class="lineCov">      14405 :   qh_makenew_nonsimplicial(qh, facetA, apex, &amp;numnew);</span></a>
<a name="3695"><span class="lineNum">    3695 </span><span class="lineCov">      14405 :   qh_willdelete(qh, facetA, NULL);</span></a>
<a name="3696"><span class="lineNum">    3696 </span><span class="lineCov">      72493 :   FORALLnew_facets {</span></a>
<a name="3697"><span class="lineNum">    3697 </span><span class="lineCov">      58088 :     newfacet-&gt;tricoplanar= True;</span></a>
<a name="3698"><span class="lineNum">    3698 </span><span class="lineCov">      58088 :     newfacet-&gt;f.trivisible= facetA;</span></a>
<a name="3699"><span class="lineNum">    3699 </span><span class="lineCov">      58088 :     newfacet-&gt;degenerate= False;</span></a>
<a name="3700"><span class="lineNum">    3700 </span><span class="lineCov">      58088 :     newfacet-&gt;upperdelaunay= facetA-&gt;upperdelaunay;</span></a>
<a name="3701"><span class="lineNum">    3701 </span><span class="lineCov">      58088 :     newfacet-&gt;good= facetA-&gt;good;</span></a>
<a name="3702"><span class="lineNum">    3702 </span><span class="lineCov">      58088 :     if (qh-&gt;TRInormals) { /* 'Q11' triangulate duplicates -&gt;normal and -&gt;center */</span></a>
<a name="3703"><span class="lineNum">    3703 </span><span class="lineNoCov">          0 :       newfacet-&gt;keepcentrum= True;</span></a>
<a name="3704"><span class="lineNum">    3704 </span><span class="lineNoCov">          0 :       if(facetA-&gt;normal){</span></a>
<a name="3705"><span class="lineNum">    3705 </span><span class="lineNoCov">          0 :         newfacet-&gt;normal= (double *)qh_memalloc(qh, qh-&gt;normal_size);</span></a>
<a name="3706"><span class="lineNum">    3706 </span><span class="lineNoCov">          0 :         memcpy((char *)newfacet-&gt;normal, facetA-&gt;normal, (size_t)qh-&gt;normal_size);</span></a>
<a name="3707"><span class="lineNum">    3707 </span>            :       }</a>
<a name="3708"><span class="lineNum">    3708 </span><span class="lineNoCov">          0 :       if (qh-&gt;CENTERtype == qh_AScentrum)</span></a>
<a name="3709"><span class="lineNum">    3709 </span><span class="lineNoCov">          0 :         newfacet-&gt;center= qh_getcentrum(qh, newfacet);</span></a>
<a name="3710"><span class="lineNum">    3710 </span><span class="lineNoCov">          0 :       else if (qh-&gt;CENTERtype == qh_ASvoronoi &amp;&amp; facetA-&gt;center){</span></a>
<a name="3711"><span class="lineNum">    3711 </span><span class="lineNoCov">          0 :         newfacet-&gt;center= (double *)qh_memalloc(qh, qh-&gt;center_size);</span></a>
<a name="3712"><span class="lineNum">    3712 </span><span class="lineNoCov">          0 :         memcpy((char *)newfacet-&gt;center, facetA-&gt;center, (size_t)qh-&gt;center_size);</span></a>
<a name="3713"><span class="lineNum">    3713 </span>            :       }</a>
<a name="3714"><span class="lineNum">    3714 </span>            :     }else {</a>
<a name="3715"><span class="lineNum">    3715 </span><span class="lineCov">      58088 :       newfacet-&gt;keepcentrum= False;</span></a>
<a name="3716"><span class="lineNum">    3716 </span>            :       /* one facet will have keepcentrum=True at end of qh_triangulate */</a>
<a name="3717"><span class="lineNum">    3717 </span><span class="lineCov">      58088 :       newfacet-&gt;normal= facetA-&gt;normal;</span></a>
<a name="3718"><span class="lineNum">    3718 </span><span class="lineCov">      58088 :       newfacet-&gt;center= facetA-&gt;center;</span></a>
<a name="3719"><span class="lineNum">    3719 </span>            :     }</a>
<a name="3720"><span class="lineNum">    3720 </span><span class="lineCov">      58088 :     newfacet-&gt;offset= facetA-&gt;offset;</span></a>
<a name="3721"><span class="lineNum">    3721 </span>            : #if qh_MAXoutside</a>
<a name="3722"><span class="lineNum">    3722 </span><span class="lineCov">      58088 :     newfacet-&gt;maxoutside= facetA-&gt;maxoutside;</span></a>
<a name="3723"><span class="lineNum">    3723 </span>            : #endif</a>
<a name="3724"><span class="lineNum">    3724 </span>            :   }</a>
<a name="3725"><span class="lineNum">    3725 </span><span class="lineCov">      14405 :   qh_matchnewfacets(qh /* qh.newfacet_list */); /* ignore returned value, maxdupdist */</span></a>
<a name="3726"><span class="lineNum">    3726 </span><span class="lineCov">      14405 :   zinc_(Ztricoplanar);</span></a>
<a name="3727"><span class="lineNum">    3727 </span><span class="lineCov">      14405 :   zadd_(Ztricoplanartot, numnew);</span></a>
<a name="3728"><span class="lineNum">    3728 </span><span class="lineCov">      14405 :   zmax_(Ztricoplanarmax, numnew);</span></a>
<a name="3729"><span class="lineNum">    3729 </span><span class="lineCov">      14405 :   if (!(*first_vertex))</span></a>
<a name="3730"><span class="lineNum">    3730 </span><span class="lineCov">          2 :     (*first_vertex)= qh-&gt;newvertex_list;</span></a>
<a name="3731"><span class="lineNum">    3731 </span><span class="lineCov">      14405 :   qh-&gt;newvertex_list= NULL;</span></a>
<a name="3732"><span class="lineNum">    3732 </span><span class="lineCov">      14405 :   qh-&gt;visible_list= NULL;</span></a>
<a name="3733"><span class="lineNum">    3733 </span>            :   /* only update v.neighbors for qh.newfacet_list.  qh.visible_list and qh.newvertex_list are NULL */</a>
<a name="3734"><span class="lineNum">    3734 </span><span class="lineCov">      14405 :   qh_update_vertexneighbors(qh /* qh.newfacet_list */);</span></a>
<a name="3735"><span class="lineNum">    3735 </span><span class="lineCov">      14405 :   qh_resetlists(qh, False, !qh_RESETvisible /* qh.newfacet_list */);</span></a>
<a name="3736"><span class="lineNum">    3736 </span><span class="lineCov">      14405 : } /* triangulate_facet */</span></a>
<a name="3737"><span class="lineNum">    3737 </span>            : </a>
<a name="3738"><span class="lineNum">    3738 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="3739"><span class="lineNum">    3739 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;triangulate_link&quot;&gt;-&lt;/a&gt;</a>
<a name="3740"><span class="lineNum">    3740 </span>            : </a>
<a name="3741"><span class="lineNum">    3741 </span>            :   qh_triangulate_link(qh, oldfacetA, facetA, oldfacetB, facetB)</a>
<a name="3742"><span class="lineNum">    3742 </span>            :     relink facetA to facetB via null oldfacetA or mirrored oldfacetA and oldfacetB</a>
<a name="3743"><span class="lineNum">    3743 </span>            :   returns:</a>
<a name="3744"><span class="lineNum">    3744 </span>            :     if neighbors are already linked, will merge as MRGmirror (qh.degen_mergeset, 4-d and up)</a>
<a name="3745"><span class="lineNum">    3745 </span>            : */</a>
<a name="3746"><span class="lineNum">    3746 </span><span class="lineCov">      28810 : void qh_triangulate_link(qhT *qh, facetT *oldfacetA, facetT *facetA, facetT *oldfacetB, facetT *facetB) {</span></a>
<a name="3747"><span class="lineNum">    3747 </span><span class="lineCov">      28810 :   int errmirror= False;</span></a>
<a name="3748"><span class="lineNum">    3748 </span>            : </a>
<a name="3749"><span class="lineNum">    3749 </span><span class="lineCov">      28810 :   if (oldfacetA == oldfacetB) {</span></a>
<a name="3750"><span class="lineNum">    3750 </span><span class="lineCov">      28810 :     trace3((qh, qh-&gt;ferr, 3052, &quot;qh_triangulate_link: relink neighbors f%d and f%d of null facet f%d\n&quot;,</span></a>
<a name="3751"><span class="lineNum">    3751 </span>            :       facetA-&gt;id, facetB-&gt;id, oldfacetA-&gt;id));</a>
<a name="3752"><span class="lineNum">    3752 </span>            :   }else {</a>
<a name="3753"><span class="lineNum">    3753 </span><span class="lineNoCov">          0 :     trace3((qh, qh-&gt;ferr, 3021, &quot;qh_triangulate_link: relink neighbors f%d and f%d of mirrored facets f%d and f%d\n&quot;,</span></a>
<a name="3754"><span class="lineNum">    3754 </span>            :       facetA-&gt;id, facetB-&gt;id, oldfacetA-&gt;id, oldfacetB-&gt;id));</a>
<a name="3755"><span class="lineNum">    3755 </span>            :   }</a>
<a name="3756"><span class="lineNum">    3756 </span><span class="lineCov">      28810 :   if (qh_setin(facetA-&gt;neighbors, facetB)) {</span></a>
<a name="3757"><span class="lineNum">    3757 </span><span class="lineNoCov">          0 :     if (!qh_setin(facetB-&gt;neighbors, facetA))</span></a>
<a name="3758"><span class="lineNum">    3758 </span><span class="lineNoCov">          0 :       errmirror= True;</span></a>
<a name="3759"><span class="lineNum">    3759 </span><span class="lineNoCov">          0 :     else if (!facetA-&gt;redundant || !facetB-&gt;redundant || !qh_hasmerge(qh-&gt;degen_mergeset, MRGmirror, facetA, facetB))</span></a>
<a name="3760"><span class="lineNum">    3760 </span><span class="lineNoCov">          0 :       qh_appendmergeset(qh, facetA, facetB, MRGmirror, 0.0, 1.0);</span></a>
<a name="3761"><span class="lineNum">    3761 </span><span class="lineCov">      28810 :   }else if (qh_setin(facetB-&gt;neighbors, facetA))</span></a>
<a name="3762"><span class="lineNum">    3762 </span><span class="lineNoCov">          0 :     errmirror= True;</span></a>
<a name="3763"><span class="lineNum">    3763 </span><span class="lineCov">      28810 :   if (errmirror) {</span></a>
<a name="3764"><span class="lineNum">    3764 </span><span class="lineNoCov">          0 :     qh_fprintf(qh, qh-&gt;ferr, 6163, &quot;qhull internal error (qh_triangulate_link): neighbors f%d and f%d do not match for null facet or mirrored facets f%d and f%d\n&quot;,</span></a>
<a name="3765"><span class="lineNum">    3765 </span>            :        facetA-&gt;id, facetB-&gt;id, oldfacetA-&gt;id, oldfacetB-&gt;id);</a>
<a name="3766"><span class="lineNum">    3766 </span><span class="lineNoCov">          0 :     qh_errexit2(qh, qh_ERRqhull, facetA, facetB);</span></a>
<a name="3767"><span class="lineNum">    3767 </span>            :   }</a>
<a name="3768"><span class="lineNum">    3768 </span><span class="lineCov">      28810 :   qh_setreplace(qh, facetB-&gt;neighbors, oldfacetB, facetA);</span></a>
<a name="3769"><span class="lineNum">    3769 </span><span class="lineCov">      28810 :   qh_setreplace(qh, facetA-&gt;neighbors, oldfacetA, facetB);</span></a>
<a name="3770"><span class="lineNum">    3770 </span><span class="lineCov">      28810 : } /* triangulate_link */</span></a>
<a name="3771"><span class="lineNum">    3771 </span>            : </a>
<a name="3772"><span class="lineNum">    3772 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="3773"><span class="lineNum">    3773 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;triangulate_mirror&quot;&gt;-&lt;/a&gt;</a>
<a name="3774"><span class="lineNum">    3774 </span>            : </a>
<a name="3775"><span class="lineNum">    3775 </span>            :   qh_triangulate_mirror(qh, facetA, facetB)</a>
<a name="3776"><span class="lineNum">    3776 </span>            :     delete two mirrored facets identified by qh_triangulate_null() and itself</a>
<a name="3777"><span class="lineNum">    3777 </span>            :       a mirrored facet shares the same vertices of a logical ridge</a>
<a name="3778"><span class="lineNum">    3778 </span>            :   design:</a>
<a name="3779"><span class="lineNum">    3779 </span>            :     since a null facet duplicates the first two vertices, the opposing neighbors absorb the null facet</a>
<a name="3780"><span class="lineNum">    3780 </span>            :     if they are already neighbors, the opposing neighbors become MRGmirror facets</a>
<a name="3781"><span class="lineNum">    3781 </span>            : */</a>
<a name="3782"><span class="lineNum">    3782 </span><span class="lineNoCov">          0 : void qh_triangulate_mirror(qhT *qh, facetT *facetA, facetT *facetB) {</span></a>
<a name="3783"><span class="lineNum">    3783 </span>            :   facetT *neighbor, *neighborB;</a>
<a name="3784"><span class="lineNum">    3784 </span>            :   int neighbor_i, neighbor_n;</a>
<a name="3785"><span class="lineNum">    3785 </span>            : </a>
<a name="3786"><span class="lineNum">    3786 </span><span class="lineNoCov">          0 :   trace3((qh, qh-&gt;ferr, 3022, &quot;qh_triangulate_mirror: delete mirrored facets f%d and f%d and link their neighbors\n&quot;,</span></a>
<a name="3787"><span class="lineNum">    3787 </span>            :          facetA-&gt;id, facetB-&gt;id));</a>
<a name="3788"><span class="lineNum">    3788 </span><span class="lineNoCov">          0 :   FOREACHneighbor_i_(qh, facetA) {</span></a>
<a name="3789"><span class="lineNum">    3789 </span><span class="lineNoCov">          0 :     neighborB= SETelemt_(facetB-&gt;neighbors, neighbor_i, facetT);</span></a>
<a name="3790"><span class="lineNum">    3790 </span><span class="lineNoCov">          0 :     if (neighbor == facetB &amp;&amp; neighborB == facetA)</span></a>
<a name="3791"><span class="lineNum">    3791 </span><span class="lineNoCov">          0 :       continue; /* occurs twice */</span></a>
<a name="3792"><span class="lineNum">    3792 </span><span class="lineNoCov">          0 :     else if (neighbor-&gt;redundant &amp;&amp; neighborB-&gt;redundant) { /* also mirrored facets (D5+) */</span></a>
<a name="3793"><span class="lineNum">    3793 </span><span class="lineNoCov">          0 :       if (qh_hasmerge(qh-&gt;degen_mergeset, MRGmirror, neighbor, neighborB))</span></a>
<a name="3794"><span class="lineNum">    3794 </span><span class="lineNoCov">          0 :         continue;</span></a>
<a name="3795"><span class="lineNum">    3795 </span>            :     }</a>
<a name="3796"><span class="lineNum">    3796 </span><span class="lineNoCov">          0 :     if (neighbor-&gt;visible &amp;&amp; neighborB-&gt;visible) /* previously deleted as mirrored facets */</span></a>
<a name="3797"><span class="lineNum">    3797 </span><span class="lineNoCov">          0 :       continue;</span></a>
<a name="3798"><span class="lineNum">    3798 </span><span class="lineNoCov">          0 :     qh_triangulate_link(qh, facetA, neighbor, facetB, neighborB);</span></a>
<a name="3799"><span class="lineNum">    3799 </span>            :   }</a>
<a name="3800"><span class="lineNum">    3800 </span><span class="lineNoCov">          0 :   qh_willdelete(qh, facetA, NULL);</span></a>
<a name="3801"><span class="lineNum">    3801 </span><span class="lineNoCov">          0 :   qh_willdelete(qh, facetB, NULL);</span></a>
<a name="3802"><span class="lineNum">    3802 </span><span class="lineNoCov">          0 : } /* triangulate_mirror */</span></a>
<a name="3803"><span class="lineNum">    3803 </span>            : </a>
<a name="3804"><span class="lineNum">    3804 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="3805"><span class="lineNum">    3805 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;triangulate_null&quot;&gt;-&lt;/a&gt;</a>
<a name="3806"><span class="lineNum">    3806 </span>            : </a>
<a name="3807"><span class="lineNum">    3807 </span>            :   qh_triangulate_null(qh, facetA)</a>
<a name="3808"><span class="lineNum">    3808 </span>            :     remove null facetA from qh_triangulate_facet()</a>
<a name="3809"><span class="lineNum">    3809 </span>            :       a null facet has vertex #1 (apex) == vertex #2</a>
<a name="3810"><span class="lineNum">    3810 </span>            :   returns:</a>
<a name="3811"><span class="lineNum">    3811 </span>            :     adds facetA to -&gt;visible for deletion after qh_update_vertexneighbors</a>
<a name="3812"><span class="lineNum">    3812 </span>            :     qh-&gt;degen_mergeset contains mirror facets (4-d and up only)</a>
<a name="3813"><span class="lineNum">    3813 </span>            :   design:</a>
<a name="3814"><span class="lineNum">    3814 </span>            :     since a null facet duplicates the first two vertices, the opposing neighbors absorb the null facet</a>
<a name="3815"><span class="lineNum">    3815 </span>            :     if they are already neighbors, the opposing neighbors will be merged (MRGmirror)</a>
<a name="3816"><span class="lineNum">    3816 </span>            : */</a>
<a name="3817"><span class="lineNum">    3817 </span><span class="lineCov">      28810 : void qh_triangulate_null(qhT *qh, facetT *facetA) {</span></a>
<a name="3818"><span class="lineNum">    3818 </span>            :   facetT *neighbor, *otherfacet;</a>
<a name="3819"><span class="lineNum">    3819 </span>            : </a>
<a name="3820"><span class="lineNum">    3820 </span><span class="lineCov">      28810 :   trace3((qh, qh-&gt;ferr, 3023, &quot;qh_triangulate_null: delete null facet f%d\n&quot;, facetA-&gt;id));</span></a>
<a name="3821"><span class="lineNum">    3821 </span><span class="lineCov">      28810 :   neighbor= SETfirstt_(facetA-&gt;neighbors, facetT);</span></a>
<a name="3822"><span class="lineNum">    3822 </span><span class="lineCov">      28810 :   otherfacet= SETsecondt_(facetA-&gt;neighbors, facetT);</span></a>
<a name="3823"><span class="lineNum">    3823 </span><span class="lineCov">      28810 :   qh_triangulate_link(qh, facetA, neighbor, facetA, otherfacet);</span></a>
<a name="3824"><span class="lineNum">    3824 </span><span class="lineCov">      28810 :   qh_willdelete(qh, facetA, NULL);</span></a>
<a name="3825"><span class="lineNum">    3825 </span><span class="lineCov">      28810 : } /* triangulate_null */</span></a>
<a name="3826"><span class="lineNum">    3826 </span>            : </a>
<a name="3827"><span class="lineNum">    3827 </span>            : #else /* qh_NOmerge */</a>
<a name="3828"><span class="lineNum">    3828 </span>            : void qh_triangulate(qhT *qh) {</a>
<a name="3829"><span class="lineNum">    3829 </span>            :   QHULL_UNUSED(qh)</a>
<a name="3830"><span class="lineNum">    3830 </span>            : }</a>
<a name="3831"><span class="lineNum">    3831 </span>            : #endif /* qh_NOmerge */</a>
<a name="3832"><span class="lineNum">    3832 </span>            : </a>
<a name="3833"><span class="lineNum">    3833 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="3834"><span class="lineNum">    3834 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;vertexintersect&quot;&gt;-&lt;/a&gt;</a>
<a name="3835"><span class="lineNum">    3835 </span>            : </a>
<a name="3836"><span class="lineNum">    3836 </span>            :   qh_vertexintersect(qh, verticesA, verticesB )</a>
<a name="3837"><span class="lineNum">    3837 </span>            :     intersects two vertex sets (inverse id ordered)</a>
<a name="3838"><span class="lineNum">    3838 </span>            :     vertexsetA is a temporary set at the top of qh-&gt;qhmem.tempstack</a>
<a name="3839"><span class="lineNum">    3839 </span>            : </a>
<a name="3840"><span class="lineNum">    3840 </span>            :   returns:</a>
<a name="3841"><span class="lineNum">    3841 </span>            :     replaces vertexsetA with the intersection</a>
<a name="3842"><span class="lineNum">    3842 </span>            : </a>
<a name="3843"><span class="lineNum">    3843 </span>            :   notes:</a>
<a name="3844"><span class="lineNum">    3844 </span>            :     only called by qh_neighbor_intersections</a>
<a name="3845"><span class="lineNum">    3845 </span>            :     if !qh.QHULLfinished, non-simplicial facets may have f.vertices with extraneous vertices</a>
<a name="3846"><span class="lineNum">    3846 </span>            :       cleaned by qh_remove_extravertices in qh_reduce_vertices</a>
<a name="3847"><span class="lineNum">    3847 </span>            :     could optimize by overwriting vertexsetA</a>
<a name="3848"><span class="lineNum">    3848 </span>            : */</a>
<a name="3849"><span class="lineNum">    3849 </span><span class="lineNoCov">          0 : void qh_vertexintersect(qhT *qh, setT **vertexsetA, setT *vertexsetB) {</span></a>
<a name="3850"><span class="lineNum">    3850 </span>            :   setT *intersection;</a>
<a name="3851"><span class="lineNum">    3851 </span>            : </a>
<a name="3852"><span class="lineNum">    3852 </span><span class="lineNoCov">          0 :   intersection= qh_vertexintersect_new(qh, *vertexsetA, vertexsetB);</span></a>
<a name="3853"><span class="lineNum">    3853 </span><span class="lineNoCov">          0 :   qh_settempfree(qh, vertexsetA);</span></a>
<a name="3854"><span class="lineNum">    3854 </span><span class="lineNoCov">          0 :   *vertexsetA= intersection;</span></a>
<a name="3855"><span class="lineNum">    3855 </span><span class="lineNoCov">          0 :   qh_settemppush(qh, intersection);</span></a>
<a name="3856"><span class="lineNum">    3856 </span><span class="lineNoCov">          0 : } /* vertexintersect */</span></a>
<a name="3857"><span class="lineNum">    3857 </span>            : </a>
<a name="3858"><span class="lineNum">    3858 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="3859"><span class="lineNum">    3859 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;vertexintersect_new&quot;&gt;-&lt;/a&gt;</a>
<a name="3860"><span class="lineNum">    3860 </span>            : </a>
<a name="3861"><span class="lineNum">    3861 </span>            :   qh_vertexintersect_new(qh, verticesA, verticesB )</a>
<a name="3862"><span class="lineNum">    3862 </span>            :     intersects two vertex sets (inverse id ordered)</a>
<a name="3863"><span class="lineNum">    3863 </span>            : </a>
<a name="3864"><span class="lineNum">    3864 </span>            :   returns:</a>
<a name="3865"><span class="lineNum">    3865 </span>            :     a new set</a>
<a name="3866"><span class="lineNum">    3866 </span>            : </a>
<a name="3867"><span class="lineNum">    3867 </span>            :   notes:</a>
<a name="3868"><span class="lineNum">    3868 </span>            :     called by qh_checkfacet, qh_vertexintersect, qh_rename_sharedvertex, qh_findbest_pinchedvertex, qh_neighbor_intersections</a>
<a name="3869"><span class="lineNum">    3869 </span>            :     if !qh.QHULLfinished, non-simplicial facets may have f.vertices with extraneous vertices</a>
<a name="3870"><span class="lineNum">    3870 </span>            :        cleaned by qh_remove_extravertices in qh_reduce_vertices</a>
<a name="3871"><span class="lineNum">    3871 </span>            : */</a>
<a name="3872"><span class="lineNum">    3872 </span><span class="lineNoCov">          0 : setT *qh_vertexintersect_new(qhT *qh, setT *vertexsetA, setT *vertexsetB) {</span></a>
<a name="3873"><span class="lineNum">    3873 </span><span class="lineNoCov">          0 :   setT *intersection= qh_setnew(qh, qh-&gt;hull_dim - 1);</span></a>
<a name="3874"><span class="lineNum">    3874 </span><span class="lineNoCov">          0 :   vertexT **vertexA= SETaddr_(vertexsetA, vertexT);</span></a>
<a name="3875"><span class="lineNum">    3875 </span><span class="lineNoCov">          0 :   vertexT **vertexB= SETaddr_(vertexsetB, vertexT);</span></a>
<a name="3876"><span class="lineNum">    3876 </span>            : </a>
<a name="3877"><span class="lineNum">    3877 </span><span class="lineNoCov">          0 :   while (*vertexA &amp;&amp; *vertexB) {</span></a>
<a name="3878"><span class="lineNum">    3878 </span><span class="lineNoCov">          0 :     if (*vertexA  == *vertexB) {</span></a>
<a name="3879"><span class="lineNum">    3879 </span><span class="lineNoCov">          0 :       qh_setappend(qh, &amp;intersection, *vertexA);</span></a>
<a name="3880"><span class="lineNum">    3880 </span><span class="lineNoCov">          0 :       vertexA++; vertexB++;</span></a>
<a name="3881"><span class="lineNum">    3881 </span>            :     }else {</a>
<a name="3882"><span class="lineNum">    3882 </span><span class="lineNoCov">          0 :       if ((*vertexA)-&gt;id &gt; (*vertexB)-&gt;id)</span></a>
<a name="3883"><span class="lineNum">    3883 </span><span class="lineNoCov">          0 :         vertexA++;</span></a>
<a name="3884"><span class="lineNum">    3884 </span>            :       else</a>
<a name="3885"><span class="lineNum">    3885 </span><span class="lineNoCov">          0 :         vertexB++;</span></a>
<a name="3886"><span class="lineNum">    3886 </span>            :     }</a>
<a name="3887"><span class="lineNum">    3887 </span>            :   }</a>
<a name="3888"><span class="lineNum">    3888 </span><span class="lineNoCov">          0 :   return intersection;</span></a>
<a name="3889"><span class="lineNum">    3889 </span>            : } /* vertexintersect_new */</a>
<a name="3890"><span class="lineNum">    3890 </span>            : </a>
<a name="3891"><span class="lineNum">    3891 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="3892"><span class="lineNum">    3892 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;vertexneighbors&quot;&gt;-&lt;/a&gt;</a>
<a name="3893"><span class="lineNum">    3893 </span>            : </a>
<a name="3894"><span class="lineNum">    3894 </span>            :   qh_vertexneighbors(qh)</a>
<a name="3895"><span class="lineNum">    3895 </span>            :     for each vertex in qh.facet_list,</a>
<a name="3896"><span class="lineNum">    3896 </span>            :       determine its neighboring facets</a>
<a name="3897"><span class="lineNum">    3897 </span>            : </a>
<a name="3898"><span class="lineNum">    3898 </span>            :   returns:</a>
<a name="3899"><span class="lineNum">    3899 </span>            :     sets qh.VERTEXneighbors</a>
<a name="3900"><span class="lineNum">    3900 </span>            :       nop if qh.VERTEXneighbors already set</a>
<a name="3901"><span class="lineNum">    3901 </span>            :       qh_addpoint() will maintain them</a>
<a name="3902"><span class="lineNum">    3902 </span>            : </a>
<a name="3903"><span class="lineNum">    3903 </span>            :   notes:</a>
<a name="3904"><span class="lineNum">    3904 </span>            :     assumes all vertex-&gt;neighbors are NULL</a>
<a name="3905"><span class="lineNum">    3905 </span>            : </a>
<a name="3906"><span class="lineNum">    3906 </span>            :   design:</a>
<a name="3907"><span class="lineNum">    3907 </span>            :     for each facet</a>
<a name="3908"><span class="lineNum">    3908 </span>            :       for each vertex</a>
<a name="3909"><span class="lineNum">    3909 </span>            :         append facet to vertex-&gt;neighbors</a>
<a name="3910"><span class="lineNum">    3910 </span>            : */</a>
<a name="3911"><span class="lineNum">    3911 </span><span class="lineCov">          8 : void qh_vertexneighbors(qhT *qh /* qh.facet_list */) {</span></a>
<a name="3912"><span class="lineNum">    3912 </span>            :   facetT *facet;</a>
<a name="3913"><span class="lineNum">    3913 </span>            :   vertexT *vertex, **vertexp;</a>
<a name="3914"><span class="lineNum">    3914 </span>            : </a>
<a name="3915"><span class="lineNum">    3915 </span><span class="lineCov">          8 :   if (qh-&gt;VERTEXneighbors)</span></a>
<a name="3916"><span class="lineNum">    3916 </span><span class="lineNoCov">          0 :     return;</span></a>
<a name="3917"><span class="lineNum">    3917 </span><span class="lineCov">          8 :   trace1((qh, qh-&gt;ferr, 1035, &quot;qh_vertexneighbors: determining neighboring facets for each vertex\n&quot;));</span></a>
<a name="3918"><span class="lineNum">    3918 </span><span class="lineCov">          8 :   qh-&gt;vertex_visit++;</span></a>
<a name="3919"><span class="lineNum">    3919 </span><span class="lineCov">         81 :   FORALLfacets {</span></a>
<a name="3920"><span class="lineNum">    3920 </span><span class="lineCov">         73 :     if (facet-&gt;visible)</span></a>
<a name="3921"><span class="lineNum">    3921 </span><span class="lineCov">         11 :       continue;</span></a>
<a name="3922"><span class="lineNum">    3922 </span><span class="lineCov">        248 :     FOREACHvertex_(facet-&gt;vertices) {</span></a>
<a name="3923"><span class="lineNum">    3923 </span><span class="lineCov">        186 :       if (vertex-&gt;visitid != qh-&gt;vertex_visit) {</span></a>
<a name="3924"><span class="lineNum">    3924 </span><span class="lineCov">         47 :         vertex-&gt;visitid= qh-&gt;vertex_visit;</span></a>
<a name="3925"><span class="lineNum">    3925 </span><span class="lineCov">         47 :         vertex-&gt;neighbors= qh_setnew(qh, qh-&gt;hull_dim);</span></a>
<a name="3926"><span class="lineNum">    3926 </span>            :       }</a>
<a name="3927"><span class="lineNum">    3927 </span><span class="lineCov">        186 :       qh_setappend(qh, &amp;vertex-&gt;neighbors, facet);</span></a>
<a name="3928"><span class="lineNum">    3928 </span>            :     }</a>
<a name="3929"><span class="lineNum">    3929 </span>            :   }</a>
<a name="3930"><span class="lineNum">    3930 </span><span class="lineCov">          8 :   qh-&gt;VERTEXneighbors= True;</span></a>
<a name="3931"><span class="lineNum">    3931 </span>            : } /* vertexneighbors */</a>
<a name="3932"><span class="lineNum">    3932 </span>            : </a>
<a name="3933"><span class="lineNum">    3933 </span>            : /*-&lt;a                             href=&quot;qh-poly_r.htm#TOC&quot;</a>
<a name="3934"><span class="lineNum">    3934 </span>            :   &gt;-------------------------------&lt;/a&gt;&lt;a name=&quot;vertexsubset&quot;&gt;-&lt;/a&gt;</a>
<a name="3935"><span class="lineNum">    3935 </span>            : </a>
<a name="3936"><span class="lineNum">    3936 </span>            :   qh_vertexsubset( vertexsetA, vertexsetB )</a>
<a name="3937"><span class="lineNum">    3937 </span>            :     returns True if vertexsetA is a subset of vertexsetB</a>
<a name="3938"><span class="lineNum">    3938 </span>            :     assumes vertexsets are sorted</a>
<a name="3939"><span class="lineNum">    3939 </span>            : </a>
<a name="3940"><span class="lineNum">    3940 </span>            :   note:</a>
<a name="3941"><span class="lineNum">    3941 </span>            :     empty set is a subset of any other set</a>
<a name="3942"><span class="lineNum">    3942 </span>            : */</a>
<a name="3943"><span class="lineNum">    3943 </span><span class="lineNoCov">          0 : boolT qh_vertexsubset(setT *vertexsetA, setT *vertexsetB) {</span></a>
<a name="3944"><span class="lineNum">    3944 </span><span class="lineNoCov">          0 :   vertexT **vertexA= (vertexT **) SETaddr_(vertexsetA, vertexT);</span></a>
<a name="3945"><span class="lineNum">    3945 </span><span class="lineNoCov">          0 :   vertexT **vertexB= (vertexT **) SETaddr_(vertexsetB, vertexT);</span></a>
<a name="3946"><span class="lineNum">    3946 </span>            : </a>
<a name="3947"><span class="lineNum">    3947 </span>            :   while (True) {</a>
<a name="3948"><span class="lineNum">    3948 </span><span class="lineNoCov">          0 :     if (!*vertexA)</span></a>
<a name="3949"><span class="lineNum">    3949 </span><span class="lineNoCov">          0 :       return True;</span></a>
<a name="3950"><span class="lineNum">    3950 </span><span class="lineNoCov">          0 :     if (!*vertexB)</span></a>
<a name="3951"><span class="lineNum">    3951 </span><span class="lineNoCov">          0 :       return False;</span></a>
<a name="3952"><span class="lineNum">    3952 </span><span class="lineNoCov">          0 :     if ((*vertexA)-&gt;id &gt; (*vertexB)-&gt;id)</span></a>
<a name="3953"><span class="lineNum">    3953 </span><span class="lineNoCov">          0 :       return False;</span></a>
<a name="3954"><span class="lineNum">    3954 </span><span class="lineNoCov">          0 :     if (*vertexA  == *vertexB)</span></a>
<a name="3955"><span class="lineNum">    3955 </span><span class="lineNoCov">          0 :       vertexA++;</span></a>
<a name="3956"><span class="lineNum">    3956 </span><span class="lineNoCov">          0 :     vertexB++;</span></a>
<a name="3957"><span class="lineNum">    3957 </span>            :   }</a>
<a name="3958"><span class="lineNum">    3958 </span>            :   return False; /* avoid warnings */</a>
<a name="3959"><span class="lineNum">    3959 </span>            : } /* vertexsubset */</a>
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.14</a></td></tr>
  </table>
  <br>

</body>
</html>
